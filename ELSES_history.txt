--------------------------------------------------------------------------------
ELSES history
--------------------------------------------------------------------------------
***************************************************
2016/11/19
ELSES v0.06.04 Released (elses-v0.06.04-20161119-XXXXXXX-rel.zip)
(commit番号後日追加)
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/11/19(commit番号後日追加) 'ELSES v0.06.04 / Update the update log (ELSES_history.txt)'
担当者名 星健夫

更新ファイル
ELSES_history.txt

概要：
supercell maker用のsample fileを追加。

説明：
(commit番号後日追加)
Date:  Nov 19, 2016 
'ELSES v0.06.04 / Update the update log (ELSES_history.txt)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/09/29(a93278b) 'Add a sample file for the supercell maker (mk_supercell_xyz.f90)'
担当者名 星健夫

新規ファイル
tool/experimental/mk_supercell_xyz/CNT_w_cell_info.xyz

概要：
supercell maker用のsample fileを追加。

説明：
実験的ツール
tool/experimental/mk_supercell_xyz/mk_supercell_xyz.f90
用のsample fileを追加。
(注：mk_supercell_xyz.f90は、ELSES make時には、compileされない)

詳細メモ：
single-wall CNT(1本鎖,周期系)のsupercellを作るときにつかう。
(Ref: 更新記録2013/04/02)
使い方の例：z方向(CNTの軸方向) 112倍に伸ばしたsupercellを作りたい時。
tool/experimental/mk_supercell_xyz/で、以下を行う
(1) mk_supercell_xyz.f90をcompileする。例：
$ gfortran mk_supercell_xyz.f90 
(2) 下記コマンドを実行
$ ./a.out -nx=1 -ny=1 -nz=112 -filename_input=CNT_w_cell_info.xyz 
-filename_output=CNT_sucercell.xyz -comment=CNT_supercell_1_1_112
下記が標準出力ででる。
@@@ mk_supecell_xyz.f90 (build 20160215)
 NOTE: This code uses GET_COMMAND_ARGUMENT defined in Fortran2003
 @@@ Read the paramters from the argument
 INFO:supercell sizes  =            1           1         112
 INFO:filename input   = CNT_w_cell_info.xyz
 INFO:filename output  = CNT_sucercell.xyz
 INFO:comment line     = CNT_supercell_1_1_112
@@@ Input file : structure_org.xyz
 -->      N        =       100
 -->  ax,ay,az [A] =       10.0000000000       10.0000000000       
12.2900000000
@@@ Output file : structure_new.xyz
 -->      N        =     11200
 -->  ax,ay,az [A] =       10.0000000000       10.0000000000     
1376.4800000000
@@@ Generate the output file
.... mk_supecell_xyz.f90 (build 20160215) ended without error
注：できあがったCNT supercell系(CNT_sucercell.xyz)の冒頭は下記：
          11200       10.0000000000       10.0000000000     1376.4800000000
CNT_supercell_1_1_112
C        -1.37999999999999989342        3.10000000000000008882       
-4.91000000000000014211
C        -0.69999999999999995559        3.31999999999999984013       
-3.68000000000000015987
C        -3.37000000000000010658       -0.34999999999999997780       
-4.91000000000000014211
C        -3.37000000000000010658        0.34999999999999997780       
-3.68000000000000015987

メモ：
追加ファイル
CNT_w_cell_info.xyz
は、100原子のcell infoつきxyzファイル。
冒頭分は下記：
100 10.0d0 10.0d0 12.29d0
CNT 
C -1.38  3.10 -4.91
C -0.70  3.32 -3.68
C -3.37 -0.35 -4.91
C -3.37  0.35 -3.68
C -2.94  1.70 -3.68
cell infoが付いていることをのぞけば、
sample/sample_non_geno/CNT100atom_dyn/CNT.xyz
と同じファイル。

Git での更新：
commit a93278b
Date:  Sep 29, 2016 
'Add a sample file for the supercell maker (mk_supercell_xyz.f90)'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/09/29(a93278b)
担当者名 星健夫

新規ファイル
tool/experimental/mk_supercell_xyz/CNT_w_cell_info.xyz

概要：
supercell maker用のsample fileを追加。

説明：
実験的ツール
tool/experimental/mk_supercell_xyz/mk_supercell_xyz.f90
用のsample fileを追加。
(注：mk_supercell_xyz.f90は、ELSES make時には、compileされない)

詳細メモ：
single-wall CNT(1本鎖,周期系)のsupercellを作るときにつかう。
(Ref: 更新記録2013/04/02)
使い方の例：z方向(CNTの軸方向) 112倍に伸ばしたsupercellを作りたい時。
tool/experimental/mk_supercell_xyz/で、以下を行う
(1) mk_supercell_xyz.f90をcompileする。例：
$ gfortran mk_supercell_xyz.f90 
(2) 下記コマンドを実行
$ ./a.out -nx=1 -ny=1 -nz=112 -filename_input=CNT_w_cell_info.xyz 
-filename_output=CNT_sucercell.xyz -comment=CNT_supercell_1_1_112
下記が標準出力ででる。
@@@ mk_supecell_xyz.f90 (build 20160215)
 NOTE: This code uses GET_COMMAND_ARGUMENT defined in Fortran2003
 @@@ Read the paramters from the argument
 INFO:supercell sizes  =            1           1         112
 INFO:filename input   = CNT_w_cell_info.xyz
 INFO:filename output  = CNT_sucercell.xyz
 INFO:comment line     = CNT_supercell_1_1_112
@@@ Input file : structure_org.xyz
 -->      N        =       100
 -->  ax,ay,az [A] =       10.0000000000       10.0000000000       
12.2900000000
@@@ Output file : structure_new.xyz
 -->      N        =     11200
 -->  ax,ay,az [A] =       10.0000000000       10.0000000000     
1376.4800000000
@@@ Generate the output file
.... mk_supecell_xyz.f90 (build 20160215) ended without error
注：できあがったCNT supercell系(CNT_sucercell.xyz)の冒頭は下記：
          11200       10.0000000000       10.0000000000     1376.4800000000
CNT_supercell_1_1_112
C        -1.37999999999999989342        3.10000000000000008882       
-4.91000000000000014211
C        -0.69999999999999995559        3.31999999999999984013       
-3.68000000000000015987
C        -3.37000000000000010658       -0.34999999999999997780       
-4.91000000000000014211
C        -3.37000000000000010658        0.34999999999999997780       
-3.68000000000000015987

メモ：
追加ファイル
CNT_w_cell_info.xyz
は、100原子のcell infoつきxyzファイル。
冒頭分は下記：
100 10.0d0 10.0d0 12.29d0
CNT 
C -1.38  3.10 -4.91
C -0.70  3.32 -3.68
C -3.37 -0.35 -4.91
C -3.37  0.35 -3.68
C -2.94  1.70 -3.68
cell infoが付いていることをのぞけば、
sample/sample_non_geno/CNT100atom_dyn/CNT.xyz
と同じファイル。

Git での更新：
commit a93278b
Date:  Sep 29, 2016 
'Add a sample file for the supercell maker (mk_supercell_xyz.f90)'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/09/29(e0d77be)
担当者名 星健夫

更新ファイル
src/elses-ini-load-geno.f90

概要：
restart tagについてのエラー検出ルーチンを追加。

説明：
設定XMLファイルのoutput/restartタグは、
他のoutput関連タグ(output/positionなど)を使うときには必須なので、
これに違反している場合にエラーで止まるようにした。
例：positionタグがあるのにrestartタグがない場合。
 ERROR:Incompatible XML setting:The restart tag is requied for the position 
tag
というエラーがでてabortする。

Git での更新：
commit e0d77be
Date:  Sep 29, 2016 
'Error checking routine with the restart tag'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/09/29(cc1b879)
担当者名 星健夫

更新ファイル
src/elses-md-output.f90
src/elses-qm-output-atom-charge.f90
src/elses-qm-solver-gkrylov-dst.f90

概要：
atom chargeのファイル出力の更新

説明：
DST workflowかつgKrylov利用の場合にも、
atom charge file出力ができるようになった。

詳細：
atom_chargeタグの使い方は、更新[09/25](be85533)を参照。
ただし、DST workflowかつgKrylov利用の場合、
interaction範囲内の原子数は出力されない(dummy値「-1」になる)。

メモ：
DST workflowかつgKrylov利用において、以下の2点がポイント：
(1) gKrylov solverにおいて、
if (config%output%atom_charge%set) calc_charge = .true. 
 (elses-qm-solver-gkrylov-dst.f90)
を追加。つまり、atom_chargeタグがあるときには、
chargeを(配列として)生成する(MDには不要だが)。
(2) atom chargeの出力は、10万原子未満のときに限っている。
（原理的にはもっと大きくても良いが、メモリを食う恐れがあるので、制限をつけている）
この値は、以下で設定できる：
integer, parameter :: num_atom_for_small_output=100000 
 (elses-md-output.f90)

Git での更新：
commit cc1b879
Date:  Sep 29, 2016 
'Update the file output for atom charge in DST workflow and gKrylov'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/09/25(be85533)
担当者名 星健夫

更新ファイル
sample/sample_geno/C6H6_opt/config.xml
src/elses-md-output.f90
src/elses-qm-output-atom-charge.f90
src/elses-xml-config.f90

概要：
atom chargeのファイル出力の更新

説明：
atom charge(atomごとのマリケンチャージ)の出力方法の詳細を更新
設定XMLファイルのoutputタグ内に、下記を書く：
<atom_charge filename="output_atom_charge.txt" mode="last" />
使用例として、以下に記載：
sample/sample_geno/C6H6_opt/config.xml

詳細：
atom_chargeタグで可能な属性の一覧
filename：ファイル名(必須)
mode："first"(最初のiteration), "last"(最後のiteration), 
"periodic(定期)", "default"(="last")
interval：出力するiteration interval
      (毎iterationごとに出力したいときは、1、に設定）

Git での更新：
commit be85533
Date:  Sep 26, 2016 
'Update the file output for atom charge'
--------------------------------------------------------------------------------
***************************************************
2016/09/18
ELSES v0.06.03 Released (elses-v0.06.03-20160902-0cc29dd-rel.zip)
Note: identical to RC2
***************************************************
--------------------------------------------------------------------------------
更新記録 2016/09/18(eeeb77a)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90

概要
matrix generation modeでの微修正

Git での更新：
commit 59942a1
Date:  Sep 11, 2016 
'Tiny modification on the matrix generation mode'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 2016/09/11(59942a1)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90

概要
matrix generation modeでの微修正

Git での更新：
commit 59942a1
Date:  Sep 11, 2016 
'Tiny modification on the matrix generation mode'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/09/18(eeeb77a)
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.06.03→v0.06.04)

Git での更新：
commit eeeb77a
Date:  Sep 18, 2016 
'Update the version number (v0.06.03 --> v0.06.04)'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
新記録 2016/09/11(59942a1)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90

概要
matrix generation modeでの微修正

Git での更新：
commit 59942a1
Date:  Sep 11, 2016 
'Tiny modification on the matrix generation mode'
--------------------------------------------------------------------------------
***************************************************
2016/09/02
ELSES v0.06.03 Release Candidate  2
elses-v0.06.03-201600902-0cc29dd-rc.tgz
***************************************************--------------------------------------------------------------------------------
日付 2016/09/02(0cc29dd)
担当者名 星健夫

更新ファイル
ELSES_history.txt

概要
ELSES v0.06.03RC2 / Update the update log (ELSES_history.txt). 

Git での更新：
commit 0cc29dd
Date:  Sep 02, 2016 
'ELSES v0.06.03RC2 / Update the update log (ELSES_history.txt)'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](40b1b91)
担当者名 井町宏人

更新ファイル：
src/elses-qm-geno-output.f90
src/elses-qm-output-participation.f90

概要：
eigen_mpi ソルバーにおいて output_participation.txt の出力が正しく行われるようにした。

詳細：
『ELSES更新[09/01] eigen_mpi ソルバーにおける output_wavefunction 出力の修正』
(commit 0e86f3d) と同様の、eigen_mpi ソルバーで固有ベクトルが分散行列形式で保持されていることへの対応。
ただし、output_participation.txt出力の条件判定に使われていた変数i_verboseの値が
rootノードとそれ以外で一貫しておらず、デッドロックの原因になっていたため、
この条件判定自体を一時的にコメントアウトしてある：
src/elses-qm-geno-output.f90 l.176
       !if (i_verbose >= 1) then  ! Comment out because i_verbose is not global and distributed operation fails.

Git での更新：
commit 40b1b91
Date:  Sep 1, 2016 
'Support output of participation ratios in eigen_mpi solver'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](487dbd5)
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-output-basis-info.f90

概要：
basis informationの書き出し機能の強化。

解説(update)：
使い方は、設定XMLファイルのoutputタグ内に書く。例：
<basis_info filename="output_basis_information.txt" mode="first"/>
・filename：省略不可。
・mode：「first」「last」「default(=last)」が設定可。省略可。
指定されたファイルにbasis informationを出力する。
ここでいうbasis informationとは、
「output_wavefunctionファイルにおいて、LCAO係数をのぞいたもの」
である。
modeが「first」「last」時には、それぞれ、
最初・最後のiteration時に出力される。

Git での更新：
commit 487dbd5
Date:  Sep. 01, 2016 
'Enhance file output for basis information'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](83ad6b1) 
担当者名 星健夫

更新ファイル：
src/code_optional/elses-la-eigen-solver-main-dummy.f90
src/elses-la-eigen-solver-main.f90 (上記ファイルのdead copy)


概要：
9/1更新(0e86f3d)への修正。

解説：
9/1更新(0e86f3d)において、
src/code_optional/elses-la-eigen-solver-main-true.f90
が更新されたが、ここで
src/code_optional/elses-la-eigen-solver-main-dummy.f90
もupdateが必要だったが、そうなっていなかったので、修正。

Git での更新：
commit 83ad6b1
Date:  Sep. 01, 2016 
'Modify for the update at 09/01(0e86f3d) '
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](0e86f3d) 
担当者名 井町宏人

更新ファイル：
src/Makefile.dep
src/code_optional/elses-la-eigen-solver-main-true.f90
src/elses-md-main.f90
src/elses-qm-geno-output.f90
src/elses-qm-output-eigenstates.f90

概要：
eigen_mpi ソルバーにおいて output_wavefunction の出力が正しく行われるようにした。

詳細：
eigen_mpi ソルバーでは、計算した固有ベクトルを分散行列の形で持つため、
分散行列に対応した出力処理を実装する必要があった。
既存の出力処理が実装された src/elses-qm-output-eigenstates.f90 に、
分散行列からベクトル1本ごとにrootノードに集める処理を追加することでこれを実現した。
一度に行列全体を集めないのはメモリ量制限を回避するためである。
また、既存の出力処理ではメインループが書かれた src/elses-md-main.f90 の時点で
rootノードのみで処理を行わせる分岐が存在したが、分散行列を扱う必要上これを外した。

Git での更新：
commit 0e86f3d
Date:  Aug 30, 2016 
'Support output_wavefunction in eigen_mpi solver'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](83ad6b1) 
担当者名 星健夫

更新ファイル：
src/code_optional/elses-la-eigen-solver-main-dummy.f90
src/elses-la-eigen-solver-main.f90 (上記ファイルのdead copy)


概要：
9/1更新(0e86f3d)への修正。

解説：
9/1更新(0e86f3d)において、
src/code_optional/elses-la-eigen-solver-main-true.f90
が更新されたが、ここで
src/code_optional/elses-la-eigen-solver-main-dummy.f90
もupdateが必要だったが、そうなっていなかったので、修正。

Git での更新：
commit 83ad6b1
Date:  Sep. 01, 2016 
'Modify for the update at 09/01(0e86f3d) '
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](41befb0) 
担当者名 星健夫

更新ファイル：
src/Makefile.dep

概要：
微修正
(Makefile.dep更新)

Git での更新：
commit 41befb0
Date:  Sep. 01, 2016 
'Tiny modification (update of src/Makefile.dep)'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](ea592c5) 
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-output.f90
src/elses-qm-output-basis-info.f90
src/ELSES_history.txt (更新ログを追加しただけ)

概要：
basis informationの書き出し機能の追加。

メモ：
Wavetool(波束解析ツール)での利用を想定。

解説：
使い方は、設定XMLファイルのoutputタグ内に、以下のように書く。
<basis_info filename="output_basis_information.txt" />
(注：ファイル名は任意)。
最終iteration(固定)で、指定されたファイルにbasis informationを出力する。
ここでいうbasis informationとは、
「output_wavefunctionファイルにおいて、LCAO係数をのぞいたもの」
である。

Git での更新：
commit ea592c5
Date:  Sep. 01, 2016 
'Added: File output for basis information'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/09/01](0e86f3d) 
担当者名 井町宏人

更新ファイル：
src/Makefile.dep
src/code_optional/elses-la-eigen-solver-main-true.f90
src/elses-md-main.f90
src/elses-qm-geno-output.f90
src/elses-qm-output-eigenstates.f90

概要：
eigen_mpi ソルバーにおいて output_wavefunction の出力が正しく行われるようにした。

詳細：
eigen_mpi ソルバーでは、計算した固有ベクトルを分散行列の形で持つため、
分散行列に対応した出力処理を実装する必要があった。
既存の出力処理が実装された src/elses-qm-output-eigenstates.f90 に、
分散行列からベクトル1本ごとにrootノードに集める処理を追加することでこれを実現した。
一度に行列全体を集めないのはメモリ量制限を回避するためである。
また、既存の出力処理ではメインループが書かれた src/elses-md-main.f90 の時点で
rootノードのみで処理を行わせる分岐が存在したが、分散行列を扱う必要上これを外した。

Git での更新：
commit 0e86f3d
Date:  Aug 30, 2016 
'Support output_wavefunction in eigen_mpi solver'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/08/30](532c758) 
担当者名 井町宏人

更新ファイル：
Makefile.inc

概要：
ifort と gfortran 向けに、推奨するデバッグオプションを Makefile.inc に追加した。
各オプションの簡単な解説を付す。


GNU Fortran コンパイラのデバッグオプション指定
-O0 -g -Wall -Wno-unused -Wno-unused-dummy-argument -ffpe-trap=invalid,zero,overflow -fbounds-check -fbacktrace -fopenmp

https://gcc.gnu.org/onlinedocs/gcc/Invoking-GCC.html
から説明を引用
-O0: (最適化しない)
-g: Produce debugging information in the operating system's native format.
-Wall: Enables commonly used warning options pertaining to usage that we recommend avoiding and that we believe are easy to avoid.
-Wno-unused, -Wno-unused-dummy-argument: (変数・仮引数の未使用に対する警告をオフ (数が多くて他の警告が見づらくなるため))
-ffpe-trap=list: Specify a list of floating point exception traps to enable.
-fbounds-check: For front ends that support it, generate additional code to check that indices used to access arrays are within the declared range.
-fbacktrace: (バックトレースを生成)
なお、I/O のバッファリングを無効にするには (コンパイル時ではなく) プログラムの実行時に GFORTRAN_UNBUFFERED_ALL=1 をつけます。


Intel Fortran コンパイラのデバッグオプション指定
-g -debug -traceback -assume nobuffered_io -check -ftrapuv -warn all,nounused -qopenmp

https://www.xlsoft.com/jp/products/intel/compilers/manual/14/for/index.htm
から説明を引用
-g: ソースレベルのデバッガーで使用するため、オブジェクト・コードの中にシンボリック・デバッグ情報と行番号を生成します。O2 をオフにして -O0 をデフォルトにします
-traceback: コンパイラーがオブジェクト・ファイルに追加情報を生成するので、シンボリック・スタック・トレースバックが可能になります。
-debug: 詳細なデバッグ情報を生成します。
-assume nobuffered_io: 内部バッファーにあるデータは直ちにディスクから読み込まれるか、ディスクに書き込まれ (フラッシュされ) ます。
-check: すべての check オプションを有効にします。 https://www.xlsoft.com/jp/products/intel/compilers/manual/14/for/GUID-AFB42D1D-FE3D-42CD-B703-9A7AA602ED12.htm
-ftrapuv: エラー検出を行いやすくするように、ローカル変数を異常な値に初期化します。
-warn: https://www.xlsoft.com/jp/products/intel/compilers/manual/14/for/GUID-E2601B5C-430F-4614-9008-DB669E4C97C6.htm

Git での更新：
commit 532c758
Date:  Aug 30, 2016 
'Add recommended debug options for ifort and gfortran'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
更新記録 [2016/08/30] (829631b)  
担当者名 星健夫

更新ファイル：
src/elses-ini-load-common.f90

概要：
微修正

Git での更新：
commit 829631b
Date:  Aug 30, 2016 
'A small modification on src/elses-ini-load-common.f90'
--------------------------------------------------------------------------------
***************************************************
2016/08/27
ELSES v0.06.03 Release Candidate  
elses-v0.06.03-201600827-e992688-rc.tgz
***************************************************
--------------------------------------------------------------------------------
日付 2016/08/27(2)
担当者名 星健夫

更新ファイル
ELSES_history.txt

概要
ELSES v0.06.03RC1 / The update log (ELSES_history.txt) was updated. 

Git での更新：
commit e992688
Date:  Aug 27, 2016 
'ELSES v0.06.03RC1 / The update log (ELSES_history.txt) was updated.'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/08/27
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

概要
バージョン番号更新(v0.06.02→v0.06.03)

Git での更新：
commit 10a317c
Date:  Aug 27, 2016 
'The version number was updated from v0.06.02 into v0.06.03'
--------------------------------------------------------------------------------
***************************************************
2016/08/26
ELSES v0.06.02 Released (elses-v0.06.01-201600505-rel.tgz)
Note: identical to RC1
***************************************************
--------------------------------------------------------------------------------
日付 2016/08/26
担当者名 星健夫

更新ファイル
src/elses-md-save-restart-xml.f90

概要
restart XML fileへの出力追加。

詳細
restart XML fileに、total number of atomsを出力追加。例：
<total_number_of_atoms> 12 </total_number_of_atoms>

Git での更新：
commit 1fdf85e
Date:  Aug 26, 2016 
'Add information into the restart XML file'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/08/18
担当者名 星健夫

更新ファイル
src/elses-ini-set-str-from-vatom.f90
src/elses-md-velocity-dst.f90
src/elses-md-velocity-routines.f90

概要
一部原子固定のダイナミクス計算法の更新。

Git での更新：
commit e990ec6
Date:  Aug 18, 2016 
'Dynamics mode with fixed atoms was updated'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/08/17(2)
担当者名 星健夫

更新ファイル
src/elses-xml-compat-check.f90

概要
8/15更新(commit b0ed69)で入ったbugを fix。

Git での更新：
commit def7d79
Date:  Aug 17, 2016 
'A bug in the commit b0ed69c in Aug 15. 2016 was fixed'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/08/17
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

概要
8/15更新(commit b0ed69)で入ったbugを fix。

Git での更新：
commit d9f6c99
Date:  Aug 15, 2016 
'A bug in the commit b0ed69c in Aug 15. 2016 was fixed'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/08/15
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-md-save-restart-xml.f90
src/elses-xml-compat-check.f90
src/elses-xml-config.f90

概要
連番XMLファイルよるrestartをサポートした。

使い方：
restart tagに「mode」属性を追加する。
「overwrite」「sequential」「append」が指定できる。
defaultは「overwrite」。
(1) overwrite mode
<restart  filename="restart.xml" interval="10" mode="overwrite" />
単一XMLファイル(restart.xml)に上書きされる。
ELSESの入力XMLファイルとして、そのまま使える。
(2) sequential mode 
<restart  filename="restart.xml" interval="10" mode="sequential" />
連番XMLファイルに記録される。
restart_step00000000.xml
restart_step00000010.xml
restart_step00000020.xml
(以下同様)
ELSESの入力XMLファイルとして、そのまま使える。
(3) append mode 
<restart  filename="restart.xml" interval="10" mode="append" />
単一XMLファイル(restart.xml)に追記される。
ELSESの入力XMLファイルとして、そのままでは使えない！！！
(詳細は、ELSESノート機能編Sec. 2.6)

注：「append mode」属性は、legacy 属性として、非推奨(廃止予定)。
<restart  filename="restart.xml" interval="10" append_mode="on" />
上記(3)のように「mode」属性で指定すべき。

Git での更新：
commit b0ed69c
Date:  Aug 15, 2016 
'Sequantial XML files are supported for restart'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/08/04(2)
担当者名 星健夫

新規ファイル
tool/plot_eigenstates/src/elses-lib-math-cubic-harmonics.f90
tool/plot_eigenstates/src/elses-lib-sto-radial-func.f90

更新ファイル
tool/plot_eigenstates/src/elses-generate-cubefile.f90
tool/plot_eigenstates/src/Makefile (上記の2つの新規ファイルを追記しただけ)
tool/plot_eigenstates/src/Makefile.dep


概要：
generate-cubeの更新。

詳細：
Irなど、原子番号が大きいものにも対応。
ただし、s,p,d軌道のみ(f以上は非対応)。

メモ：
r=0での０割りを避けるため、
・modified STO radial function      : R(r) / r^l
・modified cubic spherical function : r^l Q(x/r, y/r, z/r)
を用意して、両者の積として表現している。

git での更新：
commit 01244e2
Date:  Aug 4, 2016 
'elses-generate-cube is updated'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/08/04
担当者名 星健夫

更新ファイル
src/elses-md-save-struct.f90
src/Makefile.dep

概要：
ファイル出力機能の拡張。

詳細：
ファイル出力できる原子種名を増やした。
Irなど、原子番号が大きいものにも対応。

メモ：
古いルーチン
get_atomic_num (elses-md-save-struct.f90)
を新しいルーチン
get_atomic_num [M_lib_element_database] (elses-lib-element-name.f90)
へのwrapperに置き換え。
原子番号86(Rn)まで、対応。

git での更新：
commit 5f4bd0e
Date:  Aug 3, 2016 
'The function for file output is slightly improved'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/07/14
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-geno-Huckel-atom-parameters.f90

概要：
checking option for element XML fileを追加

詳細：
element XML fileの存在を陽にチェックするoptionを追加できる。
element tag内に「filecheck="on"」という属性を追加すれば良い。
例：
<element  name="O" model="geno"  filename="O_test.xml" filecheck="on" />

上記で「off」にすると、チェックされない。default設定は「off」

checkがonになっていると、当該ファイル(上記例ではO_test.xml)がない場合は、
以下のメッセージが標準出力にでてabortする
 ERROR:element XML file is missing : element name=O

checking optionが有効になっていることは、node logで確認できる：
例えば、DOM parserなら、
INFO-XML-DOM:Optional tag detected : element file check:O
SAX parserなら、
INFO-XML-SAX:Optional tag detected : element file check:O

追記：
チェックのon/offは、elementごとに指定する。
例：
<element  name="C" model="geno"  filename="C_test.xml" />
<element  name="H" model="geno"  filename="H_test.xml" filecheck="off"/>
<element  name="O" model="geno"  filename="O_test.xml" filecheck="on" />
上記の場合、Oのelement fileのみがチェックされる。
C,Hについてはチェックされず、ELSES default parameterが読み込まれる：
その場合、以下のようなmessageが、node logに出力される；
INFO-XML:Load_XML_AtomParameter: *** Warning!!! *** Failed to open data 
file C.xml
INFO-XML:Load_XML_AtomParameter: *** Warning!!! *** Failed to open data 
file H.xml

git での更新：
commit db8c50e
Date:  Jul 14, 2016 
'Add the checking option for element XML file'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/07/12
担当者名 星健夫

更新ファイル
src/elses-qm-dst-domain.f90

概要：
標準出力&node logメッセージの微修正。
機能に違いはなし。

git での更新：
commit fe5d426
Date:  Jul 12, 2016 
'The messages for log files are slightly modified in 
elses-qm-dst-domain.f90'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/13
担当者名 井町宏人

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/code_optional/elses-la-eigen-solver-main-true.f90
src/code_optional/elses-qm-wavepacket-main-true.f90

概要：
wavepacketの初期値設定オプション追加への対応。

詳細：
wavepacketの摂動行列の生成方法のうちいくつかでは、
行列が状態ベクトルに依存しないため、複数の状態ベクトルに対する計算を同時に実行できる。
それぞれを独立に実行するよりも大幅に計算時間を削減可能なため、これを実装した。
複数の初期状態ベクトルを、固有状態番号の列挙により指定可能である。
例：
  <wave_packet mode="on">
    <initialization type="alpha_delta_multiple">
      <alpha_delta_multiple_indices> 1790,1795,1797 
</alpha_delta_multiple_indices>
    </initialization>

git での更新：
commit 2bc53625486c5ec1147d5b901d94e22662035d57
Date:   Mon Jun 13 02:20:43 2016 +0900
'Support multiple initial states mode in wavepacket'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/13
担当者名 井町宏人

更新ファイル
src/elses-xml-config.f90
src/code_optional/elses-qm-wavepacket-main-true.f90

概要：
wavepacketの行列入れ替え時オプション追加への対応。

詳細：
wavepacketの行列入れ替え部分に、
従来のminimize_lcao_error_matrix_suppressの変種の手法2種
minimize_lcao_error_matrix_suppress_orthogonal (変換行列を最も近い直交行列に修正する)
minimize_lcao_error_matrix_suppress_adaptive (遷移の制限を適応的に行う)
を追加し、これをELSESとの連携において利用可能にした。

git での更新：
commit f1426cf204af732c298d7f869a0015d21c675efa
Date:   Mon Jun 13 02:19:43 2016 +0900
'Support two new re-initialization methods with suppressed matrix in 
wavepacket'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/12
担当者名 井町宏人

更新ファイル
src/elses-la-matvec-dstm-dens.f90

概要：
行列の対称性を利用した行列ベクトル積ルーチンの採用。

詳細：
gKrylov_Aソルバーの行列ベクトル積手法にdensを選択した際、
これまでは実際の行列ベクトル積計算にLAPACKのDGEMVルーチンを使用していたが、
行列が実対称であることから、対称性を利用して高速に計算できるDSYMVに変更した。

git での更新：
commit 1584567eca047d9ea6ff5f4b703b2d9115c8ad2a
Date:   Sun Jun 12 20:32:39 2016 +0900
'Use DSYMV instead of DGEMV in dens matvec mode'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/12
担当者名 井町宏人

更新ファイル
src/elses-md-motion.f90

概要：
dst_bench_modeの修正の再適用。

詳細：
以下の更新がgit上のリポジトリに反映されていなかった点を修正。
----------
日付 2016/05/17
担当者名 星健夫

更新ファイル
src/elses-md-motion.f90

概要：
dst_bench_modeの修正。

詳細：
dst_bench_modeでは、
cell_change_only 計算時に座標が更新されないことがある問題を修正。
----------
git での更新：
commit 44ac0f27518b71de2d5b8b8d167e2d1116a0a114
Date:   Sun Jun 12 20:30:47 2016 +0900
'Fix a bug skipping MD procedure in cell_change_only mode with 
dst_bench_mode'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/12
担当者名 井町宏人

更新ファイル
src/code_optional/elses-qm-wavepacket-main-true.f90
src/elses-xml-config.f90

概要：
wavepacketの行列入れ替え時オプション追加への対応。

詳細：
wavepacketの行列入れ替え部分に、
固有状態間の遷移を、固有値の差の大きさをもとに制限する手法
(minimize_lcao_error_matrix_suppress)を追加し、
これをELSESとの連携において利用可能にした。
例：
  <wave_packet mode="on">
    <re_initialize type="minimize_lcao_error_matrix_suppress">
      <suppress_const>10000.0</suppress_const>
    </re_initialize>

git での更新：
commit caca374b37fbe1bbe5f0b5fd9c20292f40fc11bf
Date:   Sun Jun 12 20:08:44 2016 +0900
'Add a new suppression type mode for re-initialization, 
minimize_lcao_error_matrix_suppress, and use a variable suppress_constant 
for suppression type modes'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/12
担当者名 井町宏人

更新ファイル
src/code_optional/elses-qm-wavepacket-main-true.f90

概要：
wavepacketの変数追加への対応。

詳細：
wavepacketの行列入れ替え部分の変更により、1ステップ前の行列H, Sが必要となったため、
これらを保持する処理を追加した。

git での更新：
commit df2eb6bffdee8264a8cb6b6014fa0d1b0c08f138
Date: Jun 12 20:20:03 2016 +0900
'Save Hamiltonian and overlap matrices of the previous MD time step for 
some modes of re-initialization'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/16
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90
src/elses-xml-sax-handler.f90

概要：
append modeの構造XMLファイルを読み込んだ場合には、
errorで止まるようにする

詳細：
DOMでの読み込んだ場合には、標準出力に以下がでて止まる
ERROR:<structure_history> was found in the XML file and is not supported
SAXでの読み込んだ場合には、標準出力に以下がでて止まる
ERROR(XML-SAX):<structure_history> was found in the XML file and is not 
supported

解説：
append modeでrestart XMLファイルを記録した場合、そのまま次の入力には使えない。
1snapshot分のデータを引き抜いたXMLファイルを作る必要がる。

0,1番目のsnapshopが入っている場合の例
----------------------------------------------------------
append modeでのXMLファイル 
----------------------------------------------------------
<?xml version="1.0" encoding="UTF-8"?>
<structure_history>
<structure name="test" mdstep="                   0">
（ 0番目のsnapshot分のデータ)
 </structure>
<structure name="test" mdstep="                   1">
（ 1番目のsnapshot分のデータ)
</structure>
</structure_history>
----------------------------------------------------------
append modeでない(入力に使える)XMLファイル
----------------------------------------------------------
<?xml version="1.0" encoding="UTF-8"?>
<structure name="test" mdstep="                   1">
（ 1番目のsnapshot分のデータ)
</structure>
----------------------------------------------------------
git上更新
Commits on Jun 16, 2016 (941b850)
'Error detection in the initial read of the structure XML file within the 
append mode'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/06/15
担当者名 星健夫

更新ファイル
src/elses-md-velocity-routines.f90

概要：
初期velocityの設定方法の修正(dst_benchmark_modeむけ更新)

詳細：
dst_bench_modeでは、
初期velocityは強制的に乱数から生成するようにする。
（XMLファイルにvelocity dataがあっても無視される）。
一方dst_bench_mode以外では、MD計算では、
XMLファイルにmeaningfulな(non-zeroな)
velocity dataがあれば、採用される。

参考2：
03/27更新で、
「常に、XMLファイルにvelocity dataがあっても無視される」
という仕様になってしまっていたので、それに対する修正

git更新
Commits on Jun 15, 2016 
commit 2f494a3234202a3d40ef744e8af1ffd8abbdf620
'Modified on elses-md-velocity-routines.f90 for forced initialization of 
velocity data'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/17(2)
担当者名 星健夫

更新ファイル
src/Makefile

概要：
gitでの管理にむけての準備

詳細：
make時に
「bin/ディレクトリがなければ、作る」
操作を追加。

メモ：
gitは、空のdirectoryを登録できない。
bin/は(makeする前は)空のディレクトリなので、
make時に作る仕様にした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/17
担当者名 星健夫

更新ファイル
src/elses-md-motion.f90

概要：
dst_bench_modeの修正。

詳細：
dst_bench_modeでは、
cell_change_only 計算時に座標が更新されないことがある問題を修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/16
担当者名 井町宏人

更新ファイル
src/code_optional/elses-qm-wavepacket-main-true.f90
src/elses-config.f90
src/elses-xml-config.f90


概要：
wavepacket の、行列入れ替え後に、固有状態表現のベクトルを直接見て広がりを抑えるのではなく、
固有状態への変換行列の非対角要素を小さくすることで広がりの抑制を実現する手法の実装への対応。


詳細：
固有状態表現のベクトルを直接見て広がりを抑える既存手法である minimize_lcao_error_suppress 
とパラメーター変数を共有する形で、
変換行列の非対角要素を小さくする新機能 minimize_lcao_error_matrix_suppress を実装した。
変更点は、抑制の強さを決めるパラメーターの XML からの読み込みと wavepacket への受け渡し部分のみ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/12(2)
担当者名 井町宏人

更新ファイル
src/code_optional/elses-la-eigen-solver-main-true.f90
src/elses-qm-output-levels.f90

概要：
バージョンelses-v0.06.02-20160511r1-devに存在した、
非並列に呼ばれるブロックにMPI並列を意図したコードが
含まれるためデッドロックが発生するバグを修正した。

詳細：
バージョンelses-v0.06.02-20160511r1-devでは、
eigen_mpiスキームで計算後eigen_levelを出力する際に
qm_output_levelsサブルーチン内で呼ばれる、
participation ratioを計算するルーチン
set_pratio_mpiが、MPI並列化されているにも関わらず、
(rootノード以外のファイル出力を抑止するために)
その部分にrootノードしか到達しないようになっていたため、
デッドロックが発生していた。
これを回避するため、set_pratio_mpiが呼ばれるのを、
固有値問題を解いた直後の(並列に呼ばれる)位置に
移動するという修正を行った。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/12(1)
担当者名 井町宏人

更新ファイル
src/code_optional/elses-qm-wavepacket-main-true.f90

概要：
wavepacketの、type(wp_state_t)型の変数stateの導入により
各種状態変数を隠蔽するという変更に対応した。

詳細：
以前のバージョンでは状態を表す各種変数が
ELSES側に生で見えていたため、wavepacketを呼び出すELSES側の記述が
煩雑であったのを、状態変数の隠蔽により簡潔にした。
また、これ以降wavepacketに変更があった場合に
ELSES側のソースも変更しなければならない場面が少なくなるはずである。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/11(3)
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-output-eigenstates.f90

概要
wavefunction(LCAO係数)出力機能の強化。
出力するlevelを指定できるようにした。

使用法
config XMLファイル中に、wavefunctionタグの属性として「level_lowest」「level_highest」を設定する。

例：
<output>
  <wavefunction filename="output_wavefunction.txt" level_lowest="2" 
level_highest="10" />
</output>
設定情報は、verbose modeで実行したさい、node logに下記のように出力される。
 INFO-XML:optional attirbute:wavefunction/level_lowest   =           2
 INFO-XML:optional attirbute:wavefunction/level_highest  =          10
出来上がったファイルoutput_wavefunction.txtでは、
以下のようにk=2~10の9個のLCAOベクトルが出力される。
(冒頭略)
# LCAO coefficients
         9
         1        0.322855006102656   k=         2
         2       -0.024892067024446   k=         2
         3        0.055413814858069   k=         2
         4        0.003997634354396   k=         2
(中略)
        28       -0.018626941085877   k=        10
        29       -0.027168330428638   k=        10
        30        0.016358159216596   k=        10
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/11(2)
担当者名 星健夫

更新ファイル
src/elses-md-main.f90

概要
eigen_mpiモード向け更新

詳細
以下のルーチンは、root nodeのみで呼ばれるようにした。
これらは、非並列のファイル出力ルーチン。


CallTree抜粋
- elses_md_main_01
|   + output_levels_matrices ←
|   + output_for_eigen_solver ←
|   + output_for_wfn_charge ←
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/11
担当者名 井町宏人

更新ファイル
src/code_optional/elses-la-eigen-solver-main-true.f90
src/code_optional/elses-qm-wavepacket-main-true.f90
src/elses-la-eigen-solver-main.f90
src/elses-mod-eig-leg.f
src/elses-qm-output-levels.f90
src/elses-qm-solver-eig-geno.f90
src/code_optional/elses-la-eigen-solver-main-dummy.f90
src/code_optional/elses-qm-wavepacket-main-dummy.f90
src/elses-qm-wavepacket-main.f90

概要：
eigen_mpiソルバー使用時における、固有ベクトル行列全体をノード間で冗長に持つ部分の削除
および、wavepacket 2016/05/11 版のインターフェース変更への追従


詳細：
以前のバージョンでは、eigen_mpiソルバー使用時に、
固有対の計算後に固有ベクトル行列全体を冗長に持つ設計になっていたため、
計算規模がメモリ量に制約されていた。
固有ベクトルは、そのPaticipation ratioと、密度行列の計算のみに使われるので、
それらを分散行列形式のまま並列に計算することで、固有ベクトル行列を冗長に持つ必要をなくした。
src/code_optional/elses-la-eigen-solver-main-true.f90 内の、
set_pratio_mpiがParticipation ratioの計算ルーチン、
set_density_matrix_mpiが密度行列の計算ルーチンである。

これらのルーチンへの分散固有ベクトル行列データの受け渡しのため、
module elses_arr_eig_legに以下の2つの変数が追加されている。
         integer              :: desc_eigenvectors(9)
         real*8,  allocatable :: eigenvectors(:,:)
set_pratio_mpiによるParticipation ratioの計算結果は、
同モジュールに従来からあるatmp変数の1列目に格納されるようになっている。

wavepacket 2016/05/11 版のインターフェース変更とは、
以前のバージョンでは、ハミルトニアンおよび重なり行列H、Sや各種ベクトル変数を
分散密行列形式で保持していたのを、(行列については疎行列形式のままにすることで)
ノード間で冗長に持つようにしたというものである。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/10(2)
担当者名 星健夫

更新ファイル
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/elses-lib-mpi-wrapper-compile.f90
(上記ファイルのdead copy)

詳細：
不要モジュール変数を削除。
機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/10
担当者名 星健夫

更新ファイル
src/elses-lib-timer-in-thread.f90
src/elses-la-matvec-dstm-crs.f90
src/elses-la-matvec-dstm-dens.f90
src/elses-la-matvec-dstm-sss.f90
src/elses-la-matvec-routines-dstm.f90
src/elses-md-main.f90

概要：
matvec_timer_in_threadの機能強化。
総時間だけでなく、呼び出し回数もカウントするようにした。

詳細：
module M_lib_timer_in_thread (elses-lib-timer-in-thread.f90) における
モジュール変数：matvec_timer_in_thread(n_threads,1:2)
→内容：
・matvec_timer_in_thread(n_threads,1): matvecの時間の総計
・matvec_timer_in_thread(n_threads,2): matvecの呼び出し回数の総計
--------------------------------------------------------------------------------
***************************************************
2016/05/05
ELSES v0.06.02 Release Candidate  (elses-v0.06.02-20160505-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
日付 2016/05/05(2)
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.06.01→v0.06.02)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/05
担当者名 星健夫

更新ファイル
Makefile
src/elses-ini-set-str-from-matom.f90

概要：
use_matomにおける、OpenMP計算の修正。
3/21更新が不十分だったの修正。
--------------------------------------------------------------------------------
***************************************************
2016/05/03
ELSES v0.06.01 Released (elses-v0.06.01-20160218-rc2.tgz)
Note: identical to RC2
***************************************************
--------------------------------------------------------------------------------
日付 2016/05/03
担当者名 星健夫

更新ファイル:
src/code_for_mpi/elses-lib-mpi-wrapper.f90

概要：
5/2(2)更新の修正(timerルーチン)。

詳細：
node log, 標準出力にでる
「Total simulation time」の表示が、
DST workflowでは不正だったので修正。
計算結果や他の経過時間データ(MDloopなど)は、問題なし。

メモ：
timerルーチンは、
elses-lib-wall-clock-time.f90 [モジュール：M_wall_clock_time]
に含まれる、下記の2種がある。
(1) get_system_clock_time
時刻をsecで出力。時間原点は、systemが決めている。
(2) get_elapse_wall_clock_time
初回よばれた時刻を時間原点として、経過時間をsec単位で出力。
(1)(2)とも、MPI true routineを使う場合、実体は
MPI_wtimeに帰着されるが、dummy routineを使う場合は、
system_clockに帰着される。
後者の問題点としては、
・低精度(システム依存だが、典型的にはmsec精度)
・(1)にはtimerがresetされる危険性
がある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/01(2)
担当者名 星健夫

更新ファイル:
src/elses-lib-wall-clock-time.f90
src/elses-md-main.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/elses-lib-mpi-wrapper-compile.f90 
(注：elses-lib-mpi-wrapper-dummy.f90のdead copy)

概要：
timerルーチンの整備。
MPIライブラリがtrue routineの時は、
mpi_wtimeに帰着させるようにした。

メモ：
MPIライブラリがtrue routineの時は、
従来通り、
system_clock
に帰着させるようになっている。

メモ2：
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
は、使用するuse文が同一である必要がある。
そうでないと、Make depしたときに、consistencyがとれない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/05/01
担当者名 星健夫

更新ファイル:
src/elses-md-velocity-dst.f90

概要：
4/30(4)(5)更新への修正
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/30(5)
担当者名 星健夫

更新ファイル:
src/elses-md-motion.f90
src/elses-md-velocity-dst.f90

概要：
4/30(4)更新への修正
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/30(4)
担当者名 星健夫

更新ファイル:
src/elses-md-motion.f90
src/elses-md-velocity-dst.f90

概要：
dst_bench_modeの強化

詳細：
dst_bench_modeでは、
globalなvelocity変数(velx, vely, velz)の
(allreduceをともなう)更新をやめた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/30(3)
担当者名 星健夫

更新ファイル:
src/elses-md-motion.f90
src/elses-md-velocity-dst.f90
src/elses-ini-set-str-from-vatom.f90

概要：
dst_bench_modeの強化。

メモ：
(tx, ty, tz)は廃止していく方向。
dst_bench_modeでは、以下のように廃止。
(txp,typ,tzp) → atm_position
を使う。なお、現状のdst_bench_modeでの有限温度MDは、
・(tx, ty, tz)が更新されない
・config以下のpositionなどが更新されない
（故にファイル出力が正しくできない）
の状況にある。

CallTree抜粋
- elses_md_main_01
|   - ini_load_geno
|   |   - ini_load_common
|   |   |   - set_structure_data
|   |   |   |   + set_structure_data_from_vatom
|   |   |   |   - set_atm_position_from_tx←DST_BENCH_MODEではtxpからコピー
|   - qm_engine_dst
|   |   - qm_domain_setting_dst
|   |   |   - set_atm_position_from_tx←DST_BENCH_MODEではtxpからコピー
|   - elses_md_motion
|   |   - md_motion_verlet_position_dst
|   |   |   + elses_gene_tx ←DST_BENCH_MODEではcallされず
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/30(2)
担当者名 星健夫

更新ファイル:
src/elses-config.f90
src/elses-xml-config.f90

概要：
dst_bench_modeの追加。
DST workflowのbenchmarkのみのためのモード。

詳細：
benchmarkで利用されない実験的ルーチンやそのための配列確保を、
全てskipする機能。defaultではOFF。
ONにするには、設定XMLファイルに「<dst_bench_mode />」を追加する。
例：
<distributed mode="on">
  <global_density_matrix_is_off /> 
  <global_hamiltonian_matrix_is_off /> 
  <micro_cell_booking mode="default"></micro_cell_booking>
<mat_vec>
    <mat_vec_mode>crs</mat_vec_mode> 
</mat_vec>
<dst_bench_mode />
</distributed>

コード情報：
以下のlogical variableで設定(defaultで.false.)
config%calc%distributed%dst_bench_mode
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/30
担当者名 星健夫

更新ファイル:
src/elses-md-main.f90
src/elses-md-motion.f90
src/elses-md-velocity-dst.f90

概要：
node logファイル出力の強化

詳細：
lap timeの解析に利用するために、timerを強化。
すべて、elses-md-main.f90における測定。
例えば、
$ grep -i time log-node000000.txt | grep -v mpi_check
として得られる、以下の部分：
TIME:qm_engine =        97.3410000000
TIME:detect_stop_signal =         0.0000000000
TIME:opt_check          =         0.0000000000
TIME:output_level_mat   =         0.0000000000
TIME:output_eigen_solv  =         0.0000000000
TIME:output_wfn_charge  =         0.0000000000
 TIME:mpi_time for convert velocity =   0.0000000000000000     
TIME:md_verlet_vel      =         0.0010000002
TIME:save_struct        =         0.0000000000
TIME:output_main        =         0.0000000000
 TIME:mpi_time for convert position:=   0.0000000000000000     
TIME:md_motion         =         0.0009999999

注：上記でMD計算に必須なのは、以下
(a) 量子的計算
→TIME:qm_engine
(b) 古典的計算のうちvelocity更新
→TIME:md_verlet_vel
注：(b)のうち、global変数のmpi_all_reduceにかかった時間
→TIME:mpi_time for convert velocity
(c) 古典的計算のうちposition更新
→TIME:md_motion
注：(b)のうち、global変数のmpi_all_reduceにかかった時間
→TIME:mpi_time for convert position
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/29(2)
担当者名 星健夫

更新ファイル:
src/elses-md-output.f90

概要：
node logファイル出力の強化

詳細：
Output.txtへの出力のうち、
「Energy summary (eV/atom):」の行を、node logにも出すようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/29
担当者名 星健夫

更新ファイル:
src/elses-md-motion.f90

概要：
4/28で混入したbugを修正。

詳細：
Cell-change-onlyでのkinetic energyが、
本来は0であるべきなのに、そうなっていなかったので、修正。
Cell-change-only以外には影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/28
担当者名 星健夫

新規ファイル:
src/elses-md-velocity-dst.f90

更新ファイル:
src/elses-md-main.f90
src/elses-md-motion.f90
src/elses-qm-engine-dst.f90
Makefile (上記新規ファイルを追記しただけ)

概要：
velocity計算部分を分散並列化。
モジュール変数
 vel_dst(3,noa_dst) [M_md_velocity_dst] (elses-md-velocity-dst.f90)
によって、分散してvelocityデータを格納。
今のところ、
従来から使っている、global変数(velx, vely, velz)も併用。

詳細：
(1) elses-md-velocity-dst.f90 [M_md_velocity_dst]
publicサブルーチン一覧
・subroutine convert_velocity(imode)
→velocity変数について、分散型変数とglobal型変数のconvert。
・subroutine calc_kinetic_energy_dst(kinetic_energy)
→分散型velocity変数を用いて、kinetic energyを計算。
calc_kinetic_energyの代替
・subroutine md_motion_verlet_velocity_dst(i_switch)
→分散型velocity変数を用いて、velocityを更新。dynamicsモードでのみ利用。
md_motion_verlet_velocityの代替。
・subroutine md_motion_verlet_position_dst
→分散型velocity変数を用いて、positonを更新。dynamicsモードでのみ利用。
  md_motion_verlet_positionの代替。
privateサブルーチン一覧
・subroutine md_heatbath_dst
→md_heatbathの代替
・subroutine calc_total_momentum_dst(total_momentum)
→calc_total_momentumの代替
・subroutine adjust_velocity_dst
→adjust_velocityの代替
・subroutine copy_velocity_config_to_vel_dst
→今のところ使っていない。

(2) elses-md-main.f90への更新のsummary
call md_motion_verlet_velocity
を
call md_motion_verlet_velocity_dst
に変更。

(3) elses-md-motion.f90への更新のsummary
call md_motion_verlet_position
を
call md_motion_verlet_position_dst
に変更。

(4) elses-qm-engine-dst.f90への更新のsummary
kinetic energyを(不要に)計算していたのを、やめた。
方針として、kinetic energyは、
velocityを更新した直後に、計算するようにする。

CallTree更新
- elses_md_main_01
|   - elses_ini_set_velocity
|   |   - calc_initial_velocity：ここはglobal変数を利用
|   |   |   - calc_kinetic_energy
|   |   |   - calc_total_momentum
|   |   |   + set_velocity_from_maxwell
|   |   |   - calc_kinetic_energy
|   |   |   + adjust_velocity
|   |   |   - calc_kinetic_energy
|   |   |   - calc_kinetic_energy
|   |   + convert_velocity ←新ルーチン
|   |   + calc_kinetic_energy_dst ←新ルーチン
|   |   + convert_velocity ←新ルーチン
|   - md_motion_verlet_velocity_dst ←新ルーチン
|   |   + md_heatbath_dst ←新ルーチン
|   |   + convert_velocity ←新ルーチン
|   |   + calc_kinetic_energy_dst ←新ルーチン
|   |   + calc_total_momentum_dst ←新ルーチン
|   |   + adjust_velocity_dst ←新ルーチン
|   - elses_md_motion
|   |   + md_motion_verlet_position_dst ←新ルーチン
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/25
担当者名 井町宏人

更新ファイル:
src/elses-config.f90
src/elses-xml-config.f90
src/code_optional/elses-qm-wavepacket-main-true.f90

概要：
(1)
config.xmlの<wave_packet>の子タグのひとつである<re_initialize>について、
その子タグ<suppress_const>を追加した。これはre_initializeのtype属性が
"minimize_lcao_error_suppress"であるときのみ読み込まれる。
この値は、wavepacket計算中の行列の入れ替え時に、
固有状態表現の状態ベクトルの小さい要素をより小さくし、純粋状態に近づける際のパラメーター。
(2)
wavepacket が構造データ中の酸素に非対応だったのを修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/04/20
担当者名 星健夫

更新ファイル:
src/elses-qm-output-icohp.f90

概要：
ICOHP出力(非DSTワークフロー)を、MPI対応にした。
rootノードでのみ、出力。

詳細：
- elses_md_main_01
|   - elses_qm_engine
|   |   + qm_output_icohp
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/30 (2)
担当者名 星健夫

更新ファイル:
src/elses-la-matvec-dstm-sss.f90

概要：
デバッグ用のコマンドがONになっていたので、
速度向上のため無効化
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/30 
担当者名 星健夫

新規ファイル:
src/elses-lib-timer-in-thread.f90

更新ファイル:
src/elses-lib-mpi-wrapper-compile.f90
src/elses-qm-solver-gkrylov-dst.f90
src/elses-la-gkrylov-main-dstm.f90
src/elses-md-main.f90
src/elses-la-matvec-dstm-crs.f90
src/elses-la-matvec-routines-dstm.f90
src/elses-la-matvec-dstm-sss.f90
src/elses-la-matvec-dstm-dens.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90

src/elses-lib-mpi-wrapper-compile.f90
(注：src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90のdead copy)
src/Makefile (上記新規ファイルを追記しただけ)
src/Makefile.dep

概要
DSTワークフローにおいて、
各stepごとに、matvec演算にかかった総時間を表示するようにした。
（非DSTワークフローには非対応）

詳細：
計算終了後、下記のようにすることで分かる。
$ grep MDl log-node000000.txt 
elaps-time(befor  MDloop)=              0       0.060000       0.000000     
  0.000000       0.000000
elaps-time(lap    MDloop)=              1      46.716000       0.000000     
  0.000000      15.578500
elaps-time(lap    MDloop)=              2      46.649000       0.000000     
  0.000000      16.088250
elaps-time(lap    MDloop)=              3      46.950000       0.000000     
  0.000000      16.144000
4つ目の値が、matvec演算の総時間(1stepごと)

matvec演算はOMP threadの内側で実行されるので、総時間はスレッドごとに別々に集計される。
上記にでている値は、それらの平均値である。
スレッドごとの値を出したければ、以下のようにする（4スレッドのときの出力）
$ grep 'INFO:matvec' log-node000000.txt
 INFO:matvec time per thread =           1           1   15.469000007724389     
 INFO:matvec time per thread =           1           2   15.553999993950129     
 INFO:matvec time per thread =           1           3   15.774000006495044 
 INFO:matvec time per thread =           1           4   15.516999998595566 
 INFO:matvec time per thread =           2           1   16.021999993827194 
 INFO:matvec time per thread =           2           2   16.092000002507120 
 INFO:matvec time per thread =           2           3   16.018999983323738 
 INFO:matvec time per thread =           2           4   16.219999993918464 
2つの整数値は、それぞれ、iteration, OMP thread index、の意味。

コードメモ1：
Timer変数は、モジュールM_lib_timer_in_threadにある、以下の変数
 real(8), allocatable :: matvec_timer_in_thread(:)
allocateするとmatvec_timer_in_thread(1:n)になる(nは総スレッド数)

コードメモ2：
スレッド番号(id_of_my_omp_thread, 0から始まる値)を下位のルーチンに送るようにした。
下記ルーチンに対して、
CallTree抜粋
- qm_solver_gkrylov_dst
|   - gkrylov_main_dstm
|   |   - calc_u_su_hu_crs
|   |   |   - matvec_mul_crs
|   |   - calc_u_su_hu_sss
|   |   |   - matvec_mul_sss
|   |   - calc_u_su_hu_dens
|   |   |   - matvec_mul_dens
|   |   - calc_u_su_hu_dstm
|   |   |   + matvec_mul_dstm
|   |   - cg_s_mat_dstm
|   |   |   + matvec_mul_dstm
|   |   - cg_s_mat_crs
|   |   |   - matvec_mul_crs
|   |   - cg_s_mat_sss
|   |   |   - matvec_mul_sss
|   |   - cg_s_mat_dens
|   |   |   - matvec_mul_dens
|   |   - cg_s_mat_dstm
|   |   |   + matvec_mul_dstm

メモ：
matvec演算の総時間を表示させないようにする方法は、
今のところソースコードを編集するしかない。具体的には、elses-md-main.f90における
       call init_timer_in_thread
をcomment outすれば良い。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/27
担当者名 星健夫

更新ファイル:
src/elses-md-velocity-routines.f90

概要：
初期速度ベクトル生成ルーチンのOMP並列化。

注：
この更新では、XMLファイルに速度ベクトルがあっても、無視されてしまう。
後日、修正予定。以下のflagを制御すれば良い。
forced_initialization = .true.

メモ：
elses-md-velocity-routines.f90にあるルーチンの一覧。
・set_zero_velocity_for_fixed_atoms：不使用(削除予定)
・calc_kinetic_energy
・calc_kin_ene_atom
・calc_total_momentum
・calc_total_momentum_abs
・adjust_velocity
・calc_initial_velocity
・set_velocity_from_maxwell
・allocate_velocity

上記のうち、set_velocity_from_maxwellは、OMP化しなかった。
乱数から初期速度ベクトルを生成するルーチンだが、
OMP化すると出力される乱数列が変わってしまうようだ。
当該部分をsimplifyしたもの：
do ioa=1,noa←ここでのOMP化が出来なかった。
  call rndu(rnd) 
enddo   
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/26
担当者名 星健夫

更新ファイル:
src/elses-xml-config.f90
src/elses-md-save-struct.f90

概要：
output/restartタグのdefault仕様修正。

詳細：
これまでoutputタグ内では、restartタグだけは、
defaultで(=当該タグが書かれていなくても)、
restart XMLファイルを生成していた。
これを修正し、
「restartタグを明示的に書かない限り、
restart XMLファイルは生成されない」
という仕様に変更。

メモ：
修正点を記す。

------------------------------------
修正前のelses-xml-config.f90(抜粋)
------------------------------------
! get <restart> node                                                       
                                             
node => getFirstElementByTagName(output_node,"restart")
output%restart%first_write = .true.
output%restart%append_mode = "off"
if( .not. associated(node) ) then
   output%restart%set = .true. ←ここ
   output%restart%filename = trim(config%option%output_dir)//"restart.xml"
   output%restart%interval = 10 ←ここ
   output%restart%split    = .false.
   output%restart%atom_id_is_added  = .false.
   output%restart%number_of_split_files  = -1
else
   call file_load( output%restart, node )
end if
------------------------------------
------------------------------------
修正後のelses-xml-config.f90(抜粋)
------------------------------------
! get <restart> node                                                       
                                             
node => getFirstElementByTagName(output_node,"restart")
output%restart%first_write = .true.
output%restart%append_mode = "off"
if( .not. associated(node) ) then
   output%restart%set = .false. ←ここ
   output%restart%filename = trim(config%option%output_dir)//"restart.xml"
   output%restart%interval = -1 ←ここ
   output%restart%split    = .false.
   output%restart%atom_id_is_added  = .false.
   output%restart%number_of_split_files  = -1
else
   call file_load( output%restart, node )
end if
------------------------------------
------------------------------------
修正後のsubroutine elses_md_save_struct (elses-md-save-struct.f90)
→以下を追加
------------------------------------
if (.not. config%output%restart%set) then
  if (i_verbose >= 1) then
    if (log_unit > 0) write(log_unit,*)'@@ elses_md_save_struct is 
SKIPPED:restart set=',config%output%restart%set
  endif
  return
endif
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/21
担当者名 星健夫

更新ファイル:
src/elses-ini-set-str-from-matom.f90

概要
初期処理のOMP並列化を強化
計算結果に影響なし。

詳細：
ルーチン
set_structure_data_from_matom
をOMP並列化。

CallTree抜粋
- elses_md_main_01
|   - ini_load_geno
|   |   - ini_load_common
|   |   |   - set_structure_data
|   |   |   |   - set_structure_data_from_matom
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/16(3)
担当者名 星健夫

新規ファイル:
src/elses-qm-dstm-reordering.f90

更新ファイル:
src/elses-qm-dst-projection-cell.f90
src/Makefile

概要
実験的機能：DST matvec演算むけreordering

詳細：
DSTワークフローでのmatvec演算高速化(可能性)のため、
原子indexの並び替えを行うルーチン。
有効にするには、今のところソースコード修正が必要。具体的には
subroutine set_dst_atm_list (elses-qm-dst-projection-cell.f90)
にある
logical, parameter :: flag_for_reordering = .false.
を
logical, parameter :: flag_for_reordering = .true.
と修正する。

メモ：
DSTワークフローでは、
各原子(以下「center原子」)の近傍原子をbookするが、
このbooking listでの順番いれかえを行う。
ただし、booking listの最初(1番目)は、
後の処理の都合上、center原子でなくてならならない。
2番目以降のみ、並びかえても計算結果に影響はない。
とりあえず現状では、
center原子からの距離が小さい順位にならべた。
この並べ方では、center原子は(距離=0なので)常に1番目になる。


CallTree
- elses_md_main_01
|   - qm_engine_dst
|   |   - qm_solver_gkrylov_dst
|   |   |   - set_dst_atm_list
|   |   |   |   - dst_get_atm_index_range
|   |   |   |   - suggest_proj_radius
|   |   |   |   + set_projection_dst_cell
|   |   |   |   + reorder_booked_atoms ←ここ
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/16(2)
担当者名 星健夫

更新ファイル:
src/elses-gid-initial.f90

概要
group id機能の修正。

詳細：
これまでは、強制的にgroup centerを計算していたが、
この計算は(今のところ)周期系には非対応。
そこで、周期系のときは、group centerの計算をやめることにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/16
担当者名 星健夫

更新ファイル:
src/elses-xml-sax-handler.f90

概要
group id機能の修正。

詳細：
SAX parserでは、
group idが読み込まれていなかったので、修正。

注：SAX parserでは、「tag damp属性」を追加する
例：<cluster structure="Polymer_PPE_144atom.xml" parser="sax" tag_dump="on" />
と、標準出力に、すべてのタグ(と一部の属性)がファイル出力される。
（tag_dump="off"とすれば、書かないのと同じ）
 position tag
INFO-XML-SAX:position(1:3)=        0.7736875800        0.0082801600       
 0.0171401200
 counter_atom (p) =         137
   element name =H       
   motion name =free    
   group_id    =          12
上記をみれば、読まれていない属性について、検討がつきやすい。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/15
担当者名 星健夫

更新ファイル:
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-solver-gkrylov-dst.f90
src/elses-qm-cohp-dstm.f90
src/elses-qm-cohp-dstm-plot.f90

概要
DST workflowでICOHPを出力。
この使い方は、DST workflowのときのみ。
使い方：
outputタグ内に、下記のように書く。
<bond_list filename="output_bond_list.txt" interval="2" 
criteria_in_eV="0.0001" />
有効になっているなら、以下のように確認できる。
$ grep bond_list log-node000000.txt 
INFO-XML:A optional tag is found : config%output%bond_list
属性criteria_in_eVは、ファイル出力のしきい値をeVで書く。
上記例だと、|(value)| >  0.0001 eV、のときのみ、プロットされる。
(criteria_in_eVの指定がないときは、しきい値=0.0001 eVに設定される。)
結果として、各スレッドが独立にファイル出力する。
output_bond_list000000_0000.txt
output_bond_list000000_0001.txt
・・
最初の6桁がMPI並列度数を、後ろの4桁の数字がOMP並列度数を表す。

出力ファイルの内容：
eV単位で、データをdumpする。
## distributed bond list ICOHP in eV : criteria (for abs. value) (eV) =     
    0.0001000000
## Ex. atom_index2, orbital_index1, atom_index1
## step_count =          0
1         1         1      -18.9687993602
         1         1       356       -3.0033680340
         1         1       508       -5.6286284142
         1         1       546       -1.8964870268
         1         1      1525       -2.3684634507
         1         2         1       -6.8245500335
         1         2       508       -0.4676993016
         1         2       546       -3.3807383647
orbitalに依存するICOHPは、
c(Iα,Jβ) ≡ ρ(Iα,Jβ) H(Jβ,Iα)
で定義される。ここで、I,Jがatom indexで、それぞれにおけるorbital indexがα、β
上記の量はαについてのみ和を取った
c'(Iα,J) ≡ Σ_β c(Iα,Jβ)
がプロットされている。
(atom_index2がJ, orbital_index1がα、atom_index1がI)
αについても和をとった値
C(I,J) ≡ Σ_{α,β} c(Iα,Jβ)
が本来のICOHPだが、これはpost処理として作りだす必要がある。

注：iCOHP値は合計すると、
電子構造エネルギー
E_{elec} = Tr[ρH]
になる。(小さい項は無視しているので、若干の値はあるだろうが）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/14
担当者名 星健夫

新規ファイル:
src/elses-la-matvec-dstm-sss.f90

更新ファイル:
src/elses-la-matvec-dstm-crs.f90
src/elses-la-gkrylov-main-dstm.f90
src/Makefile (上記新規ファイルを追記しただけ)

概要
DST workflowの疎行列ベクトル積に
Sparse Symmetric Skyline (SSS) format
を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/12
担当者名 星健夫 井町宏人

更新ファイル:
src/elses-options.f90

概要：
3/10(2)更新(「テストモード」の実装)が不十分だったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/10(3)
担当者名 星健夫

新規ファイル:
src/elses-qm-output-basis-info.f90
src/elses-qm-output-wfn-charge.f90

更新ファイル:
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-main.f90
src/Makefile (上記新規ファイルを追記しただけ)
tool/plot_eigenstates/src/elses-generate-cubefile.f90
sample/sample_geno/C6H6_opt/config.xml

概要
波動関数電荷(軌道依存Mulliken chargeのLCAO係数データ)の出力
config.xmlのoutputタグ内に以下のように書く。例：
<output>
  <wavefunction_charge filename="output_wfn_charge.txt" />
</output>
動作は、wavefunctionタグと同様。
例として、
sample/sample_geno/C6H6_opt/config.xml
がある。

メモ：
cubefileを作るときは「-absolute_value」をつける。例：
elses-generate-cubefile -absolute_value 
-lcao_coef_file=output_wfn_charge.txt -cutoff_au=5 
-cube_filename_header=wfn_charge 

メモ：ここでのchargeの定義は、基底ごとのmulliken charge q_iに対して
n(r) = \sum_i q_i | f_i(r) |
で定義されるもの。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/10(2)
担当者名 星健夫

更新ファイル:
src/elses-config.f90
src/elses-options.f90
src/elses-md-main.f90

概要：
初期処理だけを行う「テストモード」の実装。
設定XMLファイル、構造XMLファイルが正しく書けているか
などの、チェックを行うことを想定している。
 
詳細：
command argumentに「-test_mode=initial」をつけることで、発動。例：
./elses -test_mode=initial ./config.xml

メモ：
内部的には、MD loopの繰り返し回数を強制的に０に設定している。
elses-md-main.f90のソースコード概要
itemdmx=0 ←ここ
do itemd2=1,itemdmx
(MD loop)
enddo

メモ：
対応する構造体(elses-config.f90)は下記：
------------------------------------
type :: option_type
   character(len=256)  :: filename
   character(len=256)  :: directory     ! to be deleted                     
                                        
   character(len=256)  :: input_dir
   character(len=256)  :: output_dir
   integer             :: verbose       ! Old variable                     
                                         
   integer             :: verbose_level ! New variable (8. Feb. 2015)       
                                        
   integer             :: debug
   character(len=16)   :: functionality
   integer             :: log_node_number
   character(len=256)  :: test_mode ←追加
end type option_type
------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/10
担当者名 星健夫

更新ファイル:
src/elses-qm-output-participation.f90

概要
実験的機能の実装。
出力のためのdirectory名を設定する(継続)。
3/7更新の続き。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/09
担当者名 星健夫

更新ファイル:
src/elses-la-matvec-dstm-bcrs.f90

概要：
DST mat-vecのモードを導入の強化。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/07(2)
担当者名 星健夫

更新ファイル:
src/elses-xml-compat-check.f90

概要：
エラーチェック機能の強化。
計算機能に変更なし。

メモ：
設定XMLファイルのチェックルーチンは、
下記の
check_xml_compat (elses-xml-compat-check.f90)
で行っている。
今回は、use_matomタグを指定した場合のチェックを追加。

CallTree抜粋：
- elses_md_main_01
|   - ini_load_geno
|   |   + load_xml_config
|   |   - check_xml_compat ←ここ
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/07
担当者名 星健夫

更新ファイル:
src/elses-config.f90
src/elses-io-dst-write-log.f90
src/elses-options.f90
src/elses-xml-config.f90

概要
実験的機能の実装。
出力のためのdirectory名を設定する。

ただし、現状では、対応が確認されているファイルは、以下
・メイン出力ファイル(Output.txt)
・node logファイル
・outputタグ内の、以下のタグ；
restart, position, wavefunction, matrix_hamiltonian, matrix_overlap, 
eigen_level
他ファイルは、あいかわらず実行ディレクトリに保存される。

例：実行時に下記例のように指定する
$ ./elses -output_dir=test ./config.xml
実行ディレクトリの下にある
test/
に、当該ファイルが保存される。
ただし、当該ディレクトリ(上記だとtest/)が存在しないとエラーになる（らしい）。

注：相対パスを想定。絶対パスは想定しない。

注：ソースコードの例
output%main%filename = trim(config%option%output_dir)//'Output.txt'
実行ディレクトリの下にある
test/Output.txt
に保存される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/06(3)
担当者名 星健夫


新規ファイル:
src/elses-ini-dst.f90
src/elses-la-matvec-dstm-bcrs.f90

更新ファイル:
src/elses-la-matvec-dstm-crs.f90
src/elses-ini-load-geno.f90
src/elses-la-matvec-routines-dstm.f90
src/elses-la-gkrylov-main-dstm.f90
src/Makefile (上記新規ファイルを追記しただけ)

概要:
DST workflowにおけるmat_vecをXMLから選択できるようになった。
distributed tag内に、下記の例のように書く。
<distributed mode="on">
  <mat_vec>
    <mat_vec_mode>dstm</mat_vec_mode> 
  </mat_vec>
</distributed>
上記で、「dstm」のところで設定できる
「dstm」「default」,タグなし
→DSTM版(従来の動作)
「crs」
→Compressed Raw Storage (CRS)版
「dens」
→密行列版(演算量が増加する)
「bcrs」
→基底数が全原子で同じのときに、Blocked CRS版。
そうでなければ、CRS型。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/06(2)
担当者名 星健夫

更新ファイル:
src/elses-config.f90
src/elses-xml-config.f90

概要:
DST workflow用のtagを追加。

メモ：構造体中の
config%calc%distributed%mat_vec_mode
config%calc%distributed%mat_vec_const_num_orbital
config%calc%distributed%mat_vec_max_num_orbital
config%calc%distributed%mat_vec_switch_bcrs
に格納。

-----------------------------
elses-config.f90の当該部分
-----------------------------
type :: distributed_type
   logical               :: set
   logical               :: global_dens_mat
   logical               :: global_ham_mat
   type(micro_cell_type) :: micro_cell_booking
   logical               :: mpi_is_active
   integer               :: myrank
   integer               :: nprocs
   integer               :: log_unit
   logical               :: root_node
   logical               :: use_mpi_barrier
   character(len=20)     :: mat_vec_mode  ←ここ！
   logical               :: mat_vec_const_num_orbital ←ここ！
   integer               :: mat_vec_max_num_orbital ←ここ！
   logical               :: mat_vec_switch_bcrs ←ここ！
end type distributed_type
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/06
担当者名 星健夫

更新ファイル:
src/elses-qm-solver-gkrylov-dst.f90

概要：
エラーチェックルーチンの修正。
(abortしない限り)影響なし。

詳細：
DST workflowにおいて、
全電子数に対する数値チェックが厳しすぎで、
エラーとして検出されてしまう場合があったので修正。

メモ：
当該部分は、全電子数に対する数値チェック部分。
全電子数の精度は、2分法の収束criteriaできまり、
subroutine set_chemical_potential_dst (elses-qm-solver-gkrylov-dst.f90)
の下記部分
 err=(Nelec-N_elec_tmp)/Nelec
 if (abs(err) < 1.0d-12) exit
で担っている。
 すなわち、(相対誤差)<10^{-12}、が収束条件である。
他部分で、上記より厳しい数値チェックをすると、
 エラーとして検出されてしまう場合がある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/05(3)
担当者名 星健夫

新規ファイル:
elses-la-matvec-dstm-dens.f90

更新ファイル:
src/elses-la-gkrylov-main-dstm.f90
src/Makefile (上記新規ファイルを追記しただけ)

概要:
DST workflowでの行列ベクトル積の整備。
疎行列-ベクトル積、密行列ーベクトル積が使える。


メモ：
以下を選択できる(ただし、ソースコードを書き替えが必要)
(1) CRS形式による疎行列-ベクトル積利用(default)
(2) DSTM形式(4つにindexをもつ表示)による、疎行列-ベクトル積利用(従来)
elses-la-gkrylov-main-dstm.f90
における、
character(len=*), parameter   :: mat_vec_type = 'crs'
を、
character(len=*), parameter   :: mat_vec_type = 'dstm'
に書き換えれば良い。
(3) Dense-matrix形式による、行列ーベクトル積
elses-la-gkrylov-main-dstm.f90
における、
character(len=*), parameter   :: mat_vec_type = 'crs'
を、
character(len=*), parameter   :: mat_vec_type = 'dens'
に書き換えれば良い。

メモ：
CallTree抜粋
 - qm_solver_gkrylov_dst
 |   - gkrylov_main_dstm
 |   |   - make_mat_crs ←CRS array作成
 |   |   - calc_u_su_hu_crs
 |   |   |   - matvec_mul_crs ←CRS版mat-vec
 |   |   - calc_u_su_hu_dens
 |   |   |   - matvec_mul_dens ←dense版mat-vec
 |   |   - calc_u_su_hu_dstm
 |   |   |   - matvec_mul_dstm ←dstm版mat-vec
 |   |   - cg_s_mat_crs
 |   |   |   - matvec_mul_crs ←CRS版mat-vec
 |   |   - cg_s_mat_dstm
 |   |   |   - matvec_mul_dstm ←dstm版mat-vec
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/05(2)
担当者名 星健夫

更新ファイル:
src/elses-la-matvec-dstm-crs.f90
src/elses-la-gkrylov-main-dstm.f90


概要:
DST workflowでのCRS型行列ベクトル積。
Compressed Row Storage(CRS)形式での、matrix-vector積の実装。
inner CG loop内のmat-vecもCRS化

メモ：
elses-la-gkrylov-main-dstm.f90にある
character(len=*), parameter   :: mat_vec_type = 'crs' 
でスイッチしている。'dstm'にすると、従来の動作。

メモ：
CallTree抜粋
 - qm_solver_gkrylov_dst
 |   - gkrylov_main_dstm
 |   |   - make_mat_crs ←CRS array作成
 |   |   - calc_u_su_hu_crs
 |   |   |   - matvec_mul_crs ←CRS版mat-vec(新版)
 |   |   - calc_u_su_hu_dstm
 |   |   |   - matvec_mul_dstm ←dstm版mat-vec(従来)
 |   |   - cg_s_mat_crs
 |   |   |   - matvec_mul_crs ←CRS版mat-vec(新版)
 |   |   - cg_s_mat_dstm
 |   |   |   - matvec_mul_dstm ←dstm版mat-vec(従来)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/05
担当者名 星健夫

新規ファイル：
src/elses-la-matvec-dstm-crs.f90

更新ファイル:
src/elses-la-gkrylov-main-dstm.f90


概要:
DST workflowでのCRS型行列ベクトル積。
Compressed Row Storage(CRS)形式での、matrix-vector積の実装。

メモ：
elses-la-gkrylov-main-dstm.f90にある
logical, parameter   :: use_mat_crs = .true.
でスイッチしている。falseにすると、従来の動作。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/03/02
担当者名 星健夫

更新ファイル:
src/elses-md-save-restart-xml.f90

更新ファイル：以下のディレクトリに含まれる全ファイル
sample/sample_geno/vdW_C6H6_dimer_cco
注：ディレクトリ名をからvdW_C6H6_dimer変更。

概要:
restart XMLファイルへの出力を機能強化。
group idを出力できるようになった。
実際の計算例を
sample/sample_geno/vdW_C6H6_dimer_cco
にあげた。

メモ：restart XMLファイルの例：
 <atom element="C"  id="1" group_id="1" motion="free">
注：「id=1」がatom id。「group_id="1"」がgroup id。

メモ：
group idを出力するためには、以下が必要：
(1) 入力のXMLファイルにおいて、group idが付加されていること
(2) config.xmlのoutputタグ内のrestartタグにおいて、
「atom_id_is_added="on"」の属性を付加する
（つまり、atom idが出力されると、group idも出力される）：
<restart filename="restart.xml" interval="1" append_mode="on" 
atom_id_is_added="on"/>
注：atom_id_is_added="off"とすると、atom id, group idの出力がなくなる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/26(3)
担当者名 星健夫

更新ファイル:
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-dst-projection-cell.f90
src/elses-qm-projection-list-dstm.f90

概要:
DST workflowの更新。
solver tag内に、optional tag 「projection_list_length」を設置。
今のところ、DST workflowだけで利用。
典型的な使い方(solver tag内で)
<projection> 200 </projection>
<projection_list_length> default </projection_list_length>
<dimension>  30 </dimension>

解説：
projection_list_lengthタグは、
localな情報をstoreするworking arrayのsizeを規定する。
値は(エラーにならない限り)何でも良くて、計算結果には影響しない。
原理的にいって、
(projection値) =< (projection_list_length値) =< (全原子数)
の範囲となる。
使い方1：タグを省略。または、'default'と指定、つまり、
<projection_list_length> default </projection_list_length>
→ (projection_list_length値) = min( (全原子数), 2*(projection値) )
（従来と同じ動作）
使い方2：'full'を指定
<projection_list_length> full </projection_list_length>
→ (projection_list_length値) = (全原子数)
使い方3：数値を指定
<projection_list_length> 500 </projection_list_length>
→ (projection_list_length値) = 指定した値(上記なら500)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/26(2)
担当者名 井町宏人 星健夫

更新ファイル:
src/code_optional/elses-la-eigen-solver-main-true.f90
src/code_optional/elses-qm-wavepacket-main-true.f90
src/elses-config.f90
src/elses-xml-config.f90

概要:
実験的機能の更新(波束ダイナミクス)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/26
担当者名 星健夫

更新ファイル:
tool/src/elses-xml-generate.f90

概要:
実験的機能追加：elses-xml-generateの更新(fixed atom list)。
固定したい原子をファイルで与えられるようにした。

使い方：
補助ファイル(ファイル名任意)で指定する。
以下では、ファイル名を
fixed_atom_list.txt
とする。command argumentで
-fixed_atom_list=fixed_atom_list.txt
と指定する。例：(Ref: これまでの使い方説明：更新記録2016/02/15(2))
$ elses-xml-generate -xyz_file=structure.xyz 
-setting_file=generate.xml -output_file=structure.xml 
-fixed_atom_list=fixed_atom_list.txt -split=4
(上記は実際には、1行で書く)

補助ファイルは、固定したい原子のatom idを縦にならべるだけ。
たとえば、(atom id)=2,4,5の3原子を固定したい場合は
2
4
5
と書く。
注：今のところ「x,y,z方向全てを固定する」しか指定できない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/24
担当者名 星健夫

更新ファイル:
src/elses-qm-dst-projection-cell.f90
src/elses-qm-solver-gkrylov-dst.f90

概要：
微修正。
標準出力への書き出しを抑制。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/23
担当者名 星健夫

更新ファイル:
src/elses-config.f90

概要：
2/22更新が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/22
担当者名 星健夫

更新ファイル:
src/elses-config.f90

概要：
下記の不要ルーチンをcomment out。
機能に差はなし
subroutine structure_print
subroutine unitcell_print
subroutine atom_print
subroutine element_print
subroutine classic_print
subroutine quantum_print
subroutine config_print
subroutine system_print
subroutine target_print
subroutine calc_print
subroutine limit_print
subroutine dynamics_print
subroutine solver_print
subroutine output_print
subroutine file_print
function target_match
subroutine target_overwrite

メモ：
atom_typeに含まれるelementは、不要なので、廃止予定
type :: atom_type
   character(len=8)      :: name
   type(element_type),pointer :: element  ←これ                               
                                             
 （略）
end type atom_type
--------------------------------------------------------------------------------
***************************************************
2016/02/18
ELSES v0.06.01 Release Candidate  (elses-v0.06.01-20160116-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
日付 2016/02/18
担当者名 星健夫

更新ファイル:
src/elses-xml-config.f90

概要：
設定XMLファイル処理を微修正。

メモ：
仕様として、第一階層のタグである、
systemタグ, calcタグ, outputタグは、
必須とする(ない場合には実行時エラー)。
このうち、outputタグはemptyタグ
<output> </output>
でも良い。この場合は、標準出力と
Output.txt
のみが出力ファイルとなる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/15(2)
担当者名 星健夫

更新ファイル:
tool/src/elses-xml-generate.f90

概要：
elses-xml-generateの更新。
xyzファイルをcommand argumentとして指定可能になった。
これまでの使い方との互換性あり。

使い方説明：
例1(以前からの使い方)：
$ elses-xml-generate generate.xml structure.xml -split=4
・generate.xml (input, 設定XMLファイル)
・structure.xml (output, 構造XMLファイル)
・4分割ファイルの設定(省略可)
例2(新しい使い方)：
$ elses-xml-generate -xyz_file=structure.xyz 
  -setting_file=generate.xml -output_file=structure.xml -split=4
・structure.xyz (input, cell情報付きXYZファイル)
・generate.xml (input, 設定XMLファイル。
ただし、xyzファイル名(clusterタグ)なし。cell info(unitcellタグ)なし。)
・structure.xml (output, 構造XMLファイル)
・4分割ファイルの設定(省略可)

メモ：
実際の例が、
tool/experimental/mk_supercell_xyz
にある。
mk_supercell_xyz.f90の実行ファイルを、同ディレクトリのa.outとする。
$ ./a.out -nx=4 -ny=4 -nz=4 
-filename_input=FL-test-01-2076atom-w-cell-info.xyz 
-filename_output=FL-test-07-132864atom-w-cell-info.xyz
$ elses-xml-generate -xyz_file=FL-test-07-132864atom-w-cell-info.xyz 
-setting_file=generate-general-20160215.xml -output_file=test.xml -split=4
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/15
担当者名 星健夫

更新ファイル:
tool/experimental/mk_supercell_xyz/mk_supercell_xyz.f90

新規ファイル:
tool/experimental/mk_supercell_xyz/FL-test-01-2076atom-w-cell-info.xyz
tool/experimental/mk_supercell_xyz/generate-general-20160215.xml
注：上記新規ファイルは、sample data file

概要：
実験的ツール'mk_supercell_xyz.f90'の更新。
これまでの利用法との互換性はなし。

注：
本ツールは、ELSESのmake時にはcompileされない。
そのため利用時にsource file (mk_supercell_xyz.f90)をcompileする必要がある：例：
$ gfortran mk_supercell_xyz.f90 

注：
本ツールは、Fortran2003の規格である「GET_COMMAND_ARGUMENT」を利用している。
古いfortran compilerではcompileできない可能性がある。

使い方説明：
supercellを作るツール。大規模系にも対応。
入力ファイル：cell情報付きxyzファイル(1行目に、原子数、AX, AY, AZ(全てAngstrom単位)が並ぶ。
出力ファイル：cell情報付きxyzファイル
実行ファイル(以下では./a.out)を実行する時の例を記す：

例1：full 指定
$ ./a.out -nx=3 -ny=5 -nz=7 
-filename_input=FL-test-01-2076atom-w-cell-info.xyz 
-filename_output=supercell-w-cell-info.xyz -comment=This_is_comment
x, y, z方向に、それぞれ3倍, 5倍, 7倍に拡張したsupercellができる。
「comment=」で指定される文字列は、生成されるxyzファイルのコメント行(2行目)に書き込まれる。
生成されるsupercell-w-cell-info.xyzの冒頭は以下になる：
         217980       80.5692000000      134.2820000000      187.9948000000
This_is_comment
H         5.40968805600000024469       -3.43695919999999999206       
-5.37305380100000018473
C         5.68181185500000029975       -2.41769831700000015218       
-5.06208091099999979434

参考：実行時の標準出力：
@@@ mk_supecell_xyz.f90 (build 20160215)
 NOTE: This code uses GET_COMMAND_ARGUMENT defined in Fortran2003
 @@@ Read the paramters from the argument
 INFO:supercell sizes  =            3           5           7
 INFO:filename input   = FL-test-01-2076atom-w-cell-info.xyz
 INFO:filename output  = supercell-w-cell-info.xyz
 INFO:comment line     = This_is_comment
@@@ Input file : structure_org.xyz
 -->      N        =      2076
 -->  ax,ay,az [A] =       26.8564000000       26.8564000000       
26.8564000000
@@@ Output file : structure_new.xyz
 -->      N        =    217980
 -->  ax,ay,az [A] =       80.5692000000      134.2820000000     
 187.9948000000
@@@ Generate the output file
.... mk_supecell_xyz.f90 (build 20160215) ended without error

例2：comment を指定しない
$ ./a.out -nx=3 -ny=5 -nz=7 
-filename_input=FL-test-01-2076atom-w-cell-info.xyz 
-filename_output=supercell-w-cell-info.xyz 
生成されるxyzファイルのコメント行(2行目)は、以下のような定型文が入る。
生成されるsupercell-w-cell-info.xyzの冒頭は以下になる：
         217980       80.5692000000      134.2820000000      187.9948000000
# generated by mk_supercell_xyz.f90(build 20160215) : nx, ny, nz =         
3         5         7
H         5.40968805600000024469       -3.43695919999999999206       
-5.37305380100000018473
C         5.68181185500000029975       -2.41769831700000015218       
-5.06208091099999979434

参考：実行時の標準出力：
@@@ mk_supecell_xyz.f90 (build 20160215)
 NOTE: This code uses GET_COMMAND_ARGUMENT defined in Fortran2003
 @@@ Read the paramters from the argument
 INFO:supercell sizes  =            3           5           7
 INFO:filename input   = FL-test-01-2076atom-w-cell-info.xyz
 INFO:filename output  = supercell-w-cell-info.xyz
 INFO:comment line     = # generated by mk_supercell_xyz.f90(build 
20160215) : nx, ny, nz =         3         5         7
@@@ Input file : structure_org.xyz
 -->      N        =      2076
 -->  ax,ay,az [A] =       26.8564000000       26.8564000000       
26.8564000000
@@@ Output file : structure_new.xyz
 -->      N        =    217980
 -->  ax,ay,az [A] =       80.5692000000      134.2820000000     
 187.9948000000
@@@ Generate the output file
.... mk_supecell_xyz.f90 (build 20160215) ended without error
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/12
担当者名 星健夫

新規ファイル:
src/elses-ini-load-common.f90
src/elses-qm-chk-allocated.f90 (messege出力のみ修正)
src/elses-config.f90 (comment文のみ修正)

概要：
DSTワークフロー修正(use_matom利用時)。
use_matomを利用しない場合は、無関係。

メモ：
構造体変数
・config%system%structure%use_matom (logical)
・config%calc%calc_force_mode (character, 'on' or 'off')
に関する仕様。
「forceが不要な際に、対応する配列をallocateせず、計算もしない」、
ための設定。

use_matomの仕様
(a1) defaultではfalse
(a2) config.xmlの<calc>タグに<use_matom />と書く事で、trueに

calc_force_modeの仕様
(b1) defaultではon
(b2) config.xmlの<calc>タグに明示的設定があるとoffにできる。
(b3) ただし、use_matomがtrueのときは、
強制的にcalc_force_mode='off'となる。
(b4) calc_force_mode='off'だと、力関連配列はallocateされないし、
計算ルーチンも動かない。

CallTree抜粋
 - ini_load_geno
 |   - load_xml_config
 |   |   + config_load
 |   |   + struc_data_sync
 |   |   + struc_data_sync_matom
 |   |   + dst_structure_load_from_txt
 |   + check_xml_compat
 |   + setting_for_main_output
 |   - ini_load_common  ←(b3)の設定はここで
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/06
担当者名 星健夫

新規ファイル:
src/code_optional/elses-lib-quad-precision-true.f90

概要：
微修正。
4倍精度テストルーチンのファイル名を変えた。

メモ：
4倍精度テストルーチンについては、
true routine
src/code_optional/elses-lib-quad-precision-true.f90
dummy routine
src/code_optional/elses-lib-quad-precision-dummy.f90
がある。通常コンパイルされる
src/elses-lib-quad-precision.f90
はdummy routine。
true routineを使いたいときは、
$ cp -p src/code_optional/elses-lib-quad-precision-true.f90 
src/code_optional/elses-lib-quad-precision.f90
とする。

メモ：2015/02/26更新からの転載
4倍精度テストルーチンは、
4倍精度が使えるかどうかのテストのためだけに実施している。
したがって、ダミールーチンに置き換えても支障はない。
なお、gfortranはv.4.6(2011年3月)から4倍精度に対応。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/03
担当者名 星健夫

変更ファイル:
src/elses-ini-set-str-from-vatom.f90

概要：
微修正。
Error時のmessageを分かりやすくした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/02/01
担当者名 井町宏人 星健夫

変更ファイル:
src/elses-config.f90
src/elses-xml-config.f90
src/code_optional/elses-qm-wavepacket-main-true.f90

概要
(1) wavepacket 単体に存在するコマンドラインオプションに対応する XML 項目のうち、
足りなかったものを ELSES 側に追加 (リスタート機能は除く)
(2) ELSES で読んだ XML の項目を、wavepacket の setting 変数に反映させるルーチンの内容も
上に伴って書き足し、独立したルーチン copy_settings_from_elses_config_xml とした
(3) elses-qm-wavepacket-main-true.f90 で、input_step (何番目の行列か) の初期値が 0 だったバグを 
1 
に修正
(4) wavepacket 側のループを中断して ELSES 側のループに戻り、行列更新を行う際にメッセージを表示
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/01/31(2)
担当者名 星健夫

src/elses-eig-leg.f90
src/elses-qm-solver-eig-geno.f90

概要：
(1) EigenKernelを使ったworkflowへの対応：
subroutine elses_eig_chem_pot
(2) unused routineの削除：
subroutine elses_set_eig_leg_atmp

メモ：
以下モジュール変数は廃止予定
n_base_eig_leg [n_base_eig_leg] (意味：全基底数)
→現在はsubroutine qm_solver_eig_genoで設定している。
また、以下サブルーチンも廃止予定
・elses_alloc_eig_leg (elses-mod-eig-leg.f)
（内容：n_base_eig_leg設定
atmp, atmp2, eig2, f_occのallocate)
・copy_to_full_matrices
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/01/31
担当者名 井町宏人 星健夫

更新ファイル
src/elses-qm-solver-eig-geno.f90
src/code-optional/elses-qm-wavepacket-main-true.f90

概要：
external library利用むけの更新。
従来機能に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/01/30
担当者名 星健夫

更新ファイル
src/elses-qm-solver-eig-geno.f90
src/code-optional/elses-la-eigen-solver-main-dummy.f90
src/code-optional/elses-la-eigen-solver-main-true.f90
src/elses-la-eigen-solver-main.f90

概要：
external library利用むけの更新。
従来機能に影響なし。

注：file
src/elses-la-eigen-solver-main.f90
は、optional file
src/code-optional/elses-la-eigen-solver-main-dummy.f90
のdead copy
原子座標データ更新のタイミングを修正。
計算結果に差異はなし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/01/20
担当者名 星健夫

更新ファイル
src/elses-md-motion.f90

原子座標データ更新のタイミングを修正。
計算結果に差異はなし。

メモ：
ELSESには歴史的事情から、原子座標データが複数ある。
(a) 構造体における原子座標データ
 (config%system%structure%vatom(i)%position(1:3))
(b) 旧配列txp(reduceしていない座標) 
txp(:), typ(:), tzp(:) [module: elses_mod_txp]
(c) 旧配列tx (周期系では、reduceした座標, 0< x < 1。非周期系では(b)と同じ)
  tx(:), ty(:), tz(:) [module: elses_mod_tx]
  
・(a)と(b)は、常に同じであるべき量である。
・(a)=(b)と(c)は、周期系においては異なる。
・非周期系では、(a)=(b)=(c)となる。

従来は、
(1) 運動方程式などで座標更新するときは、(b)を使う。
(2) (1)の直後に、(c):=(b)とする (ルーチン名：md_update_tx)
(3) 座標データをファイルにsaveするタイミングで、(a):=(b)とする
（ルーチン名：elses_xml_save_txp）
となっていた。

これをあらため、
(1) 運動方程式などで座標更新するときは、(b)を使う。
(2) (1)の直後に、(c):=(b)とする
(3') (2)の直後に、(a):=(b)とする（ルーチン名：copy_txp_to_config）
とした。

CallTree概要
- elses_md_save_struct
|   - elses_xml_save_txp ← (3)
- elses_md_motion ←(1)
|   - md_update_tx →(2)
|   |   - copy_txp_to_config (3')
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/01/15
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.06.00→v0.06.01)
--------------------------------------------------------------------------------
***************************************************
2016/1/15
ELSES v0.06.00 Released (elses-v0.06.00-20160102-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2016/1/5(5)
担当者名 星健夫

更新ファイル：
src/code_optional/elses-la-eigen-solver-main-dummy.f90
src/elses-la-eigen-solver-main.f90
 (注：elses-la-eigen-solver-main-dummy.f90のdead copy)

概要：
波束ダイナミクスへの準備。
従来機能に変化なし。

Note：
make dep (Makefile.depを作る作業)する都合があるので、
dummyファイルにも、適切なuse文を書く必要がある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/1/5(4)
担当者名 星健夫・井町宏人

更新ファイル：
src/code_optional/elses-la-eigen-solver-main-true.f90
src/code_optional/elses-qm-wavepacket-main-true.f90
src/code_optional/elses-qm-wavepacket-main-dummy.f90
src/elses-qm-wavepacket-main.f90
 (注：elses-qm-wavepacket-main-dummy.f90のdead copy)
src/elses-xml-config.f90
src/elses-config.f90

概要：
波束ダイナミクスへの準備。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/1/5(3)
担当者名 星健夫

更新ファイル
すべてのfotran file(*.f, *.f90)

概要：
バージョン番号更新(version 0.05→version 0.06)
が不完全だったので、修正
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/1/5(2)
担当者名 星健夫

更新ファイル：
sample/sample_w_ext_lib/Polymer_PPE_144atom_dyn_w_EigenKernel/jobscript_on_KEI.sh

概要：
sample dataの微修正。

詳細：
restart XMLファイルが残らないようになっていたので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2016/1/5
担当者名 星健夫

新規ファイル：
src/code_optional/elses-qm-wavepacket-main-true.f90
src/code_optional/elses-qm-wavepacket-main-dummy.f90
src/elses-qm-wavepacket-main.f90
 (注：elses-qm-wavepacket-main-dummy.f90のdead copy)

更新ファイル：
src/code_optional/elses-la-eigen-solver-main-true.f90
src/elses-ext-matrix-data.f90
src/Makefile (elses-qm-wavepacket-main.oを追加しただけ)

概要：
波束ダイナミクスへの準備。
従来機能に変化なし。

詳細：
整合性をもたせるための整備
--------------------------------------------------------------------------------
***************************************************
2016/01/02
ELSES v0.06.00 Release Candidate  (elses-v0.06.00-20160102-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
日付 2016/01/02
担当者名 星健夫

新規ファイル：下記ディレクトリ以下の全ファイル
sample/sample_w_ext_lib/Polymer_PPE_144atom_dyn_w_EigenKernel/

概要：
EigenKernel利用時むけのsample data追加。
京での実行結果を含む。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/12/24
担当者名 星健夫

更新ファイル：
sample/sample_w_ext_lib/C6H6_opt_w_EigenKernel/config.xml

注：同時にディレクトリ名を
C6H6_opt_w_EigenEngineから、
C6H6_opt_w_EigenKernelに変更。

概要：
EigenKernel利用時むけの修正。

詳細：
12/22更新で、eigen_mpiソルバー利用時は、
非DSTモード変更された。
それに対応した。
OLD> <distributed mode="on" 
NEW> <distributed mode="off" 
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/12/22(2)
担当者名 星健夫

更新ファイル
すべてのfotran file(*.f, *.f90)
およびMakefile

概要：
バージョン番号更新(v0.05.03→v0.06.00)。
著作権表示(Copyright)も変更。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/12/22
担当者名 星健夫

更新ファイル：
src/elses-md-main.f90

概要：
波束ダイナミクスへの準備。
従来機能に変化なし。

詳細：
非DSTワークフローで、MPI計算を行う場合を想定した、
場合分けルーチンを追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/12/17(3)
担当者名 星健夫

更新ファイル：
Makefile.inc

概要：
Makefile.incの微修正。

詳細：
gfortranむけの記述がファイル上方にくるように調整。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/12/17(2)
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90

概要：
波束ダイナミクスへの準備。
従来機能に変化なし。

詳細：
config構造体に波束ダイナミクスの項目を追加。
今のところ、ON/OFFのみ。
構造XMLファイルのcalcタグ内
<wave_packet mode="on" />
と書くと発動。default modeは"off"。
当該タグがあるsampleは、
sample/sample_geno/Polymer_PPE_144atom_dyn

コードメモ：
下記で呼びだせる(型：character(len=20))
config%calc%wave_packet%mode
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/12/17
担当者名 星健夫

新規ファイル：
下記ディレクトリの全ファイル
sample_geno/Polymer_PPE_144atom_dyn

概要：
sample追加(高分子)。
--------------------------------------------------------------------------------
***************************************************
2015/11/11
ELSES v0.05.03 Released (elses-v0.05.03-20150930-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
***************************************************
2015/09/30
ELSES v0.05.03 Release Candidate  (elses-v0.05.03-20150930-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/09/07
担当者名 西野信也 (パッケージへのマージ：星健夫)

更新ファイル：
tool/TB-PAM

概要：
TB-PAMの更新

注(星)：上記ディレクトリの全ファイルが置き換わったわけではない。
(time stampを参照)

注(星)：西野氏によるコード作成は2015/02/06。
パッケージへのマージが、2015/09/07。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/23(3)
担当者名 星健夫

更新ファイル：
tool/src/elses-xml-generate.f90

概要：
elses-xml-generateの微修正。
計算結果に影響なし。

詳細：
換算定数angst(=0.529177)を、
ソースコードに直書きした。
削除行: use M_lib_phys_const, only : 
angst                                                                                                                     

追加行: real(8), parameter :: angst=0.529177d0

注：ELSES本体と周辺ツールとのあいだの依存関係が大きく、
makeに支障をきたすので、できるだけ依存関係を減らしたい。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/23(2)
担当者名 星健夫

削除ファイル：
src/elses-xml-selftest.f90

更新ファイル：
src/Makefile (上記削除についての変更)

概要：
不使用機能の削除。
計算結果に影響なし。

詳細：
使われていないxml selftestを削除。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/23 
担当者名 星健夫

更新ファイル：
src/elses-qm-geno-csc-basic.f90

概要：
7/22(2)への修正。
計算結果に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/22(5) 
担当者名 星健夫

新規ファイル：
src/elses-qm-geno-csc-basic.f90
src/Makefile (上記ファイルを追記しただけ)

更新ファイル：
src/elses-qm-engine-csc.f90

概要：
CSC関連データ出力を強化。
計算結果に影響なし。

詳細：
CSC γの距離依存性をプロットする。
具体的には、
CSC Note(elses-code-CSC_20080811.pdf)の(1.35)式：
γ(τ_1, τ_2, R) = 1/R - S(τ_1, τ_2, R)
条件として、非DSTモード, verbose levelが1以上, で,発動。
ファイル(ファイル名固定):output_csc_function_plot.txt

ファイルの例：
% Plotting the gamma CSC function for element pairs
%   element index, element name, Chem. Hardness [au,eV]=         1  
C               0.4189389819       11.4000000000
%   element index, element name, Chem. Hardness [au,eV]=         2  
H               0.4997868556       13.6000000000
%   k: element index i, element index j, tau_i, tau_j=         1         
1         1        1.3406047421        1.3406047421
%   k: element index i, element index j, tau_i, tau_j=         2         
1         2        1.3406047421        1.5993179379
%   k: element index i, element index j, tau_i, tau_j=         3         
2         2        1.5993179379        1.5993179379
%   index, distance[A], bare, gamma(i,j),.. [eV]
         0        1.0000000000       14.3997528532        
9.5024932173       10.0336436088       10.6377827639
         1        1.0100000000       14.2571810428        
9.4724630833        9.9977621850       10.5944281191
         2        1.0200000000       14.1174047580        
9.4423778923        9.9618526127       10.5510916341
         3        1.0300000000       13.9803425759        
9.4122415234        9.9259196174       10.5077790142
         4        1.0400000000       13.8459162050        
9.3820578010        9.8899678409       10.4644958381
         5        1.0500000000       13.7140503364        
9.3518304943        9.8540018420       10.4212475600
         6        1.0600000000       13.5846725030        
9.3215633180        9.8180260964       10.3780395094
数値の各行は下記が順番にでている。
・index
・距離R [A]
・Bare Coulomb (1/R) [eV]
・γ(τ_1, τ_2, R) [eV] (順番にプロット)(上記例では3つ)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/22(4)
担当者名 星健夫

更新ファイル：
src/elses-md-output-atom-energy.f90
src/elses-qm-output-atom-charge.f90
src/elses-qm-geno-output.f90

概要：
微修正：
7/22(2)が不十分だったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/22(3)
担当者名 星健夫

更新ファイル：
src/elses-qm-geno-output.f90

概要：
微修正：
7/22(2)が不十分だったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/22(2) 
担当者名 星健夫

更新ファイル：
src/elses-qm-output-atom-charge.f90
src/elses-qm-geno-output.f90
src/elses-qm-engine-csc.f90

概要：
CSC関連の機能拡張。

詳細：
以下の3点を拡張。
(1) verbose levelに応じて、
CSC loop中にCSC energyをplotするようにした。
具体的には、node logに、
・(verbose level) >=5 で、CSC energyを、plot
・(verbose level) >=7 で、atomごとのCSC energyを、plot
例：node logに以下のように出力される：
atom index, charge, CSC energy, CSC onsite energy [eV] =         1        
0.9734243062       -0.0006651817        0.0056264011
atom index, charge, CSC energy, CSC onsite energy [eV] =         2        
4.0265756959        0.0066130673        0.0047162487
atom index, charge, CSC energy, CSC onsite energy [eV] =         3        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =         4        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =         5        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =         6        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =         7        
4.0265756959        0.0066130673        0.0047162487
atom index, charge, CSC energy, CSC onsite energy [eV] =         8        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =         9        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =        10        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =        11        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =        12        
0.9734243062       -0.0006651817        0.0056264011
atom index, charge, CSC energy, CSC onsite energy [eV] =        13        
0.9734243062       -0.0006651817        0.0056264011
atom index, charge, CSC energy, CSC onsite energy [eV] =        14        
4.0265756959        0.0066130673        0.0047162487
atom index, charge, CSC energy, CSC onsite energy [eV] =        15        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =        16        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =        17        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =        18        
4.0265756945        0.0066130667        0.0047162482
atom index, charge, CSC energy, CSC onsite energy [eV] =        19        
4.0265756959        0.0066130673        0.0047162487
atom index, charge, CSC energy, CSC onsite energy [eV] =        20        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =        21        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =        22        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =        23        
0.9734243045       -0.0006651812        0.0056264018
atom index, charge, CSC energy, CSC onsite energy [eV] =        24        
0.9734243062       -0.0006651817        0.0056264011
INFO-CSC:step, csc_step, dq, mix_r, Ecsc[eV/atom] =         0         2  
7.47E-03  1.00E-01        0.00297394276961450823
注：atom CSC energyの平均値が、最終行にでているので、オッケー。
(-0.0005677900*12+ 0.0056448238*12)/24=0.0025385169 

(2) atom chargeのoutputファイルに、atom CSC energy (CSC loopで収束した値)
をplotするようにした。
具体的には、設定XMLファイルで、<output>タグに
<atom_charge filename="output_atom_charge.txt" interval="1"/>
を追記する。下記のようになる：
      1     H   1.00000  -0.0161983259   0.98380   0.00000   0.00000   
0.00000   0.00000        24         0      -0.00021906       0.00185290
      2     C   4.00000   0.0161983269   1.12528   2.89091   0.90870   
0.89334   1.08888        24         0       0.00217783       0.00155317
      3     C   4.00000   0.0161983265   1.12528   2.89091   0.89718   
0.90486   1.08888        24         0       0.00217783       0.00155317
      4     C   4.00000   0.0161983265   1.12528   2.89091   0.89718   
0.90486   1.08888        24         0       0.00217783       0.00155317
各原子について、最後の3つが、
・step count
・atom CSC energy [eV]。
・atom CSC energy (on site) [eV]。
を表す。それ以外は、QuickStart参照。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/22
担当者名 星健夫

更新ファイル：
src/elses-md-velocity-routines.f90

概要：
Node log出力の微修正。
計算結果に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
***************************************************
2015/07/22
ELSES v0.05.02 Released (elses-v0.05.02-20150701-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/13(2)
担当者名 星健夫

更新ファイル：
src/elses-qm-geno-output.f90
src/elses-qm-engine-csc.f90

概要：
CSC機能の出力を微修正。
計算結果に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/13
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.05.02→v0.05.03)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/02(2)
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-mod-03.f90
src/elses-mod-nrl.f90
sample/sample_geno/C6H6_dyn/config.xml
sample/sample_geno/C6H6_dyn/result/以下の全ファイル

概要：
実験的機能。
メモリ上限値の導入。
ただし現状では、使用メモリ量のcount upは限定的。

利用法：
設定XMLファイルのcalcタグ内に、下記のように書く：
<limit>
 <memory unit="GB"> 1.0d0 </memory>
</limit>
単位はGBで指定する。
(unit属性はGBのみ指定可。unit属性なしだとGBが仮定。)
確認用として、node logに以下のように上限値が出力される；
INFO-XML:Optional tag detected : (memory limit)[GB] =   1.0000000000

詳細：
使用メモリ量が上限値を超えると、エラーで止まるようにした。
使用メモリ量は、allocateされる主な配列のサイズを足し上げたもの。
(定義上、deallocateされたらその分は引き去る必要がある)。
現状では、行列H,Sのみをcount upしている。
使用メモリ量は、随時
INFO-MEMORY:estimated size [GB]=          0.00009216
というformatで、node logに出力される。

利用例：
設定された例が
sample/sample_geno/C6H6_dyn/config.xml
にある。本機能をテストしてみたければ、
<memory unit="GB"> 1.0d-9 </memory>
など、非常に小さい値にすれば良い。
その場合は、標準出力に下記のように出て、停止する；
ERROR!:(allocated memory size) [GB] =        0.0000552960
           (memory size limit) [GB] =        0.0000000010

コードメモ：
構造体の下記を使っている：
config%calc%limit%memory
→上限値 (GB単位で格納)
config%calc%limit%memory_allocated
→使用値 (GB単位で格納)
注：上限値のdefault値は-1.0d0に設定。
(config%calc%limit%memory > 0.0d0)のときのみ、
上限値のチェックがactivateされる。

CallTree抜粋：上限値の設定ルーチン
- ini_load_geno
|   - load_xml_config
|   |   - config_load
|   |   |   - calc_load
|   |   |   |   - limit_default←default (or initial)値設定
|   |   |   |   + limit_load ←XMLファイルからの読み込み

CallTree抜粋：チェック機能のあるルーチン
- elses_qm_engine
|   - qm_domain_setting
|   |   - qm_domain_ini_setting
|   |   |   - elses_init_alloc2b
|   |   |   |   - elses_alloc_mat1 ←H行列のallocate
|   |   |   - elses_init_alloc_nrl_leg
|   |   |   |   - qm_nrl_init_alloc
|   |   |   |       - elses_alloc_dsij_dpij ←S行列のallocate
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/07/02
担当者名 星健夫

新規ファイル
elses-mod-nrl.f90

削除ファイル
elses-mod-nrl.f

概要：elses-mod-nrl.fの変更。
(1) fortran90 styleにした。
(2) 標準出力の微修正（機能に変化なし）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
***************************************************
2015/07/01
ELSES v0.05.02 Release Candidate  (elses-v0.05.02-20150701-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/06/17
担当者名 星健夫

更新ファイル
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
elses-generate-cubefileの修正。
5/29更新(OMP並列化)が不十分だったので、修正。
なお、MPI並列には非対応。

メモ：
OMP並列が起動しているかどうかは、標準出力の冒頭で分かる：
例：4並列の場合
 elses-generate-cubefile with OMP parallelism : P_omp =            4
 elses-generate-cubefile with OMP parallelism : P_omp =            4
 elses-generate-cubefile with OMP parallelism : P_omp =            4
 elses-generate-cubefile with OMP parallelism : P_omp =            4
例：非並列の場合
 elses-generate-cubefile without OMP parallelism
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/06/03
担当者名 星健夫

更新ファイル
src/elses-la-gkrylov-main-dstm.f90

概要：
verbose levelの調整。

詳細：
gkrylov_main_dstm内では、
各種の数値的なchecking routineが入っている。
このcheck機能をactiveにするverbose levelを5以上とした
（これまでは1以上）

メモ：
CallTree抜粋
- qm_engine_dst
|   - qm_solver_gkrylov_dst
|   |   - gkrylov_main_dstm←ここ

上記ルーチンの下記部分：
if (i_verbose >=5) then 
  i_check_mode=1
else
  i_check_mode=0
endif   
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/29(4)
担当者名 星健夫

更新ファイル
src/elses-ini-set-str-from-vatom.f90

概要：
一部の原子を固定する機能の更新。

詳細：
構造XMLファイルで、「固定(fixed)」と指定された原子の一覧が、
下記フォーマットでlog nodeに出力されるようになった：
INFO:fixed atom: j=              1
INFO:fixed atom: j=              3
上記例だと(atom id)=1,3の原子が固定されている。

メモ：関連CallTree抜粋
 - ini_load_common
 |   - set_structure_data
 |   |   + set_structure_data_from_vatom ←ここでiflag(js)を設定
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/29(3)
担当者名 星健夫

更新ファイル
src/elses-md-output.f90

概要：
運動エネルギー3成分のplot。
結果には影響なし。

詳細：
(verbose level)が1以上のときは、
運動エネルギー3成分(x,y,z)をnode logにプロットする。

例：
$ grep 'E_kin' log-node000000.txt | cat 
E_kin_t,x,y,z=         0        0.0285012536        0.0164416374        
0.0065426247        0.0055169915
E_kin_t,x,y,z=         1        0.0248840509        0.0131779257        
0.0062688722        0.0054372530
E_kin_t,x,y,z=         2        0.0209656329        0.0089470707        
0.0065810488        0.0054375134
E_kin_t,x,y,z=         3        0.0254463688        0.0105993261        
0.0091282258        0.0057188169
E_kin_t,x,y,z=         4        0.0323257151        0.0141173796        
0.0123699768        0.0058383587
→整数値はstep count, 4つの実数は、total, x, y, z成分の運動エネルギー(au)
→total値は、Output.txtの運動エネルギーと同じ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/29(2)
担当者名 星健夫

更新ファイル
src/elses-md-velocity-routines.f90

概要：
一部の原子を固定する機能の更新。

詳細：
Fixed atomにたいして、初期速度はゼロにする。

メモ：関連CallTree抜粋
- elses_md_main_01
|   + ini_load_geno
|   - elses_ini_set_velocity
|   |   - calc_initial_velocity
|   |       + set_velocity_from_maxwell ←ここで初期速度ベクトルを生成
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/29
担当者名 星健夫

更新ファイル
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
elses-generate-cubefileのOMP並列化

詳細：
ルーチン「output_cubefile」の並列化。
do i=0, mesh_point_x-1
  do j=0,mesh_point_y-1
    do k=0, mesh_point_z-1
      do atom_index=1,natom ←ここで並列化
        do orbital_index=1, atom_info(atom_index)%num_val_orb
        enddo
      enddo
    enddo
  enddo
enddo
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/28(2)
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

概要：
2015/05/22(2)更新が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/28
担当者名 星健夫

更新ファイル
src/elses-qm-output-eigenstates.f90

概要：
matrix generation modeの修正。
他機能への影響なし。

詳細：
matrix_generationモードをGENOで行った場合に、
原子座標と基底関数の情報を
output_basis_information.txt (ファイル名固定)
に出力する。このファイルの最終行に
# LCAO coefficients .. are not included.
をつけた。
波束ダイナミクス計算ツール(未公開)との整合性のため。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/22(2)
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

概要：
matrix generation modeの修正。
他機能への影響なし。

詳細：
interval属性の値が読み込まれていなかったので、修正。
interval属性の指定をしていなければ、影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/05/22
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.05.01→v0.05.02)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
***************************************************
2015/05/20
ELSES v0.05.01 Released (elses-v0.05.01-20150417-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
***************************************************
2015/04/17
ELSES v0.05.01 Release Candidate  (elses-v0.05.01-20150417-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/02/28
担当者名 星健夫

新規ファイル
src/elses-ini-load-common.f90

概要：
matrix generation modeで、
不要にメモリ消費する場合があったのでこれを修正。
機能に変更なし。

詳細：
設定XMLファイルでsolverタグが指定されない場合、これまではeigenになっていた。
だが、これでは不要な配列をallocateしてします。
matrix generation modeでは、そのようなことがないよう、
設定XMLファイルでsolverタグが指定されない場合、
krylovとなるようにした。
確認として、verbose modeでは下記のようにlog nodeにでる：
INFO:matrix generation mode: solver mode is set to krylov
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/02/26
担当者名 星健夫

更新ファイル
src/elses-lib-quad-precision.f90

概要：
実験的機能の更新(4倍精度テストルーチン)。
シミュレーション機能変化なし。

詳細：
4倍精度テストルーチンのコード
src/elses-lib-quad-precision.f90
を、dummy routine
src/code_optional/elses-lib-quad-precision-dummy.f90
におきかえた。
true routineは、
src/code_optional/elses-lib-quad-precision.f90
にある。

メモ：
4倍精度テストルーチンは、
4倍精度が使えるかどうかのテストのためだけに実施している。
したがって、ダミールーチンに置き換えても支障はない。
なお、gfortranはv.4.6(2011年3月)から4倍精度に対応。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/02/25
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.05.00→v0.05.01)
--------------------------------------------------------------------------------
***************************************************
2015/02/21
ELSES v0.05.00 Released (elses-v0.05.00-20150117-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2015/02/12
担当者名 井町宏人　星健夫

更新ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
elses-generate-cubefileの微修正。

詳細：
メッシュ数が6の倍数のときに、
出力cubeファイルに不要な空行がはいる現象を解消。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/02/08(2)
担当者名 星健夫

更新ファイル：
src/elses-qm-solver-gkrylov-dst.f90

概要：
DSTワークフローの微更新。
計算機能への影響なし。

詳細：
log nodeへの書き出しを微修正。

メモ：
代表的な更新点としては、(verbose level)が1以上のとき、
mainのKrylov loopの中で、OMP並列度数をnode logに出力。
例：
INFO:OMP_id, P_OMP in Krylov loop =        12        20
INFO:OMP_id, P_OMP in Krylov loop =         4        20
INFO:OMP_id, P_OMP in Krylov loop =        15        20
INFO:OMP_id, P_OMP in Krylov loop =        13        20
INFO:OMP_id, P_OMP in Krylov loop =        16        20
INFO:OMP_id, P_OMP in Krylov loop =        11        20
INFO:OMP_id, P_OMP in Krylov loop =         9        20
INFO:OMP_id, P_OMP in Krylov loop =         7        20
INFO:OMP_id, P_OMP in Krylov loop =         6        20
INFO:OMP_id, P_OMP in Krylov loop =         8        20
INFO:OMP_id, P_OMP in Krylov loop =         1        20
INFO:OMP_id, P_OMP in Krylov loop =        17        20
INFO:OMP_id, P_OMP in Krylov loop =        18        20
INFO:OMP_id, P_OMP in Krylov loop =         2        20
INFO:OMP_id, P_OMP in Krylov loop =        19        20
INFO:OMP_id, P_OMP in Krylov loop =        10        20
INFO:OMP_id, P_OMP in Krylov loop =         3        20
INFO:OMP_id, P_OMP in Krylov loop =         5        20
INFO:OMP_id, P_OMP in Krylov loop =         0        20
INFO:OMP_id, P_OMP in Krylov loop =        14        20
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/02/08
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-options.f90

概要：
verbose level設定変数の再設定。
計算機能への影響なし。

詳細：
verbose level設定変数は、歴史的経緯で混乱しているので
config%option%verbose_level
として、再定義。
今後はこちらを使い、それ以外は廃止の方向とする。

メモ：
verbose level設定変数は、現状で以下の3種が存在している。
(1) config%option%verbose_level (利用を推奨)
→ユーザーが設定した値(ELSES実行時のoptionで指定した値)
(2) config%option%verbose
→非DSTワークフローでは、(1)と同じ。
DSTワークフローでは、ノードによって値が違う
・root node：(1)の値
・root node以外：-1に強制設定
(3) i_verbose [module M_qm_domain]
→(2)と同じ
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/02/05
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90

概要：
実験的機能(XML file のsplit reading)の更新。
本機能を使っていなければ、影響なし。

詳細：
以下の一文を追加。
if (system%structure%split%number_of_files == 0) system%structure%split%set 
= .false.
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/01/30(2)
担当者名 星健夫

更新ファイル：
src/elses-la-gkrylov-main.f90
src/elses-qm-solver-gkrylov.f90

概要：
不要ファイルの整理

詳細：
上記2ファイルは、不要ファイル(Outdated routine)。
念のため、該当サブルーチンがcallされると、stopするようにした。
近日、ファイルごと削除する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/01/30
担当者名 星健夫

更新ファイル：
src/eelses-la-gkrylov-main-dstm.f90

概要：
DSTワークフローにおける、
京での不都合を解消。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/01/30
担当者名: 西野信也

更新ファイル
tool/TB-PAM/util/elses_compare_data.cc
tool/TB-PAM/util/elses_read_config.cc
tool/TB-PAM/elses/run.sh

更新内容
TB-PAMにおいて比較すレベルの数を指定できる機能を追加。
マニュアルの更新は未完。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/01/30

担当者名: 西野信也、渡辺尚貴

更新ファイル
tool/TB-PAM/util/elses_optimize_param.cc

更新内容
TB-PAMにおいて、最適化の初期条件の指定ができるように
オプションを追加。
マニュアルの更新は未完。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/01/21
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
sample/sample_geno/C6H6_opt/config.xml

概要：
設定XML仕様にバージョン導入。
旧仕様・新仕様の両方に対応しているので、従来機能に変更なし。

詳細：
設定XMLファイル(典型名:config.xml)の仕様にバージョン
(ELSES XML version)を導入した。
例は、
sample/sample_geno/C6H6_opt/config.xml
にある、下記行：
<config name="C6H6_geno_opt_20150121" elses_xml_version="5.01">
ここでは
(ELSES XML version) = 5.01
に設定されている。defaultでは、
(ELSES XML version) = 1.00
と設定される。
elses_xml_version="current"
とすると、規定されている最新仕様になる。

ELSES XML versionの仕様：
・ver. 1.0 (upto ELSES v0.05.00)
最初の仕様。
・ver. 5.01 (ELSES v0.05.01)
設定XMLでbounary tagを要求する。
注：従来の仕様では、boundary tagが無いときは、周期系を仮定していた

内部仕様：
(ELSES XML version)は、
config%elses_xml_version (実数)
に格納される。「current」のときの値は、
subroutine config_loadの
real(8), parameter   :: elses_xml_version_current=5.01d0
で設定される。
--------------------------------------------------------------------------------
***************************************************
2015/01/17
ELSES v0.05.00 Release Candidate (elses-v0.05.00-20150117-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
日付 2015/01/02(3)
担当者名 星健夫

更新ファイル：
Makefile

概要：
package build時刻の記録。
計算機能への変化なし。

詳細：
package build時の時刻を、パッケージ展開時top directoryの
00_elses_build_time.txt
のtime stampとして、記録するようにした。

詳細2：
Makefileに1行追加。以下該当部分付近の抜粋：
release: clean
        @touch 00_elses_build_time.txt　←追加行
        @rm -f bin/*
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/01/02(2)
担当者名 星健夫

更新ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
cubefile生成ツールの機能拡張。
これまでの機能との互換性あり。

詳細：
cubefileファイル(出力ファイル)名のheader部分を設定可能とした。
従来は「eigen_state_」に固定されていた。

仕様：
実行時のoptionとして
「-cube_filename_header=(文字列)」で設定可能。

例えば、上記文字列部分が「mycube_」だった場合、
$ elses-generate-cubefile -cube_filename_header=mycube_
とする。この場合は、標準出力ファイルに
 cube file name header (custom)  :mycube_
と出力される。出力されるcubeファイルは、例えば、
mycube_000001.cube
mycube_000001.cube
となる。

指定がない場合は、「eigen_state_」とされる。
この場合は、標準出力ファイルに
 cube file name header (default) :eigen_state_
と出力される。出力されるcubeファイルは、従来通り例えば、
eigen_state_000001.cube
eigen_state_000002.cube
となる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2015/01/02
担当者名 星健夫

更新ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
cubefile生成ツールの機能拡張。
これまでの機能との互換性あり。

詳細：
LCAO係数ファイル(入力ファイル)名称を設定可能とした。
従来は「output_wavefunction.txt」に固定されていた。

仕様：
実行時のoptionとして
「-lcao_coef_file=(ファイル名)」で設定可能。

例えばLCAO係数ファイルが「output_wavefunction-test.txt」だった場合、
$ elses-generate-cubefile -lcao_coef_file=output_wavefunction-test.txt
とする。
この場合は、標準出力ファイルに
 LCAO coef. file name (custom ) :output_wavefunction-test.txt
と出力される。

指定がない場合は、「output_wavefunction.txt」とされる。
この場合は、標準出力ファイルに
 LCAO coef. file name (default) :output_wavefunction.txt
と出力される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/27(2)
担当者名 星健夫

更新(新規)ファイル：
sample/sample_geno/C6H6_opt以下の全ファイル

概要：
C6H6(ベンゼン)最適化のsample dataを更新。
作業チュートリアルとなるように、配慮。

詳細：
作業工程として、xyzファイルから始められるようにした。
展開時にあるファイルは、以下：
00run.sh
C6H6.xyz
C6H6.xml
config.xml
generate.xml
result/ (実行結果が格納されたディレクトリ)
result_present/ (空)
このうち、C6H6.xmlは、以下の作業をするのには、不要。
上記ディレクトリにある00run.shを実行すると、以下を実行する：
(1) xyzファイルから構造XMLファイルを生成
(2) ELSES実行
(3) cubeファイル生成
(4) 結果ファイルをresult_present/にコピー
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/27
担当者名 星健夫

更新ファイル
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
周辺ツールであるelses-generate-cubeを、更新。
write文の微修正。

詳細：
メッシュ上の波動関数のwrite文を
OLD| write(10,'(1X,E15.8)') wf
NEW| write(10,'(1X,E18.8e3)') wf
とした。結果は、
OLD| 0.18539306E-08
NEW| 0.18539306E-008
と、指数部分が3桁になった。
「e3」がそれを指定している。

注：以前のままだと1^{-100}以下の値では、
指数部を示す「E」が消滅する。
サンプルコード：
program main
double precision :: x = 0.123456789d-100, y = 123d0 ! 値は適当
print *, x, y ! デフォルトフォーマット
print '(D28.18, D28.18)', x, y ! 28は幅、18は仮数部の桁数を指定
print '(E28.18, E28.18)', x, y
print '(E22.18, E22.18)', x, y
print '(E28.18e3, E28.18e3)', x, y
print '(F28.18, F28.18)', x, y
end program main
結果：
$ ./a.out
1.2345678900000000E-101 123.00000000000000
0.123456788999999996-100 0.123000000000000000D+03
0.123456788999999996-100 0.123000000000000000E+03
********************************************
0.123456788999999996E-100 0.123000000000000000E+003
0.000000000000000000 123.000000000000000000

注：これまでは、
if (dabs(wf) <= 1.0d-80) wf=0.0d0
を直前にいれて、1^{-100}以下の値が出ないようにしていた。
Ref. 2010/09/02更新
が、今回の更新でこれをやめた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/26
担当者名: 西野信也

更新ファイル
tool/TB-PAM/elses_obtain_data.cc
tool/TB-PAM/elses/run.sh

更新内容
GaussianとELSESのMOの比較に関する情報の出力部分
（2014/11/03更新分）のバグを修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/26(3)
担当者名 星健夫

更新ファイル
すべてのfotran file(*.f, *.f90)
およびMakefile

概要：
バージョン番号更新(v0.04.05→v0.05.00)。
著作権表示(Copyright)も変更。

メモ：
第二階層の番号は年一回変える方針。
(2014年はv0.04, 2015年v0.05)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/26(2)
担当者名 星健夫

更新ファイル
src/elses-qm-solver-eig-geno.f90

概要：
ファイル出力の微修正。
計算機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/26
担当者名 星健夫

更新ファイル
src/elses-ini-load-geno.f90

概要：
file conversion modeの微修正。
他機能に変化なし。

詳細：
config%output%position%intervalが設定されていないと
file conversion modeが発動しない問題を修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/14
担当者名 星健夫

新規ファイル：
sample/sample_w_ext_lib/C6H6_opt_w_EigenEngine以下の全ファイル


更新ファイル
src/code_optional/elses-la-eigen-solver-main-dummy.f90
src/elses-la-eigen-solver-main.f90 (上記dummy fileのdead copy)

概要：
分散並列固有値ソルバー(EigenEngine)連結むけ準備。
従来機能に変化なし。

詳細：
(1) 分散並列固有値ソルバー(EigenEngine)むけのsample dataを追加。
→sample/sample_w_ext_lib/C6H6_opt_w_EigenEngine
(2) 分散並列固有値ソルバー(EigenEngine)ない場合に読んでしまうと、
The external library called Eigen Engine may be required.
というメッセージがでて、止まるようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/12/13
担当者名 星健夫

更新ファイル
src/elses-qm-output-eigenstates.f90
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
LCAO係数ファイル(典型名：output_wavefunction.txt)の拡張。
下位互換性があるので、使用法に差はない。

詳細：
LCAO係数ファイルの拡張として、具体的には以下：
(1) 1行目にformatを記すことにした
# file_format= v0.04.05
これは固定。generate-cubeでは、ここの情報(「v0.04.05」の部分)を識別子として、
古いformatにも新しいformatにも、対応している。
(2) LCAO係数データが出てくる部分の最初に
# LCAO coefficients
        30
の2行を記すことにした。1行目は固定コメント。
2行目は以下に格納されているLCAOベクトルの本数。

注：elses-generate-cubefileでの動作。
「file_format」を最初に読んで、以下の動作はformatごとに変えている。

注：file formatの歴史
[1] v0.03.09まで
今のelses-generate-cubefileで、対応不可能。
[2] [1]以降〜[3]以前
1行目にfile formatの記述なし。
(LCAOベクトルの数)=(行列次元数)に固定。
今のelses-generate-cubefileで、対応可能。
[3] v0.04.05仕様 (更新2014/12/12)
1行目にfile formatの記述「# file_format= v0.04.05」あり。
(LCAOベクトルの数)=(行列次元数)に固定せず。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/11/29
担当者名 井町宏人・星健夫

更新ファイル
src/code_optional/elses-la-eigen-solver-main-true.f90

概要：
分散並列固有値ソルバー連結むけ準備。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/11/20(2)
担当者名 星健夫

更新ファイル
src/code_optional/elses-la-eigen-solver-main-true.f90

概要：
分散並列固有値ソルバー連結むけ準備。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/11/20
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.04.04→v0.04.05)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
***************************************************
2014/11/20
ELSES v0.04.04 Released (elses-v0.04.04-20141023-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/11/18
担当者名 星健夫

更新ファイル
Makefile.inc
src/Makefile
src/elses-xml-config.f90
src/elses-qm-solver-eig-geno.f90
src/elses-la-eigen-solver-main.f90
(src/code_optional/elses-la-eigen-solver-main-dummy.f90のコピー)
src/code_optional/elses-la-eigen-solver-main-true.f90
src/code_optional/elses-la-eigen-solver-main-dummy.f90

概要：
分散並列固有値ソルバー連結むけ準備。
従来機能に変化なし。

メモ：
(1) ext-lib無効時のMakefile.incの主要行
FC = ifort
FFLAGS = -O -openmp 
LDFLAGS = $(FFLAGS)
LIBS = -L /opt/intel/mkl/10.0.3.020/lib/em64t -lmkl_lapack -lmkl -lguide 
-lpthread
LIBS-EXT = 
(2) ext-lib有効時のMakefile.incの主要行
FC = mpif90
FFLAGS = -O2 -fopenmp
LDFLAGS = -fopenmp
LIBS-EXT = -L$(TOPDIR)/ext-lib -lEigenTest
INCLUDE = -I/usr/local/include/EigenExa-2.2a -I/usr/local/include/ELPA
LIBS = $(INCLUDE) -L/usr/local/lib64 -lelpa_openmp -lEigenExa-2.2a 
-lscalapack \
-L/usr/lib64 -llapack -lblas -lgomp
注：「LIBS-EXT=・・・」の行は、ELSES本体のコンパイル時のみに使われる。

注：external library利用時のcalc/solverタグ仕様（まだコード自身は未完成）
<solver scheme="eigen_mpi">
  <eigen_mpi>
    <SEP_solver> EigenExa </SEP_solver>
    <GS_transformation> ScaLAPACK </GS_transformation> 
    <blocksize>      32  </blocksize> 
  </eigen_mpi>
</solver>
なお、設定自由度をフルに書くと以下になる：
<solver scheme="eigen_mpi">
  <eigen_mpi>
    <SEP_solver> EigenExa </SEP_solver>
    <GS_transformation> ScaLAPACK </GS_transformation> 
    <blocksize>      32  </blocksize> 
    <level_lowest>    1  </level_lowest>
    <level_highest>  2  </level_highest>
  </eigen_mpi>
</solver>
上記のうち「level_lowest」「level_highest」は、
仕様があるだけで当分使う予定はない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/11/12
担当者名 星健夫

更新ファイル
src/code_optional/elses-la-eigen-solver-main-true.f90
Makefile.inc 


概要：
分散並列固有値ソルバー連結むけ準備。
従来機能に変化なし。

注：Makefile.incは下記コメント行を追加しただけ：
# For gfortran with Eigen Engine
#FC = mpif90
#FC = gfortran
#FFLAGS = -O2 -fopenmp
#LDFLAGS = -fopenmp
#INCLUDE = -I/usr/local/include/EigenExa-2.2a -I/usr/local/include/ELPA
#LIBS = $(INCLUDE) -L/usr/local/lib64 -lelpa_openmp -lEigenExa-2.2a 
-lscalapack \
#-L/usr/lib64 -llapack -lblas -lgomp
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/11/11
担当者名 星健夫

更新ファイル
src/elses-xml-compat-check.f90
src/elses-md-main.f90
src/elses-qm-solver-geno-main.f90
src/elses-qm-solver-eig-geno.f90
src/code_optional/elses-la-eigen-solver-main-true.f90

概要：
分散並列固有値ソルバー連結むけ準備。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/11/03
担当者名: 西野信也

更新ファイル
tool/TB-PAM/elses_obtain_data.cc
tool/TB-PAM/doc/manual.doc
tool/TB-PAM/doc_work/manual_20141103.doc

更新内容
GaussianとELSESのMOの比較に関する情報の出力を追加。
TB-PAM/elses/MO_match_information.datに対応させた
MOのインデックスとそれらの内積の値が出力される。
これは試験的な実装なのでマニュアルには未記載。

また、以前の構造追加に関する項目のマニュアル更新に
おいて、サンプル例が間違っていたため修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/10/29
担当者名: 西野信也

更新ファイル
tool/TB-PAM/elses_generate_molfile.cc
tool/TB-PAM/doc/manual.doc
tool/TB-PAM/doc_work/

更新内容
elses_generate_molfile.ccにベンゼンおよびエタンの
構造作成部分を追加。
この点に関してマニュアルに追記。
また、マニュアルの履歴を残すためにdoc_workに
過去のマニュアルを保存するようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/10/25
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-ini-load-common.f90

概要：
分散並列固有値ソルバー連結むけ準備。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
***************************************************
2014/10/23
ELSES v0.04.04 Release Candidate (elses-v0.04.04-20141023-rc.tgz)
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/10/22
担当者名: 西野信也
 
更新ファイル
tool/TB-PAM/elses_generate_molfile.cc
tool/TB-PAM/doc/manual.doc
tool/TB-PAM/param.PS4.cfg
 
更新内容
PS4に対するgaussianインプットファイル作成部分を修正。
PS4^3-に対応するファイル出力にした。
また、このPS4^3-の計算はELSESのエレメントファイルも
カスタマイズする必要がある特殊な計算であるため、
サンプルからは削除。
 
マニュアルのサンプル例でbasetypeとspinの設定が
抜けている記述があったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/10/16
担当者名: 西野信也
 
更新ファイル
tool/TB-PAM/param.cfg
tool/TB-PAM/param.CF4.cfg
tool/TB-PAM/param.CH4.cfg
tool/TB-PAM/param.CO2.cfg
tool/TB-PAM/param.H2O.cfg
tool/TB-PAM/param.NH3.cfg
tool/TB-PAM/param.PS4.cfg
tool/TB-PAM/param.SO2.cfg
tool/TB-PAM/doc/manual.doc
 
 
更新内容
サンプルファイルへbasetypeの項目を追加。
マニュアルへコンパイル環境とbasetypeの記述を追記。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/10/14
担当者名: 渡辺尚貴、西野信也

更新ファイル
tool/TB-PAM/util/elses_optimize_param.cc
tool/TB-PAM/util/elses_obtain_data.cc

更新内容
TB-PAMのutilityのコンパイルでLinuxの種類とg++のバージョンの違いによって
エラーと警告が出る部分を以下のように修正しました。
・includeファイルのパスを変更。
・型変換部分を修正。
ただし、一部の警告はg++のバージョンによっては残ります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/10/13
担当者名 星健夫

更新ファイル
src/elses-qm-output-participation.f90
src/elses-qm-output-levels.f90

概要：
実験的機能(participatin ratio出力の強化)

内容：
participatin ratio出力をリニューアル。
非DST workflowでeigen solverのときのみで、かつ、
<output>タグ内の<eigen level>タグで、「format="full"」を選ぶとeigen
levelと一緒に出力される：
タグの書き方の例：
<eigen_level filename="output_eigen_levels.txt" mode="periodic"
interval="1" format="full" unit="eV" />

sample/sample_geno/C6H6_dynで、上記タグ指定をしたときの、
出力ファイル(output_eigen_levels.txt)の冒頭：
        0         1      -30.62922077387827712869
1.00000000000000000000        6.20559540870686454639
        0         2      -27.73876736454993618963
1.00000000000000000000        4.97874986140181707839
        0         3      -27.73873592539415611213
1.00000000000000000000        4.97847312875483893890
        0         4      -22.26022092170530441990
1.00000000000000000000       10.90167507587889694776
        0         5      -22.26015125981331266303
1.00000000000000000000       10.95366012420314483222
        0         6      -19.47146848596470647408
1.00000000000000000000       15.70833611078731628652
        0         7      -17.69065703945146239562
1.00000000000000000000       14.01850868400258853796
左から順番に、
step count, level index, eigen level (eV単位), occupation number,
participation ratio

注意：
現状ではある条件化で、
output_participation.txt(ファイル名固定)にもでる
（詳細は2012/12/06(2)更新を参照）。
リニューアルに伴い、過去の出力機能は廃止予定。

詳細メモ：
新規ルーチン：
gene_participation [M_output_participation]
(elses-qm-output-participation.f90)

CallTree抜粋
- elses_md_main_01
|   - output_levels_matrices
|   |   - set_active_status
|   |   - set_append_mode
|   |   + qm_output_matrices_mm
|   |   - set_active_status
|   |   - set_append_mode
|   |   + qm_output_matrices_mm
|   |   - set_active_status
|   |   - set_append_mode
|   |   - qm_output_levels　　　 ←更新ルーチン
|   |       + gene_participation ←新設ルーチン
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/10/05
担当者名 西野信也

更新ファイル
tool/TB_PARAM

概要：
分子系に対するパラメータ自動最適化プログラムです。
マニュアルは
TB_PARAM/doc/manual.doc
になります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/18
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

概要：
時間計測機能の強化。

内容：
構造XMLファイルの読み込み時間だけを計測できるようにした。
node logに、秒単位で、
TIME:Read_structure_XML_file =    0.00100
の形式で、出力される。


詳細：
サブルーチンstruc_load_sax(sax法)
またはstructure_load(dom法)のみを計測。
CallTree解析
- ini_load_geno
|   - load_xml_config
|   |   - config_load
|   |   |   - system_load
|   |   |   |   + struc_load_sax ←ここ
|   |   |   |   + structure_load ←ここ
|   |   |   |   + structure_element_load

メモ：
時刻取得ルーチンとして、
get_system_clock_time_loc
measure_clock_time_period_loc
をモジュール内ルーチンとして、追加。
これらは、
get_system_clock_time 
measure_clock_time_period
 [M_wall_clock_time] (elses-lib-wall-clock-time.f90)
のdead copy。
直接リンクしなかった理由は、
elses-xml-config.f90
が、
tool/src/elses-xml-generate.f90
からもリンクされているため。
このような依存関係はコード開発の妨げになるので、
そのうち依存関係を断ち切りたい。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/17
担当者名 星健夫

更新ファイル
src/elses-mod-03.f90

概要：
2014/09/05更新が不十分であったので修正。

詳細：
gfortranでcompileが通らないところがあった。
論理値変数alloc_dfijに対して
  if ( alloc_dfij == .false. ) ...
という箇所があると、gfortranではエラー。
Ref. 
「論理値同士の比較には==や/=を使えません。.eqv.もしくは.neqv.を利用します。」
http://www.nag-j.co.jp/fortran/FI_7.html
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/16
担当者名 星健夫

更新ファイル
src/elses-gid-basic-routines.f90
src/elses-gid-constraint.f90

内容：
実験的機能の更新(group ID準備)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/15
担当者名 星健夫

更新ファイル
src/elses-lib-phys-const.f90

概要：
エネルギー単位にkcal/mol追加。

詳細：
換算定数を追加しただけ。
コード中では今のところ、使われていない。
具体的には、下記行をelses-lib-phys-const.f90に追加：
   real(8), parameter :: kcal_per_mol = 627.50955d0
!                        --->  1 [au] = 627.50955 [kcal/mol]
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/14(2)
担当者名 星健夫

新規ファイル
src/elses-lib-read-w-split.f90

更新ファイル
src/elses-ini-load-geno.f90
src/Makefile (上記新規ファイルを追記しただけ)

概要：
実験的ルーチン「read_w_split」[M_lib_read_w_split]の追加。
複数項目（項数不定）の文字列から、各項目を配列として読み出す。
例えば「a bc def」という文字列から、
「a」「bc」「def」を配列として読み出す。
項数(上記例だと3)は何でも良い。
使い方はテストルーチン（下記）を参照。

詳細：
verbose levelが1以上のときに、
テストルーチンtest_read_w_splitを冒頭で実行。
正しく実行できたときは、log nodeの冒頭付近に、下記のようにでる：
@@ test_read_w_split
  input text = "  Dog Book  Apple    Supercalifragilisticexpialidocious"
  number_of_items =            4
  max_word_length =           34
  item = "Dog"
  item = "Book"
  item = "Apple"
  item = "Supercalifragilisticexpialidocious"
....end without error: test_read_w_split
上記のテストルーチンは、下記で実行：
CallTree抜粋：
- elses_md_main_01
|   - ini_load_geno
|   |   - make_db_element_name
|   |   - show_db_element_name
|   |   + test_convert_unit
|   |   + test_read_w_split ←ここ
|   |   - quad_prec_test_for_pi
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/14
担当者名 星健夫

更新ファイル
sample/shell_scripts/elses_sample_test.sh

概要：
elses sample test (サンプルの自動実行)に、
C(111)表面(Pandey構造)
sample/sample_non_geno/C_surf_111_Pandey_opt
での実行を追加。

詳細：
下記を追加；
cd ../../sample_non_geno/C_surf_111_Pandey_opt
../../../bin/elses-xml-generate generate.xml C_surf_111_Pandey_ini.xml 
../../shell_scripts/elses_test.sh 0
../../../bin/elses-generate-cubefile 1200
head -n 1000 eigen_state_001200.cube > eigen_state_001200.cube.header
diff ./eigen_state_001200.cube.header ./result/eigen_state_001200.cube.header
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/11(3)
担当者名 星健夫

更新ファイル
src/elses-md-cell-change.f90
sample/sample_geno/vdW_C6H6_dimer/input_cell_change.txt   

概要：
cell-changeでの仕様拡張。
従来機能に変化なし。

詳細メモ：
cell change用の補助ファイルであるinput_cell_change.txt
の1行目に、cell length (AX, AY, AZ) を指定するが、
そのさいに単位を指定できるようになった。
例は、
sample/sample_geno/vdW_C6H6_dimer/input_cell_change.txt  
にある。上記例での1行目
10.d0 10.d0 10.d0 Angstrom
は、
AX=AY=AZ=10 Angstrom
を意味する。
指定の仕方は次のとおり
(a) (単位部分)=「au」「a.u.」
→原子単位
(b) (単位部分)=「Angstrom」「angstrom」「Angst」「angst」「A」
→オングストローム単位
(c) (単位部分)なし (従来の仕様)
→原子単位
(d) (単位部分)が上記以外（スペルミスなど）
→エラーでプログラム停止
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/11(2)
担当者名 星健夫

更新ファイル
src/elses-io-ctrl-plot-eigenstates.f90
src/elses-qm-output-eigenstates.f90
src/elses-ini-load-geno.f90

概要：
非GENOの一部での可視化用波動関数データの出力が、できるようになった。
具体的には、CのXu model, SiのKwon model,の2種類。

詳細メモ：
波動関数データは、GENO defaultのSTO軌道が選ばれる。

詳細メモ：
内部的には、
SetAtomParameters
を呼んで、STO情報を
構造体AtomParameter
に格納している。

CallTree抜粋：
- elses_md_main_01
|   - ini_load_geno
|   |   + ini_load_common
|   |   - load_element_info
|   |   |   + SetAtomParameters　←ここで設定
|   |   |   + elses_nrl_ini
|   + elses_ini_set_velocity
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/11(1)
担当者名 星健夫

新規ファイル
sample/sample_non_geno/C_surf_111_Pandey_opt/下の全ファイル。

詳細：
Xu modelによる、Carbon(111)-Pandey型表面。

詳細：
典型例として、
sample/sample_non_geno/C_surf_111_Pandey_opt
で、下記を順番に実行すれば良い。
$ ../../../bin/elses-xml-generate generate.xml C_surf_111_Pandey_ini.xml 
$ ../../../bin/elses -verbose ./config.xml >& log.txt 
$ ../../../bin/elses-generate-cubefile 1200
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/08
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.04.03→v0.04.04)
--------------------------------------------------------------------------------
***************************************************
2014/09/08
ELSES v0.04.03 Released (elses-v0.04.03-20140816-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/05(2)
担当者名 星健夫

削除ファイル：
src/elses-mod-03.f

新規ファイル
src/elses-mod-03.f90

概要：
コードの微細な修正。
機能変更なし

詳細：
F90形式に変えた。
また、matrix generationモードでは、
不要なarray(dbij, dbij2, dfij)のalloationをやめた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/09/03
担当者名 西野信也

更新ファイル
tool/band/samples/plot_band_script/plot_band_structure.sh

概要：
ELSESのbandモードで計算されたバンド構造をgnuplotを用いてグラフ化するスクリプト。
EigenEnergy.txtとSymLine.txtを入力ファイルとして、バンドを描く。
バンドの数等の情報は入力ファイルから拾ってくる。
グラフにする際の、エネルギー原点や対称点のインデックスは標準入力から指定できる。
サンプルを動かすスクリプト(run.sh)も同一ディレクトリに置いてある。
詳細はクイックスタートに後ほど追加する予定。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/08/28(4)
担当者名 星健夫

更新ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
8/28(2)更新が不十分だったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/08/28(3)
担当者名 星健夫

更新ファイル：以下ディレクトリの全ファイル(8/28, 04:15のtime stamp)
sample/sample_geno/C6H6_opt/result/

概要：
sample data resultの一部、具体的には、
sample/sample_geno/C6H6_opt/result/
に含まれるデータファイルを、
最新コードのデータファイルに置き換え。

詳細：
8/28更新により生成されるcube fileが変更されたため、
referenceとなれるresultファイルを更新。
該当するのは、以下の3ファイル：
eigen_state_000001.cube.header
eigen_state_000002.cube.header
eigen_state_000003.cube.header

メモ：
cube fileの検証は、以下を実行する。
$ cd sample
$ ./shell_scripts/elses_sample_wavefunction_test.sh
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/08/28(2)
担当者名 星健夫

更新ファイル
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
generete-cube toolの機能拡張(cutoffの導入)。

詳細：
grid data生成の際に、
STO関数にcutoff radius (r_cut)を代入できるようになった。
R(r) = STO関数 ( r < r_cut)
R(r) = 0       ( r > r_cut)

使い方：
実行時のoptionとして指定する。
たとえば、-cutoff_au=1、とすると、 r_cut = 1 auとなる。
例：
$ elses-generate-cubefile 15 -cutoff_au=1
(15番目の波動関数にたいして、cubefileをつくる。
その際cutoff=1auとする。
標準出力に：以下のようにでる：
 OPTION:The cutoff radius for plot [au] =   1.0000000000000000     
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/08/28
担当者名 星健夫

更新ファイル
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
generete-cube tool(cubeファイル作成ツール)の修正。
ELSES本体とは無関係。

詳細：
STOの動径成分表式の修正。
以前のコードとは数値上の互換性はなくなる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/08/27
担当者名 星健夫

更新ファイル
src/elses-md-cell-change.f90

概要：
ファイル出力の微修正。
計算内容に変化なし。

メモ：ルーチン「elses_md_cell_change」について
(a) cell-change-only mode, (b) eigen solver, (c) xyz方向で周期境界, 
の条件がそろった場合、
　(interaction range cutoff) = min(ax,ay,az)/2.01d0
となる。verbose modeの場合、メッセージがnode logに出力される。例：
 INFO:Modify the cutoff(cell_change_only, eigen-solver ):new,old [au] =    16.79600531    16.50000000

CallTree抜粋
- ini_load_geno
|   - make_db_element_name
|   - show_db_element_name
|   + test_convert_unit
|   - quad_prec_test_for_pi
|   + load_xml_config
|   + check_xml_compat
|   + setting_for_main_output
|   + ini_load_common
|   + load_element_info
|   - check_xml_element_info
|   - set_tot_elec_num
|   + ini_misc_set
|   + ini_group_id
|   + for_conversion_mode
|   + elses_md_cell_change　←
|   - chk_input_data
- elses_md_motion
|   + md_motion_verlet_position
|   + steepest_descent
|   + update_snapshot
|   - md_update_tx
|   - update_population_guess
|   + elses_md_cell_change　←
|   + elses_md_constraint
|   + add_constraint_w_groups
--------------------------------------------------------------------------------
********************************************************************************
2014/08/16
ELSES v0.04.03 Release Candidate  (elses-v0.04.03-20140816-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2014/07/13(2)
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

概要：
エラー検出強化(小さすぎる原子間距離を検出)。
2013/02/25(2)更新機能をdefaultでONにする。

詳細：
原子構造を乱数で与える場合など、
原子間距離がunphysicalに小さいことがある。
計算途中でこれをdetectして、
・warningをだす
・abortする
の処理を行う。defaultで
(warningを出す距離のしきい値) = 0.5 A
(abortする距離のしきい値)     = 0.1 A
となっている。
出力は標準出力またはノードログにでる。例えば、
ABORT   :Too short atom-pair distance:        12         1        0.1322808814
は、12番目と1番目の原子間距離がR=0.1322808814[au]で、
プログラムがabortした、という意味。
これらの動作仕様はelses-xml-config.f90で変更可能。
この機能をOFFにしたり、しきい値を変えたい場合は、
設定XMLファイルで設定できる
（参照：2013/02/25(2)更新機能）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/13
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.04.02→v0.04.03)
--------------------------------------------------------------------------------
***************************************************
2014/07/13
ELSES v0.04.02 Released (elses-v0.04.02-20140625-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2014/07/12
担当者名 星健夫

更新ファイル
tool/src/elses-xml-generate.f90

内容：
エラーチェック強化。
計算内容自体に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/10
担当者名 星健夫

更新ファイル
src/elses-gid-constraint.f90

内容：
実験的機能の更新(group ID準備)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/09(2)
担当者名 星健夫

更新ファイル
src/elses-gid-constraint.f90

内容：
実験的機能の更新(group ID準備)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/09
担当者名 星健夫

新規ファイル
src/elses-lib-read-w-comment.f90

更新ファイル
src/Makefile (上記新規ファイルを追加)

内容：
実験的機能の更新(read_w_comment)。

詳細：
「コメント付きテキストファイル」の読み込みルーチンを作成：
ルーチン名：read_w_comment [M_lib_read_w_comment]
使い方の例：
integer :: fd
character(len=1024) :: line_chara (「len=1024」は他の値でも可)
logical :: end_of_file
call read_w_comment(fd, '#', line_chara, end_of_file)
行頭に「#」がある行を、コメント文とみなす。
unit番号fdのファイルからコメント文を無視して１行読み込む。
コメント行は何行続いていても無視される(ただし最大値が1024行)。
結果の文字列がline_charaに保存される。
ただし、ファイル末に達していて読めなかった場合は、
end_of_file=.true.
を返す。その場合は、line_charaはempty。
読み込まれるファイルの例が、
# test1
# test2
1
# test3
2 
だったとすると、1,2,4行目は無視されて読み込まれる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/08(2)
担当者名 星健夫

更新ファイル
src/elses-gid-initial.f90
src/elses-gid-basic-routines.f90

内容：
実験的機能の更新(group ID準備)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/08
担当者名 星健夫

更新ファイル
src/elses-md-main.f90
src/elses-gid-basic-routines.f90
src/elses-md-motion.f90

内容：
実験的機能の更新(group ID準備)。

メモ：
elses-md-main.f90は、7/4更新以前のバージョンに戻した。

CallTree更新：
- elses_md_motion
|   + md_motion_verlet_position
|   + steepest_descent
|   + update_snapshot
|   - md_update_tx
|   - update_population_guess
|   + elses_md_cell_change
|   + elses_md_constraint
|   + add_constraint_w_groups←ここでconstraint制御
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/04
担当者名 星健夫

新規ファイル
src/elses-gid-constraint.f90
src/elses-gid-basic-routines.f90

更新ファイル
src/elses-md-main.f90
src/elses-xml-config.f90
src/elses-config.f90
src/elses-gid-initial.f90
src/Makefile (上記新規ファイルを追加しただけ)

内容：
実験的機能の更新(group ID準備)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/02
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90
src/elses-gid-initial.f90

内容：
実験的機能の更新(group ID準備)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/01(2)
担当者名 星健夫

更新ファイル
sample/sample_geno/vdW_C6H6_dimer/config.xml
sample/sample_geno/vdW_C6H6_dimer/benzene_dimer.xml
sample/sample_geno/vdW_C6H6_dimer/benzene_dimer_basic.xml

内容：
実験的機能の更新(group ID準備)。
sampleデータを更新。
ただし、defaultではgroup ID機能は発動しない。

詳細：config.xmlの変更は、calcタグ内にuse_group_idタグを追加しただけ。
<calc mode="cell_change_only">
  <cell_change scheme="from_file" filename="input_cell_change.txt">
  </cell_change>
  <use_group_id mode="off" />
  <genoOption>
   <CSC_method> ELSTNER </CSC_method>
   <CSC_max_loop_count> 0 </CSC_max_loop_count>
   <CSC_charge_convergence>  1d-5 </CSC_charge_convergence>
   <CSC_charge_mixing_ratio> 0.1 </CSC_charge_mixing_ratio>
   <van_der_Waals mode="on"> 
     <vdW_lambda mode="on"> 1.4d-5 </vdW_lambda> 
   </van_der_Waals> 
  </genoOption>
</calc>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/07/01
担当者名 星健夫

新規ファイル
src/elses-gid-initial.f90

更新ファイル
src/elses-config.f90
src/elses-xml-sax-parser.f90
src/elses-xml-config.f90
src/elses-ini-load-geno.f90 
src/Makefile (上記新規ファイルを追加しただけ)

内容：
実験的機能の更新(group ID準備)。

詳細：
group id用の自由度をconfig構造体に設定。


---------------------------
config構造体の該当部分
---------------------------
  type :: calc_type
     character(len=20)   :: mode        ! "dynamics", "optimization" and so 
on
     type(optimization_type) :: optimization
     type(genoOption_type)   :: genoOption
     type(limit_type)    :: limit
     type(dynamics_type) :: dynamics
     type(solver_type)   :: solver
     type(distributed_type)   :: distributed
     type(snapshot_type)      :: snapshot
     type(cell_change_type)   :: cell_change
     type(calc_check_type)    :: calc_check
     character(len=20)        :: calc_force_mode 
     logical                  :: use_integer_elec_num
     logical                  :: calc_virial_pressure
     logical                  :: use_group_id
     type(interation_range_type)    :: interaction_range
  end type calc_type
---------------------------
  type :: atom_type
     character(len=8)      :: name
     type(element_type),pointer :: element
     character(len=16)     :: class
     character(len=8)      :: motion
     real(8), dimension(3) :: position
     real(8), dimension(3) :: velocity
     logical               :: velocity_set
     real(8), dimension(3) :: force
     logical               :: force_set
     real(8)               :: population
     logical               :: population_set
     real(8)               :: population_guess
     logical               :: population_guess_set
     integer               :: group_id ←追加
     logical               :: group_id_set ←追加
     integer                                     :: ncustumize
     type(custumize_type), pointer, dimension(:) :: vcustumize
  end type atom_type
---------------------------

CallTree抜粋
- elses_md_main_01
|   - ini_load_geno
|   |   - make_db_element_name
|   |   - show_db_element_name
|   |   + test_convert_unit
|   |   - quad_prec_test_for_pi
|   |   - load_xml_config
|   |   |   - config_load
|   |   |   |   - system_load
|   |   |   |   |   + struc_load_sax ←SAXパーサーでの読み込み(未完成)
|   |   |   |   |   - structure_load
|   |   |   |   |   |   + atom_load ←DOMパーサーでの読み込み(完成)
|   |   + check_xml_compat
|   |   + setting_for_main_output
|   |   + ini_load_common
|   |   + load_element_info
|   |   - check_xml_element_info
|   |   - set_tot_elec_num
|   |   + ini_misc_set
|   |   + ini_group_id ←ここで各種初期設定
|   |   + for_conversion_mode
|   |   + elses_md_cell_change
|   |   - chk_input_data
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/06/29
担当者名 星健夫

更新ファイル
sec/elses-xml-sax-handler.f90

内容：
実験的機能の更新(SAX型XMLパーサー)。
SAX使っていなければ、影響なし。
（defaultでは、非SAX）。

詳細：
以下の２点の修正：
(1) 2014/06/18(2)更新で導入した、
構造XMLファイルでの新規tagが、
SAXパーサーだとunknownタグとしてエラーチェックで検出されることに対処。
(defaultのDOMパーサーだと、無視されるので、エラーにならない)。
具体的には、新規タグは無視するようにした：上記ソースファイルの以下の行。
case('total_number_of_atoms','boundary','group_id_is_added','number_of_groups', 
'max_number_of_group_atoms')
write(*,'(a,a)')'INFO-XML-SAX:the beginning of the following tag was found 
and ignored;', trim(name)
(2) SAXパーサーでは、split modeに対して、atom idが番号チェックされる仕様。
しかし、split mode以外でもチェックしていたので、これを緩めた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/06/28
担当者名 星健夫

更新ファイル
sample/sample_geno/vdW_C6H6_dimer/input_group_id_setting.txt

内容：
06/18(2)更新への微修正。
--------------------------------------------------------------------------------
********************************************************************************
2014/06/25
ELSES v0.04.02 Release Candidate  (elses-v0.04.02-20140625-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2014/06/20
担当者名 星健夫

更新ファイル
tool/src/elses-xml-generate.f90

内容：
06/18(2)更新の微修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/06/19(2)
担当者名 星健夫

新規ファイル
src/code_optional/elses-la-eigen-solver-main-true.f90
src/code_optional/elses-la-eigen-solver-main-dummy.f90

更新ファイル
src/elses-qm-solver-eig-geno.f90
src/elses-la-eigen-solver-main.f90
(src/code_optional/elses-la-eigen-solver-main-dummy.f90と同じ)

内容：
外部数値ライブラリ接続の準備。
(同じ系統の更新は、2014/06/18, 2014/06/19)。

詳細：
外部数値ライブラリ接続の際には、src/で
cp code_optional/elses-la-eigen-solver-main-true.f90 elses-la-eigen-solver-main.f90
とする。元に戻る場合は、
cp code_optional/elses-la-eigen-solver-main-dummy.f90 elses-la-eigen-solver-main.f90
とする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/06/19
担当者名 星健夫

更新ファイル
src/Makefile

内容：
外部数値ライブラリ接続の準備。
(同じ系統の更新は、2014/06/18)。

詳細：
外部数値ライブラリ接続の際には、src/Makefileの以下を変える。
# Setting NOT for the external numerical library 
FFLAGS += $(FFLAGS-NRL) $(FFLAGS-XML)
LIBS-EXT = 
# Setting for the external numerical library 
#FFLAGS += $(FFLAGS-NRL) $(FFLAGS-XML) -I$(TOPDIR)/ext-lib
#LIBS-EXT = -L$(TOPDIR)/ext-lib -lEigenTest
具体的には、2,3行目をコメントとし、5,6行目をコメントから外す。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/06/18(2)
担当者名 星健夫

更新ファイル
tool/src/elses-xml-generate.f90
sample/sample_geno/vdW_C6H6_dimer/generate.xml
sample/sample_geno/vdW_C6H6_dimer/input_group_id_setting.txt

概要：
実験的機能の追加(構造XML作成ツールの追加機能)。

内容：
構造XMLファイルに対し、下記情報を追加できるようにした。
ただし、(c)(d)を除いて、現在のところ、ELSES本体で読み込まれることはない。
（後日、ELSESでの読み込みルーチンを作成予定）
(a)全原子数 
(b)境界条件情報(周期or非周期)
(c)原子の個別id(通し番号)
(d)heat bath massの値
(e)原子にgroup idを割り当て
このうち、(a)だけはdefaultで追加される。
残りは、生成用設定ファイル(典型名generate.xml)で設定できる。
(e)はさらに補助ファイル(典型名input_group_id_setting.txt)が必要となる。

ベンゼンダイマーの例がsampleディレクトリ
sample/sample_geno/vdW_C6H6_dimer
にある。
２つの分子に属する各原子がそれぞれ(group_id=1,2)となっている。
生成された構造XMLファイルの冒頭(空行は一部削除してある)
----------------------------------------
<?xml version="1.0" encoding="UTF-8"?>
<structure name="benzene_dimer" mdstep="0">
 <total_number_of_atoms> 24 </total_number_of_atoms>
 <unitcell>
   <vector unit="a.u.">  0.188972687777436E+02  0.000000000000000E+00  0.000000000000000E+00</vector>
   <vector unit="a.u.">  0.000000000000000E+00  0.188972687777436E+02  0.000000000000000E+00</vector>
   <vector unit="a.u.">  0.000000000000000E+00  0.000000000000000E+00  0.188972687777436E+02</vector>
 </unitcell>
 <boundary x="nonperiodic" y="nonperiodic" z="nonperiodic" />
 <heatbath>
  <massperatom unit="a.u.">  0.200000000000000E+02</massperatom>
  <position unit="a.u.">  0.000000000000000E+00   </position>
  <velocity unit="a.u.">  0.000000000000000E+00   </velocity>
 </heatbath>
 <group_id_is_added> 
   <number_of_groups> 2 </number_of_groups>
   <max_number_of_group_atoms> 12 </max_number_of_group_atoms>
 </group_id_is_added> 
 <atom element="H" id="1" group_id="1" motion="free">
  <position unit="internal"> -0.106834237290000E+00  0.000000000000000E+00  0.000000000000000E+00</position>
 </atom>
 <atom element="C" id="2" group_id="1" motion="free">
  <position unit="internal"> -0.802754360000000E-03  0.000000000000000E+00  0.000000000000000E+00</position>
 </atom>
 (以下略)
----------------------------------------

設定方法：
(1) 生成用XMLファイルを書く
sampleディレクトリにあるgenerate.xmlが例である。
----------------------------
<?xml version="1.0" encoding="UTF-8"?>
<generate name="benzene_dimer">
  <unitcell>
    <vector unit="angstrom">   10.0    0.0    0.0 </vector>
    <vector unit="angstrom">    0.0   10.0    0.0 </vector>
    <vector unit="angstrom">    0.0    0.0   10.0 </vector>
  </unitcell>
  <cluster structure="benzene_dimer.xyz" >
  </cluster>
  <boundary mode="on" x="nonperiodic" y="nonperiodic" z="nonperiodic" />  
  <atom_id_is_added mode="on" />
  <group_id_is_added mode="on" file="input_group_id_setting.txt" />
  <heatbath>
   <massperatom unit="a.u.">  20.0d0</massperatom>
  </heatbath>
</generate>
----------------------------
注：mode="on"とあるところをmode="off"とすると、タグが無効になる。
つまりタグを書かないのと同義になる。


(2) group id機能には、さらに補助ファイルを用意する。
sampleディレクトリにあるinput_group_id_setting.txtが例である。
----------------------------
# C6C6 dimer
# number of atoms, number of groups, maximum number of group atoms
24 2 12
#
 1  1
 2  1
 3  1
 4  1
 5  1
(中略)
16  2
17  2
18  2
19  2
20  2
21  2
22  2
23  2
24  2
----------------------------
上記で「#」から始まる行はコメント行で、何行書いても(ただし上限は1000行)無視される。
以下コメント行をのぞいて説明する。１番最初の行
24 2 12
は、
・総原子数（ベンゼン2個分で24原子）
・総group数（ダイマーなので２）
・最大のグループ内原子数（グループはベンゼン１個分(C6H6)なので12個）
となる。
後の行は、各原子について、atom_id, group_id, がならんでいる。
たとえば、
17  2
という行は、17番目の原子(atom_id=17)が、2番目のgroupに属する(group_id=2)ことを意味する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/06/18
担当者名 星健夫

更新ファイル
Makefile

新規ディレクトリと新規ファイル
ext-lib/
ext-lib/Makefile (今はダミーファイル)

内容：
実験的機能の追加(外部数値ライブラリ接続の準備)

詳細：
ScaLAPACK, EigenExaなどの外部数値計算ライブラリを、
接続するための準備。
ext-lib以下にライブラリを置く想定。
現状ではダミーファイルが置いてある。

メモ：
Makefile
から
ext-lib/Makefile
を参照している。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/06/02
担当者名 みずほ総研(代執行:山元進)
更新ファイル tools/band/src/dos.f90, tools/band/doc/manual.doc
更新内容
固体系の計算において、tetrahedron method, hisogram, gaussian の
各方法について、積分 DOS が描けるようになった。 manual.doc 参照のこと
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/05/30
担当者名 星健夫

更新ファイル
src/elses-qm-output-atom-charge.f90

内容：
atom charge出力ファイルへ情報追加。

詳細：
atom charge出力ファイル(典型名output_atom_charge.txt)に、
step countの情報を行末に追加。例：
1     C   4.00000   0.0228795978   1.17047   2.85241   0.92228   0.92638   1.00375        72         0
末尾の「0」が、step count。
他の数値は以前(QuickStrt Sec.4.3)のまま。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/05/28
担当者名 星健夫

更新ファイル
doc/quick-start-e.pdf
doc/quick-start-j.pdf

QuickStart更新

詳細：
Sec. 2.6(計算途中での終了)を、追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/05/17(2)
担当者名 星健夫

更新ファイル
doc/quick-start-e.pdf
doc/quick-start-j.pdf

QuickStart更新

詳細：
Sec. 3.1(計算条件設定ファイル)に
周期境界条件の設定についての記述がなかったので、追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
ELSES更新[05/17] バージョン番号更新(v0.04.01→v0.04.02)
--------------------------------------------------------------------------------
日付 2014/05/17
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.04.01→v0.04.02)
--------------------------------------------------------------------------------
***************************************************
2014/05/17
ELSES v0.04.01 Released (elses-v0.04.01-20140430-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
********************************************************************************
2014/04/30
ELSES v0.04.01 Release Candidate  (elses-v0.04.01-20140430-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2014/04/01
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.04.00→v0.04.01)
--------------------------------------------------------------------------------
***************************************************
2014/03/31
ELSES v0.04.00 Released (elses-v0.04.00-20140303-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2014/03/22
担当者名 星健夫

更新ファイル
src/elses-ini-load-geno.f90

概要：
Rest part専用のlong cutoff機能(2013/12/14更新)が不十分だったので、修正。
defaultではOFFなので、この機能を意図的に使っていなければ、無関係。

メモ：
本機能は、構造体config%calc%interaction_range内にある以下の量で制御されている
(a) cutoff_rest_cellmax (logical) (input)
(b) cutoff_rest　　　　 (real) 　
(c) cutoff_rest_non_vdW (real) 

CallTree抜粋
- ini_load_geno
|   - make_db_element_name
|   - show_db_element_name
|   + test_convert_unit
|   - quad_prec_test_for_pi
|   - load_xml_config
|   |   - config_load
|   |   |   + system_load
|   |   |   + calc_load   　 ←(1)
|   |   |   + output_load
|   |   + struc_data_sync
|   |   + struc_data_sync_matom
|   |   + dst_structure_load_from_txt
|   + check_xml_compat
|   + setting_for_main_output
|   + ini_load_common
|   + load_element_info　　　←(2)
|   - check_xml_element_info
|   - set_tot_elec_num
|   + ini_misc_set
|   + for_conversion_mode
|   + elses_md_cell_change
|   - chk_input_data
- mpi_wrapper_barrier_time

(1)で、(a)を設定。(b)(c)はdummy value (=-1)になっている。
(2)で、(b)(c)を設定
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/03/19
担当者名 星健夫

更新ファイル
src/elses-io-ctrl-dos-plot.f90
tool/DOS/Makefile
tool/DOS/elses-dos.f90

概要：
周辺ツールのコード整備。
機能変化なし。

内容：
周辺ツール(tool/DOS/elses-dos.f90)関連のコード整備。
該当ツールについては、2010/06/26更新、を参照。

本ツールmake時には
不必要なファイル(具体的にはsrc以下の全ファイル)が
リンクされることになっていた。
本体ELSESコード開発の際に不都合をもたらすので、
必要最小限のファイルへのリンクだけに変えた。
現在は、以下の４ファイルのみをリンクしている
elses-mod-file-io.f90
→vacant_unitを使うため
elses-lib-phys-const.f90
→物理定数ev4auを使うため
elses-lib-math-func.f90 
→Fermi-Dirac関数を使うため
elses-io-ctrl-dos-plot.f90
→control fileの読み込みルーチンを使うため
--------------------------------------------------------------------------------
********************************************************************************
2014/03/03
ELSES v0.04.00 Release Candidate  (elses-v0.04.00-20140303-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2014/02/27(4)
担当者名 星健夫

更新ファイル
src/elses-qm-output-eigenstates.f90

概要：
2014/02/27(2)更新が不十分だったので、修正。

詳細：
Default(input_mesh_grid.txtなしの場合)の動作が、
2013/12/26更新の仕様に合致していなかったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/27(3)
担当者名 星健夫

更新ファイル
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
elses-generate-cubefile.f90の修正

詳細：
Default(input_mesh_grid.txtなしの場合)の動作が、
2013/12/26更新の仕様に合致していなかったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/27(2)
担当者名 星健夫

更新ファイル
src/elses-qm-engine.f90
src/elses-qm-output-eigenstates.f90

概要：
行列データ書き出し機能の強化。

詳細：
matrix_generationモード(2/27更新参照)をGENOで行った場合に、
原子座標と基底関数の情報を
output_basis_information.txt (ファイル名固定)
に出力する。
formatは、output_wavefunction.txtと同じで、
固有ベクトル部分が含まれていないだけ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/27
担当者名 星健夫

更新ファイル
elses-qm-engine.f90

概要：
行列データ書き出し機能の強化。

詳細：
直交基底モデルでも、行列データ書き出しを可能にした。
calcタグのmode属性を
<calc mode="matrix_generation">
とする。
(従来はGENO系でしかできかなった)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/18
担当者名 星健夫

更新ファイル
src/elses-qm-vdW-parameters.f90

内容：
実験的機能の追加(2/13更新が不十分だったので、修正)

参考：output_vdW_parameter_db.txtの冒頭は、以下になるべきだった。
(2/13更新とはpolarizationの値が違う)
# ELSES: Data base for vdW parameters
#   Ref. CRC Handbook of Chemistry and Physics, 94th Edition
#     ed. William M. Haynes, CRC Press, Boca Raton (2013); ISBN:978-1466571143
#   The unit of ionization_energy     : eV
#   The unit of dipole_polarizability : 10^{-24} cm3
#   The unit of covalent_radius       : Angstrom
#
#     Note: The ionization energy of At is a dummy value (-1.0),
#           since the value is missing in the book. 
#
#                  ion_ene         polariz    cov_rad
    1       H     13.5984330      0.6667930    0.3200
    2      He     24.5873870      0.2050522    0.3700
    3      Li      5.3917190     24.3300000    1.3000
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/13(3)
担当者名 星健夫

更新ファイル
src/elses-qm-geno-Huckel-atom-parameters.f90
src/elses-qm-vdW-parameters.f90

内容：
実験的機能の追加（vdW parameterのdata base一覧表の出力)。

詳細：
新ルーチン追加：
show_vdW_parameters_db
[M_qm_vdW_parameters](elses-qm-vdW-parameters.f90)
上記ルーチンをcallすると、vdW parameterのdata base一覧表の出力が、
output_vdW_parameter_db.txt 
に出力される。
上記ルーチンは、計算結果には影響を及ぼさない。
現状では、(i)vdW力をon (ii)verbose levelが1以上のとき、発動する。

参考：output_vdW_parameter_db.txtの冒頭
# ELSES: Data base for vdW parameters
#   Ref. CRC Handbook of Chemistry and Physics, 94th Edition
#     ed. William M. Haynes, CRC Press, Boca Raton (2013); ISBN:978-1466571143
#   The unit of ionization_energy     : eV
#   The unit of dipole_polarizability : 10^{-24} cm3
#   The unit of covalent_radius       : Angstrom
#
#     Note: The ionization energy of At is a dummy value (-1.0),
#           since the value is missing in the book. 
#
#                  ion_ene         polariz    cov_rad
    1       H     13.5984330      6.6679300    0.3200
    2      He     -1.0000000      2.0505220    0.3700
    3      Li     -1.0000000    243.3000000    1.3000
    4      Be     -1.0000000     56.0000000    0.9900
    5       B     -1.0000000     30.3000000    0.8400
    6       C     11.2603000     16.7000000    0.7500
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/13(2)
担当者名 星健夫

更新ファイル
src/elses-lib-db-ion-ene.f90
src/elses-lib-db-polarization.f90
src/elses-lib-db-covalent-radius.f90

内容：
vdW parameter data baseにデータ追加。

詳細：
86番(Rn,ラドン)までの全elementに対して、
　ionization_energy, dipole_polarizability, covalent_radius
のデータに対応。データの値は、以下から収録：
CRC Handbook of Chemistry and Physics, 94th Edition
  ed. William M. Haynes, CRC Press, Boca Raton (2013); ISBN:978-1466571143
注：以下の元素のpolarization値は、複数の値が記されている。
　　data baseには、書籍で一番上に記載されているデータを収録。
　　He, Na, Mg, K, Va, Cu, Zn, Sr, Ag, Cd, In, Sn I, Hg, Tl, Pb
注：ELSES全体としては、原子番号84(Po)までに対応、とする。
    85番以上だと、エラーでabortする(ルーチン「set_vdW_parameters_db」の機能)。
注：データベース自体は、原子番号86番まで対応している。
　　が、原子番号85のアスタチン(At)のionization_energyが書籍になかったので、
　　ダミー値(-1.0d0)を返すようになっている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/13
担当者名 星健夫

更新ファイル
src/elses-lib-element-name.f90

内容：
element name data baseにデータ追加。
86番(Rn,ラドン)までの全element nameを追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/12(2)
担当者名 星健夫

更新ファイル：下記ディレクトリ下の全ファイル
sample/sample_non_geno/W_NRL_BCC_250atom_cell_change_only/result/
sample/sample_non_geno/W_NRL_FCC_500atom_cell_change_only/result/
sample/sample_non_geno/W_NRL_SC_125atom_cell_change_only/result/

内容：
微修正（出力ファイルの改行コード）。
計算機能には変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/12
担当者名 星健夫

更新ファイル
src/elses-qm-geno-Huckel-atom-parameters.f90

内容：
微修正（エラーメッセージを強化）。
計算機能には変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/08
担当者名 星健夫

新規ディレクトリ
sample/sample_non_geno/W_NRL_BCC_250atom_cell_change_only
sample/sample_non_geno/W_NRL_BCC_250atom_cell_change_only/result
sample/sample_non_geno/W_NRL_FCC_500atom_cell_change_only
sample/sample_non_geno/W_NRL_FCC_500atom_cell_change_only/result
sample/sample_non_geno/W_NRL_SC_125atom_cell_change_only
sample/sample_non_geno/W_NRL_SC_125atom_cell_change_only/result

内容：
NRL-tungsten系のsample data追加。
resultディレクトリに結果ファイル
Output.txt, log-node000000.txt, logfile.txt
も入っている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/06(2)
担当者名 星健夫

新規ディレクトリ
sample/sample_geno/vdW_C6H6_opt

変更ディレクトリ
sample/sample_geno/vdW_C6H6_dimer


内容：
vdWのsampleを更新。
vdWパラメーターを変更(ref. 02/06更新)したので、これまでの結果は異なる。

注：
上記２ディレクトリにある
C_vdW_unused.xml
H_vdW_unused.xml
は、不要ファイル。
vdWパラメータつきのelement XML fileの見本として置いてあるだけ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/02/06
担当者名 星健夫

新規ファイル
src/elses-lib-db-ion-ene.f90
src/elses-lib-db-polarization.f90
src/elses-lib-db-covalent-radius.f90

変更ファイル：
src/elses-qm-vdW-parameters.f90
src/elses-qm-geno-Huckel-atom-parameters.f90
src/Makefile (上記新規ファイルを登録しただけ)

概要：
vdW力の設定方法を拡張。
（vdW力を使わなければ、無関係）

内容：
vdW力を使うときは、
・ionization energy
・dipole polarization
・covalent radius
をelement XML fileで指定する必要があったが、以下は不要に。
element fileがない場合は、Default値が指定される。
Default値は、以下の文献の値による：
CRC Handbook of Chemistry and Physics, 94th Edition
ed. William M. Haynes, CRC Press, Boca Raton (2013)
ISBN:978-1466571143

詳細：
新規ファイル内に値がベタ書きされている。
ただし、現状ではC, Hしか書かれていない。
この書き方で問題なければ、残りのelementも追加する予定。

詳細：
vdW力を使うために必要なのは、設定CXMLファイルのcalc/genoOptionに、
以下のような記述を追加するだけ。
<van_der_Waals mode="on"> 
  <vdW_lambda mode="on"> 1.4d-5 </vdW_lambda> 
</van_der_Waals> 
vdW_lambda（論文のλ）を指定しない場合は、論文値(λ=7.5d-4)になる
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/01/23(3)
担当者名 星健夫

新規ファイル
src/elses-qm-vdW-parameters.f90

変更ファイル：
src/elses-qm-geno-Huckel-atom-parameters.f90
src/Makefile (上記新規ファイルを登録しただけ)
sample/sample_geno/vdW_C6H6_dimer/C_vdW.xml (書式変更のみ。結果は不変)
sample/sample_geno/vdW_C6H6_dimer/H_vdW.xml (書式変更のみ。結果は不変)

内容：
vdW用element XML file仕様を変更。
旧仕様との互換性はないので、element fileの書式変更が必要。
sampleディレクトリ以下では、
該当ファイルは２つだけ(上記C_vdW.xml, H_vdW.xml)で、これらを修正。

詳細：
elementタグ内に以下のように書く。
新仕様
<vdW>
  <dipole_polarizability unit="au">  12.7d0 </dipole_polarizability>
  <ionization_energy unit="eV"> 11.26030d0 </ionization_energy>
  <covalent_radius unit="au"> 1.455089695886254d0 </covalent_radius>
</vdW>
参考：旧仕様
<dipole_polarizability unit="au">  12.7d0 </dipole_polarizability>
<ionization_energy unit="eV"> 11.26030d0 </ionization_energy>
<vdW_radius unit="au"> 1.455089695886254d0 </vdW_radius>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/01/23(2)
担当者名 星健夫

新規ファイル
src/elses-xml-get-value-with-unit.f90

変更ファイル：
src/Makefile (上記新規ファイルを登録しただけ)

内容：
「物理量(単位付き)をau単位の数値として取り出す」ルーチンを作成。

詳細：
２種類のルーチンを追加。
xml_get_value_w_unit [M_xml_get_value_with_unit]
xml_get_value_w_unit_detail [M_xml_get_value_with_unit]

使い方：
(1) xml_get_value_w_unit(node, tag_name, value_au,comment)
 node     : XML fileを読み込んだnode (input)
 tag_name：読み出したいtag名 (input)
 value_au：au単位での値(output)
 comment ：メッセージ用の文字列（今のところ使われていない）(input/output)
　例：xml_get_value_w_unit(node_input, 'ionization_energy', value, comment)
(2) xml_get_value_w_unit_detail(node, tag_name, value_au, value_org, unit_org, comment)
 (1)と同じだが、outputが増えている。
 value_org：オリジナル(ファイルに書かれている)単位での値(output)
 unit_org：オリジナル(ファイルに書かれている)単位(output)

注：01/23(3)更新で、具体的使用事例があげられる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/01/23
担当者名 星健夫

変更ファイル：
src/elses-lib-phys-const.f90

内容：
XMLファイルに書ける単位表記の追加。
センチメートル：
→ unit='cm' or 'centimeter'
(センチメートル)^3：
→ unit='cm3' or 'centimeter3'
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/01/13
担当者名 星健夫

修正ファイル：
sample/shell_scripts/elses_sample_test.sh
sample/shell_scripts/elses_sample_test_for_mpi.sh

新規ファイル：
sample/shell_scripts/result/result_elses_sample_test.txt
sample/shell_scripts/result/result_elses_sample_test_for_mpi.txt

内容：
sample test tool (shell script)更新。

詳細：
以下の２点
(1) 下記２ディレクトリの計算をtest toolから実行するようにした
sample/sample_non_geno/Si_bulk_512atom_cell_change_only
sample/sample_non_geno/Si_sc_512atom_cell_change_only
(2) standard outputfileを以下に保存
sample/shell_scripts/result/result_elses_sample_test.txt
sample/shell_scripts/result/result_elses_sample_test_for_mpi.txt
それぞれ、
./shell_scripts/elses_sample_test.sh > result_elses_sample_test.txt
./shell_scripts/elses_sample_test_for_mpi.sh 2 > result_elses_sample_test_for_mpi.txt
として出来たファイルが、reference standard outputfileとして保存してある。
今後はテストするたびに、standard outputfileを上記reference fileと比較する。
テストが正常に終了していれば、日付や計算時間以外は同じになるはず。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2014/01/11
担当者名 星健夫

新規ディレクトリ
sample/sample_non_geno/Si_bulk_512atom_cell_change_only
sample/sample_non_geno/Si_bulk_512atom_cell_change_only/result
sample/sample_non_geno/Si_sc_512atom_cell_change_only
sample/sample_non_geno/Si_sc_512atom_cell_change_only/result

内容：
sampleデータ追加と微調整。
下記ディレクトリに、Kwonモデル, eigen solverによる、volume変化計算を追加；
sample/sample_non_geno/Si_bulk_512atom_cell_change_only
sample/sample_non_geno/Si_sc_512atom_cell_change_only
それぞれ、ダイアモンド構造・単純立方格子構造での512-atom supercell計算に該当。
単純立方格子のinput構造XMLファイルでは、
ダイアモンド構造と最近接原子間距離が同じになるようにとってある。
注：simple cubicのsuper cellを作る、非常に単純なツール
sample/sample_non_geno/Si_sc_512atom_cell_change_only/make_supercell_sc.f90
も追加されている。
--------------------------------------------------------------------------------
********************************************************************************
2014/01/07
ELSES v0.03.20 Released (elses-v0.03.20-20131220-rel.tgz)
Note: identical to RC2
********************************************************************************
--------------------------------------------------------------------------------
日付 2014/01/07
担当者名 星健夫

更新ファイル
Makefile
Makefile.inc
Makefile.inc_release
Makefile.inc11
*/Makefile
(src/Makefile)
(tool/Makefile)
*/*/Makefile
(tool/DOS/Makefile)
(tool/src/Makefile)
*/*/Makefile
(tool/xml-check/src/Makefile)
(tool/band/src/Makefile)
(tool/plot_eigenstates/src/Makefile)
(tool/LDOS/src/Makefile)
(tool/MSD/src/Makefile)
src/*.f90
src/*.f
src/*/*.f90
src/*/*.f
tool/*/*.f90
tool/*/*.f
tool/*/*/*.f90
tool/*/*/*.f

内容：
(1) Copyright表示変更
2007-2013→2007-2014に)
(2) バージョン主番号変更
v.0.03→v.0.04

注：下記ファイルは手動で書き替える必要あり。
Makefile
src/elses-00-version-info.f90
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/12/27
担当者名 星健夫

新規ファイル：
src/elses-xml-check-element-info.f90

変更ファイル：
src/elses-ini-load-geno.f90
src/elses-qm-geno-Huckel-atom-parameters.f90
src/Makefile(上記新規ファイルを追加しただけ)
 
概要：
エラーチェック強化。

内容：
設定XMLファイルでvdW力がonになっているのに、
element infoでvdWパラメーターが設定されていないときに、
エラーで止まるようにした。

詳細：
下記の新ルーチンでチェック：
check_xml_element_info[M_check_xml_element_info](elses-xml-check-element-info.f90)

CallTree抜粋：
- ini_load_geno
|   - make_db_element_name
|   - show_db_element_name
|   + test_convert_unit
|   - quad_prec_test_for_pi
|   + load_xml_config
|   + check_xml_compat
|   + setting_for_main_output
|   + ini_load_common
|   + load_element_info
|   - load_element_info
|   |   + SetAtomParameters　←element XML fileの読み込み
|   |   + elses_nrl_ini
|   - check_xml_element_info　←チェック
|   - set_tot_elec_num
|   + ini_misc_set
|   + for_conversion_mode
|   + elses_md_cell_change
|   - chk_input_data
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/12/26
担当者名 星健夫

更新ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90

概要：
実験的機能(elses-generate-cubefileの拡張)

内容：
input_mesh_grid.txtから、
grid regionを指定できるようになった。

詳細：
長さの単位は、「internal」「au」が選べる。
前者は、LCAO係数ファイル内のcell size (AX, AY, AZ)で規格化された単位のこと。

(1) internal単位でのフル設定例
80 80 80                        # Number of mesh points
-0.5d0 -0.5d0 -0.5d0 internal   # origin of the mesh grid region
 1.0d0  1.0d0  1.0d0 internal   # sizes of the mesh grid region   
注：３つの並びは、x方向、y方向、z方向をあらわす。
→ origin = (-0.5, -0.5, -0.5) 
   size   = ( 1.0,  1.0,  1.0)
→ -0.5 < x < 0.5　の領域にmeshが設定される。y,zも同様。

(2) au 単位でのフル設定 
70 70 70                        # Number of mesh points
-10d0 -10d0 -10d0 au   # origin of the mesh grid region
 25d0  25d0  25d0 au   # sizes of the mesh grid region   
→ origin = ( -10,  -10, -10)
   size   = (  25,   25,  25)
→ -10 < x < 15　の領域にmeshが設定される。y,zも同様。

(3) mesh pointのみの設定例：
70 70 70                        # Number of mesh points
→(1)の値に、grid regionが設定される(従来通り)

(4)input_mesh_grid.txtなし
→(1)の値に、grid region, mesh pointが設定される(従来通り)


--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/12/21
担当者名 星健夫

変更ファイル：
src/elses-xml-config.f90
tool/src/elses-xml-generate.f90
sample/shell_scripts

概要：
実験的機能(elses-xml-generateの拡張)。
cell infoつきXYZファイル(注1)に対応した。

内容：
originalのXYZファイルにはcell infoが入っていない。
そのため、cell infoを与える必要がある。
ここではcell vectorが直交している場合のみを扱う。
x,y,z方向のcell vectorの大きさは、AX, AY, AZ,とそれぞれする。

本更新により、２種類の方法ができたことになる：
方法(A) generate.xmlで設定する
→従来方法(Quick Start Sec. 3.5 構造ファイルの作成方法)
方法(B) cell info付きXYZファイルを用意する
→この場合は、generate.xmlにはcell情報を書かない(書いてはいけない, 注2)
→具体例が以下にある：
sample/sample_geno/vdW_C6H6_dimer
下記コマンドを実行することで、構造XMLファイルが生成される
$ ../../../bin/elses-xml-generate generate.xml benzene_dimer.xml

注1：cell infoつきXYZファイルとは、１行目に
(原子数) AX AY AZ
を書くファイルのこと。AX, AY, AZはAngstrom単位。

注2：cell info付きXYZファイルでのcell info指定と、
generate.xmlでのcell info指定の両方がある場合は、
XYZファイル内のcell infoは無視される。

詳細：
cell info (AX, AY, AZ)は、a.u.単位で、以下構造体データに格納される：
generate%unitcell%vectorA(1)
generate%unitcell%vectorB(2)
generate%unitcell%vectorC(3)

方法(A)のときのCallTree抜粋
elses-xml-generate
  |- generate_load
  |    |- unitcell_load

方法(B)のときのCallTree抜粋
elses-xml-generate
  |- generate_load
  |    |- cluster_load
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
********************************************************************************
2013/12/20
ELSES v0.03.20 Release Candidate 2 (elses-v0.03.20-20131220-rc2.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/12/20(2)
担当者名 星健夫

変更ファイル：
src/elses-la-eigen-solver-main.f90

概要：
微修正。

内容：
ifortでwarningがでるので、
使っていないルーチンを微修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/12/20
担当者名 星健夫

変更ファイル：
sample/sample_geno/vdW_C6H6_dimer/config.xml

概要：
sample dataの微修正。

内容：
出力ファイルを追加。
計算結果は不変。
--------------------------------------------------------------------------------
********************************************************************************
2013/12/17
ELSES v0.03.20 Release Candidate (elses-v0.03.20-20131217-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/12/17
担当者名 星健夫

新規ディレクトリ
sample/sample_geno/vdW_C6H6_dimer

変更ファイル：
sample/shell_scripts/elses_sample_test.sh

概要：
sample追加(vdW用)。
elses sample test (shell script)で自動実行。

内容：
ベンゼンダイマーの分子間距離を、モノマー固定のまま、
z = 1.4 ~ 7.0 A
の範囲でδz = 0.01 A刻みでふる計算。
cell-change-only modeを用いている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/12/14
担当者名 星健夫

新規ファイル
srcv/elses-qm-geno-rest-kernal.f90

変更ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-ini-load-geno.f90
src/elses-qm-geno-Huckel.f90
src/elses-qm-geno.f90
src/elses-qm-geno-rest-dstm.f90
src/Makefile
(上記新規ファイルを追加しただけ)
sample/sample_geno_mpi/C_liq_01728atom_dst/config.xml
(機能的には変更なし)

概要：
実験的機能(Rest part専用のlong cutoff導入)。

内容：
Rest part専用のcutoffを導入する。
vdW力をRest partに取り込むと、
これはlonger interaction rangeを必要とする。
TB hamiltonianに対する（短い）cutoffとは独立に、
Rest part専用の（長い)cutoffが必要となる。
今回の実装では、「cell_max」モードのみを導入した。
Non-order-N型計算で、
・周期系　→(minimum cell size) / 2
・非周期系→cutoffなし。
に相当する。

詳細：
設定XMLファイルのcalcタグ内に、下記を追加する。
  <interaction_range>
    <cutoff_rest mode="cell_max" />
  </interaction_range>
「mode="off"」とすると、default仕様(タグを書かないのと同じ)になる。
注：記述例として、
sample/sample_geno_mpi/C_liq_01728atom_dst/config.xml
には、interaction_rangeタグが書いてある。
ただし、「mode="off"」となっているので、default仕様(タグを書かないのと同じ)になる。

内部詳細：
config構造体に、下記を導入して、cell_maxモードのon/offを設定している(defaultはoff)。
config%calc%interaction_range%cutoff_rest_cellmax (logical)

メモ：
Rest partルーチンを、
non-DSTワークフローとDSTワークフローで、共有化する。
そのためのルーチンが
calc_geno_rest_kernel [M_qm_geno_rest_kernel](elses-qm-geno-rest-kernal.f90)

CallTree抜粋(non-DST)
- elses_qm_engine
|   - set_rest_geno
|   |   - calc_geno_rest_kernel
|   |       - get_vector_for_atom_pair
|   |       + RepulsiveEnergy

CallTree抜粋(DST)
- qm_engine_dst
|   - qm_solver_gkrylov_dst
|   |   - calc_geno_rest_dstm
|   |   |   - calc_geno_rest_kernel
|   |   |   |   - get_vector_for_atom_pair
|   |   |   |   + RepulsiveEnergy


メモ：
下記自由度も定義されているが、まだXMLでは設定できない。
config%calc%interaction_range%cutoff_rest
configcalc%interaction_range%cutoff_rest_non_vdW
それぞれ、rest-partのcutoff(具体的な値を設定する),
vdWのcutoff(具体的な値を設定する)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/12/03
担当者名 星健夫

新規ファイル：
src/elses-la-eigen-solver-main.f90

変更ファイル：
src/elses-xml-compat-check.f90
src/elses-md-main.f90
src/elses-qm-solver-geno-main.f90
src/elses-qm-solver-eig-geno.f90
src/Makefile
(上記新規ファイルを追記しただけ)


概要：
実験的機能(「eigen_dst」ワークフロー)の準備

内容：
分散メモリ型固有値計算ワークフロー
(「eigen_dst」)の『入り口』を追加。
本体は、今後接続。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/11/22(2)
担当者名 星健夫

新規ファイル：
src/code_optional/elses-lib-quad-precision-dummy.f90
（このファイルは通常はコンパイルされない）

概要：
旧コンパイラ環境での互換性向上(4倍精度計算)。

内容：
4倍精度計算のテストルーチン
quad_prec_test_for_pi [M_lib_quad_prec] (elses-lib-quad-precision.f90)
が、一部の旧コンパイラ環境で非互換であるため、
コンパイルできない場合がある。
その場合に、dummy routine（同名だが中身は実質的にempty）に置き換えることで、
問題を回避する。
具体的には、
$ cp src/elses-lib-quad-precision.f90 src/elses-lib-quad-precision.f90.org
$ cp src/code_optional/elses-lib-quad-precision-dummy.f90 src/elses-lib-quad-precision.f90
を実行してからコンパイルする（上記で１行目はoriginal fileを保存しているだけで、不要）。

注：
4倍精度計算は現状では、上記テストルーチンでのみ使われているため、
上記置き換えを行っても物理的計算結果には全く影響を与えない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/11/22
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90
src/elses-md-velocity-routines.f90
src/elses-md-cell-change.f90
sample/shell_scripts/elses_sample_test_for_mpi.sh

新規ディレクトリ：
sample/sample_geno_mpi/C_liq_01728atom_dst_cell_change_md

概要：
実験的機能の更新(cell-change-md)。

内容：
有限温度計算をしながらperiodic cellを変化させる。
cell vectorは直交しているときのみ対応。
速度ベクトルは不変なので、運動エネルギーは変化しない。
計算例(C_liq_01728atom_dst_cell_change_md)も用意し、
MPI計算用のsample test script(elses_sample_test_for_mpi.sh)で実行される。


設定方法：
dynamicsモードでの設定を基礎とする。
(1) 補助入力ファイルを用意する。
以下、ファイル名を「input_cell_change.txt」とする。
(2) 設定XMLファイル
calcタグ内に、下記を追加する
<cell_change scheme="from_file" filename="input_cell_change.txt" />

(verbose level)>=1の場合node logに以下のように出力される
 INFO-XML:Optional tag:cell_change%set = T
 INFO-XML:Optional tag:cell_change%scheme =from_file           
INFO-XML:Optional tag:cell_change%filename =input_cell_change.txt                                           
(中略)
 INFO:Change cell size [au](new/old)=         2    48.32128648    48.32128648    48.32128648    48.80938028    48.80938028    48.80938028
上記で最後の行が、cellが変化したことを意味する。具体的には(step count)=2で、
cell size (ax, ay, az)が以下のように変化(au単位)
New : (48.32128648    48.32128648    48.32128648)
Old： (48.80938028    48.80938028    48.80938028)

補助入力ファイル(input_cell_change.txt)の例：
48.8093802832818 48.8093802832818 48.8093802832818 
 0  1.00d0   1.00d0   1.00d0
 2  0.99d0   0.99d0   0.99d0
 4  0.96d0   0.96d0   0.96d0
フォーマットは、QuickStart(Sec. 3.6.2 Cell change only モード)を参照。
変化させるstep countだけを記述すれば良い。上記例だと、
(step count)=0,2,4しか記述がない。この場合、
(step count)=1は(step count)=0と同じになり、
(step count)=3は(step count)=1と同じになり、
(step count)=5以降は(step count)=4と同じになる。

プログラム構造のメモ：
CallTree抜粋
- elses_md_main_01
|   - ini_load_geno
|   |   + elses_md_cell_change　　←ここではvelxなどをscaleしない (for_next_step = .false.)
|   - elses_ini_set_velocity
|   - elses_md_motion
|   |   + md_motion_verlet_position
|   |   + steepest_descent
|   |   + update_snapshot
|   |   + elses_md_cell_change　　←ここではvelxなどをscaleする (for_next_step = .true.)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/11/19
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-geno.f90
src/elses-qm-geno-Huckel.f90

概要：
実験的機能の更新(vdW力)。

内容：
パラメーターλ（default値は、論文値λ=7.5d-4）をXMLから指定できるようにした。

詳細：
設定XMLファイルにおける、calc/genoOption/van_der_Waalsタグで指定する。
結果は、ノードログに以下のようにでる：
 INFO-XML: optional tag: van_der_Waals (vdW) = T
 INFO-XML: optional tag: vdW_lambda =   7.5000000000000002E-004
(中略)
 @@ set_rest_geno
 INFO:E_vdW_only [au, eV] =  -8.2246899352100805E-002  -2.2380697264096265     
 INFO:vdW_lambda      =   7.5000000000000002E-004

詳細メモ：
用例：
<van_der_Waals> 
  <vdW_lambda mode="default" /> 
</van_der_Waals>
→vdWがON。λはdefault値。
用例：
<van_der_Waals mode="on"> 
  <vdW_lambda mode="default" /> 
</van_der_Waals>
→vdWがON。λはdefault値。
用例：
<van_der_Waals mode="on"> 
  <vdW_lambda mode="on">  0.00075d0 </vdW_lambda> 
</van_der_Waals>
→vdWがON。λは、XMLファイルで設定。
用例：
<van_der_Waals mode="off"> 
→vdWがOFF。タグを書かないのと同じ。

注：
設定手順としては、「mode」属性が優先される。
用例1：
<van_der_Waals mode="off"> 
  <vdW_lambda mode="default" /> 
</van_der_Waals>
→vdWがOFF。
用例2：
<van_der_Waals mode="on"> 
  <vdW_lambda mode="default">  0.001d0 </vdW_lambda> 
</van_der_Waals>
→vdWがON。λはdefault値になって、「0.001d0」は無視される。

注：
これまでのタグの書き方、たとえば、
<van_der_Waals> T </van_der_Waals>
だと動かない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/11/08
担当者名 星健夫

新規ファイル：
src/elses-md-virial-pressure.f90

更新ファイル：
src/Makefile (上記新規ファイルを追記しただけ)
src/elses-md-output.f90
src/elses-config.f90
src/elses-xml-config.f90

内容：
実験的機能（Virial定理による圧力を表示）。

詳細(理論)：
Virial定理
 P = P_1 + P_2
 P_1 = (2/3V) K                 (運動エネルギー項)
 P_2 = (1/3V) \sum_i (r_i, f_i) (原子間相互作用項)
により、instantな圧力を計算。

詳細(利用法)：
設定XMLタグ内に、
  <calc_virial_pressure />
または、
  <calc_virial_pressure mode="on" />
と書く事で発動。
modeを「off」にすると、発動しない（タグ記述なしと同義）。

出力は、log nodeに、下記の例のように出力される
@@ plot_virial_pressure (TEST)
  note : Pressure unit : 1 au =   29421.294766185641      GPa
Pressure:P(total)   (GPa) =          0        0.3887247668
Pressure:P_1(total) (GPa) =          0        0.0828394800
Pressure:P_2(total) (GPa) =          0        0.3058852868
Pressure:P_1(x,y,z) (GPa) =          0        0.0336719293        0.0194805686        0.0296869821
Pressure:P_2(x,y,z) (GPa) =          0        0.1529337050        0.1529515818        0.0000000000
注：上記で、「0」となっているところは、step count。
注：下２段の３つの実数値は、P_1, P_2のx, y, z成分
　　　P_1 = P_1x + P_1y + P_1z, P_2 = P_2x + P_2y + P_2z 

詳細(コード)：
・該当ルーチン
plot_virial_pressure [M_md_virial_pressure] (elses-md-virial-pressure.f90)
・On/Offは下記論理変数で決まる
config%calc%calc_virial_pressure

・CallTree抜粋
- elses_md_main_01
|   - elses_md_output_main
|   |   - plot_virial_pressure 
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/11/06(3)
担当者名 星健夫

更新ファイル：
src/elses-ini-load-geno.f90
src/elses-lib-phys-const.f90

内容：
汎用単位コンバーターを作る
function convert_unit(モード名, 単位名) [M_lib_phys_const]
　モード名="from" or "into"
　単位名は"eV"など

詳細：
テストルーチン
(test_convert_unit [M_lib_phys_const])にて、使い方を参照。例：
value=1.0d0
write(log_unit,*)'energy: 1 au = X eV       : X=', value*convert_unit('into','eV')
value=1.0d0
write(log_unit,*)'length: X au = 1 Angstrom : X=', value*convert_unit('from','Angstrom')
以下の結果が、node logの冒頭付近に記載される：
@@@ test_convert_unit
 energy: 1 au = X eV       : X=   27.2116000000000     
 energy: 1 au = X J        : X=  4.359780863302800E-018
 length: X au = 1 Angstrom : X=   1.88972687777436     
 length: 1 au = X m        : X=  5.291770000000000E-011
 pressure: 1 au = X GPa    : X=   29421.2947661856     

CallTree抜粋
- elses_md_main_01
|   - ini_load_geno
|   |   - test_convert_unit

注：elses-ini-load-geno.f90への変更は、
test_convert_unitをcallしただけ。

メモ：
eVとJ(ジュール)の換算定数を微修正(違いは0.01%程度)。
この定数はこれまで使われていなかったので、計算結果に影響なし。
微修正した理由は、eVとK(ケルビン)の換算定数との厳密な数値的整合性のため。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/11/06(2)
担当者名 星健夫

更新ファイル：
src/elses-md-velocity-routines.f90

内容：
運動エネルギーをx,y,z成分ごとに出力できるようにした
E_KE = E_KE_x + E_KE_y + E_KE_z

詳細：
該当ルーチンcalc_kinetic_energy[M_md_velocity_routines]
コードは以下：
subroutine calc_kinetic_energy(kinetic_energy, k_e_component)
implicit none
real(8), intent(out)           :: kinetic_energy    ! total kinetic energy                                                
real(8), intent(out), optional :: k_e_component(3)  ! x,y,z components                                                    
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/11/06
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.19→v0.03.20)
--------------------------------------------------------------------------------
********************************************************************************
2013/10/23
ELSES v0.03.19 Released (elses-v0.03.19-20131010-rel.tgz)
Note: identical to RC
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/10/16
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90
src/elses-md-cell-change.f90

内容：
cell-change-onlyモードで反復回数を自動設定可能にした

詳細：
cell-change-onlyモードで反復回数を自動設定できるようにした。
従来は、設定XMLファイルのcalcタグ内に、
  <cell_change scheme="from_file" filename="input_cell_change.txt">
    <max_num_iter> 5 </max_num_iter>
  </cell_change>
と言う風に、反復回数(上記例では5)を書き込む必要があった。
今後は、max_num_iterタグがない場合は、
補助入力ファイル(上記例ではinput_cell_change.txt)から自動設定する。
具体的には、(補助ファイルの最終行にあるstep count)+1、に設定する。
(+1するのは、(step count)=0から始まることを考慮している)。

参考：ワークフローの解説

CallTree抜粋
- ini_load_geno
|   - load_xml_config
|   |   - config_load
|   |   |   - calc_load
|   |   |   |   + cell_change_load　←(a)
|   + check_xml_compat
|   - ini_load_common
|   |   + load_element_alloc
|   |   + load_structure_alloc
|   |   - allocate_velocity
|   |   + set_unitcell_info
|   |   - elses_md_motion_ini_set 　←(b)
|   |   + set_structure_data
|   |   + load_xml_conditions
|   + load_element_info
|   - set_tot_elec_num
|   + ini_misc_set
|   + for_conversion_mode
|   + elses_md_cell_change　　←(c)
|   - chk_input_data

ワークフロー(cell_change_onlyモード)
(a) 設定XMLファイル(典型名:config.xml)読み込み。
 calc%cell_change%max_num_iterタグあるか？
　YES→config%calc%cell_change%max_num_iter=(上記tagの値)
　NO→ config%calc%cell_change%max_num_iter= -1 (dummy value)
(b) itemdxmxの設定
　itemdmx = config%calc%cell_change%max_num_iter
(c) cell-change補助ファイル(典型名:input_cell_change.txt)読み込み。
　( config%calc%cell_change%max_num_iter < 0 )なら、
　config%calc%cell_change%max_num_iter=(補助ファイルの最終行のstep count)+1
　と上書きする
　さらに、itemdmxも下記のように上書き
  itemdmx = config%calc%cell_change%max_num_iter
--------------------------------------------------------------------------------
********************************************************************************
2013/10/10
ELSES v0.03.19 Release Candidate (elses-v0.03.19-20131010-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/10/06
担当者名 星健夫

更新ファイル：
src/elses-qm-geno-Huckel.f90

内容：
実験的機能の更新(vdW力)。

更新：
10/05更新が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/10/05
担当者名 星健夫

更新ファイル：
src/elses-qm-domain.f90
src/elses-qm-geno.f90
src/elses-qm-geno-Huckel.f90

内容：
実験的機能の更新(vdW力)。

更新：
vdWエネルギーのみのエネルギー値(E_vdW)を、変数
E_vdW_only [モジュール名：M_qm_domain]
として格納する。
この値は、いまのところ、(verbose level>=1)、
のときに標準出力で
INFO:E_vdW_only [au, eV] = (値)
という形式で見えるだけ。

参考：vdW力の計算手順
CallTree抜粋 (MD,非DSTワークフロー)
- elses_qm_engine
|   - calc_kinetic_energy
|   + qm_domain_setting
|   - set_rest_geno　　　  ←ここ（総和）
|   |   + RepulsiveEnergy　←ここ（atom-pairに対して）
|   - generate_foi
|   + qm_geno_output
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/10/03
担当者名 星健夫

更新ファイル：
Makefile.inc

内容：
コメント文として、compile optionを加える。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/10/02
担当者名 山元進
更新ファイル src/elses-xml-config.f90
更新内容
default で vanDerWaals = .false. にするようにするコードを入れ忘れたため追加．
パラメータ読み取りのバグ修正．
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/09/30 (9/21-30にかけての変更のまとめ)
担当者名 山元進
更新ファイル src/elses-{config,xml-config,qm-engine,qm-geno,qm-geno-Huckel,qm-geno-Huckel-geno-atom-parameters,band-calc}.f90 tool/band/src/band.f90
更新内容
1) conduction の計算用に，Hamiltonian と Overlap を書き出す機能．
config.xml の calc mode="write_Hamiltonian" にすると有効になる。
 内部的には、繰り返し回数を 0 にセットして mode を optimization にしたうえで， matrix_generation flag を enable する．
config.xml の calc mode="matrix_generation" の場合と重複するので，
後日，conduction の計算プログラムが，みずほ情報総研から納入された段階で，添削する．

2) band 計算用に，unit cell あたりの Ecc (core-core の repulsive energy) を出力する機能． EccPerAtom.txt に原子当たりの Ecc を出力する．
tool/band の band を使用すると，このファイルから値を読み取って，Unit Cell あたりの Ecc を標準出力に表示する．

3)
Phys. Rev. B 73, 205101 (2006). の表式に従って、van der Waals 相互作用を入れる． London 分散力に damping を入れた形．
現在、この論文における n と λ は hard coded (elses-qm-geno-Huckel.f90 中).
config.xml の genoOption に <van_der_Waals> F </van_der_Waals> を入れると有効になる．
原子ファイルに、  
<dipole_polarizability> 数値(atomic unit) </dipole_polarizability>
<ionization_energy> 数値(eV)  </ionization_energy>
<vdW_radius> 数値(atomic unit) </vdW_radius>
を入力する必要がある．しかし，入力しなくても, デフォルトの値を入力して計算してしまうので，注意
i_verbose=1 だと，これらのタグがないときに not found の表示を出す．
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/09/21
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90
src/elses-md-motion.f90
src/elses-qm-engine.f90

追加ディレクトリ
sample/sample_geno/C6H6_mat_gene

追加ファイル
sample/sample_geno/C6H6_mat_gene/config.xml
sample/sample_geno/C6H6_mat_gene/C6H6_optimized.xml

内容：
実験的機能の追加(行列生成onlyモード)。

詳細：
2013/08/30更新への機能追加。
XMLからの制御が可能になった。
calcタグのmode属性を、以下のように設定すれば良い。
<calc mode="matrix_generation">
具体例が、
sample/sample_geno/C6H6_mat_gene
に入っている。
C6H6_optで最適化された構造に対して、行列(H,S)を生成する。
結果行列(H,S)は、ELSES matrix libraryの「BNZ30」に含まれるものに相当する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/09/20
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f9

内容：
標準出力へのメッセージ追加。

詳細：
XML読み込みにDOMパーサーを選んだとき(default)、
以下のwarningをnode logに出力する：
INFO-XML:XML parser= dom
WARNING:DOM PARSER is used for reading the input XML file.
WARNING:DOM PARSER may be impractical for large systems, such as 100,000-atom systems.
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/09/08
担当者名 星健夫

更新ファイル：
src/elses-qm-dst-micro-mat.f90

内容：
実験的機能の更新(DSTワークフロー)。

詳細：
ルーチン「set_mat_tb0_diag_loc」のエラーチェックルーチンが、
エラーを誤検出することがあったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/09/03
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90
src/elses-qm-output-matrices.f90

内容：
固有エネルギー出力設定の詳細更新。

詳細：
固有エネルギー出力設定(2012/07/05更新)のうち、
eigen levelの出力がinterval属性に対応していなかったので、対応させる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/09/01
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.18→v0.03.19)
--------------------------------------------------------------------------------
********************************************************************************
2013/09/01
ELSES v0.03.18 Released (elses-v0.03.18-20130813-rel.tgz)
Note: identical to RC2
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/08/31
担当者名 星健夫

更新ファイル：
src/elses-qm-engine.f90

内容：
実験的機能の追加(行列save only)。
8/30更新が不十分だったので修正。
--------------------------------------------------------------------------------
日付 2013/08/30
担当者名 星健夫

更新ファイル：
src/elses-qm-engine.f90

内容：
実験的機能の追加(quick hackによる行列save onlyモード)。

詳細：
quick hackによる行列save onlyモードを追加。
initial structureに対して行列(H,S)を生成したら、solverを起動することなく、行列をsaveしてstopする。
geno、非DST、非CSCのときのみ、有効。
具体的には、上記ファイルのソースコードの
logical, parameter  :: matrix_generation_and_stop = .false.  ! for quick hack
を「.true.」にする。
--------------------------------------------------------------------------------
日付 2013/08/26
担当者名 星健夫

更新ファイル：
sample_geno/C6H6_dyn/config.xml
sample_geno/C6H6_opt/config.xml
sample_non_geno/Au_NW_0143atom/config.xml
sample_non_geno/CNT100atom_dyn/config.xml

内容：
sampleにおけるconfigファイルの微修正。

詳細：
calcタグ内に、
use_integer_elec_numタグ(Ref:2013/05/28(2)更新)
を追加。
--------------------------------------------------------------------------------
日付 2013/08/14
担当者名 星健夫

更新ファイル：
src/elses-kr-main.f

内容：
直交基底系workflowかつkrylovソルバー利用時の更新。
それ以外には無関係。

詳細：
直交基底系workflowかつkrylovソルバー時の、
mode_for_large_memoryタグが無視されているのを修正。
例：
<solver scheme="krylov">
  <projection> 200 </projection>
  <dimension>  30 </dimension>
  <mode_for_large_memory> 1 </mode_for_large_memory>
  <mode_for_suggest_projection> upto_v0.03.08 </mode_for_suggest_projection>
</solver>
注：mode_for_large_memoryタグが未設定のときは、値=0。
--------------------------------------------------------------------------------
********************************************************************************
2013/08/13
ELSES v0.03.18 Release Candidate 2(elses-v0.03.18-20130813-rc2.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/08/12(2)
担当者名 星健夫

更新ファイル：
src/Nrl/nrlmatrix.f90

内容：
NRL workflowの修正。
一部の(新しい)intel compilerでの不都合への対応。
NRL workflowを使わなければ、無関係。

詳細：
一部の(新しい)intel compiler
で最適化オプションをつけてコンパイルすると、
実行時にsegmentation faultがでる場合がある問題を、回避。
この更新は計算結果に影響を与えないが、(若干の)速度低下の可能性がある。
以前のコードに戻したければ、
logical, parameter :: suffix_check_in_MNrlMatrix= .true.
を、
logical, parameter :: suffix_check_in_MNrlMatrix= .false.
にすれば良い。

この問題は、該当compilerの最適化処理に問題があると考えている。
上記の「suffix_check」は、本来は不要のチェック処理をいれている。

メモ：問題が報告された環境
ifort version 13.1.1.163 build 20130313
で、下記の最適化optionをつけた場合：
FFLAGS = -O2 -openmp -mcmodel=medium -assume nobuffered_io
注：以下のcompile optionにすれば問題なし。
FFLAGS = -g -assume nobuffered_io -check all -traceback -ftrapuv  -implicitnone
注：古いifort (v.11など)では、最適化optionをつけた状態でも問題なし。
--------------------------------------------------------------------------------
日付 2013/08/12
担当者名 星健夫

更新ファイル：
sample/shell_scripts/elses_test.sh 

内容：
sample test tool (shell script)の修正。
ELSES本体への影響なし。

詳細：
ELSES実行前にファイル「Output.txt」が存在していたときは、
消去してから実行するようにした。
これをしないと、以前の結果ファイルが残っていた場合に、
正しくない結果を出す可能性がある。
--------------------------------------------------------------------------------
********************************************************************************
2013/08/11
ELSES v0.03.18 Release Candidate (elses-v0.03.18-20130811-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/08/11
担当者名 星健夫

更新ファイル：
doc/quick-start.pdf
doc/quick-start-e.pdf

内容：
Quick start更新

詳細：
2.5節「sample test toolの実行」を更新。
sample test toolの更新(2013/8/10更新(1)-(6))を反映。

texファイル(quick-start-e_20130811.tex, quick-start_20130811.tex)はdoc_workにあり。
--------------------------------------------------------------------------------
日付 2013/08/10(6)
担当 星健夫

新規ファイル：
sample/shell_scripts/result/result_elses_sample_test.txt

更新内容：
sample test tool全体のresult fileを用意。

詳細：
compile後、
$ cd ./sample/
$ ./shell_scripts/elses_sample_test.sh > result_elses_sample_test.txt
として出来たファイルを、保存したもの。

現在の内容は、以下：
------------------------------------------------------------------------------
ELSES sample test
------------------------------------------------------------------------------
TEST for C6H6_opt (GENO)
2013/08/09 PM 06:56:12
.....Total Simulation time (sec )    =                       0.10900
------------------------------------
TEST for C6H6_dyn (GENO)
2013/08/09 PM 06:56:12
.....Total Simulation time (sec )    =                       0.19280
------------------------------------
TEST for VCNT_100atom (non-geno) 
    (with generation of initial XML file and final eigen values)
2013/08/09 PM 06:56:13
.....Total Simulation time (sec )    =                       3.92220
.....Checking the resultant eigen levels 
------------------------------------
TEST for Au_NW_0143atom (non-geno;NRL) 
    (with generation of the element file)
2013/08/09 PM 06:56:17
.....Total Simulation time (sec )    =                       7.52500
ELSES sample test .... ended successfully, if no numerical data appears above
------------------------------------------------------------------------------
ELSES band calculation test : carbon diamond with Cerda spd orbitals
 test> ../../../../bin/elses -band -verbose ./config.xml > logfile.txt
 test> ../../../../bin/band > log-band.txt
 test> diff EigenEnergy.txt result/EigenEnergy.txt
---> Test ended successfully, if no numerical data appears above
--------------------------------------------------------------------------------
日付 2013/08/10(5)
担当 星健夫

更新ファイル：
sample/sample_geno/C6H6_opt/result下のファイル

更新内容：
sample test tool用result file入れ替え。

詳細：
sample/sample_geno/C6H6_opt/result下のファイルは、以下：
Output.txt
eigen_state_000001.cube.header
eigen_state_000002.cube.header
eigen_state_000003.cube.header
log-node000000.txt
logfile.txt
output_C.xml
output_H.xml
output_participation.txt
output_wavefunction.txt
position.xyz
restart.xml
--------------------------------------------------------------------------------
日付 2013/08/10(4)
担当 星健夫

更新ファイル：
sample/shell_scripts/elses_test.sh
sample/shell_scripts/elses_sample_test.sh

新規ファイル：
sample/shell_scripts/elses_sample_wavefunction_test.sh

更新内容：
sample test tool (shell script)を更新。
ELSES本体には影響なし。

メモ：
波動関数に対するsample testは
sample/shell_scripts/elses_sample_wavefunction_test.sh
として独立させ、標準テスト
sample/shell_scripts/elses_sample_test.sh
からは呼ばないことにした。
--------------------------------------------------------------------------------
日付 2013/08/10(3)
担当 星健夫

新規ファイル：
sample/shell_scripts/replace_result.sh

更新内容：
実験的機能の追加(sample test tool関連)。
未完成で、今のところ、使われていない。

解説：
sample下のいくつかのデータにはresultディレクトリがあって、結果が入っている。
例：sample/sample_geno/C6H6_opt/result
このresultディレクリ下のファイルを自動で入れ替えるためのツール。
まだ未完成。
--------------------------------------------------------------------------------
日付 2013/08/10(2)
担当 星健夫

更新ファイル：
sample/sample_non_geno/CNT100atom_dyn/config.xml
sample/sample_non_geno/CNT100atom_dyn/result/Output.txt 
sample/sample_non_geno/CNT100atom_dyn/result/output_eigen_levels.txt 

更新内容：
sample dataの微修正。

詳細：
1000iteから100iteへ反復回数を変更。
対応して、result下のファイルも総入れ替え。
--------------------------------------------------------------------------------
日付 2013/08/10
担当 星健夫

更新ファイル：
tool/band/samples/shell_scripts/elses_test_band.sh

更新内容：
band計算用sample test tool(shell script)の微修正。
数値計算結果に影響なし。

詳細：
上記shell scriptは、
tool/band/samples/band-diamond-spd/
下のデータを自動実行するもので、標準test tool
sample/shell_scripts/elses_sample_test.sh
から呼ばれている。
修正点としては、
中間ファイル(OverlapAndHamiltonian.txt)が非常に大きい(1GB)のため、
test後に削除するようにした。
--------------------------------------------------------------------------------
日付 2013/07/27(2)
担当 星健夫

更新ファイル：
src/elses-eig-leg.f90
sample/sample_geno/C6H6_opt/result下のファイル全部

更新内容：
対角化ソルバーでの、固有ベクトルの符号自由度を固定。
物理的議論に影響はない。

詳細：
書き替えたルーチンは、elses_eig_mateig。
固有ベクトルv ( H v = e S v )には、符号の自由度(v → -v)が存在し、
これは計算機環境(LAPACKの実装方法)によって変わりうる。
そこで、この自由度をsettleさせるために、
LAPACKの対角化直後に、
「sum_i v(:) < 0なら、v : = - v (符号反転)」
という操作をすることにした。

なお、sample/sample_geno/C6H6_opt/result下を書き替えたのは、
上記変更にともない、output_wavefunction.txtが変更されるため。
--------------------------------------------------------------------------------
日付 2013/07/27
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.17→v0.03.18)
--------------------------------------------------------------------------------
********************************************************************************
2013/07/02
ELSES v0.03.17 Released (elses-v0.03.17-20130611-rel.tgz)
Note: identical to RC
********************************************************************************
********************************************************************************
2013/06/11
ELSES v0.03.17 Release Candidate (elses-v0.03.17-20130611-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/06/11(2)
担当 星健夫

更新ファイル：
sample/shell_scripts/elses_sample_test.sh

新規ファイル：
sample/sample_geno/C6H6_opt/result/eigen_state_000001.cube.header
sample/sample_geno/C6H6_opt/result/eigen_state_000002.cube.header
sample/sample_geno/C6H6_opt/result/eigen_state_000003.cube.header

更新内容：
elses_sample_test.shにcube file生成を追加する。

詳細：
sample/sample_geno/C6H6_opt
で、下記を実行する。
../../../bin/elses-generate-cubefile 1 3 > log-generete-cube.txt
head -n 100 ./eigen_state_000001.cube > eigen_state_000001.cube.header
head -n 100 ./eigen_state_000002.cube > eigen_state_000002.cube.header
head -n 100 ./eigen_state_000003.cube > eigen_state_000003.cube.header
diff ./eigen_state_000001.cube.header ./result
diff ./eigen_state_000002.cube.header ./result
diff ./eigen_state_000003.cube.header ./result

注：eigen_state_000001.cube.headerは、最初の100行のみを記載したファイル。
（ファイル全体は大きいので）
--------------------------------------------------------------------------------
日付 2013/06/11
担当 西野信也

ファイル：
/tool/plot_eigenstates/src/elses-generate-cubefile.f90

更新内容：
波動関数可視化ツールにおいて、single-zeta形式の入力ファイル（またはデフォルト）を
読み込んだ時に、C1=0.0として規格化の計算をしていたので、この点を修正した。
single-zeta、double-zetaどちらの形式の入力ファイルでも動作する事を確認した。
--------------------------------------------------------------------------------
日付 2013/05/28(2)
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-ini-load-geno.f90
src/lses-qm-solver-gkrylov-dst.f90
sample/sample_geno_mpi/C_liq_01728atom_dst/config.xml
sample/sample_geno_mpi/C_liq_01728atom_dst_cell_change_only/config.xml
sample/sample_geno_mpi/C_liq_01728atom_dst_opt/config.xml
sample/sample_geno_mpi/C_liq_13824atom_dst/config.xml

内容：
実験的機能の追加（丸め誤差対策としての整数電子数処理）。
従来機能に影響なし。

詳細：
元素ごとの電子数・系全体の電子数が、
厳密に整数である場合（ほとんどの計算系は該当する）、
本指定をすると、丸め誤差のcorrectionを行ってくれる。

Element XML fileをユーザーが書いた場合など、
元素ごとの電子数（例えば炭素なら４であるべき）が、
丸め誤差のため(倍精度での)厳密な整数値になっていない場合がある(下記注)。
これを補正する。
この機能が発動すると、log nodeに以下のようなメッセージが（何カ所か）出る。
INFO:integer_elec_num corrction (befor) : val_elec_atom=    1                  3.99999999999999955591
INFO:integer_elec_num corrction (after) : val_elec_atom=    1                  4.00000000000000000000
実装としては、anint関数を使って、
val_elec_atm(nss)=anint(val_elec_atm(nss))
と補正している。
全電子数に大しての同様の補正も合わせておこなう。

使い方：
calcタグ内に、
  <use_integer_elec_num    />
または
  <use_integer_elec_num    mode="on" />
と書く。該当タグなしか
  <use_integer_elec_num    mode="off" />
と書くと、機能しない。

sample/sample_geno_mpi下のconfig.xmlについては、
本タグを追加しておいた。

注：
Element XML fileでは、
軌道ごとのoccupationを(非整数として)指定し、
それらの和として元素ごとの電子数を計算している。
--------------------------------------------------------------------------------
日付 2013/05/28
担当者名 星健夫

新規ファイル：
src/elses-lib-quad-precision.f90

更新ファイル：
src/elses-ini-load-geno.f90
src/Makefile (上記新規ファイルを追加しただけ)

内容：
4倍精度テスト計算ルーチンの追加。
4倍精度が(compilerで)正しく扱われているかどうかのチェックするだけ。
計算結果には影響なし。

詳細：
初期設定(MD loop前)中にテストをする。
テストには、
π = 4 atan (1) 
をつかった。verboseモードの場合、下記内容がlog nodeに出力される。
@@ Quad precision test for pi (= 4.0 * atan(1.0))  
 Double precision : pi =    3.1415926535897931159979634685441851620000
 Quad   precision : pi =    3.1415926535897932384626433832795027970000
 Reference  value : pi =    3.141592653589793238462643383279502884197169399375
     (eye guide)              123456789012345678901234567890123456789012345678
INFO:Quad precision test ... OK
注：verboseモードでない場合は、最終行だけ出力される。
注：「Reference value」はMaximaで計算し、Walfram alphaなどで確認した値。
　　文字列として貼っているだけ。

補足：
４倍精度の表現は以下のようにしている：
  integer,  parameter :: QUAD_PRECISION = selected_real_kind(p=30)  
  real(QUAD_PRECISION)   :: value_quad
  value_quad   = 4.0_QUAD_PRECISION * atan(1.0_QUAD_PRECISION)

補足：上記「selected_real_kind」の参考URL
http://www.nag-j.co.jp/nagfor/faq.htm#faq46
http://gcc.gnu.org/onlinedocs/gfortran/SELECTED_005fREAL_005fKIND.html
--------------------------------------------------------------------------------
日付 2013/05/26(3)
担当者名 星健夫

更新ファイル：
src/elses-ini-load-common.f90

内容：
DST-MATOMワークフローの修正。
計算結果に影響なし。

詳細：
DST-MATOMワークフローでは、下記配列をallocateせず；
j2js, j2ja, js2j
該当ルーチン：ini_misc_set_geno [M_ini_load_common] (elses-ini-load-common.f90)

CallTree抜粋
- elses_md_main_01
|   - show_mpi_info
|   - ini_load_geno
|   |   - make_db_element_name
|   |   - show_db_element_name
|   |   + load_xml_config
|   |   + check_xml_compat
|   |   + setting_for_main_output
|   |   + ini_load_common
|   |   + load_element_info
|   |   - set_tot_elec_num
|   |   - ini_misc_set
|   |   |   - elses_set_mass2
|   |   |   - ini_misc_set_geno　←ここでallocate
|   |   |   + elses_init_compat2
|   |   + for_conversion_mode
|   |   + elses_md_cell_change
|   |   - chk_input_data
--------------------------------------------------------------------------------
日付 2013/05/26(2)
担当者名 星健夫

更新ファイル：
src/elses-qm-solver-gkrylov-dst.f90
src/elses-la-gkrylov-main-dstm.f90

内容：
DSTワークフローでの不要変数の削除。
計算結果に影響なし。

詳細：
j_srcの削除。
( 定義：j_src=js2j(orb_index,atm_index) )
--------------------------------------------------------------------------------
日付 2013/05/26
担当者名 星健夫

更新ファイル：
src/code_for_mpi/elses-lib-mpi-wrapper.f90

内容：
エラーメッセージ増強。
計算結果に影響なし。

詳細：
allocation error時のエラーメッセージで、
配列のサイズも出すようにする。
--------------------------------------------------------------------------------
日付 2013/05/15(3)
担当者名 星健夫

更新ファイル：
src/elses-qm-output-levels.f90

内容：
ファイル出力の微修正。
計算結果に影響なし。

詳細：
固有値出力時の桁数を微修正。
--------------------------------------------------------------------------------
日付 2013/05/15(2)
担当者名 星健夫

更新ファイル：
sample/shell_scripts/elses_sample_test.sh
sample/shell_scripts/elses_test.sh

内容：
sample test (shell script)に、
sample/sample_non_geno/CNT100atom_dyn
のテストを追加。
これは、以下を行っている；
(1) XYZファイルからXMLファイルを作る
(2) ELESを実行する　(有限温度MD, 1000 step分)
(3) エネルギー経過を、result下のデータと比較する
(4) 最終MD stepでの固有値を、result下のデータと比較する
--------------------------------------------------------------------------------
日付 2013/05/15
担当者名 星健夫

追加ディレクトリ：
sample/sample_non_geno/CNT100atom_dyn

追加ファイル：
sample/sample_non_geno/CNT100atom_dyn/CNT.xyz
sample/sample_non_geno/CNT100atom_dyn/config.xml
sample/sample_non_geno/CNT100atom_dyn/generate.xml
sample/sample_non_geno/CNT100atom_dyn/result/Output.txt
sample/sample_non_geno/CNT100atom_dyn/result/output_eigen_levels.txt

内容：
sample追加(non-geno, CNT dynamics)
--------------------------------------------------------------------------------
日付 2013/05/14
担当者名 星健夫

更新ファイル：
src/elses-md-output.f90

内容：
標準出力の微修正。
計算結果に影響なし。

詳細：
Output.txtへのエネルギー書き出しで、
非常に大きな系になると出力桁数が足りなくなるため、
そのような場合には桁数を増やすようにformat文を場合分けした。
--------------------------------------------------------------------------------
日付 2013/05/11
担当者名 星健夫

更新ファイル：
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90

内容：
標準出力の微修正。
計算結果に影響なし。

詳細：
プログラム開始直後に、最低限のMPI情報を標準出力に出力する。
node logには出力されているが、エラー時にはファイルが生成されないことがあるため、
標準出力にも出しておく。

出力例１：dummy MPI wrapperを使った場合の、標準ファイルの冒頭：
 INFO-MPI:NO MPI routine is used.
 -----------------------
 |ELSES standard output|
 -----------------------

出力例２：true MPI wrapperを使った場合の、標準ファイルの冒頭：
 INFO-MPI:mpi_wrapper_initial(true routine)
 INFO-MPI:myrank, nprocs=           0           2
 INFO-MPI:mpi_wrapper_initial(true routine)
 INFO-MPI:myrank, nprocs=           1           2
 -----------------------
 |ELSES standard output|
 -----------------------
注：myrank=0,1,2,....,7のノードに対して、上記の情報が冗長に出力される。
--------------------------------------------------------------------------------
日付 2013/05/10
担当者名 星健夫

更新ファイル：
src/elses-ini-set-str-from-matom.f90

内容：
実験的機能の更新。
計算結果に影響なし。

詳細：
DSTワークフローで、matom構造体を使った際に、
matom構造体が不要になった段階でdeallocateするようにした。
--------------------------------------------------------------------------------
日付 2013/05/09
担当者名 星健夫

更新ファイル：
src/elses-md-dst-update-cell-booking.f90

内容：
微修正。

詳細：
1行の文字数制限を超過している部分があったので、改行を入れただけ。
(gfortranだと、compileが通らない。ifortなら問題なし)
--------------------------------------------------------------------------------
日付 2013/05/04
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.16→v0.03.17)
--------------------------------------------------------------------------------
***************************************************
2013/05/04
ELSES v0.03.16 Released (elses-v0.03.16-20130413-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2013/05/01
担当者名 星健夫

新規ファイル：
tool/band/src/plot_data.f90

更新ファイル：
tool/band/src/band.f90
tool/band/src/Makefile (上記新規ファイルを追加下だけ)

内容：
実験的機能の追加(band計算)。
従来機能に変化なし。

詳細：
band図計算の際に生成される、行列(Hermitian行列, Matrix Market形式)
と固有値を出力するルーチンを追加。
実験的ルーチンなので、今のところソースコード書き換えをしないと、発動しない。
band.f90のおける、
!  call plot_and_mask_matrix
（中略）
!  call plot_eigen_value
の2行。現状では上記のようにcomment outされている。
band.f90に追加したのは上記の（comment outされた）文だけ。
--------------------------------------------------------------------------------
日付 2013/04/25
担当者名 星健夫

新規ファイル
tool/band/samples/shell_scripts/elses_test_band.sh

新規データディレクトリ：
tool/band/samples/band-diamond-spd
tool/band/samples/band-diamond-spd/result

更新ファイル
sample/shell_scripts/elses_sample_test.sh

内容：
band図を書くsampleを作る・自動化ツールも追加。

詳細：
(1) band図を書くsampleを追加。
Cerda論文(2000)にあるspd基底を用いた、ダイヤモンド系。
結果をresultサブディレクトリに格納。

(2) (1)のsampleを使った、自動検証ツール用を作成。
tool/band/samples/shell_scripts/elses_test_band.sh

(3) (2)のband計算テストツールを、統合型自動検証ツールから呼ぶ
sample/shell_scripts/elses_sample_test.sh

注：統合型自動検証ツールの使い方
sampleディレクトリで
$ ./shell_scripts/elses_sample_test.sh
を実行する。問題なければ、以下のような出力になる。
ELSES sample test
  test C6H6_opt (GENO)
.....Total Simulation time (sec )    =                       0.18910
  test C6H6_dyn (GENO)
.....Total Simulation time (sec )    =                       0.28820
  test Au_NW_0143atom (non-geno;NRL) (with generation of the element file)
.....Total Simulation time (sec )    =                      26.41960
ELSES sample test .... ended successfully, if no numerical data appears above
ELSES band calculation test : carbon diamond with Cerda spd orbitals
 test> ../../../../bin/elses -band -verbose ./config.xml > logfile.txt
 test> ../../../../bin/band > log-band.txt
 test> diff EigenEnergy.txt result/EigenEnergy.txt
---> Test ended successfully, if no numerical data appears above
--------------------------------------------------------------------------------
日付 2013/04/16
担当者名 星健夫

更新ファイル：
sample/sample/sample_geno/C6H6_dyn/config.xml
sample/sample/sample_geno/C6H6_dyn/C6H6.xml
sample/sample/sample_geno/C6H6_opt/C6H6.xml
doc/quick-start.pdf
doc/quick-start-e.pdf

内容：
heatbath massの設定について、4/15更新に合わせた。

詳細：
C6H6_dyn/config.xml
→systemタグ内に、下記を追加：
  <heatbath_mass mode="on">
    <mass_per_atom unit="a.u."> 25.0d0 </mass_per_atom>
  </heatbath_mass>
C6H6_dyn/C6H6.xml
→heatbathタグを削除
C6H6_opt/C6H6.xml
→heatbathタグを削除
doc/quick-start.pdf
→Sec. 3.1.3 (温度と熱浴質量の設定)を更新
doc/quick-start-e.pdf
→Sec. 3.1.3 (Temperature and heat-bath mass)を更新

TeXソースファイル(doc_work)
quick-start_20130416.tex, quick-start-e_20130416.tex
--------------------------------------------------------------------------------
日付 2013/04/15
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90
sample/sample_non_geno/Au_NW_0143atom/config.xml
sample/sample_non_geno/Au_NW_0143atom/Au_nanowire_143atoms.xml
sample/sample_non_geno/Au_NW_0608atom/config.xml
sample/sample_non_geno/Au_NW_0608atom/Au_nanowire_608atoms.xml

内容：
heatbath massの値を、設定XMLファイルから設定できるようにした。
sample下の更新ファイルは、この仕様によって書かれたものにした。

詳細：
heatbath massの値は、設定XMLファイルでsystem tag内に以下の要領で書く。
  <heatbath_mass mode="on">
    <mass_per_atom unit="a.u."> 400.0d0 </mass_per_atom>
  </heatbath_mass>
(例：sample/sample_non_geno/Au_NW_0143atom/Au_nanowire_143atoms.xml)
注：mode="off"と設定すると、「tagを書かない」のと同じ状況になる。

node log (ファイル名の例：log-node000000.txt)に、以下の出力がでる。
INFO-XML:Optional tag detected : heatbath mass mode=on
INFO-XML:Optional tag detected : heatbath mass per atom [au]= 400.00000
INFO-XML:The tag of heatbath mass per atom in the structure XML file IS IGNORED

詳細な仕様：
heatbath massの値は、構造XMLファイルに書かれていることもある
（シミュレーションの継続データなど）。

設定の優先順位は、以下である。
(1) 設定XMLファイルに値がある場合
　→設定XMLファイルの値を採用(構造XMLファイル内の値は、無視される)
(2) 設定XMLファイルに値がない場合
　(2-1) 構造XMLファイルに値がある場合
　　→構造XMLファイルの値を採用
　(2-2) 構造XMLファイルにも値がない場合
　　→(heatbath mass per atom) = 25 a.u. に設定
　　（この値は推奨値ではない。ユーザーが適切に設定すべき）

注：一般論としての原則
・設定XMLファイル→ユーザーが手動で書くもの
・構造XMLファイル→機械的に生成するもの
・両者の設定が矛盾するときは、設定XMLファイルが優先する。
--------------------------------------------------------------------------------
日付 2013/04/14
担当者名 星健夫

追加ディレクトリ：
sample/sample_non_geno/Au_NW_0143atom
sample/sample_non_geno/Au_NW_0143atom/result
sample/sample_non_geno/Au_NW_0608atom

更新ファイル：
sample/shell_scripts/elses_sample_test.sh

内容：
sample追加。

詳細：
NRL系のsampleを追加。
Au_NW_0143atom (金ナノワイヤ143原子系, resultディレクトリに結果あり)
Au_NW_0608atom (金ナノワイヤ608原子系)

sample実行ツール(elses_sample_test.sh)で、
上記143原子を追加し、NRL系列の試験とした。
下記のようになる：
$ cd sample
$ ./shell_scripts/elses_sample_test.sh 
ELSES sample test
  test C6H6_opt (GENO)
.....Total Simulation time (sec )    =                       0.07810
  test C6H6_dyn (GENO)
.....Total Simulation time (sec )    =                       0.09290
  test Au_NW_0143atom (non-geno;NRL) (with generation of the element file)
.....Total Simulation time (sec )    =                       7.31440
ELSES sample test .... ended successfully, if no numerical data appears above

注：上記金ナノワイヤ系の詳細は、下記論文を参照：
[1] Y. Iguchi, T. Hoshi, T. Fujiwara
Phys. Rev. Lett. 99, 125507 (2007)
http://dx.doi.org/10.1103/PhysRevLett.99.125507
[2] T. Hoshi, T. Fujiwara, 
J. Phys.: Condens. Matter 21, 272201, (2009)
http://dx.doi.org/10.1088/0953-8984/21/27/272201
--------------------------------------------------------------------------------
********************************************************************************
2013/04/13
ELSES v0.03.16 Release Candidate (elses-v0.03.16-20130413-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/04/13
担当者名 星健夫

更新ファイル：
doc/quick-start.pdf
doc/quick-start-e.pdf

内容：
Quick start更新

詳細：
次の点：
(1) 7.5節(v.0.03.16での重要な更新; sampleディレクトリの再構成)を追加。
(2) 2.2節(ELSES の実行)を修正。sampleディレクトリの再構成を反映させた。
(3) 2.5節「sample test toolの実行」を追加。

texファイル(quick-start-e_20130413.tex, quick-start_20130413.tex)はdoc_workにあり。
--------------------------------------------------------------------------------
日付 2013/04/05
担当者名 星健夫

更新ファイル：
src/elses-md-main.f90
src/elses-ini-load-common.f90
src/elses-qm-projection-suggest.f90

内容：
コード整備。
計算結果に影響なし。

詳細：
elses-md-main.f90
→標準出力のみの変更
elses-ini-load-common.f90
→非常に大きい系でのエラーチェック。
ぐたいてきにはinteger(4)の限界値
　 huge(0)=2,147,483,647 (約21億)
に関わるエラーチェック。
elses-qm-projection-suggest.f90
→suggest_proj_radiusにエラーチェック機能を追加。
( suggest_proj_radius < 2 [au] )だと、エラーになるようにする。
--------------------------------------------------------------------------------
日付 2013/04/04
担当者名 星健夫

更新ファイル：
src/elses-qm-chk-allocated.f90

内容：
DSTワークフロー整備。

詳細：
4/3更新の修正。
--------------------------------------------------------------------------------
日付 2013/04/03
担当者名 星健夫

新規ファイル：
src/elses-qm-chk-allocated.f90

更新ファイル：
src/elses-qm-solver-gkrylov-dst.f90
src/Makefile (上記新規ファイルの追加のみ)

内容：
DSTワークフロー整備。従来機能に変化なし。

詳細：
allocation状況をモニターできるようにした。
--------------------------------------------------------------------------------
日付 2013/04/02
担当者名 星健夫

新規ファイル：
tool/experimental/mk_supercell_xyz/mk_supercell_xyz.f90
tool/experimental/mk_supercell_xyz/diamond_in_cubic_cell.xyz
tool/experimental/mk_supercell_xyz/input_supercell_size.txt
tool/experimental/mk_supercell_xyz/mk_diamond_cubic_cell.f90
tool/experimental/mk_supercell_xyz/generate.xml

説明：
大規模系(おおむね数万原子以上)むけsupercell構造作成用の、実験的ツール
(mk_supercell_xyz.f90)。
および、サンプルデータなどの関連ファイル。
今のところ、ELSESのmake時にはコンパイルされない。

詳細：
Supercell構造作成ツールとしては、
tool/Perl/mkSupercell.pl
があるが、大規模系では(メモリ・計算時間が巨大になり)現実的でなくなる。
そのような場合でも使えるツールの需要があったので、暫定的に提供。

本ツールは、cell(並進対称)ベクトルが直交している場合、つまり
(AX,  0,  0)^T 
( 0, AY,  0)^T
( 0,  0, AZ)^T
である場合のみ、対応している。

このツールの入出力ファイルは以下であり、
それぞれの例が上記ディレクトリにあがっている。
入力(a)：original構造ファイル(cell情報付きXYZ形式)
例：diamond_in_cubic_cell.xyz
→ダイヤモンド構造(8原子からなるcubic cell)データファイル。
→使うときは「structure_org.xyz」(ファイル名固定)に改名する必要がある。
入力(b)：supercellの拡大周期情報(x, y, z方向の拡大周期を整数値(NX,NY,NZ)で指定)
例：input_supercell_size.txt
→NX=10, NY=40, NZ=80, の場合（一行「10 40 80」と書いてあるだけ）。
→そのまま、使う(ファイル名固定)。
出力：supercell構造ファイル(cell情報付きXYZ形式)
例：diamond_in_super_cell.xyz
（上記入力ファイルを使った場合の結果ファイル）
→実際の出力ファイルは「structure_new.xyz」となる(ファイル名固定)。

注：「cell情報付きXYZ形式ファイル」とは、１行目に原子数Nと
cell情報(Angstrom単位)が１行目に、
N  AX AY AZ
と記されているファイル形式である(cf. QuickStart Sec. 3.1.11)。

以下、上記データファイルを用いた作業手順を述べる。

(1) original構造ファイルを、cell情報付きXYZファイルとして用意する。
一般的には、手作業（または他ソフト）で生成する。
上記ディレクトリはサンプルデータとして、
diamond_in_cubic_cell.xyz
がある。
参考：上記サンプルデータを作成するsimpleなツールとして
mk_diamond_cubic_cell.f90
が、上記ディレクトリにある。
コンパイルして実行(入力ファイルなし)するだけ。

(2) supercellの超周期構造の情報が記載されたファイル
input_supercell_size.txt
も入力ファイルとして必要。

(3) Supercell構造作成ツールは、
mk_supercell_xyz.f90
である。これを単体でコンパイルする。例：
ifort mk_supercell_xyz.f90
以下では、できた実行ファイルをa.outとする。

(4) 以下のように実行する
cp diamond_in_cubic_cell.xyz structure_org.xyz
./a.out

(5) 標準出力に、以下ができる。
Input file : input_supercell_size.txt
 -->   nx, ny, nz  =        10        40        80
Input file : structure_org.xyz
 -->      N        =         8
 -->  ax,ay,az [A] =        3.5479998469        3.5479998469        3.5479998469
Output file : structure_new.xyz
 -->      N        =    256000
 -->  ax,ay,az [A] =       35.4799984686      141.9199938742      283.8399877484

(6) 実行後、structure_new.xyzというファイルができている。
冒頭は、下記のようになる：
         256000       35.4799984686      141.9199938742      283.8399877484
# generated by mk_supercell_xyz.f90 (build 20130402)
C         0.00000000000000000000        0.00000000000000000000        0.00000000000000000000
C         0.88699996171382866628        0.88699996171382866628        0.88699996171382866628
C         1.77399992342765733255        1.77399992342765733255        0.00000000000000000000
C         2.66099988514148577678        2.66099988514148577678        0.88699996171382866628
C         1.77399992342765733255        0.00000000000000000000        1.77399992342765733255
C         2.66099988514148577678        0.88699996171382866628        2.66099988514148577678
C         0.00000000000000000000        1.77399992342765733255        1.77399992342765733255
C         0.88699996171382866628        2.66099988514148577678        2.66099988514148577678
C         3.54799984685531466511        0.00000000000000000000        0.00000000000000000000
C         4.43499980856914355343        0.88699996171382866628        0.88699996171382866628


(7) structure_new.xyzのcell情報(AX, AY, AZ)は引き継がれないので、
補助XMLファイル(典型名：generate.xml)
に自分で書き込む(QuickStart Sec. 3.5.2参照)。
上記ディレクトリにある、
generate.xml
が、該当ファイルになっている。
generate.xmlの全文は、以下：
<?xml version="1.0" encoding="UTF-8"?>
<?xml version="1.0" encoding="UTF-8"?>
<generate name="structure_new">
  <unitcell>
    <vector unit="Angstrom"> 35.4799984686    0.0              0.0             </vector>
    <vector unit="Angstrom">  0.0           141.9199938742     0.0             </vector>
    <vector unit="Angstrom">  0.0             0.0            283.8399877484    </vector>
  </unitcell>
  <cluster structure="structure_new.xyz">
  </cluster>
</generate>

(8) elses-xml-generateを使って、XMLファイルを作る：
../../../bin/elses-xml-generate generate.xml structure_new.xml
結果として、XMLファイル
structure_new.xml
が生成される。
--------------------------------------------------------------------------------
日付 2013/03/29 (4)
担当者名 星健夫

更新ファイル：
sample/sample_geno_mpi/C_liq_01728atom_dst_cell_change_only/config.xml

内容：
DST用サンプルの微修正。
結果に変わりはない。

詳細：
use_matomタグを追加。
--------------------------------------------------------------------------------
日付 2013/03/29 (3)
担当者名 星健夫

更新ファイル：
src/elses-qm-dstm-ini-setting.f90
src/elses-qm-engine-dst.f90
src/elses-qm-dst-micro-mat.f90

内容：
DSTワークフロー整備。従来機能に変化なし。

詳細：
use_matomを使った計算の整備(続き)。
--------------------------------------------------------------------------------
日付 2013/03/29 (2)
担当者名 星健夫

新規ファイル：
src/elses-xml-sax-data-sync-matom.f90

更新ファイル：
src/elses-ini-set-str-from-matom.f90
src/elses-xml-sax-parser.f90
src/elses-ini-load-common.f90
src/Makefile (上記新規ファイルの記述を追加)

内容：
コード整備。従来機能に変化なし。

詳細：
use_matomを使った計算の整備(続き)。
--------------------------------------------------------------------------------
日付 2013/03/29
担当者名 星健夫

更新ファイル：
src/elses-ini-load-geno.f90
src/elses-ini-load-common.f90
src/elses-qm-dst-projection-cell.f90
src/elses-md-motion.f90

内容：
コード整備。従来機能に変化なし。

詳細：
use_matomを使った計算の整備。
--------------------------------------------------------------------------------
日付 2013/03/28(5)
担当者名 星健夫

更新ファイル：
src/elses-qm-dst-domain.f90

内容：
03/28(3)更新の修正。
--------------------------------------------------------------------------------
日付 2013/03/28(4)
担当者名 星健夫

更新ファイル：
sample/shell_scripts/elses_test.sh

内容：
sample test tool類の整備。

詳細：
3/28(2)更新を修正。
result_newディレクトリは、やめる。
--------------------------------------------------------------------------------
日付 2013/03/28(3)
担当者名 星健夫

新規ファイル：
src/elses-ini-set-str-from-matom.f90

更新ファイル：
src/elses-xml-sax-handler.f90
src/elses-ini-load-common.f90
src/elses-ini-set-str-from-vatom.f90
src/elses-qm-domain.f90
src/Makefile (上記新規ファイルの記述を追加)

内容：
DSTワークフローの整備。
計算結果に変更なし。
--------------------------------------------------------------------------------
日付 2013/03/28(2)
担当者名 星健夫

更新ファイル：
sample/shell_scripts/elses_test.sh

内容：
sample test tool類の整備。

詳細：
各sampleディレクトリで、テスト時に出来た出力ファイルを
result_new
に移動するようにした。
例：sample/sample_geno/C6H6_opt/result_new
このディレクトリは、パッケージ配布時には、空である。
--------------------------------------------------------------------------------
日付 2013/03/28
担当者名 星健夫

新規ファイル：
src/elses-ini-set-str-from-vatom.f90

更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-xml-sax-parser.f90
src/elses-xml-sax-handler.f90
src/elses-md-save-struct.f90
src/elses-ini-load-common.f90
src/Makefile (上記新規ファイルを追加しただけ)

内容：
コード整備。
結果に変更なし。

詳細：
構造体の詳細な制御のため、以下を追加：
config%system%structure%use_matom
config%system%structure%use_vatom
--------------------------------------------------------------------------------
日付 2013/03/27(2)
担当者名 星健夫

更新ファイル：
src/elses-qm-solver-gkrylov-dst.f90
src/elses-qm-dst-domain.f90
src/elses-md-dst-update-cell-booking.f90

内容：
DSTワークフローの整理。
結果に変更なし。

詳細：
(verbose level)=2で、各種check機能が働くようにする。
--------------------------------------------------------------------------------
日付 2013/03/27
担当者名 星健夫

更新ファイル：
sample/shell_scripts/elses_sample_test.sh
sample/shell_scripts/elses_sample_test_for_mpi.sh

内容：
使い方が若干変わった。

詳細：
下記のように使う。
(1) 非MPI計算のテスト
cd sample
./shell_scripts/elses_sample_test.sh
(2) MPI計算のテスト(標準版)
cd sample
./shell_scripts/elses_sample_test_for_mpi.sh 2 
上記でテストされる系は以下：
sample/sample_geno_mpi/C_liq_01728atom_dst
sample/sample_geno_mpi/C_liq_01728atom_dst_opt
sample/sample_geno_mpi/C_liq_01728atom_dst_cell_change_only
(3) MPI計算のテスト(拡大版)
cd sample
./shell_scripts/elses_sample_test_for_mpi.sh 2 large
上記でテストされる系は以下：
sample/sample_geno_mpi/C_liq_01728atom_dst
sample/sample_geno_mpi/C_liq_01728atom_dst_opt
sample/sample_geno_mpi/C_liq_01728atom_dst_cell_change_only
sample/sample_geno_mpi/C_liq_13824atom_dst
-------------------------------------------------------------------------------
日付 2013/03/26
担当者名 星健夫

ファイル：
doc/quick-start.pdf

更新内容：
Quick Start(日本語版)で、「ですます調」を「である調」へ変更。
(他文書がすべて「である調」なので、
統一した方が文書作成能率があがるので）。

英語版の変更なし。
texファイル(quick-start_20130326.tex)はdoc_workにおいてあります。
-------------------------------------------------------------------------------
日付 2013/03/22(4)
担当者名 星健夫

新規ディレクトリ：
sample/sample_geno_mpi/C_liq_01728atom_dst_opt

更新ファイル：
sample/shell_scripts/elses_sample_test_for_mpi.sh

内容：
DST向けsampleデータ追加。
Optimization modeの確認用。
v0.03.15(正式版)で計算したデータが、下記にある：
sample/sample_geno_mpi/C_liq_01728atom_dst_opt/result

注：下記のようにすると、上記系を含むテストができる。
cd sample/sample_geno_mpi/
../shell_scripts/elses_sample_test_for_mpi.sh 2 large
-------------------------------------------------------------------------------
日付 2013/03/22(3)
担当者名 星健夫

更新ファイル：
src/elses-qm-engine-dst.f90
src/elses-md-alloc.f90
src/elses-ini-load-common.f90
src/elses-md-motion-verlet.f90
src/elses-md-motion.f90
src/elses-md-velocity-routines.f90

内容：
DSTワークフローで、配列のallocationを細かく制御。
計算結果に影響なし。

詳細：
DSTワークフローでは、下記arrayを、
不必要なときはallocateしないようにした。
foi
→calc_force_mode="off"のときは、allocateしない。
foiold
→dynamics mode以外では、allocateしない。
iflag
→optimization, dynamic mode以外では、allocateしない。

注：非DSTワークフローには影響を及ぼさない。
つまり、非DSTワークフローでは、上記配列はすべてallocateされる。
注：使っているところでは、
「allocateされているかどうか」を、チェックしてから使うようにする。

CallTree抜粋
- ini_load_geno
|   - make_db_element_name
|   - show_db_element_name
|   + load_xml_config
|   + check_xml_compat
|   + setting_for_main_output
|   - ini_load_common
|   |   + load_element_alloc
|   |   + load_structure_alloc　←ここでallocate
|   |   - allocate_velocity
|   |   + set_unitcell_info
|   |   - elses_md_motion_ini_set
-------------------------------------------------------------------------------
日付 2013/03/22(2)
担当者名 星健夫

新規ファイル：
src/elses-md-alloc.f90

更新ファイル：
src/elses-xml-02.f
src/elses-mod-01.f
src/Makefile (上記新規ファイルを追加しただけ)

内容：
旧style(*.f)で書かれたコードの整理。
計算結果に影響なし。

詳細：
下記配列のallocation部分：
jsei, tx, ty, tz, txp, tyz, tzp, foi, foiold, iflag
→array_alloc_for_md[M_md_alloc](elses-md-alloc.f90)でまとめてallocate

CallTree抜粋
- ini_load_geno
|   - make_db_element_name
|   - show_db_element_name
|   + load_xml_config
|   + check_xml_compat
|   + setting_for_main_output
|   - ini_load_common
|   |   + load_element_alloc
|   |   - load_structure_alloc
|   |   |   + array_alloc_for_md　←ここでallocate
|   |   |   - elses_alloc_amm
-------------------------------------------------------------------------------
日付 2013/03/22
担当者名 星健夫

sampleディレクトリを以下のように整備
sample_geno/ 
→geno系、非MPI計算
sample_geno_mpi/ 
→geno系、MPI計算
sample_non_geno/ 
→非geno系、非MPI計算
shell_scripts/
→sample testツール(下記３種)

新規ファイル：
shell_scripts/elses_sample_test.sh
shell_scripts/elses_sample_test_for_mpi.sh
shell_scripts/elses_test.sh

内容：
sampleディレクトリの整備。
sample test toolは一新
(ただし機能は変わらず。ファイルをまとめ直しただけ)。
それ以外に、sampleデータの追加・削除なし。

参考：
(1) sample test tool(非MPI版)の使い方
cd sample/sample_geno
../shell_scripts/elses_sample_test.sh
(2) sample test tool(MPI版)の使い方
cd sample/sample_geno_mpi/
../shell_scripts/elses_sample_test_for_mpi.sh 2
注：(2)については、従来の設定自由度が備わっている
　　(詳細：2013/03/16更新)。
-------------------------------------------------------------------------------
日付 2013/03/21(2)
担当者名 星健夫

新規ディレクトリ：
sample/sample/sample_for_mpi/C_liq_01728atom_dst_cell_change_only

更新ファイル：
sample/sample/sample_for_mpi/elses_sample_test_for_mpi.sh

内容：
DST用に新しいsampleを追加。
(cell-change-onlyモード用)。

詳細：
elses_sample_test_for_mpi.sh
のlarge test modeでは、 
C_liq_01728atom_dst_cell_change_only
のテストも行う。
-------------------------------------------------------------------------------
日付 2013/03/21
担当者名 星健夫

削除ファイル：
src/elses-qm-dst-dens-mat.f90

更新ファイル：
src/elses-qm-geno-csc-dst.f90
src/elses-qm-solver-gkrylov-dst.f90

内容：
DSTワークフローにおいて、不要なファイルを削除
計算結果に影響なし。

詳細：
use M_qm_dst_dens_matは消す。
下記配列は必要なので、elses-qm-solver-gkrylov-dst.f90に移動；
  real(8), allocatable :: e_num_on_atom_dst(:)    ! DIFFERENT VALUES AMONG NODES    
  real(8), allocatable :: e_num_on_basis_dst(:,:) ! DIFFERENT VALUES AMONG NODES    
-------------------------------------------------------------------------------
日付 2013/03/20(4)
担当者名 星健夫
 
更新ファイル：
src/elses-qm-engine-dst.f90
src/elses-qm-dstm-ini-setting.f90
src/elses-qm-solver-gkrylov-dst.f90

内容：
実験的機能の拡張(forceを計算しないmode)。
03/20(2)更新の続き。

詳細：
下記を使わないようにする：
atm_force_tb0(3,noav)
atm_force_csc(3,noav),

CallTree抜粋
- qm_engine_dst
|   - calc_kinetic_energy
|   - qm_domain_setting_dst
|   |   + initial_mcell_booking
|   |   - check_cell_booking
|   |   + qm_domain_ini_setting_dstm　←ここでallocate
|   - get_system_clock_time
|   + prep_cohp_dst
|   + initialize_charge
|   + qm_solver_gkrylov_dst
|   + qm_solver_gkrylov_dst
|   - rms_delta_q
|   - tune_mix_ratio
|   - renew_charge
|   - calc_total_force       　←ここで計算(foiに出力)
|   + qm_geno_output
|   - qm_calc_ecsc
-------------------------------------------------------------------------------
日付 2013/03/20(3)
担当者名 星健夫

新規ファイル：
src/elses-xml-compat-check.f90

更新ファイル：
src/elses-ini-load-geno.f90
src/elses-md-main.f90

内容：
設定XMLファイルにおける、エラーチェック整備。
DST, 非DSTワークフローにわけて、チェック。
計算結果に影響なし。

詳細：
新ルーチン
check_xml_compat [M_xml_compat_chk] (elses-xml-compat-check.f90)
で実行。

CallTree抜粋
- elses_md_main_01
|   - ini_load_geno
|   |   - make_db_element_name
|   |   - show_db_element_name
|   |   + load_xml_config
|   |   - check_xml_compat ←ここ！
|   |   + setting_for_main_output
|   |   + ini_load_common
|   |   + load_element_info
|   |   - set_tot_elec_num
|   |   + ini_misc_set
|   |   + for_conversion_mode
|   |   + elses_md_cell_change
|   |   - chk_input_data

elses-md-main.f90の更新は、
ここで行われていたチェックを上記新ルーチンに移動しただけ。
-------------------------------------------------------------------------------
日付 2013/03/20(2)
担当者名 星健夫
 
更新ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-geno-rest-dstm.f90
src/elses-qm-solver-gkrylov-dst.f90

内容：
実験的機能の拡張(forceを計算しないmode)。

詳細：
今のところ、本機能はDSTワークフローのみで、有効。
cell-change onlyモードなどで, forceを計算する必要のないときに利用する。
config.xmlにおいて、calcタグ内に以下を追加。
  <calc_force mode="off" />
Default mode: on

内部仕様：elses-config.f90の以下の部分
type :: calc_type
   character(len=20)   :: mode        ! "dynamics", "optimization" and so on                                                                     
   type(optimization_type) :: optimization
   type(genoOption_type)   :: genoOption
   type(limit_type)    :: limit
   type(dynamics_type) :: dynamics
   type(solver_type)   :: solver
   type(distributed_type)   :: distributed
   type(snapshot_type)      :: snapshot
   type(cell_change_type)   :: cell_change
   type(calc_check_type)    :: calc_check
   character(len=20)        :: calc_force_mode ←ここ("on" or "off")
end type calc_type
-------------------------------------------------------------------------------
日付 2013/03/20
担当者名 星健夫
 
更新ファイル：
src/elses-qm-dst-domain.f90

内容：
機能変化なし。
下記の不要ルーチンを削除
qm_domain_ini_setting_dst
set_booking_list_w_cell
-------------------------------------------------------------------------------
日付 2013/03/19/
担当 西野信也

ファイル：
elses-qm-output-eigenstates.f90
/tool/plot_eigenstates/src/elses-generate-cubefile.f90

更新内容：
s軌道とp軌道のdouble-zetaに波動関数可視化部分を対応させました。
-------------------------------------------------------------------------------
日付 2013/03/16
担当者名 星健夫
 
更新ファイル
elses_sample_test_for_mpi.sh

削除ファイル
elses_sample_test_for_mpi_large.sh

内容：
MPI計算用sample testツールの更新。
削除したelses_sample_test_for_mpi_large.shの機能は、
elses_sample_test_for_mpi.shに統合された。

解説：MPI計算用sample testツールの使い方、
MPI用にcompileした後で、動作検証用に実行する。

例1：標準テストをノード数＝２で実行する。
> sample/sample_for_mpi/elses_sample_test_for_mpi.sh 2
注：ノード数指定（上記の「2」）は、省略できない。
注：以下のsampleが実行される。
sample/sample_for_mpi/C_liq_01728atom_dst

例2：大型テストをノード数＝２で実行する。
> sample/sample_for_mpi/elses_sample_test_for_mpi.sh 2 large
注：ノード数指定（上記の「2」）は、省略できない。
注：以下のsampleが実行される。
sample/sample_for_mpi/C_liq_01728atom_dst
sample/sample_for_mpi/C_liq_13824atom_dst

例1を実行したときの結果：(2node, 6thread)
> ./elses_sample_test_for_mpi.sh 2 
ELSES sample test for MPI: the number of nodes = 2
  test C_liq_01728atom_dst
.....Total Simulation time (sec )    =                     194.05300
ELSES sample test .... ended successfully, if no numerical data appears above
--------------------------------
Information of the parallelism 
--------------------------------
 INFO-MPI:   mpi_is_active or not :  T
INFO-MPI: True  MPI wrapper
INFO-MPI-OMP: P_MPI, P_OMP=         2         6

例2を実行したときの結果：(2node, 6thread)
> ./elses_sample_test_for_mpi.sh 2 large
ELSES sample test for MPI: the number of nodes = 2
Large test mode
  test C_liq_01728atom_dst
.....Total Simulation time (sec )    =                     194.36710
  test C_liq_13824atom_dst
.....Total Simulation time (sec )    =                    1554.56110
ELSES sample test .... ended successfully, if no numerical data appears above
--------------------------------
Information of the parallelism 
--------------------------------
 INFO-MPI:   mpi_is_active or not :  T
INFO-MPI: True  MPI wrapper
INFO-MPI-OMP: P_MPI, P_OMP=         2         6

上記で、計算時間以外の数値データが現れていたら、テスト失敗を意味する。
-------------------------------------------------------------------------------
日付 2013/03/05
担当者名 星健夫
 
ディレクトリ移動：
sample_for_mpi/
を
sample/sample_for_mpi/
に移動
--------------------------------------------------------------------------------
日付 2013/03/03
担当者名 星健夫
 
更新ファイル：
src/elses-qm-dst-domain.f90
src/elses-qm-dstm-get-nna-distance.f90

内容：
エラー処理の更新。
2013/03/01(3)更新の微修正。
--------------------------------------------------------------------------------
日付 2013/03/01(3)
担当者名 星健夫
 
新規ファイル
src/elses-qm-dstm-get-nna-distance.f90

更新ファイル
src/Makefile
src/elses-la-gkrylov-main-dstm.f90

内容：
新ルーチン：get_nna_distance_dstm [M_dstm_get_nna_distance]
DSTワークフローで、nearest-neighbor-atom (NNA) distanceを得るルーチン。
今のところ使っているのは、
u^T S u
--------------------------------------------------------------------------------
日付 2013/03/01(2)
担当者名 星健夫

新規ファイル
sample_for_mpi/elses_sample_test_for_mpi.sh
sample_for_mpi/elses_sample_test_for_mpi_large.sh

ディレクトリ移動：
sample/C_liq_13824atom_dst
sample/C_liq_01728atom_dst
を
sample_for_mpi/C_liq_13824atom_dst
sample_for_mpi/C_liq_01728atom_dst
にそれぞれ移動。

内容：
MPI用のsampleをsample_for_mpi/下に移動。
また、MPI用sample test tool(shell script)として、
sample_for_mpi/elses_sample_test_for_mpi.sh
sample_for_mpi/elses_sample_test_for_mpi_large.sh
を追加。
前者は「標準テスト」ツールで、液体炭素1728原子系でのテストを行う。
後者は「拡大テスト」ツールで、くわえて、
液体炭素13824原子系でのテストを行う（時間がかかる）。

解説：
elses_sample_test_for_mpi.shを例に説明する。
(elses_sample_test_for_mpi_large.shでも同じ)
sample_for_mpi/上で
./elses_sample_test_for_mpi.sh
とすることで、MPI用テストができる。
(MPI並列度数)=2のテストをする。

テストが成功すると、以下のようにでる：
ELSES sample test for MPI (mpirun -n 2)
  test C_liq_01728atom_dst
ELSES sample test .... ended successfully, if no numerical data appears above
--------------------------------
Information of the parallelism 
--------------------------------
 INFO-MPI:   mpi_is_active or not :  T
INFO-MPI: True  MPI wrapper
INFO-MPI-OMP: P_MPI, P_OMP=         2         6
ただし、最後の「2 6」はMPI・OMP並列度数を表すため、
環境によって変わりうる。

参考：sample_for_mpi/elses_sample_test_for_mpi.shの全文
#!/bin/sh
echo 'ELSES sample test for MPI (mpirun -n 2)'
echo '  test C_liq_01728atom_dst'
cd C_liq_01728atom_dst
mpirun -n 2 ../../bin/elses -verbose ./config.xml > logfile.txt
grep 'Energy summary (eV/atom)' Output.txt > data.txt
grep 'Energy summary (eV/atom)' result/Output.txt > data_ref.txt
diff data.txt data_ref.txt
#cd ../
#echo '  test C_liq_13824atom_dst'
#cd C_liq_13824atom_dst
#mpirun -n 2 ../../bin/elses -verbose ./config.xml > logfile.txt
#grep 'Energy summary (eV/atom)' Output.txt > data.txt
#grep 'Energy summary (eV/atom)' result/Output.txt > data_ref.txt
#diff data.txt data_ref.txt
echo 'ELSES sample test .... ended successfully, if no numerical data appears above'
echo '--------------------------------'
echo 'Information of the parallelism '
echo '--------------------------------'
grep 'MPI' log-node000000.txt | grep 'mpi_is_active'
grep 'MPI' log-node000000.txt | grep 'wrapper'
grep 'INFO-MPI-OMP' Output.txt
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/03/01
担当者名 星健夫
 
新規ファイル
sample/elses_sample_test.sh

内容：
sample test tool(sample/elses_sample_test.sh)を微修正。動作に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/02/25(2)
担当者名 星健夫

更新ファイル
sample/C_liq_13824atom_dst/config.xml
sample/C_liq_01728atom_dst/config.xml
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-dst-domain.f90
src/elses-qm-domain.f90

エラーチェック機能(option)の追加。
原子間距離が近すぎる原子ペアを検出する。
計算結果に影響なし。

解説：原子間距離が近すぎる原子ペアを検出する。
入力座標を間違った場合など、
原子間距離がunrealisticに近すぎる原子ペアがあると計算が破綻することがある。
（注：重なり行列の数値的取り扱いによる破綻、など。
物理的観点から言うと、
ELSESでは内殻電子を陽に考えてはいないので、
原子間距離が近すぎるとunphysicalなことが起こりうる）。

このような状況が起こるときに備えて、
原子間距離が近すぎる原子ペアを検出することができる。
設定XMLファイル(典型名:config.xml)のcalcタグ内に、
下記の要領で追加する。
  <calc_check mode="on">
   <short_atom_pair_distance mode="on"> 
     <warning_level unit="angstrom">  0.5    </warning_level> 
     <abort_level   unit="angstrom">  0.1    </abort_level> 
   </short_atom_pair_distance> 
  </calc_check>
上記の場合、原子間距離が0.5 Angstrom以下の時は、
WARNING :Too short atom-pair distance:　（原子ペア、原子間距離の情報）
というメッセージが、標準出力にでる。原子間距離が0.1 Angstrom以下の時は、
ABORT   :Too short atom-pair distance:　（原子ペア、原子間距離の情報）
というメッセージが、標準出力にでて、強制終了する。
注：「mode="on"」というところを「mode="off"」とすると、
タグが無効（タグを書いていないことと同義）となる。
注：上記タグは、以下の設定XMLファイルには入っている：
sample/C_liq_01728atom_dst/config.xml
sample/C_liq_13824atom_dst/config.xml

内部仕様：
config構造体における、以下の値を利用
config%calc%calc_check%set : on/offの設定 (default:false)
config%calc%calc_check%short_atom_pair_distance%set  : on/offの設定 (default:false)
config%calc%calc_check%short_atom_pair_distance%warning_level : warningがでるしきい値
config%calc%calc_check%short_atom_pair_distance%abort_level   : abortになるしきい値

DSTワークフローでの検出ルーチン：set_projection_dst_cell [M_qm_domain_dst]
CallTree抜粋
- qm_engine_dst
|   - calc_kinetic_energy
|   + qm_domain_setting_dst
|   + prep_cohp_dst
|   + initialize_charge
|   + qm_solver_gkrylov_dst
|   - qm_solver_gkrylov_dst
|   |   + proj_init_compat
|   |   - set_dst_atm_list
|   |   |   - dst_get_atm_index_range
|   |   |   - suggest_proj_radius
|   |   |   + set_projection_dst_cell　←ここ！

非DSTワークフローでの検出ルーチン：make_booking_list[M_qm_domain]
CallTree抜粋
- elses_qm_engine
|   - calc_kinetic_energy
|   - qm_domain_setting
|   |   + qm_domain_ini_setting
|   |   - make_booking_list　←ここ！
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2013/02/25
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.15→v0.03.16)
--------------------------------------------------------------------------------
***************************************************
2013/02/25
ELSES v0.03.15 Released (elses-v0.03.15-20130204-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2013/02/19
担当 星健夫

新規ファイル
sample/elses_sample_test.sh

更新内容：
sampleデータ検証ツール(shell script)の追加。
sampleデータ
sample/C6H6_opt
sample/C6H6_dyn
を自動実行し、結果が正しいかどうかを数値的に確認する、shell script。

詳細；
shell scriptの実行内容は、
それぞれのディレクトリでELSESを実行し、それぞれの結果ファイル
sample/C6H6_opt/result/Output.txt
sample/C6H6_dyn/result/Output.txt
に含まれるエネルギー値と一致するのかを(diffを取る事で)検証する。

問題がなければ、下記のように出力される。
> ./elses_sample_test.sh
ELSES sample test
  test C6H6_opt
  test C6H6_dyn
ELSES sample test .... ended successfully, if no numerical data appears above

スクリプトの全文：
#!/bin/sh
echo 'ELSES sample test'
echo '  test C6H6_opt'
cd C6H6_opt
../../bin/elses -verbose ./config.xml > logfile.txt
mv Output.txt result/Output_new.txt
cd result/
grep 'Energy summary (eV/atom)' Output_new.txt > data_new.txt
grep 'Energy summary (eV/atom)' Output.txt > data.txt
diff data.txt data_new.txt
echo '  test C6H6_dyn'
cd ../../C6H6_dyn
../../bin/elses -verbose ./config.xml > logfile.txt
mv Output.txt result/Output_new.txt
cd result/
grep 'Energy summary (eV/atom)' Output_new.txt > data_new.txt
grep 'Energy summary (eV/atom)' Output.txt > data.txt
diff data.txt data_new.txt
echo 'ELSES sample test .... ended successfully, if no numerical data appears above'
--------------------------------------------------------------------------------
日付 2013/02/05/
担当 西野信也

ファイル：
calc_msd.f90

更新内容：
ファイル読み込み時のMDステップの標準出力を削除。
--------------------------------------------------------------------------------
********************************************************************************
2013/02/04
ELSES v0.03.15 Release Candidate (elses-v0.03.15-20130204-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2013/02/03(2)
担当 星健夫

更新ファイル
doc/quick-start-e.pdf
doc/quick-start.pdf

更新内容：
2/3更新(sampleデータの整理)の反映。他微修正。
texファイル(quick-start_20130203.tex, quick-start-e_20130203.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
日付 2013/02/03
担当 星健夫

更新ファイル
sample以下のデータ(詳細下記)

更新内容：
sampleデータの整理。

詳細：
(i) GENO系列と非GENO系列をわける。
　後者は、sample/sample_non_genoに移動。
(ii) 古い結果ファイルは削除。
　結果ファイルがあるのは４例（下記）とする。
　これらはresultというsubdirectoryに、結果ファイルがある。

sample以下のディレクトリ構成
| C6H6_dyn (結果付き) (対角化, ダイナミクス)
| C6H6_opt (結果付き) (対角化, 構造最適化)
| CF4
| C_liq_01728atom_dst (結果付き) (Krylov with DSTワークフロー)
| C_liq_13824atom_dst (結果付き) (Krylov with DSTワークフロー)
| Fe2
| FeO
| H2
| H2O
| H2O_dimer
| NO2
| SO2
| sample_non_geno
| | C60
| | C60s
| | CNT
| | C_liq_01728atom
| | C_liq_13824atom
| | Si_bulk_512atom
| | Si_bulk_large
| | nrl.param-check
--------------------------------------------------------------------------------
日付 2013/01/11(3)
担当 星健夫

更新ファイル
src/elses-mod-03.f

更新内容：
出力の微修正など。

詳細：
非DSTワークフローでのallocation部(ルーチンelses_alloc_mat1)で、
allocation前に必要メモリ量を出力。
また、非DSTワークフローの限界原子数を100万から300万に変更。
--------------------------------------------------------------------------------
日付 2013/01/11(2)
担当 星健夫

更新ファイル
src/elses-qm-domain.f90

更新内容：
出力の微修正。

詳細：
標準ファイルへの出力を抑制。
--------------------------------------------------------------------------------
日付 2013/01/11
担当 星健夫

更新ファイル
src/elses-xml-config.f90

更新内容：
出力の微修正。

詳細：
XML parser (DOM or SAX)をnode logに出力
例：
INFO-XML:XML parser= sax
--------------------------------------------------------------------------------
日付 2013/01/10
担当 星健夫

更新ファイル
src/elses-io-ctrl-plot-eigenstates.f90

更新内容：
非GENO系での修正。

詳細：
GENO系only向けのルーチン(ouput_eigenstates)
が、非GENO系で呼ばれることがあったので、修正。
--------------------------------------------------------------------------------
日付 2013/01/08
担当 星健夫

更新ファイル
src/elses-md-output.f90


更新内容：
Output.txtへchemical potentialの出力を追加。
--------------------------------------------------------------------------------
日付 2012/12/19(6)
担当 星健夫

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
動作確認用sampleの説明を、確認のとれた計算結果データのあるC6H6にする。
texファイル(quick-start_20121218.tex, quick-start-e_20121218.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
日付 2012/12/19(5)
担当者名 星健夫

新規ディレクトリ
sample/C6H6_opt
sample/C6H6_dyn

削除ディレクトリ
sample/C6H6

内容
sample更新。
動作チェック用に結果データも置く。
ベンゼンの構造最適化、および、有限温度ダイナミクス。

詳細：
sample/C6H6_optにおいて
../../bin/elses ./config.xml > log.txt
とした結果を置く。sample/C6H6_dynも同様。
ファイルリスト：
sample/C6H6_opt/C6H6.xml
sample/C6H6_opt/config.xml
sample/C6H6_opt/result_v0.03.15_at_20121219/Output.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/log-node000000.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/log.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/output_wavefunction.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/position.xyz
sample/C6H6_opt/result_v0.03.15_at_20121219/restart.xml
sample/C6H6_dyn/C6H6.xml
sample/C6H6_dyn/config.xml
sample/C6H6_opt/result_v0.03.15_at_20121219/Output.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/log-node000000.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/log.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/output_wavefunction.txt
sample/C6H6_opt/result_v0.03.15_at_20121219/position.xyz
sample/C6H6_opt/result_v0.03.15_at_20121219/restart.xml
--------------------------------------------------------------------------------
日付 2012/12/19(4)
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

内容
出力更新。結果に影響なし。

詳細：
config nameをnode logに主力。
config XMLファイルのうち、
<config name="XXX">
における「XXX」のこと。
--------------------------------------------------------------------------------
日付 2012/12/19(3)
担当者名 星健夫

更新ファイル
src/elses-eig-leg.f90

内容
出力更新。結果に影響なし。

詳細：
GENO対角化ソルバーで、LAPACKの消費時間をnode logに出力。
--------------------------------------------------------------------------------
日付 2012/12/19(2)
担当者名 星健夫

更新ファイル
src/elses-io-ctrl-plot-eigenstates.f90

内容
12/18(5),(6)更新が仕様通りでなかったので、修正
--------------------------------------------------------------------------------
日付 2012/12/19
担当者名 星健夫

更新ファイル
tool/xml-check/src/elses-xml-check.f90

tool(XML checker)更新。
ELSES本体に影響なし。

詳細：
チェックすべきタグを追加：convergence_criteria
--------------------------------------------------------------------------------
日付 2012/12/18(7)
担当者名 星健夫

更新ファイル
Makefile
Makefile.inc
Makefile.inc_release
Makefile.inc11
src/Makefile
src/*.f
src/*.f90
src/Nrl/*.f
src/Nrl/*.f90
src/code_for_mpi/*.f90
tool/*/*.f90
tool/*/*/*.f90
tool/*/*.f
tool/*/*/*.f
tool/Makefile
tool/plot_eigenstates/src/Makefile
tool/DOS/Makefile
tool/src/Makefile
tool/LDOS/src/Makefile
tool/MSD/src/Makefile

Copyright表示での年表記変更(2007-2013に)
--------------------------------------------------------------------------------
日付 2012/12/18(6)
担当者名 星健夫

更新ファイル
src/elses-io-ctrl-plot-eigenstates.f90

内容
12/18(5)更新が仕様通りでなかったので、修正
--------------------------------------------------------------------------------
日付 2012/12/18(5)
担当者名 星健夫

更新ファイル
src/elses-md-main.f90
src/elses-qm-geno-output.f90
src/elses-io-ctrl-plot-eigenstates.f90

内容
Steepest Descentでconvergedしたときの処理。

詳細：
wavefunctionタグが設定されていた場合に、
最終(converged)状態を書き出すようにする。
--------------------------------------------------------------------------------
日付 2012/12/18(4)
担当者名 星健夫

新規ファイル
src/elses-qm-engine-csc.f90
src/elses-md-output.f90
src/elses-qm-domain.f90
src/elses-ini-load-common.f90

内容：
CSC時にconverged iteとdqをOutput.txtに出力。

詳細：
新たに下記変数を導入
csc_ite_converged [M_qm_domain]
　CSCでconvergeしたときのCSC iteration number
csc_dq_converged [M_qm_domain]
　CSCでconvergeしたときのdq値

動作(1) 初期化：load_xml_config [M_ini_load_common]
csc_ite_converged = -1     ! dummy value                                                                                                         
csc_dq_converged  = -1.0d0 ! dummy value                                                                                                         

動作(2) 値の設定：qm_engine_csc
if ( dq < config%calc%genoOption%CSC_charge_convergence ) then
  write(*,'(a,i10,E13.6)') 'INFO:CSC loop is converged:loop num., dq=',i_csc_loop, dq
  csc_ite_converged = i_csc_loop
  csc_dq_converged  = dq
  exit
endif

動作(3) 出力
elses-md-output.f90
--------------------------------------------------------------------------------
日付 2012/12/18(3)
担当者名 星健夫

新規ファイル
src/elses-md-dst.f90
src/elses-00-main.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/elses-lib-mpi-wrapper-compile.f90 (elses-lib-mpi-wrapper-dummy.f90と同じ)

標準出力関連の微修正。

詳細；
プログラムが正常終了したときに出るメッセージを、微修正。
標準出力およびnode logに、以下のように出る。
MPI非利用時 (MPI wrapper routineが、互換(dummy)ルーチンのとき)
..... ELSES ended successfully (without MPI)
MPI利用時   (MPI wrapper routineが、真のMPIルーチンのとき)
..... ELSES ended successfully (with MPI)
--------------------------------------------------------------------------------
日付 2012/12/18(2)
担当者名 星健夫

新規ファイル
src/elses-md-output.f90

ファイル出力の微修正。計算結果に影響なし。

詳細：
config名のファイル出力を追加。
config名は、設定XMLファイルのconfigタグにあるname属性のこと。
例：<config name="C6H6_20121208">
これを、Output.txtの冒頭部分に
INFO: config_name = C6H6_20121208
と表示するようにした。
--------------------------------------------------------------------------------
日付 2012/12/18
担当者名 星健夫


更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.14→v0.03.15)
--------------------------------------------------------------------------------
***************************************************
2012/12/18
ELSES v0.03.14 Released (elses-v0.03.14-20121127-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2012/12/06(2)
担当者名 星健夫

新規ファイル
src/elses-qm-geno-output.f90
src/elses-qm-output-participation.f90

実験的機能の微変更(Participation ratioの出力)。

詳細：
以下の条件のとき、出力されるようにする。
（暫定的措置。本来は、独自タグを設けるべき）
・「wavefunction」タグが設定されている
・最終MD step
・verbose levelが1以上
ファイル名は「output_participation.txt」に固定。
機能内容は、2012/02/18更新を参照。
--------------------------------------------------------------------------------
日付 2012/12/06
担当者名 星健夫

更新ファイル
src/elses-qm-geno-output.f90
src/elses-io-ctrl-plot-eigenstates.f90
src/elses-qm-output-eigenstates.f90

波動関数(LCAO係数)データの連続保存を可能にした。
（従来は、最後のiterationのみ）。
ただし、この機能はGENO対角化(非DST)ワークフローでのみ利用可。

仕様：
wavefunctionタグで、下記のようにintervalを指定する。
<wavefunction filename="output_wavefunction.txt" interval="10" />

結果として、MD step数が入ったファイルに書き出される。例：
output_wavefunction_00000000.txt
output_wavefunction_00000010.txt
output_wavefunction_00000020.txt
ただし、最終MD stepでは、(intervalの値に関わらず)必ず書き出される。

また、interval属性を省略するか、
(interval値)=0と指定することで、(従来通り)最終MD stepのみで保存され、
そのときのファイル名は(従来通り)「output_wavefunction.txt」になる。
--------------------------------------------------------------------------------
日付 2012/12/05
担当者名 山元進
更新ファイル src/{elses-00-main,elses-qm-geno,elses-band-calc,elses-options}.f90 tool/band/src/band.f90
更新内容

ハミルトニアンと、オーバーラップマトリックスの値をやり取りする際、
テキストフォーマットだと時間がかかるとのことで、書式なし出力を利用する事ができるようにした。

elses -band=BinIO
band -BinIO

で書式なし入出力を利用可能。

--------------------------------------------------------------------------------
********************************************************************************
2012/11/27
ELSES v0.03.14 Release Candidate (elses-v0.03.14-20121127-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/11/27
担当者名 星健夫

追加ディレクトリ
sample/C_liq/result_geno_dst_20121127
sample/C_liq_13824atom/result_geno_dst_20121127

削除ディレクトリ
sample/C_liq/result_geno_dst_20120828
sample/C_liq_13824atom/result_geno_dst_20120828

sampleディレクトリでDST計算データを差し替え。
--------------------------------------------------------------------------------
日付 2012/11/15
担当者名 星健夫

更新ファイル
Makefile
src/elses-xml-sax-parser.f90

ファイル出力の微修正。計算結果に変化ないs。
--------------------------------------------------------------------------------
日付 2012/11/15
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.13→v0.03.14)
--------------------------------------------------------------------------------
日付 2012/10/15/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
v0.03.13における仕様変更部分を追加。
--------------------------------------------------------------------------------
***************************************************
2012/10/09
ELSES v0.03.13 Released (elses-v0.03.13-20120921-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
********************************************************************************
2012/09/21
ELSES v0.03.13 Release Candidate (elses-v0.03.12-20120921-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/09/09/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
Optimization modeの収束条件に関する記述を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/09/06
担当者名 星健夫

更新ファイル
src/elses-xml-sax-parser.f90

更新内容：
gfortranでコンパイルできない問題を修正

詳細：
1行あたりの文字数(132文字)を超過している行があったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/09/04
担当者名 星健夫

更新ファイル
src/elses-md-motion.f90

更新内容：
8/23更新（optimization modeでの収束判定）
が不十分だったので、の修正。

詳細：
dynamics modeで、設定回数だけiterationが回らない問題が発生していた。

メモ：
optimization modeでの収束判定は、elses_md_main_01の、下記部分。
>   call optimization_check(converged_in_optimization)
>       ! ---> Check the convergence (only in the optimization scheme)
>   if (converged_in_optimization) final_iteration = .true.
optimizationモード以外では、ルーチン「optimization_check」で
converged_in_optimization = .false.
となるべきだが、そうなっていなかった。これを修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/30(3)
担当者名 星健夫

更新ファイル
src/elses-mod-01.f
src/elses-md-main.f90
src/elses-qm-output-matrices.f90
src/elses-qm-engine.f90

更新内容：
実験的機能の更新（各種行列の書き出し）。
従来機能に変化なし。

メモ：
機能は、2012/07/05更新を参照。
該当ルーチンはoutput_levels_matrices。
なお、最初と最後のstepを検出するために、下記module variableを設定
・first_iteration [elses_mod_md_dat]
・final_iteration [elses_mod_md_dat]
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/30(2)
担当者名 星健夫

新規ファイル・ディレクトリ
sample/C6H6/config_20120830.xml
sample/C6H6/result_20120830（ディレクトリ）

更新内容：
sample更新。

詳細
設定XMLファイルおよび、それを使っての計算。
(GENO(No CSC)によるC6H6のoptimization)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/30
担当者名 星健夫

更新ファイル
src/elses-md-dst.f90

更新内容：
2012/08/29更新以降、非DSTワークフローで、
main output fileがでない場合がある問題を修正。

メモ：main output file初期設定のワークフロー
（8／29更新のメモをアップデート）

装置番号：output_unit [M_lib_dst_info]
（root node以外は、output_unit=-1 (dummy setting)）
ファイル名：config%output%main%filename

下記の手順で指定
(0) config%calc%distributed%root_nodeを設定。
 （非DSTワークフローでは、.true.、に設定）
(1) output_unit=-1 (dummy setting)
(2) 設定XMLファイル読み込み
→config%output%main%filenameを設定
(3) root nodeでのみ、output_unitを非ゼロに設定し、openする。

CallTree（一部）
+ elses_process_options
+ set_dst_initial・・・・・・・・・・・(0)
+ set_dst_write_log_file・・・・・・・・(1)
+ elses_band_calculation
- elses_md_main_01
|   - ini_load_geno
|   |   - make_db_element_name
|   |   - show_db_element_name
|   |   + load_xml_config・・・・・・・(2)
|   |   + setting_for_main_output・・・(3)
|   |   + ini_load_common
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/29(3)
担当者名 星健夫

更新ファイル
src/elses-md-output.f90
src/elses-md-motion.f90

更新内容：
Optimization modeでのファイル出力の強化。
計算結果に変更なし。

詳細：
Optimization modeのときのみ、
main output file(default名:Output.txt)に、
iterationでのエネルギー差δEを下記形式で出力。
 SD energy difference per atom [eV]=         1        0.00015499142578131788
2つの値は、それぞれ以下を意味する：
・step_count
・原子1個あたりのエネルギー差[eV]：δE / N_atom

メモ：
ここでのエネルギー差(δE)は、2012/08/23更新で定義されている量で、
sd_ratio, forceから決まる。

ワークフローのメモ：
下記の手順で計算
(1) δEを計算。
→ sd_energy_diff(1:4) [M_md_motion]
  (4成分は、total, x成分, y成分, z成分)
(2) sd_energy_diff(1)をもとに、ファイル出力。
注：CallTree抜粋
- elses_md_main_01
|   - optimization_check・・・・(1)
|   - elses_md_output_main
|   |   - output_energy・・・・ (2)
|   + elses_md_motion
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/29(2)
担当者名 星健夫

更新ファイル
src/elses-md-output.f90
src/elses-io-dst-write-log.f90

更新内容：
日付と時刻を表示を追加。

詳細：
log nodeファイルと、メインoutput fileの冒頭に、
下記のように、日付と時刻を表示する。
Date: 2012 08 29; Time: 15 21 36
（format：YYYY MM DD; HH MM SS）
内部的にはdate_and_timeルーチンを利用。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/29
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-lib-dst-info.f90
src/elses-io-dst-write-log.f90
src/elses-ini-load-geno.f90
src/elses-md-output.f90

更新内容
実験的機能の更新。
メインoutput fileのファイル名(Output.txt)を、変更可能にした。

詳細：
outputタグ内に、
<main filename="output-main.txt" />
の要領で、ファイル名を指定可能にした。
ファイル名以外の設定自由度はなし。
Defaultは（従来通り）「Output.txt」。

Optionとしては、mode属性がある。
・<main mode="custom_name" filename="output-main.txt" />
　→タグ有効化（mode属性を書かないのと同じ）
・<main mode="default_name" />
　→タグが無効化（タグを書かないのと同じ）。
・<main mode="default_name" filename="output-main.txt" />
　→タグが無効化（タグを書かないのと同じ）。

メモ：ワークフロー
装置番号：output_unit [M_lib_dst_info]
（root node以外は、output_unit=-1 (dummy setting)）
ファイル名：config%output%main%filename

下記の手順で指定
(1) output_unit=-1 (dummy setting)
(2) 設定XMLファイル読み込み
→config%output%main%filenameを設定
(3) root nodeでのみ、output_unitを非ゼロに設定し、openする。

CallTree（一部）
+ elses_process_options
+ set_dst_initial
+ set_dst_write_log_file・・・・・・・・(1)
+ elses_band_calculation
- elses_md_main_01
|   - ini_load_geno
|   |   - make_db_element_name
|   |   - show_db_element_name
|   |   + load_xml_config・・・・・・・(2)
|   |   + setting_for_main_output・・・(3)
|   |   + ini_load_common
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/28(2)
担当者名 星健夫

更新ファイル
src/elses-la-gkrylov-main-dstm.f90

更新内容
実験的機能の更新（DST用ファイルの微修正）。

詳細：
標準出力への大量出力を抑制しただけ。
結果に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/28
担当者名 星健夫

削除ファイル・ディレクトリ
sample/C_liq/config_geno_dst.xml
sample/C_liq/result_geno_dst_20120814 (ディレクトリ)
sample/C_liq_13824atom/config_geno_dst.xml
sample/C_liq_13824atom/result_geno_dst_20120814 (ディレクトリ)

新規ファイル・ディレクトリ
sample/C_liq/config_geno_dst_20120828.xml
sample/C_liq/result_geno_dst_20120828 (ディレクトリ)
sample/C_liq_13824atom/config_geno_dst_20120828.xml
sample/C_liq_13824atom/result_geno_dst_20120828 (ディレクトリ)

更新内容
実験的機能の更新
（DST用sample設定ファイルおよび結果ファイルの更新）。

詳細：
変更点は、以下の3点。
cutoff_radius=8.0 (←5.0d0)
projection=200（←100）
mode_for_suggest_projection=default（←upto_v0.03.08）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/27
担当者名 星健夫

新規ファイル
src/elses-qm-flexible-cutoff.f90

更新ファイル
src/elses-xml-config.f90
src/elses-la-matvec-routines-dstm.f90
src/elses-ini-load-geno.f90
src/elses-la-gkrylov-main-dstm.f90
src/Makefile (上記新規ファイルを追加しただけ）

更新内容
実験的機能の追加（gKrylovでのflexible cutoffの準備）。
従来機能に変化なし。

詳細：
flexible cutoffは、準備段階で、まだ機能しない。
目に見える違いは、
u^T S u 
が小さくなるときの出力をくわしくした点のみ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/23/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
Cell change only モードに関する節を追加。
texファイル(quick-start_20120823.tex, quick-start-e_20120823.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/23
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-main.f90
src/elses-md-motion.f90


更新内容
実験的機能の追加（optimization modeでの収束判定）。

詳細：
optimization modeでの収束判定条件をXMLで指定できるようにした。
現在できるのは「全エネルギー／原子数」での判定のみ。
例：設定XMLファイルにおいてcalc/optimizationタグ内に、以下の容量で追加する。
 <convergence_criteria mode="energy_per_atom" unit="eV"> 1.0d-5 </convergence_criteria>
タグがない場合、収束判定はされずに、calc/optimization/max_num_iterタグに書かれたstep数だけ実行される。
注：mode="off"で、タグを書かないのと等価になる。

結果は、node log (log-node000000.txtなど)に対して、
grep 'SD energy difference per atom (tot)' 
を行うことで、以下の要領でわかる：
  SD energy difference per atom (tot) [eV] =         1        0.01034615148788674450
  SD energy difference per atom (tot) [eV] =         2        0.00896509207833975572
  SD energy difference per atom (tot) [eV] =         3        0.00780286262325060979
  SD energy difference per atom (tot) [eV] =         4        0.00681917395384924480
  SD energy difference per atom (tot) [eV] =         5        0.00598224962354406472
  SD energy difference per atom (tot) [eV] =         6        0.00526679351694676456
自然数部分がステップ数を表し、実数部分がエネルギー変化量δEを全原子数Nで割り（|δE | / N ）、eV単位で表示したもの。
  |δE | / N < (上記タグで指定されたcriteria値) 
が満たされると、収束と判定され、計算が終了する。

注：ここでのエネルギー変化量δEは、SD　stepにおける各原子座標の変化量(δx_i, δy_i, δz_i)および、
各原子にかかる力(F_x_i, F_y_i, F_z_i)より、
 δE = \sum_i F_x_i δx_i + F_y_i δy_i + F_z_i δz_i)
で定義される。これはちょうど、次のstepとのエネルギー差
　E( x_i + δx_i, y_i + δy_i, z_i + δz_i) - E( x_i , y_i, z_i)
を、1次のTaylor展開で求めた表式に相当する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/22
担当者名 星健夫

更新ファイル
src/elses-md-cell-change.f90

更新内容
cell_change_onlyモードの修正。

詳細：
(1) cell_change_onlyモード、(2) GENO系 or NRL系、
(3) 周期系、(4) solver='eigen'、
の条件が全て満たされた場合に、
cell lengths変更と同時に
cutoff_radius=min(ax,ay,az)/2.01d0
とcutoffもscaleさせる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/21
担当者名 星健夫

更新ファイル
src/elses-md-save-restart-xml.f90

更新内容
split書き出し機能(8/10更新)が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/16(2)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90
sample/C60/config.xml
sample/C60s/config.xml
sample/CNT/config.xml
sample/C_liq/config.xml
sample/C_liq_13824atom/config.xml
sample/Si_bulk_512atom/config.xml
sample/Si_bulk_large/Si_bulk_4096atom/config.xml
sample/Si_bulk_large/Si_bulk_32768atom/config.xml

更新内容
default solverの仕様統一。

詳細：
これまでは、GENO&NRL系列とそれ以外とで、default solverが違っていた。
(GENO&NRL系列→eigen, それ以外→krylov)。
これをeigenに統一。

sampleファイルでの動作が同じになるように、
GENOでもNRLでもないsampleデータのconfigファイルには、calcタグ内に
<solver scheme="krylov">  </solver>
を追加。

ついでに、
dynamics計算での繰り返し回数を減らす（totalタグを20程度にする）ようにした。
繰り返し回数が多すぎてsampleデータの実行に時間がかかりすぎる、という意見に答えて。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/16
担当者名 星健夫

更新ディレクトリ
src/elses-md-main.f90

更新内容
実験的機能の更新(MPI経過時間表示の更新)。
計算結果に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/15(2)
担当者名 星健夫

更新ディレクトリ
src/elses-xml-sax-parser.f90

更新内容
実験的機能の更新(XMLファイルのsplit読み込み機能の修正)

詳細：
非split読みこみ時に生じうるバグを修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/15
担当者名 星健夫

更新ディレクトリ
sample/C_liq
sample/C_liq_13824atom

更新内容
sampleデータに結果ファイルを追加。

詳細：
検証用に、DST計算の結果ファイルを以下に追加：
sample/C_liq/result_geno_dst_20120814
sample/C_liq_13824atom/result_geno_dst_20120814

メモ：
8/11研究会での議論に基づき作成した
http://www.elses.jp/develop/ELSES-sample-extra-20120814.tgz
を、統合した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/10(5)
担当者名 星健夫

更新ファイル
src/elses-xml-sax-parser.f90

更新内容
XMLファイルのsplit読み込み機能の強化。

メモ：
split読み込みの際に、(MPI並列度数)≠(分割数)、にも対応。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/10(4)
担当者名 星健夫

更新ファイル
sample/C_liq/config_geno_dst.xml
sample/C_liq_13824atom/config_geno_dst.xml

更新内容
実験的機能の更新(DST用sampleデータ)

メモ：
systemタグ内に、下記行を追加した。
<split_input_file number_of_files="0" />
このタグは、分割ファイル読み込みのときのみ、意味をもつ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/10(3)
担当者名 星健夫

新規ファイル
sample/C_liq/config_geno_dst.xml
sample/C_liq/C_liq_1728atom_basic.xml

更新ファイル
sample/C_liq/C_liq_1728atom.xml

更新内容
実験的機能の更新(DST用sampleデータ)

メモ：
config_geno_dst.xml
→DSTワークフローむけの設定XMLファイル。
C_liq_13824atom/config_geno_dst.xmlと、同じ計算方法。
注：チュートリアルむけに、（すぐ結果がでる）本系(1728原子系)を用意。

C_liq_1728atom.xml
不要な速度データを削除

C_liq_1728atom_basic.xml
並列読み込み時に必要となるファイル。
elses-xml-generateから新規に作った。
（作り方は、2012/07/27更新を参照）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/10(2)
担当者名 星健夫

更新ファイル
src/elses-xml-sax-handler.f90
src/elses-md-save-restart-xml.f90

更新内容
実験的機能の更新(構造データのsplit書き出し)

メモ：SAX法における属性指定エラーチェック
begin_element内において、以下のようにする(cf. elses-xml-sax-handler.f90)
   call get_value(attributes,"atom_initial", chara_wrk, status)
   if ( (trim(chara_wrk) =='') .or. (status /=  0) ) then
      write(*,*)'ERROR(XML-SAX):No atom_initial attirbute:status=',status
      stop
   endif   
Ref. XMLF90_UserGuide.pdf
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/10
担当者名 星健夫


更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.12→v0.03.13)
--------------------------------------------------------------------------------
***************************************************
2012/08/09
ELSES v0.03.12 Released (elses-v0.03.12-20120723-rel.tgz)
Note: identical to RC4
***************************************************
--------------------------------------------------------------------------------
日付 2012/08/09(3)
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-save-restart-xml.f90

更新内容：
実験的機能の更新(構造データのsplit書き出し)。

メモ：構造XMLファイルの分割(split)書き出し(完成)
設定XMLの中に、以下の要領で属性を指定する。
例：<restart  filename="restart.xml" interval="2" split="on" number_of_split_files="4" />
・split属性：
　分割書き出しのon/offの設定。値は「on」または「off」(非指定は「off」に相当)。
・number_of_split_files属性(optional)：
　分割ファイル数。非指定時は、分割ファイル数=MPI並列度数、に設定される。　
上記の例だと、
restart_000000.xml
restart_000001.xml
restart_000002.xml
restart_000003.xml
の4つのファイルができる。
それぞれのファイルの内容は、2012/07/27更新に説明されている。
注：分割ファイル数は原子数以下でなければ、エラーになる。
　（目的を考えると、(分割ファイル数) << (原子数)、が通常の状況）

内部動作：
並列計算時の動作は、以下のとおり。
例1：(MPI並列度数)=4, (ファイル分割数)=4
　0番目のノード→restart_000000.xmlを出力。
　1番目のノード→restart_000001.xmlを出力。
　2番目のノード→restart_000002.xmlを出力。
　3番目のノード→restart_000003.xmlを出力。
例2：(MPI並列度数)=2, (ファイル分割数)=4
　0番目のノード→restart_000000.xml, restart_000002.xmlを出力。
　1番目のノード→restart_000001.xml, restart_000003.xmlを出力。
例3：(MPI並列度数)=8, (ファイル分割数)=4
　0番目のノード→restart_000000.xmlを出力。
　1番目のノード→restart_000001.xmlを出力。
　2番目のノード→restart_000002.xmlを出力。
　3番目のノード→restart_000003.xmlを出力。
  4番目以降のノード→何もしない
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/09(2)
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-main.f90
src/elses-md-save-struct.f90
src/elses-md-dst-get-atom-range.f90
src/elses-md-save-restart-xml.f90

更新内容：
実験的機能の更新((構造データのsplit書き出し)。
ただし、まだ途中。

メモ：
これまで構造データの書き出しはroot nodeでのみ行ってきた。
これを、全ノードで（分散して）行うことが可能にする。
（ただし、今のところsplit書き出しに対応しているのは、XMLファイルのみ）

ルーチン「elses_md_save_struct」における、以下の部分。

    if ( (save_at_this_node) .or. (split_save_mode) ) then
      call elses_xml_save_txp
!       ---> Copy structure data in config%system%structure%.....
      call save_restart_xml(final_iteration)
!       ---> Save restart XML file
    endif  
!
    if (save_at_this_node) then
      if ( trim(config%calc%mode) == "dynamics" ) then
        call save_velocity_data
      endif   
      call save_position_data
!       ---> Save position data for molecular visualization tools
    endif  
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/08/09
担当者名 星健夫

更新ファイル
sample/C_liq_13824atom/C_liq_13824atom.xml

更新内容：
上記ファイルから、不要なvelocity情報を消去した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/31
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90

更新内容：
実験的機能の更新(MPI関連)。

詳細
MPI barrier利用のon/offを決めるタグを設定。
消費時間のみに関連する自由度で、計算結果には無関係。

メモ：
該当変数(logical)
→config%calc%distributed%use_mpi_barrier
該当タグ：distributedタグ内で、以下のように設定。
→<use_mpi_barrier mode="on"/>
mode属性はon(default)またはoff。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/30 
担当者名 星健夫

更新ファイル
tool/xml-check/src/elses-xml-check.f90

削除ファイル
too/src/xml-check.f90

更新内容：
ツール更新(xml-check)。
ELSES本体には無関係。

詳細：
checkできるタグを追加。
不要ファイルを削除。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/29
担当者名 星健夫

更新ファイル
src/elses-xml-sax-handler.f90

更新内容：
実験的機能の更新(SAX読み込みの修正)。

詳細
2012/07/28更新が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/28
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-xml-sax-parser.f90
src/elses-xml-sax-handler.f90
src/elses-xml-sax-data-sync.f90

更新内容：
実験的機能の更新(DST版でのsplit読み込みモード)。

メモ：DST版での並列化読み込みモード
分割された構造XMLファイルを用意することで、ファイル読み込みを並列化する。
下記の手順をとる。
(1) 分割された構造XMLファイルを用意する。
MPI並列数と同じだけの、分割ファイルを用意する。
例えば4並列するときは、4ファイルに分割する。
具体的には、2012/07/27更新メモの(3)を参照。
(2) 設定XMLファイルで、clusterタグで「read_mode="split"」属性を付加する。
原子数指定もする。またsystemタグ内に、分割ファイル数を指定する。4並列なら
<splitted_input_file number_of_files="4" />とする。
例：systemタグの例(sample/C_liq_13824atom用)。
<system>
  <cluster structure="C_liq_13824atom.xml" parser="sax" tag_dump="off" read_mode="split" cutoff_radius="5.0d0" number_of_atoms="13824" />
  <splitted_input_file number_of_files="4" />
  <temperature unit="kelvin"> 6000.0 </temperature>
  <element  name="C" model="geno"  filename="C.xml" />
</system>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/27(2) 
担当者名 星健夫

更新ファイル
tool/src/elses-xml-generate.f90
sample/C60/generate.xml:    
sample/CNT/generate.xml:    
sample/C_liq/generate.xml:  
sample/C_liq_13824atom/generate.xml

削除ファイル
sample/C60s/generate.xml:    

更新内容：
実験的機能の更新(XML作成ツールelses-xml-generateの拡張

詳細：
2012/07/27更新が不十分だったので、修正。
generate.xmlでは不必要な部分を削除。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/27
担当者名 星健夫

更新ファイル
tool/src/elses-xml-generate.f90

更新内容：
実験的機能の更新(XML作成ツールelses-xml-generateの拡張)
従来の使い方は変化せず。

詳細：
DSTワークフローで使う入力ファイルを作ることができるように、拡張。
簡単に言うと、atom IDの付加、分割ファイル出力、ができる。

----------------------------------------
メモ：構造XMLファイル作成の拡張
----------------------------------------
以下では、出力構造ファイル名を「sample.xml」として説明。

(1) 従来と同じ使い方
操作：
> elses-xml-generate generate.xml sample.xml
または、
> elses-xml-generate generate.xml sample.xml -split=0
結果：
従来と同様、
sample.xml(構造ファイル)
ができる。内容は従来と全く同じ。
他に、'root_only'モードで使う、
sample_basic.xml (構造basicファイル)
ができる。
構造basicファイルの名称は、構造ファイル名から派生される。
例えば、構造ファイル名が「abc.xml」なら「abc_basic.xml」となる。

(2) atom IDを付加、ファイル分割はせず
操作：
> elses-xml-generate generate.xml sample.xml -split=1
結果：
(1)と同様に、
sample.xml (構造ファイル)
sample_basic.xml (構造basicファイル)
ができる。(1)との違いは、sample.xmlでの全atomタグに、ID属性がついていることだけ。
 <atom element="C" id="1" class="" motion="free">
注：ID属性の値は、1,2,3,....(全原子数)、となっている。
注：ID属性がついていても、問題なくELSESで入力できる。

(3) atom IDを付加、ファイル分割をする。
ELSES側でまだ対応していないので、
ここでできたファイルは今のところ使えない。
4ファイルに分割する場合を例に説明する。
操作：
> elses-xml-generate generate.xml sample.xml -split=4
結果：
sample_000000.xml
sample_000001.xml
sample_000002.xml
sample_000003.xml
sample_basic.xml (構造basicファイル)
ができる。構造basicファイルは、(1)(2)と同じ。
他の4ファイルが、分割された構造ファイル。
名称は、構造ファイル名から派生される。
分割された構造ファイルの特徴として、以下のようなsplitタグが入っている：
 <split file_index="2" number_of_files="4" atoms_in_this_file="3456" atom_initial="6913" atom_final="10368" >
それぞれの属性値の意味は、
　fine_index値：ファイル番号(例えば、sample_000002.xmlなら、file_index値=2)
  number_of_files値：ファイルの分割数
  atoms_in_this_file値：このファイルに入っている原子数
  atom_initial値：最初のatom ID
  atom_final値  ：最後のatom ID
注：N原子系を、M分割すると、j番目(j=0,1...)のファイルでは、
 atom_initial値 = j * N / M + 1
 atom_final値   = (j+1) * N / M 
のatom IDをもつ原子が記録されている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/26
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90
src/elses-xml-sax-parser.f90
src/elses-config.f90 (comment文のみ更新)
src/elses-ini-load-common.f90
src/elses-xml-sax-data-sync.f90

更新内容：
実験的機能の更新(DST版でのroot_only読み込みモード)。

詳細：
2012/07/25(3)更新の調整。使用法に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/25(3)
担当者名 星健夫

新規ファイル
src/elses-xml-sax-data-sync.f90 
sample/C_liq_13824atom/C_liq_13824atom_basic.xml

更新ファイル
src/elses-ini-load-common.f90
src/elses-xml-sax-parser.f90
src/Makefile (上記新規fortran fileの登録のみ)

更新内容：
実験的機能の更新(DST版でのroot_onlyモードでのXML読み込み)。

詳細：DST版でのroot_onlyモードでのXML読み込み
default(従来)は、全ノードで冗長に読みにいっている。
root_onlyモードでは、
rootのみで原子構造データを読み込んで、MPI通信で全ノードに伝える(SAX法のみ)。

準備としては、構造XMLファイルから原子情報(atomタグ)をのぞいたファイルを作る。
ファイル名は名称部分に「_basic」をつけたものにする。
このファイルを以下、構造basicファイル、と呼称する。
例えば、構造ファイルがC_liq_13824atom.xmlなら、
構造basicファイル名はC_liq_13824atom_basic.xmlでなければならない。
計算では、root_nodeでは構造ファイル(上記例だとC_liq_13824atom.xml)が、
他ノードでは構造basicファイル(C_liq_13824atom_basic.xml)が読み込まれる。

起動するには、config XMLファイルで、「read_mode="root_only"」と属性指定する。
また、root_only読み込みでは、number_of_atoms属性の指定は必須。例：
<cluster structure="C_liq_13824atom.xml" parser="sax" tag_dump="off" read_mode="root_only" cutoff_radius="5.0d0" number_of_atoms="13824" />
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/25(2)
担当者名 星健夫

更新ファイル
src/elses-lib-element-name.f90
src/elses-ini-load-geno.f90

更新内容：
原子番号-元素名の双方向変換ルーチン更新。
使い方は2012/06/09の更新記録にあり(変更なし)。

詳細：
初期処理として、ルーチン「ini_load_geno」で
 call make_db_element_name
を行っている。
内容は、databaseの作成(配列のallocationと値の代入)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/25
担当者名 星健夫

更新ファイル

ファイル：
src/elses-config.f90
src/elses-md-dst.f90
src/elses-io-dst-write-log.f90

更新内容：
機能変化しない変更(config構造体の拡張)

詳細：
下記を追加：
config%calc%distributed%mpi_is_active
config%calc%distributed%myrank
config%calc%distributed%nprocs
config%calc%distributed%root_node
config%calc%distributed%log_unit 
注：module「M_lib_dst_info」にあるものと同じ。
基本的な変数（特に計算途中で変化しないもの）は、
config構造体にいれておくことにする。

--------------------------------------------------------------------------------
********************************************************************************
2012/07/23
ELSES v0.03.12 Release Candidate 4 (elses-v0.03.12-20120723-rc4.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/07/23/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
xyzファイルのコメント部分に関する注意事項を追記。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/20 (2)
担当者名 星健夫

更新ファイル

ファイル：
src/elses-ini-load-geno.f90
src/elses-ini-load-common.f90
src/elses-md-motion.f90
src/elses-xml-sax-handler.f90

更新内容：
file conversion modeの整備。

詳細：
速度・力のデータにも対応。

メモ：
座標・速度・力の入ったrestart用XMLファイルをinputとして、
file conversionモード計算を行った場合、
新たにできるrestart用XMLファイルはinput fileと同一になるようにした。
(つまり、XML→XMLの変換では、同じファイルになる、ということ）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/20
担当者名 星健夫

更新ファイル

ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-xml-sax-handler.f90
src/elses-xml-sax-parser.f90
sample/C_liq_13824atom/config_geno_dst.xml

更新内容：
実験的機能の更新(SAXパーサーの整備)。

重要な変更：
sample/C_liq_13824atomのconfig_geno_dst.xmlを利用した計算において、
DOM法読み込みとSAX法読み込みとで、運動エネルギーが4ケタしか一致しない場合があったので、修正。

メモ：
(1) 速度情報の読み込みに関するまとめ
構造XMLファイルにおいて、原子ごとの情報として定義されているのは、
  <position>, <velocity>, <force>, <population>, <population_guess>
の5つ。restart用XMLファイルには全でが出力されている。DOM法では全て読み込んでいる。
今回の更新で、SAX法でも、force情報以外は読み込むようになった。
なお、force情報は(position情報から生成できるので)本来必要ない。
（force情報がXMLファイルに入っているのは、可視化ソフトなどで利用するため）。

(2) 設定XMLでのclusterタグに属性追加
   tag_dump: "on" "off" (defaultは"off")
   　SAX法で全タグを書き出す（チェック用）。DOM法では無効。
   read_mode: 
     今のところ、属性を定義してあるだけ。後日、利用予定。

(3) 今回の更新で、SAX法の機能がDOM法に追いついたことになる。
そこで、sample/C_liq_13824atom/config_geno_dst.xmlのパーサー属性を「DOM」から「SAX」に変更。

(4) SAX法における、XMLファイルのチェックルーチン(xml_flag_init, xml_flag_check)を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/18
担当者名 星健夫

更新ファイル

ファイル：
src/elses-qm-output-matrices.f90

更新内容：
7/12更新が不十分だったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/17(2)
担当者名 星健夫

更新ファイル

ファイル：
src/elses-qm-engine.f90

更新内容：
実験的機能の更新(rest_part_onlyスキーム)

詳細：
rest_partのみを計算するスキーム。
今のところ、geno・非DSTのみに対応。
設定XMLファイルのcalcタグ内に、
<solver scheme="rest_part_only"> </solver>
と書く。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/17
担当者名 星健夫

更新ファイル

ファイル：
src/elses-md-main.f90

更新内容：
設定ミス検出機能の強化。

詳細：
ユーザーが設定XMLファイルを書き間違ったときに
エラーで止まる機能の追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/16/
担当者名 星健夫

更新ファイル

ファイル：
src/elses-qm-geno-Huckel-atom-parameters.f90

更新内容：
実験的機能の更新(element XMLファイルの書き出しなど)
従来機能に変化なし。

詳細(1)：
標準出力への書き出しを、
（abort時のエラーメッセージをのぞいて）
ノードログファイル(log-node000000.txt)への書き出しに書き換え。

詳細(2)：
element XML file(例:酸素なら,O.xml)がないときは
default値が読み込まれるのだが、
verboseモードに限り、これら値をXML fileに出力。
ただし、実験的機能なので不完全(d軌道に非対応など)。

動作例：element XML fileが存在しないとき
ノードログファイルに以下のメッセージがでる。
INFO-XML:Load_XML_AtomParameter: *** Warning!!! *** Failed to open data file O.xml
verboseモードのときは、element XML fileが、
「output_O.xml」という名前でできる。

動作例：element XML fileが存在するとき
ノードログファイルに以下のメッセージがでるだけ
INFO-XML:Load_XML_AtomParameter:element file=O.xml
--------------------------------------------------------------------------------
********************************************************************************
2012/07/13
ELSES v0.03.12 Release Candidate 3 (elses-v0.03.12-20120713-rc3.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/07/13/
担当者名 星健夫

更新ファイル

ファイル：
src/elses-qm-solver-gkrylov-dst.f90

更新内容：
gfortranでコンパイルが通らない問題を修正。
（1行の文字数が長過ぎていた）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/13/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
unit cellの設定に関する記述を修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/12
担当者名 星健夫

更新ファイル
src/elses-qm-output-matrices.f90
src/elses-eig-leg.f90

実験的機能の更新(行列&固有値出力)。
従来機能に変更なし。

詳細：
eigen_levelタグのエネルギー単位設定が
正しく行われない場合があったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/11(7)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90

入力ファイル読み込みでの稀な不都合を改善。

詳細：
「dynamicsモード以外」かつ「構造XMLに速度データが含まれる」場合、
の不都合を改善。

メモ：速度データの取り扱い
構造XMLでj-th atomに速度データが含まれると、
config%system%structure%vatom(j)%velocity_set = .true.
となる。一方、設定XMLで、calc mode="dynamics"以外では、
配列(velx, vely, velz)はallocateされない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/11(6)
担当者名 星健夫

更新ファイル
src/elses-qm-output-levels.f90
src/elses-eig-leg.f90

実験的機能の更新(行列&固有値出力)。

詳細：
matrix_hamiltonianなどのタグで、
未設定時のdefault値が、一部設定されていなかったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/11(5)
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

実験的機能の更新(cell_change_onlyモード)。
従来機能に変化なし。

詳細：
一部ファイル出力でformat文が間違っていたので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/11(4)
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-cell-change.f90

実験的機能の更新(cell_change_onlyモード)。
従来機能に変化なし。

詳細：
cell_changeタグが未設定のときの処理が、正しくなかったので対応。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/11(3)
担当者名 星健夫

更新ファイル
src/elses-md-main.f90

軽微な修正(ファイル出力を分かりやすく)。
機能変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/11(2)
担当者名 星健夫

更新ファイル
src/elses-md-cell-change.f90

軽微な修正(error messageを分かりやすく／node logfileへの出力)。
機能変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/11
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90
src/elses-ini-load-geno.f90

軽微な修正(エラーメッセージを分かりやすく)。
機能変化なし。
--------------------------------------------------------------------------------
********************************************************************************
2012/07/10
ELSES v0.03.12 Release Candidate 2 (elses-v0.03.12-20120710-rc2.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/07/10(2)
担当者名 星健夫

新規ファイル
sample/C_liq_13824atom/config_geno_dst.xml

実験的機能の更新(DST版用sampleファイルの追加)。

詳細：
中規模計算の設定
(<micro_cell_booking mode="one_cell"/>)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/10
担当者名 星健夫

更新ファイル
src/elses-md-main.f90
src/elses-qm-solver-gkrylov-dst.f90

実験的機能の更新。
従来機能に変更なし。

詳細：
DST版で経過時間のファイル出力が意図通りでなかったので修正。
計算結果に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
********************************************************************************
2012/07/06
ELSES v0.03.12 Release Candidate  (elses-v0.03.12-20120706-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/05
担当者名 星健夫

更新ファイル
src/elses-md-output.f90
src/elses-config.f90
src/elses-qm-engine.f90
src/elses-xml-config.f90
src/elses-qm-output-levels.f90
src/elses-qm-output-matrices.f90

実験的機能の更新(H,Sなどのファイル出力)。
従来機能に変化なし。

詳細：
Hamiltonian, overlap matrices, eigen levelの出力を整備。
XMLファイルからの制御ができるようにした。
Hamiltonian, overlap matricesは、MatrixMarket形式で出力する。
現状では、非DST版のGENOだけに対応。

暫定仕様（変更する可能性もあり）：
outputタグ内に追加する。例：
  <matrix_hamiltonian filename="output_hamiltonian.txt" mode="last" format="MatrixMarket_sym" unit="a.u." />
  <matrix_overlap     filename="output_overlap.txt" mode="last" format="MatrixMarket_sym" />
  <eigen_level        filename="output_eigen_levels.txt" mode="last" format="level_only" unit="a.u." />
(1) Hamiltonian 行列
  mode属性：文字：last, periodic, default(=last), on(=last), off
    last:最後のiterationのみ出力
    periodic:周期的に出力。周期はinterval属性で指定する。
    off:発動せず。
  interval属性：整数
  　mode属性="periodic"のときの、周期を指定。
  format属性：文字："MatrixMarket_sym" "MatrixMarket_gen"
    MatrixMarket_sym : symmetric形式(下三角成分のみ出力) 
    MatrixMarket_gen : general形式。非対角要素H(i,j)とH(j,i)を冗長に出力
  unit属性：文字：a.u., eV
  append_mode属性：on, off
    追記モードのon/off
(2) Overlap行列
　unit属性をのぞいて、(1)と同じ仕様。
(3) eigen level
  下記以外は(1)と同じ仕様。
  format属性：文字："level_only" "full" 
     level_only : 1行には、level index (k)、固有エネルギー(E_k)、が出力。例：
         1       -1.26478100744643384701
         2       -0.68245286285899264822
         3       -0.61888812899997081018
         4       -0.58346440488615181064
         5        0.22498890821334280310
         6        0.30408092998916885774
     full : 1行には、MD step count、level index (k)、固有エネルギー(E_k)、occupation (f_k)、が出力。例：
        10         1       -1.26478100744643384701        1.00000000000000000000
        10         2       -0.68245286285899264822        1.00000000000000000000
        10         3       -0.61888812899997081018        0.99999999999581223875
        10         4       -0.58346440488615181064        0.99999999500146996567
        10         5        0.22498890821334280310        0.00000000000000000000
        10         6        0.30408092998916885774        0.00000000000000000000
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/07/03/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
様々な計算モードに関する記述を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/29
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-ini-load-geno.f90
src/elses-md-motion.f90
src/elses-md-cell-change.f90

実験的機能の更新(cell_change_onlyモード)。
従来機能に変化なし。

詳細：
Periodic cell lengths (AX, AY, AZ)だけを変えるモードを、試験的に実装。
例えば、理想的なvolume expansionなどができる。
従来も類似機能は（試験的に）あったが、仕様も若干変更。

メモ：cell_change_onlyモードの暫定的仕様
（以下は暫定的仕様なので、変更するかもしれない）
このモードでは、構造XMLファイルのcell lengthsは無視され、
新たに定義された補助ファイルで与えられる。

内部的には、ルーチン
elses_md_cell_change [module M_md_cell_change]
(ファイルelses-md-cell-change.f90)で更新している。

使い方は、以下：
config.xmlで、calcタグのmode属性を「cell_change_only」にする：
<calc mode="cell_change_only">
calcタグ内に、下記の容量で情報追加：
<cell_change scheme="from_file" filename="input_cell_change.txt">
   <max_num_iter> 10 </max_num_iter>
</cell_change>
補助ファイル(上記のinput_cell_change.txt)の例：
51.136009312574d0  88.5526014925063d0 94.4863438887178d0
 0   0.8   0.8    0.8
 1   0.85  0.85   0.85
 2   0.9   0.9    0.9
 3   0.95  0.95   0.95
 4   1.0   1.0    1.0
 5   1.1   1.1    1.1
 6   1.2   1.2    1.2
 7   1.3   1.3    1.3
 8   1.4   1.4    1.3
 9   1.5   1.5    1.5
10   1.6   1.6    1.6
1行目：cell lengthsのreference値(a.u.単位)
2行目以降の各行：stepcount, AXのscale値, AYのscale値, AZのscale値
ここでstepcountの意味は、最初をstepcount=0としたもの。
AX, AY, AZのscale値とは、1行目の値でnormalizeした値。
注：input_cell_change.txtに記録がないstepcountの場合は、
直前の記録の値が用いられる。
上記例なら、stepcount=11以降は、stepcount=10の時のcell lengthsとなる。

結果は、例えば、以下のようにして見る事ができる：
> grep Energy Output.txt | grep summary | grep eV
 Energy summary (eV/atom):            0      -66.97559540     
 Energy summary (eV/atom):            1      -70.63700976     
 Energy summary (eV/atom):            2      -72.74055923     
 Energy summary (eV/atom):            3      -73.80520398     
 Energy summary (eV/atom):            4      -74.19291064     
 Energy summary (eV/atom):            5      -73.74131018     
 Energy summary (eV/atom):            6      -72.47607900     
 Energy summary (eV/atom):            7      -70.96731433     
 Energy summary (eV/atom):            8      -69.56988810     
 Energy summary (eV/atom):            9      -68.50967860     
(上記の各行は、行頭部分だけしか書かれていない)
上記の場合、stepcount=4、つまりAX,AY,AZのscale値が全て1.0のときが、エネルギー最小になっている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/28(2)
担当者名 星健夫

更新ファイル
src/elses-qm-engine.f90

非GENO系列の更新。
GENOでの機能に変化なし。

詳細：
Orthogonal systems (Xu, Kwonなど)では、
bond_listタグが有効でなかったので、有効にした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/28
担当者名 星健夫

新規ファイル
src/elses-qm-output-atom-charge-ortho.f90

更新ファイル
src/elses-qm-output-atom-charge.f90
src/Makefile (上記新規ファイルを追加しただけ)

非GENO系列の更新。
GENOでの機能に変化なし。

詳細：
Orthogonal systems (Xu, Kwonなど)では、
atom_chargeタグが有効でなかったので、有効にした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/27(2)
担当者名 星健夫

新規ファイル
src/elses-qm-population-ortho.f90

更新ファイル
src/elses-qm-engine.f90
src/Makefile (上記新規ファイルを追加しただけ)

非GENO系列の更新。
GENOでの機能に変化なし。

詳細：
Orthogonal systems (Xu, Kwonなど)では、
populationタグがrestart XMLに出力されていなかったので、
出力されるようにした。
この機能をオフにしたいときは、
elses-qm-population-ortho.f90の下記行でtrueをfalseにする。
logical, parameter  :: save_population_in_ortho_cases = .true.
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/27
担当者名 星健夫

更新ファイル
src/elses-xml-sax-handler.f90

実験的機能の更新(SAX型XMLパーサーの更新)。
従来機能に変化なし。

詳細：
SAX型XMLパーサーではmyLengthタグに非対応だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/23
担当者名 星健夫

更新ファイル
src/elses-xml-sax-parser.f90

実験的機能の更新(SAX型XMLパーサーの更新)。
従来機能に変化なし。

詳細：
SAX型XMLパーサーでは、
config%system%structure%vatom(:)%class
のdefault値が未設定だったので、設定するようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/22
担当者名 星健夫

更新ファイル
src/elses-lib-dst-info.f90
src/elses-io-dst-write-log.f90
src/elses-md-dst.f90

実験的機能の更新(DST版;情報のファイル出力)。
従来機能に変化なし。

詳細：
node logfileに、MPI wrapperがtrueかdummyかを出力するようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/21
担当者名 星健夫

更新ファイル
src/elses-qm-geno-Huckel.f90

エラー検出ルーチンの追加。従来機能に変化なし。

詳細：
ユーザーが構造ファイルを間違って作ったために、
原子間距離がゼロ(<1.0d-10)になっている場合に、
function RepulsiveEnergy
において、下記例の様なエラーメッセージを出して止まるようにした。
（従来は、(原子間距離)^{-1}を計算するときに、floating invalidのエラーになっていた）
例：
ERROR(RepulsiveEnergy):i,j,R(i,j)=        37         1        0.00000000000000000000
ERROR(RepulsiveEnergy):Two atoms are placed at the same position
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/20(3)
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-options.f90
src/elses-io-dst-write-log.f90

実験的機能の更新(DST版;logfileを出力するnode数)。
従来機能に変化なし。

詳細：
logfileを出力するnode数を、起動時optionで設定できるようにした。
上記設定値がゼロ以下なら、どのノードに対してもlogfileが出力されない。
上記設定値が総ノード数より多い場合は、全ノードに対してlogfileが出力される。
default値は（従来の仕様通り）8。
例：mpirun -n 16 ./elses -log_node_number=4 ./config.xml 
この場合、k=0,1,2,3番目のnodeに対してlogfileが、
log-node000000.txt
log-node000001.txt
log-node000002.txt
log-node000003.txt
という名称で、それぞれ出力される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/20(2)
担当者名 星健夫

更新ファイル
src/elses-md-motion-verlet.f90

write文の整理。計算結果に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/20
担当者名 星健夫

更新ファイル
src/elses-kr-sub.f
src/elses-qm-projection-suggest.f90

gKrylov法でのDST/非DSTの仕様統一促進。

詳細：
GENO-非DSTのgKrylovでも、GENO-DSTのgKrylovと同様、
mode_for_suggest_projection
の設定を有効にした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/19
担当者名 星健夫

更新ファイル
src/elses-xml-sax-parser.f90

一部エラーメッセージを分かりやすくした。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/12/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
v0.03.12におけるログ出力の変更についての記述を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/10/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
1:band計算ツールに関してOverlapAndHamiltonian.txtの出力場所の記述が間違っていた点を
修正。
2:固有エネルギー出力に関する記述を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/09
担当者名 星健夫

新規ファイル
src/elses-lib-element-name.f90

更新ファイル
src/Makefile (上記ファイルを追記しただけ)

原子番号-元素名の双方向変換ルーチンを追加：
ただし、まだどこからもcallされていない。
従来機能に変化なし。

詳細：
下記2ルーチンなどを用意：
subroutine get_element_name(atomic_num, element_name)
   integer,          intent(in)  :: atomic_num
   character(len=8), intent(out) :: element_name
→原子番号から元素名を得る
subroutine get_atomic_num(element_name, atomic_num)
   character(len=*), intent(in)   :: element_name
   integer,          intent(out)  :: atomic_num
→元素名から原子番号を得る

注：後者のルーチンは、module M_md_save_structにも、
同一名称・同一機能・同一インターフェースのルーチン
　get_atomic_num(element_name, atom_num)
が存在する。しかし、このルーチンの実装では、
「逆引き」ルーチンの作成が困難だったため、あらためて作った。
今後は、新しく作ったget_atomic_numに置き換えていくべき。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/08(2)
担当者名 星健夫


更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.11→v0.03.12)
---------------------------------------------------
***************************************************
2012/06/08
ELSES v0.03.11 Released (elses-v0.03.11-20120515-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2012/06/08
担当者名 星健夫

更新ファイル 

詳細：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-save-struct.f90

解析用に、速度データのファイル出力機能を追加。

詳細：
設定XMLファイルのoutputタグに、positionタグと同様の形式で、
velocityタグを追加する。例：
 <velocity filename="C6H6-velocity.xyz" interval="10" />
ファイル名は任意（拡張子は何でも良い。拡張子がなくても良い）。
intervalで設定したステップごとに、指定されたファイルに出力される。

ファイルには、XYZ形式のフォーマットで記録される。単位はa.u.。例：
        12
 C6H6 mdstep=          10
C     0.140356671946042E+01 -0.412660919941948E-01 -0.146279209929468E-01
C     0.665572864858468E+00  0.126534311252602E+01 -0.246962860415114E-02
C    -0.689955745811826E+00  0.129076487534889E+01  0.424880116289095E-01
C    -0.135754383637916E+01 -0.200271126234952E-01 -0.529771051603569E-02
C    -0.761588602328513E+00 -0.123056689064265E+01 -0.322177096516984E-01
C     0.751719170059808E+00 -0.127369045863769E+01  0.332599193978676E-01
H     0.243103065819462E+01  0.651122282839358E-01  0.622990297866981E-01
H     0.128672535909289E+01  0.213658704402929E+01  0.110735950728606E+00
H    -0.133022908485741E+01  0.214988097023592E+01 -0.116557242181240E+00
H    -0.243612221003258E+01  0.343080633355305E-01 -0.909094986308579E-01
H    -0.127837440767813E+01 -0.207123248504901E+01 -0.326872934196135E+00
H     0.118670499294222E+01 -0.220213292398692E+01  0.109448677795990E+00

注：タグが正しく書かれていれば、標準出力に以下の行がでる
INFO-XML:An optional tag is found : config%output%velocity

注：dynamicsモードになっていなければ、上記タグは無視される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/02/
担当 西野信也


ファイル：
elses-md-save-struct.f90
elses-qm-output-eigenstates.f90


更新内容：
エレメント名を読み込み原子番号を返すサブルーチンget_atomic_numにおける
対応する原子種を拡張した。
また、elses-qm-output-eigenstates内で原子番号を出力する部分はこのサブルーチンを
利用するように変更。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/02(4)
担当者名 星健夫

更新ファイル 
src/elses-qm-solver-gkrylov-dst.f90

詳細：
DST版のgkrylovソルバーで、MDに不必要な計算は、抑制できるようにした。
具体的には、下記スイッチを導入した（今のところ、変更には、ソースコード書き替え必要）。
calc_charge、calc_atm_energy_by_2nd_def、calc_cohp
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/02(3)
担当者名 星健夫

更新ファイル 
src/elses-00-main.f90
src/elses-io-dst-write-log.f90
src/elses-qm-dst-projection-cell.f90
src/elses-qm-dst-domain.f90
src/elses-qm-engine-dst.f90
src/elses-md-dst-update-cell-booking.f90
src/elses-md-dst-cell.f90
src/elses-qm-solver-gkrylov-dst.f90
src/elses-md-cell-change.f90
src/elses-md-constraint.f90
src/elses-xml-sax-handler.f90
src/elses-md-dst.f90
src/elses-md-main.f90
src/elses-lib-omp.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/Makefile (項目の順番を入れ替えだけ)

ファイル書き出しの整理。
計算結果に影響なし。

詳細：
MPI計算で、標準出力ファイルへの冗長な書き出しを抑制、など。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/02(2)
担当者名 星健夫

更新ファイル 
src/elses-lib-dst-info.f90

モジュール変数を追加。
計算結果に影響なし。

詳細：
logical変数root_nodeを、モジュール変数に追加。
「if (myrank ==0 ) ~~~」
と「if (roote_node) ~~~」は、等価。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/06/02
担当者名 星健夫

更新ファイル 
src/elses-lib-wall-clock-time.f90

時間測定ルーチンの追加。
計算結果に影響なし。

詳細：
system_clockルーチンを使った、
時間測定ルーチンのまとめ（2,3番目が、今回追加したルーチン）。
時間はすべてで秒単位。
・get_system_clock_time(time_present)
　（output: time_present)
　system-clock time (sec)を取得。
・measure_clock_time_period(time_present, time_previous, time_period)
　（input:time_present, time_previous, output:time_period)
  get_system_clock_timeで得た二つの時刻の間の、期間を測定：
　　time_period = time_present-time_previous
　ただし、system-clock timeの値が周期的にresetされてしまうことを考慮してある。
・show_reset_period_of_clock(time_reset_period)
　system-clock timeの値が、resetされる周期を表示。
　マシンによって決まっている値。
・get_elapse_wall_clock_time(elapse_time)
　シミュレーション開始時からの経過時間を表示。
　system-clock timeの値が周期的にresetされてしまうことを考慮してある。
　thread unsafeな(OMP並列下では使ってはいけない)ルーチン。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/31
担当者名 星健夫

更新ファイル 
src/elses-md-dst-get-atom-range.f90
src/elses-md-dst-cell.f90
src/elses-md-dst-update-cell-booking.f90

実験的機能の更新(DSTワークフロー)

詳細：
mcell bookingにおいて、非常に大きい並列度数で、
integer(kind=4)の桁溢れが起こる問題に対処。

メモ：integer(kind=4)の桁溢れ可能性と回避
ループ
 do i=1, n
  (計算)
 enddo
を、均等に、(nprocs)並列する場合、
 i_ini=myrank*n/nprocs
 i_fin=(myrank+1)*n/nprocs-1
 do i=i_ini, i_fin
   (計算)
 enddo
と通常する。 i_ini, i_finは、nを超えないが、
途中に現れるかけ算(myrank+1)*nの最大値
　nprocs * n
が、integer(kind=4)の上限
　2**31 - 1 = 2,147,483,647 (約21億) 
を超えることがある。たとえば、
　n     = 300, 000 (30万)
 nprocs =  10,000  (1万) 
だと、
　nprocs * n = 3,000,000,000 (30億)
となる。
これを回避するため、途中のかけ算をinteger(kind=8)で行う。
ルーチン名：dst_get_index_range [M_md_dst_get_atom_range]
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/30(2)
担当者名 星健夫

更新ファイル 
src/elses-qm-solver-gkrylov-dst.f90

実験的機能の更新(DSTワークフローの微修正)
ファイル出力の微修正。計算結果に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/30
担当者名 星健夫

更新ファイル 
src/elses-xml-sax-parser.f90

実験的機能の更新(SAX型XMLパーサー)。

詳細：
エラーメッセージを少し詳しくした、だけ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/26
担当者名 星健夫

新規ファイル 
src/elses-lib-report-mpi-time.f90

更新ファイル 
src/elses-md-main.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/Makefile(上記新規ファイルの記述を追加しただけ)

更新内容
実験的機能の更新(MPIコマンド時間の計測強化)。
従来機能に変化なし。

詳細メモ：
以下のように、all_reduce, barrierにかかった時間を測定・足し上げ。
(a) 各MDステップでの時間が、各ノードごとのlogファイル(log-node00000.txtなど)の
「MDloop」が含まれる行に出力。例：
elaps-time(lap    MDloop)=              1       3.795000       0.064870       0.342004
最初の整数が時間step数。残りの3つの実数がそれぞれ、実経過時間、all_reduce時間、barrier時間（秒単位）。
(b) 全計算終了後に、ファイル(output-total-consumed-mpi-time.txt)に出力。
全ノードについて、1ノードにつき1行の下記情報が出力される：
node_id, allreduce_time, barrier_time=          0        0.7112004287        1.0675616898
最初の整数がノードID。残りの2つの実数がそれぞれ、全all_reduce時間、全barrier時間（秒単位）。
注：この機能は、MPIが有効なら、有効になっている。
制御するには、code_for_mpi/elses-lib-mpi-wrapper.f90で、以下の行を編集する。
  logical, parameter :: measure_wtime     = .true.
  logical, parameter :: sum_up_wtime      = .true.
  logical, parameter :: barrier_everytime = .true.
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/25
担当者名 星健夫

更新ファイル 
src/elses-xml-sax-parser.f90

更新内容
実験的機能の更新(SAX型XMLパーサ)。
従来機能に変化なし。

詳細メモ：
SAX型XMLパーサが、gfortranで正しく動かない問題をfix。
XML fileの2度読みのためには、
「call close_xmlfile」が必要だったので、追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/24/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
quick startにdouble-zetaでの計算に関するトラブルシューティングを追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/24
担当者名 星健夫

更新ファイル 
src/elses-md-main.f90

更新内容
ファイル出力の微修正。
計算結果に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/23
担当者名 星健夫

更新ファイル 
src/elses-xml-sax-parser.f90

更新内容
実験的機能の更新(SAX型XMLパーサ)。
従来機能に変化なし。

詳細メモ：
SAX型XMLパーサで、velocity_setなどのdefault値
(XML)ファイルに情報が無かったときの値)を設定。
--------------------------------------------------------------------------------
日付 2012/05/22(2)
担当者名 星健夫

更新ファイル 
src/elses-md-main.f90

更新内容
微修正。計算結果に変化なし。

詳細メモ：
分散メモリ環境で、一部の経過時間をより明確に測定するため、
mpi_wrapper_barrier_timeの位置を変える。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/22
担当者名 星健夫

更新ファイル 
src/elses-qm-solver-gkrylov-dst.f90

更新内容
実験的機能の修正（DST版）。
機能変化なし。

詳細メモ：
一部の経過時間をより正確に測定するため、
mpi_wrapper_barrier_timeを挿入。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/16
担当者名 星健夫

更新ファイル 
src/elses-xml-sax-parser.f90

更新内容
XML設定エラー検出の強化

詳細メモ：
config.xml内に原子数を指定(2012/04/18更新で導入された機能)し、
これが書き間違いである場合に、以下のようなメッセージが出てとまるようにする：
 ERROR(struc_load_sax):wrong number of atoms:counter_atom_p=     2125824
 # The number of atoms in the config. XML file may be wrong
--------------------------------------------------------------------------------
********************************************************************************
2012/05/15
ELSES v0.03.11 Release Candidate  (elses-v0.03.11-20120515-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/05/14/
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
quick startにハイパーリンク機能を追加

texファイル(quick-start_20120514.tex, quick-start-e_20120514.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/12(2)
担当者名 星健夫

更新ファイル 
src/elses-qm-geno-Huckel-atom-parameters.f90

更新内容
一部エラーメッセージを分かりやすくした

詳細メモ：
GENOハミルトニアンでdouble-zetaを使う場合、
パラメーター群(zeta1, zeta2, c1, c2)にはnormalizationからくる条件式がある。
これを満たさないときにエラーで止まるが、
その際のメッセージを少し分かりやすくした。以下、例：
c1,c2=  7.23130306240707E-01  6.00000000000000E-01
z1,z2=  2.12500000000000E+00  2.50000000000000E+01
sqrt(z1.z2)     =  9.60113094396169E-01
Suggested c1,c2 =  7.53172006986839E-01  6.24926379508812E-01
ERROR:Please correct the element XML file for the double-zeta parameters
renormalizeDoubleZeta in SetAtomParameters: erroneous normalization of double zeta
注：上記の「Suggested c1,c2 」が、条件式をみたした値になっている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/12
担当者名 星健夫

更新ファイル 
src/elses-xml-config.f90

更新内容
XML関連のメッセージを分かりやすくした

詳細メモ：
XML設定がただしく認識されているかどうかを
ユーザーが確認できるように、
XMLに関連した情報は「INFO-XML」を文頭について標準出力に出すようにする。
(一部はverbose modeでないと出力されない)。
例：INFO-XML:An optional tag is found : config%output%atom_charge
現状では全部が上記のようになっているわけではないが、順次変えて行く。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/01(2)
担当者名 星健夫

更新ファイル 
Makefile.inc

更新内容
Makefile.incに追記。

詳細メモ：
富士通FX10用の記述を追記：
## Fujitsu FX10
#FC = mpifrtpx
#FFLAGS = -Kfast,openmp,SPARC64IXfx
#LDFLAGS = $(FFLAGS)
#LIBS = -SSL2
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/05/01
担当者名 星健夫

更新ファイル 
src/elses-io-dst-write-log.f90

更新内容
ファイル出力の修正

詳細メモ：
「log-node00000.txt」というファイルができる仕様だったが、
実際にはverbose levelが1以上の場合のみになっていた。
仕様(QuickStart Sec.2.2の記述)通り、どんな場合でもでるように修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/04/23
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
quick startに目次を追加しました。

texファイル(quick-start_20120423.tex, quick-start-e_20120423.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/04/18
担当者名 星健夫

更新ファイル 
src/elses-xml-config.f90
src/elses-xml-sax-parser.f90

更新内容
実験的機能の更新（XML入力関連）

詳細メモ：
高速化のために、原子数を設定XMLで与えられるようにした(option)。
ただし高速化するのは、SAXパーサーを利用したときのみ。
書き方の例：
<cluster structure="sample.xml" parser="sax" cutoff_radius="5.0" number_of_atoms="10" />

詳細メモ：
通常は、原子数を調べる必要があるため、構造XMLファイルは2度読みをしている。
上記のように原子数を与えてやることで読み込みを1回で済ませることができ、
ファイル読み込み時間が短縮する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/04/17(3)
担当者名 星健夫

更新ファイル 
src/elses-qm-projection-list-dstm.f90
src/elses-qm-dst-domain.f90
src/elses-md-dst-cell.f90

更新内容
実験的機能の更新（DST版）

詳細：
DST版での非周期系の扱い(mcell booking)を更新。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/04/17(2)
担当者名 星健夫

更新ファイル 
src/elses-config.f90

更新内容
gKrylov_Aでのdefault設定の詳細を変更

詳細：
mArnoldi_qのdefault値を、1から15に変更。
論文(Hoshi et al., JPCM24, 165502 (2012))にあわせた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/04/17
担当者名 星健夫

更新ファイル 
src/elses-md-main.f90

更新内容
ユーザー設定ミスの検出強化。

詳細：
nprocsが2以上で非DSTワークフローになっているときに、エラーで止まるようにする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/04/11 (2)
担当者名 星健夫

更新ファイル
src/elses-eig-leg.f90

微修正。機能変化なし。

詳細：
GENOの対角化ソルバーでのエラーメッセージを
少しくわしくした。
具体的には、cutoffが小さく過ぎて、
overlapが負固有値をもった（可能性がある）エラーの場合に、
 INFO:Error in eigen-value solver
 INFO:The cutoff may be too small
というメッセージがstandard outputに現れる。
--------------------------------------------------------------------------------
日付 2012/04/11
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.10→v0.03.11)
--------------------------------------------------------------------------------
***************************************************
2012/04/11
ELSES v0.03.10 Released (elses-v0.03.10-20120319-rel.tgz)
Note: identical to RC3
***************************************************
--------------------------------------------------------------------------------
********************************************************************************
2012/03/19
ELSES v0.03.10 Release Candidate 3 (elses-v0.03.10-20120319-rc3.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/03/18
担当者名 山元進
更新ファイル src/elses-qm-geno-Huckel.f90
更新内容
Repulsive part のエネルギー計算、およびエネルギーの微分値計算の部分のバグを修正。
本来、右側(ケット側)の分子軌道が double-ζ 型かどうか判定すべきところで、
左側(ブラ側)の分子軌道を参照していた。
影響する範囲： 
　電子構造計算部分には影響がない。
　dynamics および、最適化には影響する。
　double-ζ 型の軌道を使わない計算には、影響がない。
　double-ζ 型でも、単体の計算には、影響が無い。
　double-ζ 型の化合物の場合影響がある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/03/18
担当 西野信也

Quick Startの更新

ファイル：
quick-start-e.pdf

更新内容：
quick startの英語版にxml-checkツールの説明、実行ファイルの移動に関する章を追
加。
また、これに伴う、本文の他の部分も修正しました。

texファイル(quick-start-e_20120312.tex)はdoc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/03/17
担当者名 星健夫

更新ファイル
src/elses-md-main.f90
src/elses-qm-engine-dst.f90
src/elses-qm-domain.f90 
src/elses-qm-solver-gkrylov-dst.f90
src/elses-qm-dst-micro-mat.f90
src/elses-ini-load-common.f90


実験的機能の更新（DST版更新）。
従来機能に変化なし。

詳細：
非GENO系でのDST workflowの準備。
module変数S_is_I [M_qm_domain]の追加、など。
--------------------------------------------------------------------------------
********************************************************************************
2012/03/10
ELSES v0.03.10 Release Candidate 2 (elses-v0.03.10-20120310-rc2.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/03/09
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf

更新内容：
quick startに実行ファイルの移動に関する章の追加。
また、これにともなう本文の修正を行いました。

texファイル(quick-start_20120309.tex)はdoc_workにおいてあります。
--------------------------------------------------------------------------------
********************************************************************************
2012/03/09
ELSES v0.03.10 Release Candidate (elses-v0.03.10-20120309-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/03/05
担当者名 星健夫

新規ファイル
src/elses-eig-standard.f90

更新ファイル
src/elses-la-krgl-main.f90
src/elses-la-matvec-routines-dstm.f90
src/elses-la-gkrylov-main-dstm.f90
src/elses-la-gkrylov-main.f90
src/Makefile (上記新規ファイルを追記しただけ)

クリロフ計算(非DST/DST版)の更新

詳細：
内部的に使っているルーチン(標準固有値問題ソルバールーチン)を、
非DST/DST版で統一化(eig_standard [M_eig_standard])する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/03/05
担当者名 山元進
更新ファイル Makefile Makefile.inc Makefile.inc_release src/Makefile
tool/Makefile tool/LDOS/Makefile(名前変更) tool/band/src/Makefile
更新内容

(1) Makefile のスタイル統一へ向けて、若干の変更
TOPDIR マクロ	Makefile 中で、パッケージ最上位ディレクトリからの相対関係を知ることは難しいので、
TOPDIR マクロ で開発者が、相対関係を指定する。そのあと、
include $(TOPDIR)/Makefile.inc
を実行することで、ELSES 本体の src や、 bin ディレクトリを指すマクロが利用可能になる。

(2) XML 関係のモジュールを利用する際に使う、LIBS-XML OBJ-XML というマクロを新設した。

(3) サブディレクトリの Makefile の名前を Makefile で統一。
本来外部のパッケージである XML 用ライブラリでのみ Makefile-elses　を利用する。 

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/28(3)
担当者名 星健夫

更新ファイル
src/elses-md-dst-cell.f90

実験的機能の更新（DST版の微修正）

詳細：
標準出力の変更（機能変更なし）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/28
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf

更新内容：
xml-checkツールに関する説明を追加。

texファイル(quick-start_20120228.tex)はdoc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/28(2)
担当者名 星健夫

更新ファイル
src/Makefile

コード整備（機能変化なし）

詳細：
CallTreeを作るときに、xmlf90-1.2g-elses以下のファイルも対象に追
加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/28
担当者名 星健夫

更新ファイル
src/elses-qm-dst-domain.f90
src/elses-md-dst-cell.f90
src/elses-md-dst-update-cell-booking.f90

実験的機能の更新（DST版更新）

詳細：
micro cell booking法を修
正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/26
担当者名 星健夫

更新ファイル
src/elses-qm-output-eigenstates.f90
tool/plot_eigenstates/src/elses-generate-cubefile.f90

GENO対角化での波動関数書き出し機能の更新。

詳細：
Coefficientデータファイル(典型名:output_wavefunction.txt)に、
周期系か非周期系かの情報が入っていなかったので、追加。
これにより、elses-generate-cubefileで、周期系か非周期系かを自動的に判別して、
それぞれに対応したcubeファイルが生成される。
この変更により、旧バージョンで作られたCoefficientデータファイルは、
elses-generate-cubefileと非互換となる。
Coefficientデータファイルを新バージョンで作り直せば良い。

注：旧バージョンで作られたCoefficientデータファイルを、
新しいバージョンのelses-generate-cubefileで、cubeファイルに変換することもできる。
具体的には、elses-generate-cubefile.f90の以下2行をactiveする。
!   file_format='upto_v0.03.09'   ! Activate this line, if needed
!   i_pbc=1                         ! Activate this line, if needed
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/23
担当者名 星健夫

新規ファイル
src/elses-qm-output-rest-energy-pair.f90

更新ファイル
src/elses-qm-solver-eig-geno.f90
src/elses-qm-output-icohp.f90
src/Makefile (上記新規ファイルを追記しただけ)

実験的機能(ICOHP, COHP spectrumの更新)。
GENOハミルトニアン、対角化のみ対応。

詳細：
(1) ICOHP (Bond) list (output_bond_list.txt)に、
ICOHPの対角(on-site)成分も出力させる。
(2) Atom pairごとのRest (repulsive) energy を出力。
ファイル名：output_rest_energy_pair.txt（固定）
output_bond_list.txtと同じフォーマットで、
output_bond_list.txtが出力されるタイミングで一緒に出力される。
(3) COHP spectrum (output_cohp.txt) のnormalizationがおかしかったので修正。
(4) ICOHP spectrum (eV単位)の出力を、output_cohp.txtに追加。
output_cohp.txtの1行に、以下の要領で数値が出力される：
energy mesh index, energy (eV), COHP(pair index順にならぶ), ICOHP(eV,pair
index順にならぶ)
注：論文中での「(I,J) pairのCOHP」とは、
C(I,J) = (-1/π) \sum_{αβ} H_{Jβ;Iα} G_{Iα;Jβ}
のこと。output_cohp.txtで出力されるCOHPは
C(I,J)+C(J,I) = 2 C(I,J)
である。注意が必要。
ICOHP行列B(I,J)は、2 C(I,J)のenergy積分。
注：output_cohp.txtにあるICOHPのうち、chemical potentialでの値が、
output_bond_list.txtにあるICOHP値に相当する。
注：output_bond_list.txtにある、ICOHP行列成分の総和が、Band structure energyに等しい：
E_band = 2 \sum_k f_k epsilon_k (2はpara-spin factor)
      = 2 Tr [ρH ]            (2はpara-spin factor)
	   = sum_{I,J} B(I,J)
　(para-spin factorはB(I,J)の定義に入っている。I,Jはfullに和をとる)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/21(4)
担当者名 星健夫

更新ファイル
src/elses-md-velocity-routines.f90

コード微修正。

詳細：
速度配列のゼロクリア。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/21(3)
担当者名 星健夫

更新ファイル
src/elses-md-save-struct.f90

xyzとaxsfの構造ファイルを同時に出力できるようにした。

詳細：
outputタグ中に、拡張子「.xyz_axsf」でファイル名を記載する。
例：<position filename="position.xyz_axsf" interval="1" />
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/21(2)
担当者名 星健夫

更新ファイル
src/elses-qm-output-participation.f90

実験的機能（2/18更新に対する再修正）
Participation ratioの出力部分。

詳細：
不要なstop文を削除
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/21
担当者名 星健夫

更新ファイル
src/elses-qm-output-participation.f90

実験的機能（2/18更新に対する修正）
Participation ratioの出力部分。

詳細：
gfortranで、一部のwrite文が通らない問題を修正。
計算結果に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/20
担当 西野信也

MSD計算ツールへの機能追加

ファイル：
/tool/MSD/src/calc_msd.f90

更新内容：
従来のMSDに加え、成分毎のMSDが出力されるように変更。
出力は従来通りoutput_msd.txtファイルに行われ、
Time msd msd_x msd_y msd_z
の順番で情報が書き出される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/18
担当者名 星健夫

新規ファイル
src/elses-qm-output-participation.f90

更新ファイル
src/elses-qm-geno-output.f90
src/Makefile (上記新規ファイルの追記のみ)


実験的機能（Participation ratioの出力）。

詳細：
Participation ratio (P)は、固有状態ごとに定義される量。
局在状態ならP=(1程度), 非局在状態ならP=(原子数程度)になる。
利用例：T. Fujiwara, T. Mitsui, S. Yamamoto, PRB53, R2910 (1996).
今のところ、verbose level1以上で、
wavefunctionタグが設定されている場合に出力される。
出力ファイル名（今のところ固定）：output_participation.txt
ファイルは固有値数分の行からなり、各行に
固有値index (k), energy level E(k) (eV), Participation ratio P(k),
occupation f(k)
が並ぶ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/16(2)
担当者名 星健夫

新規ファイル
src/elses-qm-set-s-as-i.f90

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-engine.f90
src/Makefile(上記新規ファイルを追記しただけ)

実験的機能（GENO非DST版でartificialにS=Iとするオプションを追加）

詳細：
genoOptionタグ内に、
<set_S_as_I />
または、
<set_S_as_I mode="on" />
と書くと発動。上記タグがない場合や、modeが「off」なら発動しない。

注：該当ルーチンはset_s_mat_as_i [M_qm_set_s_as_i]
注：計算に物理的な意味はなくなる。
数理的性質を調べるときのみ、有用。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/16
担当者名 星健夫

更新ファイル
src/elses-qm-solver-eig-geno.f90

実験的機能（GENO対角化でのTPDOSの出力）

詳細：
TPDOSの出力（実験的実装）。
PDOS/PNOS(s,p,d)を、原子種ごとに総和をとってプロットする。
input_energy_mesh.txtの1行目に「2」と書くと発動。
最後のiterationに対して、PDOS/PNOSを、output_tpdos.txtに出力される。
1行目はタイトルで、2行目以降に原子種ごとにデータが出力される。
各行にでる数値は、以下の内容になっている：
element index, energy mesh index, energy (eV), TPDOS(s,p,d) (1/eV),
TPNOS(s,p,d)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/14
担当者名 星健夫

更新ファイル
src/elses-la-krgl-main.f90

gKrylov_A法の微修正。

詳細：
計算検証ルーチンを追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/12
担当者名 星健夫

更新ファイル
src/elses-la-krgl-main.f90

実験的機能（gKrylov_A法の詳細設定の修正）。

詳細：
2012/02/11の修正が不十分だったのが、再修正。
cf. 2012/02/11更新、2012/01/02更新、2012/01/09(4)更新
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/11(2)
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.09→v0.03.10)
--------------------------------------------------------------------------------
***************************************************
2012/02/11
ELSES v0.03.09 Released (elses-v0.03.09-20120119-rel.tgz)
Note: identical to RC
***************************************************
--------------------------------------------------------------------------------
日付 2012/02/11
担当者名 星健夫

更新ファイル
src/elses-la-krgl-main.f90

実験的機能（gKrylov_A法の詳細設定）。

詳細：
非DST版でmArnoldi_qタグを設定したときの動作が、DST版と違っていたので修正。
cf. 2012/01/02更新、2012/01/09(4)更新
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/08
担当者名 星健夫

更新ファイル
tool/src/xml-check.f90

実験的機能（ツール：XMLファイルcheckerの修正）。
ELSES本体には無関係。

詳細：
1/24更新への修正。下記タグを認識していなかったので、修正。
HML_constant_K
HML_K
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/07
担当 西野信也

Quick Startの更新

ファイル：
quick-start-e.pdf

更新内容：

英語版に
・positionファイルへのセル情報出力
・計算時間設定
に関する文章を追記。

texファイル(quick-start-e_20120207.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/03
担当者名 星健夫

新規ファイル
src/elses-io-pair-list-for-cohp.f90

更新ファイル
src/elses-qm-solver-eig-geno.f90
src/elses-qm-geno-output.f90

実験的機能（対角化ワークフローでのCOHPスペクトラム）
従来機能に影響なし。


詳細：対角化ワークフローでのCOHP spectrumの計算方法（暫定的）

(A) 入力ファイル。
　以下の条件がそろうと、COHP spectrumは最後のiteration時にのみ、出力される。
・input_energy_mesh.txtを用意する。DOS計算と同じ要領で書く。
　ただし、1行目に「3」と書く。
・input_pair_list_for_cohp.txtを用意する。
　COHPを出力させたいatom pairを書く。1行ごとに、原子indexを二つ書く。
　例えば、1番目の原子と2番目の原子の間のCOHP spectrumを出す場合は、「1 2」と書く。
　原子pairの一方だけ指定したい場合は、2番目の値はは「0」とする。
　例えば、4番目の原子と(非ゼロの)COHPをもつ原子を全て出力させたければ「4 0」と書く。
・以下が、入力ファイルの例
-------------------------------
input_energy_mesh.txt
-------------------------------
3        # Mode ( 0 for nothing, 1 for TDOS, 2 for TDOS and LDOS, 3
for COHP spectrum )
1500     # Number of the energy mesh points
-50      # Lowest energy mesh point in eV
100      # Highest energy mesh point in eV
0.1      # Level broadening parameters in eV
-------------------------------
input_pair_list_for_cohp.txt
-------------------------------
1 2
6 7
4 0
9 11
8 9
-------------------------------

(B) 出力ファイル。
・output_cohp_pair_list.txt：計算される全原子ペアが、出力される。
　1行ごとに、原子indexが二つ出力される。
　例えば、1番目の原子と3番目の原子の間のCOHP spectrumを出す場合は、「1 3」と出力される。
・output_cohp.txt：COHPの値が出力される
　1行に、energy point (eV)、全ペアに大してのCOHP値、が出力される。
　ペアの順番は、output_cohp_pair_list.txtの順になる。
　つまり、output_cohp_pair_list.txtにN個のpairが記載されていれば、
　output_cohp.txtでは1行にN個分のCOHP値が書かれている。--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/02/01
担当 西野信也

Quick Startの更新

ファイル：
quick-start-e.pdf
quick-start.pdf

更新内容：

英語版に
・constant Kの設定
・s、p軌道に対するdouble-zeta
・MSD計算ツール
・xyz2xml.pl、xyz2xyz.plツール
に関する文章を追記。

日本語版のconstant Kに関する文章にミスプリがあったので修正。

texファイル(quick-start_20120201.tex、quick-start-e_20120201.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/28
担当者名 星健夫

更新ファイル
src/elses-md-output.f90

コード整備（標準出力）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/27
担当者名 星健夫

更新ファイル
src/elses-md-cell-change.f90

実験的機能（Unit cell変化時の機能整備）。

詳細：
(ax, ay, az)を書き換えた直後に、
config%system%structure%unitcell%vectorA(1)なども更新する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/26
担当者名 星健夫

新規ファイル
call_tree.html

CallTreeへのredirect HTMLファイルを用意。
ELSES本体への影響はなし。

上記HTMLファイルをウェブブラウザで開くと、
CallTree HTMLファイル(src/HTML/index.html)へredirectされる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/26(b)
担当者名 星健夫

新規ファイル
src/elses-xml-sax-counter.f90
src/elses-xml-sax-parser.f90
src/elses-xml-misc.f90
src/elses-xml-sax-handler.f90

実験的機能（SAX法での構造XMLファイル読み込みの拡充）

詳細：
1/25更新の継続。
atomタグ下のvelocity, forceの読み込みに非対応、など、
従来法(DOM法)での読み込みと比べると、まだ一部が不十分。

~~~~~~~~(以下、有用と思われる付記)~~~~~~~~

SAXでの構造XMLの読み込みができるようになりました。
（ただし、atomタグ下のvelocity, forceの読み込みに非対応なので、
　dynamics計算の継続用XMLはまだ非対応です）

本来の目標である、大規模系でのよみこみをやってみました。
ナノ多結晶ダイアモンドでの計算(鳥取大のwork staion)でのデータです。
MD loopが始まる前までの時間は、標準出力の以下行にでます。これをみました。
elaps-time(befor  MDloop)=              0           57.4865000000

107520(約10万)原子系
　DOM法：127.2847 sec
　SAX法：  4.9364 sec
1376256(約138万)原子系
　DOM法： (30分待っても終わらず)
　SAX法： 57.4865 sec

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/25
担当者名 星健夫

新規ファイル
src/elses-xml-sax-counter.f90
src/elses-xml-sax-handler.f90
src/elses-xml-sax-parser.f90

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/Makefile (上記新規ファイルを追記)
tool/Makefile (上記新規ファイルを追記)

実験的機能（SAX法での構造XMLファイルの読み込み）。
従来機能に変化なし。

注：tool/Makefileも変更しているのは、
tool/Makefileにelses-xml-config.f90が記載されているために、
依存関係から上記新規ファイルも記載する必要があるため。
tool下のツール類には影響はない。

詳細：SAX法での構造XMLファイルの読み込み。
atomタグ下のvelocity, forceの読み込みに非対応、など、
従来法(DOM法)での読み込みと比べると、まだ一部が不十分。

指定するには、clusterタグに、parser属性を追加する。
例：<cluster structure="C6H6.xml" parser="sax" />
「sax」「SAX」でSAX法が選択され、「dom」「DOM」でDOM法が指定される。
parser属性がなければ（従来通り）DOM法になる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/24
担当 西野信也

Quick Startの更新

ファイル：
quick-start-e.pdf
quick-start.pdf

更新内容：

英語版に
・出力ログファイル
・ソルバー選択
に関する文章を追記。

日本語版に温度設定に関する節が抜けていたので追加。

texファイル(quick-start_20120124.tex、quick-start-e_20120124.tex)は
doc_workにおいてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/24
担当者名 星健夫

新規ファイル
tool/src/xml-check.f90

更新ファイル
tool/Makefile (上記ファイルを追記)

実験的機能（ツール：XMLファイルのcheck）。
ELSES本体には無関係。

詳細：実験的新ツール：tool/xml-check
機能：設定XMLファイル・構造XMLファイル両方について、
主にXML tagのspell checkをする。
使い方：xml-check config.xml
全タグが逐次的にチェックされ随時出力されていき、最終診断結果は最後にでる。
・実行結果の例(sample/C6H6/config.xmlの結果)：
XML tag checker
scanned file name=config.xml
---------------Tag check starts--------------------
tag starts:config
tag starts:system
tag starts:cluster
（中略）
tag ends:position
tag ends:outputm
tag ends:config
---------------Tag check ends--------------------
scanned file name=config.xml
RESULT: OK !

・実行結果の例(sample/C6H6/config.xmlで、<optimization>タグを「<optimisation>」と
spell missしたもの)
XML tag checker
scanned file name=config.xml
---------------Tag check starts--------------------
tag starts:config
tag starts:system
tag starts:cluster
（中略）
unknown tag=optimisation
（中略）
tag ends:outputm
tag ends:config
---------------Tag check ends--------------------
scanned file name=config.xml
RESULT:ERROR:unknown tag is found!

複数定義されている下記タグについては、階層性のチェック。
・positionタグ：定義されている場所は以下
　atomタグ下（構造XMLファイル）、heatbathタグ下（構造XMLファイル）、outputタグ下（設定XMLファイル）
・velocityタグ：定義されている場所は以下
　atomタグ下（構造XMLファイル）、heatbathタグ下（構造XMLファイル）

機能の限界
・XML文法の間違いは検出できない。例：
　正：<A><B></B></A>
　誤：<A><B></A>
→xmllint(unixコマンド)などで検出できる
・階層性の間違いは（上記説明にあるものを除いて）検出できない。例：
　正：<A><B></B></A>
　誤：<A></A><B></B>
・属性名(attibute)の間違いはできない。例：
　正：<A unit="a.u."></A>
　誤：<A unitt="a.u."></A>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/20(2)
担当者名 星健夫

更新ファイル
src/elses-xml-02.f
src/elses-mod-01.f
src/elses-md-motion-verlet.f90
src/elses-md-velocity-routines.f90
src/elses-md-output.f90
src/elses-ini-load-common.f90

コード整備（不要変数の削除）。機能変化なし。

詳細：
温度を表す旧変数tempk0[elses_mod_thermo]の削除。
温度変数は、
config%system%temperature [M_config]
に統一。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/20
担当者名 星健夫

更新ファイル
src/elses-mod-01.f
src/elses-ini-load-common.f90
src/elses-xml-02.f

コード整備（不要配列の削除）。機能変化なし。

詳細：
不要配列である、(txp0, typ0, tzp0) [elses_mod_txp0]の削除。
--------------------------------------------------------------------------------
********************************************************************************
2012/01/19
ELSES v0.03.09 Release Candidate (elses-v0.03.09-20120119-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2012/01/19
担当者名 星健夫

新規ファイル
src/elses-io-update-snapshot.f90

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-io-dst-system-load.f90
src/elses-io-read-xyz-file.f90
src/elses-md-motion.f90
src/Makefile (上記新規ファイルを追記)

実験的機能の更新（snapshotモード構築途中）

詳細：
snapshotモードの実装（ただしまだ不完全）。以下仕様：
snapshotモードとは、ファイルからsnapshotを順次読み込んで計算するモード。
config XML内で<calc mode="snapshot">としたうえで、calcタグ内に、例えば
<snapshot initial="0" number="5" interval="2" />
と書く。この場合、ファイルに含まれる先頭snapshotから2つおきに、合計5snapshotsが順次読み込まれる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/18(3)
担当者名 星健夫

更新ファイル
src/elses-mod-01.f
src/elses-xml-02.f
src/elses-ini-load-common.f90
src/elses-md-velocity-routines.f90
src/elses-md-motion.f90

機能変化しないコード整備（速度配列の取り扱い）。

詳細：
dynamicsモード以外では、
速度配列(velx, vely, velz)をallocateしないようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/18(2)
担当者名 星健夫

更新ファイル
Makefile.inc

微修正（コメント文のみ）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/18
担当者名 星健夫

更新ファイル
src/elses-qm-projection-list-dstm.f90
src/elses-qm-cohp-dstm-plot.f90

実験的機能の更新（分散メモリ版でのCOHP出力の修正）。

詳細：
2012/01/16更新が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/18
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf

更新内容：
計算時間制限オプションに関するセクションを追加。
xyz出力ファイルへのセルサイズ追記オプションに関する説明を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/16
担当者名 星健夫

新規ファイル
src/elses-qm-cohp-dstm.f90
src/elses-qm-cohp-dstm-plot.f90

更新ファイル
src/elses-qm-engine-dst.f90
src/elses-qm-solver-gkrylov-dst.f90
src/Makefile (上記新規ファイルの追記)

実験的機能の更新（DST版でのCOHPの出力）
出力するタイミングの指定方法は、2011/04/01更新記録と同様。
ただし制限（下記）がある。

詳細メモ：
COHPの各要素は、各ノードでバラバラに計算されるため、
dump file (output-cohp-data-dump.txt;ファイル名固定)に出力される。
それをMatrixMarket形式のファイルに変換するツール（今のところ非公開）が必要。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/13(2)
担当者名 星健夫

更新ファイル
src/elses-qm-nrl.f90
src/elses-qm-partial-trace-dstm.f90

微修正（verbose levelの取り扱い）。
機能変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/13
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-dst-cell.f90
src/elses-qm-dst-domain.f90 (コメント文のみ)

実験的機能の更新（分散メモリ版でのmicro cell bookingタグ）

詳細メモ：
micro-cell分割でのbooking法のパラメーターを、手動設定できるようにした。
（無くても自動設定されるので、手動設定したい場合のみ）
distributedタグ内に、下記の要領で書く。
<micro_cell_booking mode="default">
  <cell_number_x> 4 </cell_number_x>
  <cell_number_y> 4 </cell_number_y>
  <cell_number_z> 4 </cell_number_z>
  <search_range_x> 1 </search_range_x>
  <search_range_y> 1 </search_range_y>
  <search_range_z> 1 </search_range_z>
</micro_cell_booking>
modeは「default」の他に、
「one_cell」(micro cell分割をしない)、
「inactive」(タグがinactiveの意。micro_cell_bookingタグを書かないのと等価)、
を受け付ける。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/10
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90

非常に大きい系(100万原子系など)での取り扱い修正。

詳細メモ：
非常に大きい系で、エラーで止まる問題を修正。
エラーで止まらない限り、動作は正常。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/09(4)
担当者名 星健夫

更新ファイル
src/elses-la-gkrylov-main-dstm.f90

実験的機能の更新（分散メモリ版でのgKrylov_A）

詳細メモ：
mArnoldi_qタグの動作が意図通りでなかったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/09(3)
担当者名 星健夫

更新ファイル
src/elses-io-read-xyz-file.f90

実験的機能の更新（cell情報付きxyzファイルの読み込み）。

詳細メモ：
2011/11/18更新が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/09(2)
担当者名 星健夫

更新ファイル
src/elses-qm-dst-projection-cell.f90
src/elses-qm-projection-suggest.f90

実験的機能の更新（分散メモリ版の微修正）。

詳細メモ：
データ書き出し部分のみ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/09
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90

実験的機能の更新（分散メモリ版）。

詳細メモ：
1/7更新が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/08(2)
担当者名 星健夫

新規ファイル
src/elses-la-eigen-tridiag.f90

更新ファイル
src/elses-la-gkrylov-main-dstm.f90
src/Makefile (上記新規ファイルを追記しただけ)

実験的機能の更新（分散メモリ版）。

詳細メモ：
gKrylov_L法の試験的実装（非分散メモリ版には未実装）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/08
担当者名 星健夫

更新ファイル
src/elses-md-main.f90
src/elses-qm-engine-dst.f90
src/elses-la-gkrylov-main-dstm.f90

実験的機能の更新（分散メモリ版）。

詳細メモ：
config%calc%solver%schemeの取り扱いの微修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/07
担当者名 星健夫

新規ファイル
elses-qm-projection-suggest.f90

更新ファイル
src/elses-qm-projection-list-dstm.f90
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-dst-projection-cell.f90
src/Makefile (上記新規ファイルを追加しただけ)

実験的機能の更新（分散メモリ版）。

詳細メモ：
gKrylovソルバー開発者むけタグとして、
calc%solverタグ内に、mode_for_suggest_projectionタグを設定。
例：
<mode_for_suggest_projection>
  default
</mode_for_suggest_projection>
内容としては、「from_density」(default)、
「upto_v0.03.08」(これまでのコードとの厳密な数値的互換性を持つモード)が選べる。
明示的設定がないときは、前者になる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/06(2)
担当者名 星健夫

更新ファイル
src/elses-md-main.f90

実験的機能の更新（分散メモリ版）。

詳細メモ：
分散メモリ版ワークフローへの分岐条件を修正。
非MPI環境でも、分散メモリワークフローに流れるようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/06
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90

実験的機能の更新。
実行時間制限(1/3更新で導入)のbugfix。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/05(2)
担当者名 星健夫

更新ファイル
src/elses-qm-projection-list-dstm.f90

実験的機能の更新（分散メモリ版）

詳細；
projection listの決め方の修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/05
担当者名 星健夫

更新ファイル
src/elses-lib-stop-signal.f90

機能変化を伴わない微修正（改行コード修正）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/04
担当者名 星健夫

更新ファイル
src/elses-lib-stop-signal.f90

手動停止機能の修正。

詳細：
2011/1/3更新に問題があったので、修正。
具体的には、close文の前にreturnが入ったいたので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/03
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf

更新内容：
出力ログファイルに関する文章を追加。
計算ソルバーの指定に関する記述を修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/03
担当者名 星健夫

新規ファイル
src/elses-lib-stop-signal.f90

更新ファイル
src/elses-md-main.f90
src/Makefile (上記新規ファイルを追加しただけ)

実験的機能の更新（実行時間制限の設定など）。

詳細：
計算途中で(規定のMDstep数に到達する前に)
止める方法として、以下の2つを実装。
(1) 設定XMLファイルで時間制限を設定する。
calc%limit%timeタグを設定することで、できる。
例：制限時間を1分に設定
<calc>
 <limit>
   <time unit="min"> 1 </time>
 </limit>
</calc>
注：unitの表記としては、
「second」「seconds」「sec」「s」
「minute」「minutes」「min」「m」
「hour」「hours」「h」
「day」「days」「d」
を受け付ける。
注：(経過時間) > (制限時間)になったら、
fileへのsaveなどを行って計算を終了する。
従って、全体の経過時間は制限時間を上回る。
計算時間にhard limitがある場合は、
hard limitより小さい値を設定する必要がある。
(2) 計算途中でstop signalを送ることで、止める。
ファイルを用意することでstop signalを送る。
具体的には、実行ディレクトリに、
00_stop_signal.txt
というファイルを用意して、1行目に0以外の整数を書き込む（2行目以降は不要）。
毎MDstepごとに上記ファイルを探して読んでいる。
stop signalが検出されしだい、fileへのsaveなどを行って計算を終了する。
注：上記ファイルが存在しなかったり、
1行目に0が書いてあれば、発動しない。
注：計算が走り出してから急に止めたくなった
(しかし計算が完了したMDstepまでの結果は保存しておきたい)ときに使う。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/02(2)
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-save-struct.f90

出力機能の拡張(xyz形式にcell情報追加可)。

詳細：
xyz形式のpositionファイルに、cell情報追加ができるようにした。
設定XMLファイルで、attirbute「cell_info="on"」を追加する。「off」にすると無効になる。
例：
<position filename="position.xyz" cell_info="on" interval="1" />
できあがったXYZファイルの1行目には、原子数、AX, AY, AZが並ぶ(長さはAngstrom単位)。
例：
       12       10.00000000000000000000
10.00000000000000000000       10.00000000000000000000
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/1/02
担当者名 星健夫

更新ファイル
src/elses-la-krgl-main.f90
src/elses-la-gkrylov-main-dstm.f90

実験的機能の更新（gkrylov）。

詳細：
2011/12/21(1)更新および2012/1/1更新で導入したXMLタグの扱いが、
意図通りでなかったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/01(3)
担当者名 星健夫

更新ファイル
src/elses-qm-solver-gkrylov-dst.f90

実験的機能の更新（分散メモリ版）。

詳細：
現在の分散メモリ版では、mode_for_large_memoryはない。
設定XMLファイル内で、
mode_for_large_memory=1
となっていても、強制的に=0に直される(warningが出る)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/01(2)
担当者名 星健夫

更新ファイル
src/elses-la-matvec-routines-dstm.f90

実験的機能の更新（分散メモリ版）。

詳細メモ：
エラーチェック機能の追加、動作仕様に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2012/01/01
担当者名 星健夫

更新ファイル
src/elses-la-gkrylov-main-dstm.f90

実験的機能の更新（分散メモリ版との統合促進）

2011/12/21(1)更新で導入したXML設定を、分散メモリ版にも導入。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/30(2)
担当者名 星健夫

更新ファイル
Makefile
Makefile.inc
Makefile.inc_release
Makefile.inc11
src/Makefile
src/*.f
src/*.f90
src/Nrl/*.f
src/Nrl/*.f90
src/code_for_mpi/*.f90
tool/*/*.f90
tool/*/*/*.f90
tool/Makefile
tool/plot_eigenstates/src/Makefile
tool/DOS/Makefile
tool/LDOS/src/Makefile-elses
tool/LDOS/src/*.f
tool/MSD/src/*.f90
tool/MSD/src/Makefile

Copyright表示での年表記(2007-2012に)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/30
担当者名 星健夫

更新ファイル
Makefile
src/elses-md-cell-change.f90

実験的機能の更新（周期セルの変形）。

注：
周期セルの変形機能の試験的実装。
ただし、a,b,c軸は直交している場合のみに対応。
input_cell_change.txtというファイルが存在するときに、発動する。
ファイル内容の例：
41.0342853147435 41.0342853147435 41.0342853147435
1 1.00 1.00 1.00
2 1.01 1.01 1.01
3 1.02 1.02 1.02
4 0.99 0.99 0.99
6 0.98 0.98 0.98
第1行目：cell length のreference値(au単位)。(ax0, ay0, az0)
第2行目：step count指定値, cell lengthの比 (cx, cy, cz)
step count指定値以降のcell lengthが、
 ax = cx * ax0
となる。ay, azも同様。
ここでのstep countは、構造XMLファイルにあるmd stepの値を基準とする。
継続シミュレーションでなければ、初期構造は(step count)=0、に相当する。
上記の例では、
step count=0,1で、cx=cy=cz=1
step count=2で、cx=cy=cz=1.01
step count=3で、cx=cy=cz=1.02
step count=4,5で、cx=cy=cz=0.99
step count=6以降で、cx=cy=cz=0.98
といったように、volume変化を表している。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/29(2)
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.08→v0.03.09)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/29
担当者名 星健夫

更新ファイル
src/elses-md-motion.f90

実験的機能の更新（原子位置update法）。
従来機能への変更なし。

注：詳細
Optimization modeで、sd_ratio=-1.0と設定すると、
原子座標が全く更新されず、iterationだけが継続する。
(periodic cellの変形などの時に使う想定)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
********************************************************************************
2011/12/27
ELSES v0.03.08 Released (elses-v0.03.08-20111202-rel.tgz)
Note: identical to RC2
********************************************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/21
担当 西野信也

Quick Startの更新

ファイル：
quick-start.pdf
quick-start-e.pdf

更新内容：
repulsive_rescalingタグのミスプリを修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/21(2)
担当者名 星健夫

更新ファイル
Makefile
src/elses-qm-engine-dst.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能への変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/21(1)
担当者名 星健夫

更新ファイル
Makefile
src/elses-config.f90
src/elses-xml-config.f90
src/elses-la-krgl-main.f90

実験的機能の更新（gKrylov）。

詳細：
gKrylovのパラメーター設定を、XMLファイルから行えるようにする。
<solver>タグに以下の要領で書く：
 <mArnoldi_q> 15 </mArnoldi_q>
 <inner_cg_loop>
    <max_iteration> 100 </max_iteration>
    <convergence_eps> -4 </convergence_eps>
 </inner_cg_loop>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/3
担当者名 星健夫

削除ファイル
src/elses-md-add-01.f90

不要(全く使われていない)ファイルの削除。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
********************************************************************************
2011/12/02
ELSES v0.03.08 Release Candidate 2 (elses-v0.03.08-20111202-rc2.tgz)
********************************************************************************
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/12/1
担当者名 星健夫

更新ファイル
src/elses-lib-dst-info.f90
src/elses-md-output.f90
src/elses-io-dst-write-log.f90

ファイル出力機能の修正。
計算結果には影響なし。

従来(非DST)ワークフローでの変化としては、
新しいログファイルとして
log-node00000.txt (ファイル名固定)
ができる。計算時間などの詳細情報がでるだけなので、無視して問題ない。

メモ：
DST版ワークフロー導入に伴い、ファイル出力機能の取り扱いを拡張した。
従来のようにwrite文で出力を行うと、node数(MPI並列度数)分だけ冗長に出力される。
これを制御するために、以下のようにしている。

A. 方針
・標準出力ファイルには、今後はできる限り出力しない。出力する場合は、原則的にroot nodeからのみ、とする。
　（例外：errorを検出してstopする場合のerror messageなど）
・代わりに、nodeごとのlogfileを定義する；
　log-node00000.txt, log-node00001.txt .....  (ファイル名固定)
ただし全ノードで書き出すと多数のファイルができるので、
最初の8ノード(node ID=0,1,...7)だけで書き出す。他nodeでは書き出さない。
・Output.txtは、root nodeでのみ書き出しをする。
注：物理的議論をするだけなら、root node以外からの出力は不要。
　　root node以外での出力は、nodeごとの計算時間のunbalanceなど、開発者むけの情報を出すため。

B. 制御パラメータ
下記を使う(全て整数型)。初期に決まり、その後変化しない。
・ i_verbose (module:M_qm_domain)
　→既存。root node以外での出力をおさえるために、強制的に-1に設定する。
・ log_unit  (module:M_lib_dst_info)
　→新設。nodeごとのlogfileに割り当てられた出力unit。
　　logfileを出力しないノードでは、強制的に-1(dummy値)に設定される。
・ output_unit (module:M_lib_dst_info)
　→新設。Output.txtへの出力に割り当てられた出力unit。
　　root node以外では、強制的に-1(dummy値)に設定される。

C. 各nodeでの制御パラメーターの値
(C-a) root node (node ID=0)
　　i_verbose ：ユーザーが決めるverbose level (defaultでは0)
   log_unit : 有効 (vacant_unitを読んで自動設定)
	output_unit：有効  (vacant_unitを読んで自動設定)
(C-b) root node以外で、logfileを出力するnode (node ID=1,2,...7)
　　i_verbose = -1 (dummy値)(固定)
   log_unit : 有効  (vacant_unitを読んで自動設定)
	output_unit= -1 (dummy値)(固定)
(C-c) その他のnode (node ID=8,...)
　　i_verbose = -1 (dummy値)(固定)
   log_unit  = -1 (dummy値)(固定)
	output_unit= -1 (dummy値)(固定)

D. プログラムの例
(D-a) 標準出力に、root nodeだけから出力させたい場合。
| use M_qm_domain, only : i_verbose
| (中略)
| if (i_verbose >= 0) write(*,*)'Hello'
注：root node以外ではi_verbose=-1なので、出力されない。
(D-b) root nodeから、verbose levelが1以上の時のみ、logfileへの出力をさせたい場合。
| use M_qm_domain, only : i_verbose
| use M_lib_dst_info,  only : log_unit
| (中略)
| if (i_verbose >= 1) then
|   if (log_unit > 0) write(log_unit, *)'Hello'
| endif
(D-c) logfileが設定されたnodeにて、該当logfileに出力させたい場合。
| use M_lib_dst_info,  only : log_unit
| (中略)
| if (log_unit > 0) write(log_unit, *)'Hello'
注：logfileが設定されていないnodeではlog_unit=-1なので、出力されない。

E. 細かいこと
「root node以外では強制的にi_verbose=-1とする」設定を解除したければ、
module M_md_dstに含まれる
 logical, parameter :: print_on_all_nodes = .false.
の部分を、trueに変えると良い。
この場合全nodeで、i_verboseの値は、ユーザーが設定したverbose levelになる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/11/27
担当者名 星健夫

更新ファイル
src/elses-qm-output-icohp.f90

実験的機能整備(π-ICOHP)。
従来機能に変化なし。

詳細メモ：
π-ICOHPの出力を整備。
ただしソースコードを書き換える必要がある。
具体的には、elses-qm-geno-output.f90の下記場所でimode_icohp=3にするだけ。
	imode_icohp=1
   call qm_output_icohp(imode_icohp)
使い方の詳細は、2011/04/01の更新記録を参照。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/11/24
担当者名 星健夫

更新ファイル
src/elses-md-save-struct.f90

ファイル入出力機能の微修正。

詳細メモ：
xyzファイルへのwrite文にformatを追加しただけ。
--------------------------------------------------------------------------------
********************************************************************************
2011/11/23
ELSES v0.03.08 Release Candidate (elses-v0.03.08-20111123-rc.tgz)
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/11/18
担当者名 星健夫

新規ファイル
src/elses-io-read-xyz-file.f90

更新ファイル
src/elses-md-save-struct.f90
src/elses-ini-load-common.f90
src/elses-io-dst-system-load.f90
src/Makefile (上記新規ファイルの追記のみ)

実験的機能の更新（ファイル入出力機能）。
今のところ、ソースコードを書き換えないと発動しない。

詳細メモ：「拡張されたxyz形式ファイルによる構造データ入出力」
非常に大きい系（数百万原子系）だと、
XML形式構造ファイルの読み込みルーチン(DOM法)が機能しなくなる
(時間がかかりすぎる)ことへの、暫定的対策。
拡張されたxyz形式ファイルとは、xyzファイルにcell情報を追加して、
周期系に対応させた（独自の）形式で、1行目に、
原子数　AX   AY   AZ
と、cell sizesをangstrom単位で記載する (cell vectorは直交していることを仮定)。
注：速度・力・電荷の情報は保存されていないので、XML形式ファイルの代わりにはならない。
(a) 拡張xyz形式での出力方法
elses-md-save-struct.f90の
logical, parameter           :: cell_info = .false.
の行をtrueに書き換えたうえで、
xyz形式ファイルを出力するように設定する。
できたxyz形式ファイルには、cell情報が入っている。
(b) 拡張xyz形式での入力方法
該当ファイル名を、
input_structure.txt
とする（名前は今のところ固定）。
構造XMLファイルで、cell情報と原子座標情報をすべて削る(heatbath情報のみ記述する)。
そうすると、input_structure.txtからデータを読み込む。
注1：構造XMLファイルに原子座標情報が入っている場合、input_structure.txtは無視される。
注2：構造XMLファイルに原子座標情報は入っておらず、cell情報だけが入っている場合、
input_structure.txtにcell情報が入っていなければ、cell情報は構造XMLファイルから読み込まれる。
input_structure.txtにcell情報が入っていれば、cell情報はinput_structure.txtの値が設定される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/11/12(2)
担当者名 星健夫

更新ファイル
Makefile.inc

Makefile.incの微修正。
comment行の編集のみ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/11/12
担当者名 星健夫

更新ファイル
src/elses-md-output.f90
src/elses-qm-output-matrices.f90
src/elses-qm-output-levels.f90

実験的機能の更新（ファイル出力機能）

詳細メモ：
行列(H,S)・固有値を定期的にファイル出力する機能の整備。
今のところ、ソースを変更しないと発動しない。
今後、XMLによる設定ができるように改変予定。

現状で発動させるには、elses-md-output.f90の
　logical, parameter :: plot_hamiltonian = .false.
　logical, parameter :: plot_levels      = .false.
　logical, parameter :: small_output = .true.
を、それぞれ、true, true, false,に書き換える。
position fileへの出力と同じタイミングで、ファイル出力される。
H, S, 固有値は、それぞれ
output_matrix_h.txt
output_matrix_s.txt
output_level.txt
に出力される。H,SはMatrix Market形式で、追記されていく。
H,Sは対称行列であるが、非対角要素(i,j)と(j,i)の両方が冗長に出力される。
H, 固有値の単位はa.u.。eVで出したければ、
subroutine qm_output_levels
subroutien qm_output_matrices
にある、
!   unit_conv=ev4au
   unit_conv=1.0d0
のところの1行目のコメントアウトを外し、2行目をコメントアウトする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/10/26
担当者名 星健夫

更新ファイル
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/elses-lib-mpi-wrapper-compile.f90

実験的機能の更新（分散メモリ版との統合促進）

注：
src/elses-lib-mpi-wrapper-compile.f90
は、
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
のコピー
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/10/25 (2)
担当者名 星健夫

新規ファイル
src/elses-qm-alloc-charge.f90
src/elses-qm-dstm-ini-setting.f90
src/elses-qm-projection-list-dstm.f90

更新ファイル
src/elses-la-gkrylov-main-dstm.f90
src/elses-qm-solver-gkrylov-dst.f90
src/elses-md-dst-update-cell-booking.f90
src/elses-md-make-bk-list-w-cell.f90
src/elses-qm-dst-micro-mat.f90
src/elses-qm-dst-domain.f90
src/elses-qm-dst-projection-cell.f90
src/elses-md-dst-cell.f90
src/Makefile(上記新規ファイルを追記)

実験的機能の更新（分散メモリ版との統合促進）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/10/25
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.07→v0.03.08)
--------------------------------------------------------------------------------
********************************************************************************
2011/10/20
ELSES v0.03.07 Released (elses-v0.03.07-20110910-rel.tgz)
Note: identical to v0.03.07 RC
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/10/11
担当者名 星健夫

更新ファイル：
src/elses-xml-02.f

旧スタイルで書かれたコードの整備（計算結果に影響なし）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/10/09
担当者名 星健夫

更新ファイル：
src/elses-md-save-struct.f90
src/elses-md-save-restart-xml.f90

特殊な設定条件下でおこる問題をfix。
計算数値に影響なし。

詳細：
verbose modeにせず、かつ、(XML/positionファイル等の保存interval)=0、
のとき、ファイル保存ルーチンに起こる問題をfix。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/09/24
担当者名 星健夫

更新ファイル：
src/elses-qm-population.f90

計算結果に影響のないコード整備（標準出力関連）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/09/23 (2)
担当者名 星健夫

更新ファイル：
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/elses-md-main.f90
src/elses-md-motion.f90
src/elses-md-output.f90
src/elses-lib-mpi-wrapper-compile.f90

実験的機能の更新（分散メモリ版での標準出力関連）

注：ファイル
src/elses-lib-mpi-wrapper-compile.f90
は、
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
のコピー
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/09/23
担当者名 星健夫

更新ファイル：
src/elses-00-main.f90
src/elses-qm-population.f90

計算結果に影響のないコード修正（標準出力関連）
--------------------------------------------------------------------------------
********************************************************************************
2011/09/10
ELSES v0.03.07 Release candidate (elses-v0.03.07-20110910-rc.tgz)
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/09/08(4)
担当者名 星健夫

更新ファイル：
src/elses-lib-dst-info.f90

gfortranでコンパイルできなかった問題を修正

メモ：
この問題は9/8(3)更新で混入したもの。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/09/08(3)
担当者名 星健夫

新規ファイル：
src/elses-lib-dst-info.f90
更新ファイル：
src/elses-md-dst-update-cell-booking.f90
src/elses-qm-dst-domain.f90
src/elses-io-dst-write-log.f90
src/elses-md-dst.f90
src/elses-md-main.f90
src/elses-md-motion.f90
src/elses-md-output.f90
src/Makefile (上記新規ファイルを追加)

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に変更なし。

メモ：
消費時間測定を追加。write文の整備。コード整備。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/09/08(2)
担当者名 星健夫

更新ファイル：
src/elses-md-dst-cell.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に変更なし。

メモ：
write文の整備。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/09/08
担当者名 星健夫

更新ファイル：
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/30
担当者名 星健夫

新規ファイル：
src/elses-qm-geno-rest-dstm.f90
src/elses-md-dst-update-cell-booking.f90

更新ファイル：
src/elses-md-dst-cell.f90
src/elses-qm-dst-domain.f90
src/Makefile (上記新規ファイルを追記）

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に変更なし。

詳細：
分散メモリ版ワークフローにおける、Restパート計算とcell booking法の更新。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/28
担当者名 星健夫

更新ファイル
src/Makefile

src/Makefileのbugfix.

詳細：
2011/08/27(6)更新で入ったbugをfix。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/27 (6)
担当者名 星健夫

新規ファイル
src/elses-md-make-bk-list-w-cell.f90
src/elses-md-dst-get-atom-range.f90

更新ファイル
src/Makefile(上記新規ファイルを追記しただけ)
src/elses-qm-dst-projection-cell.f90
src/eelses-qm-dst-domain.f90
src/elses-md-dst-cell.f90

実験的機能の更新（分散メモリ版との統合促進）。

詳細：
MPIにおけるdo loop分割ルーチンの更新。
従来ワークフローへの影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/27 (5)
担当者名 星健夫

更新ファイル
src/elses-io-dst-system-load.f90

実験的機能の更新（分散メモリ版との統合促進）。

詳細：
分散メモリワークフローでの、ファイル入力コードの修正。
従来ワークフローでは、影響は及ぼさない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/27 (4)
担当者名 星健夫

更新ファイル
src/elses-md-save-restart-xml.f90

ファイル出力コードの整備。
計算結果に代わりなし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/27 (3)
担当者名 星健夫

更新ファイル
src/elses-md-main.f90
src/elses-md-save-struct.f90
src/elses-xml-config.f90

ログファイルへの情報書き出しを微変更。
計算結果に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/27 (2)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90

実験的機能の更新（分散メモリ版との統合促進）。

詳細：
分散メモリワークフローでの、ログ書き出し処理。
従来ワークフローでは、影響は及ぼさない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/27
担当者名 星健夫

更新ファイル
src/elses-io-dst-write-log.f90

実験的機能の更新（分散メモリ版との統合促進）。

詳細：
分散メモリワークフローでのファイル出力処理。
従来ワークフローでは影響は及ぼさない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/18(2)
担当者名 星健夫

新規ファイル
src/elses-la-eigen-solver.f90

更新ファイル
src/elses-eig-leg.f90
src/Makefile (上記新規ファイルを追記しただけ)

標準対角化計算のコード整理(機能変化なし)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/18
担当者名 星健夫

更新ファイル
src/elses-qm-dst-domain.f90

gfortranでcompileが通らない箇所を修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/17(2)
担当者名 星健夫

新規ファイル
src/elses-qm-output-matrices.f90
src/elses-qm-output-levels.f90

更新ファイル
src/elses-md-output.f90
src/Makefile (上記新規ファイルを追加しただけ)

実験的機能の更新（ファイル出力）。
今のところ、ソースコードを書き換えないと、発動しない。

メモ：
Hamiltonian行列および固有値の履歴を書き出しする機能。
・ルーチン「elses_md_output_main」(elses-md-output.f90)の下記行を
「.true.」にすると、発動する：
　logical, parameter :: plot_hamiltonian = .false.
　logical, parameter :: plot_levels      = .false.
・発動すると、構造データファイル出力と同じタイミングでeV単位で出力する。
・Hamiltonianの出力ファイル名は「output_hamiltonian_history.txt」に、
　固有値はoutput_level_history.txtに固定。
・H行列は対称行列であるが、非対角要素は、H(i,j)とH(j,i)を冗長に出力。
・行列ファイルの形式はMatrix market形式で、時系列的に追記されていく。例：
%%MatrixMarket matrix coordinate real general
% step_count=         0
        400         400       16000
        1         1        2.0350000000
        2         1       -1.6750000000
        3         1       -1.6750000000
1行目：matrix-market形式のheader
2行目：時間ステップ
3行目：総行数、総列数、非ゼロ要素総数
4行目以降：行番号、列番号、非ゼロ要素の値(eV単位)（i, j, A(i,j)）。
注：全体として、(非ゼロ要素総数)+3、の行で、1スナップショットに相当。
・固有値ファイルの形式は以下。例：
        0         1      -22.6272949734        1.0000000000
        0         2      -22.1731063205        1.0000000000
        0         3      -22.1620997788        1.0000000000
        0         4      -21.3945320960        1.0000000000
        0         5      -21.3480998467        1.0000000000
        0         6      -20.9695495561        1.0000000000
        0         7      -20.9597812672        1.0000000000
        0         8      -20.9233528753        1.0000000000
1行づつは、以下の内容：
第1項：時間ステップ
第2項：固有値インデックス(k=1,2,3....,行列次元数)
第3項：固有値e_k (eV単位)
第4項：占有数f_k ( 0 =< f_k =< 1 )
注：全体として、(行列次元数)の行で1スナップショットに相当。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/17
担当者名 星健夫

更新ファイル
src/elses-kr-sub.f

コード整備（非常に大きい系むけ）。

メモ：
400万原子以上の系で、エラー判定ルーチンが意図通り機能しない問題を解消。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/16
担当者名 星健夫

更新ファイル
src/elses-la-matvec-dst.f90
src/elses-qm-dst-dens-mat.f90
src/elses-qm-dst-domain.f90
srcelses-la-matvec-routines-dstm.f90
src/elses-qm-partial-trace-dstm.f90
src/elses-qm-dst-projection-cell.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能への変更なし。

メモ：分散メモリ版用ファイルのうち、
仕様が固まっていない以下の3ファイルは、
（コンパイルを通すための）ダミーファイルが入っている：
src/elses-qm-engine-dst.f90
src/elses-la-gkrylov-main-dstm.f90
src/elses-qm-solver-gkrylov-dst.f90
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/14(3)
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.06→v0.03.07)
--------------------------------------------------------------------------------
********************************************************************************
2011/8/14
ELSES v0.03.06 Released (elses-v0.03.05-20110711-rel.tgz)
Note: identical to v0.03.06 RC2
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/08/14(2)
担当者名 星健夫

新規ファイル
src/elses-md-get-distance.f90
src/elses-la-gkrylov-main-dstm.f90
src/elses-qm-dst-micro-mat.f90
src/elses-la-matvec-routines-dstm.f90
src/elses-qm-partial-trace-dstm.f90
src/elses-qm-charge-from-weight-dst.f90

更新ファイル
src/Makefile(上記新規ファイルの追加)

実験的機能の更新（分散メモリ版との統合促進）。
従来機能への変更なし。

メモ：分散メモリ版用ファイルのうち、
仕様が固まっていない以下の3ファイルは、
（コンパイルを通すための）ダミーファイルが入っている：
src/elses-qm-engine-dst.f90
src/elses-la-gkrylov-main-dstm.f90
src/elses-qm-solver-gkrylov-dst.f90
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/14
担当者名 星健夫

更新ファイル
src/elses-qm-population.f90

コードの微修正。計算結果に影響なし。

詳細：
標準出力へのメッセージ内容の微修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/08/06
担当者名 星健夫

更新ファイル
src/elses-vis-rasmol.f90

PDBファイルへの書き出し機能の修正(再)。

詳細：
10万原子以上だと、書式の一部が非対応となる問題を修正。
7/8(3)更新と同じ内容。
ファイルが正しく置き換わっていなかったので、再更新。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/26
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf
 
mksupercellツールに関する注意事項を追記。
 
texファイル（quick-start_20110726.tex）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/26
担当者名 星健夫

更新ファイル
src/elses-md-motion-verlet.f90

構造最適化モードでの問題修正。

詳細：
構造最適化モードで、運動エネルギーの表示が仕様通りでない（０でない）問題を修正。
構造最適化自体は正しく行われる。この問題は7/4更新で混入した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/21
担当者名 星健夫

新規ファイル
src/elses-io-dst-write-log.f90

更新ファイル
src/elses-qm-domain.f90
src/elses-md-dst.f90
src/elses-md-main.f90
src/elses-md-output.f90
src/Makefile(上記新規ファイルを追加)

実験的機能の更新（分散メモリ版との統合促進）。

詳細：
分散メモリワークフローでのファイル出力処理。
従来ワークフローでは影響は及ぼさない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/19
担当者名 星健夫

新規ファイル
src/elses-io-dst-system-load.f

更新ファイル
src/elses-ini-load-common.f90
src/Makefile(上記新規ファイルを追加)

実験的機能の更新（分散メモリ版との統合促進）。

詳細：
大規模系のファイル入力関連の整備。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/17
担当者名 星健夫

更新ファイル
src/elses-xml-config.f90
src/elses-ini-load-common.f90

コード整備（機能変更なし）。

詳細：
structure XMLファイルに不備があったときのエラー処理の手順を変更。
--------------------------------------------------------------------------------
********************************************************************************
2011/07/11
ELSES v0.03.06 Release candidate 2 (elses-v0.03.06-20110711-rc2.tgz)
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/07/10
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf
 
以下の項目を追記。
・s, p軌道に対するdouble-zetaの取り扱い
・コンスタントKの指定方法
・xyz2xml.pl、xyz2xyz、msdツール
 
texファイル（quick-start_20110710.tex）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/09
担当者名 山元進
更新ファイル elses-md-save-restart-xml.f90
更新内容
gfortran の一行の長さの制限に引っかかった行を分割。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/08 (5)
担当者名 星健夫

更新ファイル
src/elses-qm-population.f90
src/elses-md-save-restart-xml.f90

7/7更新に対する補正。
下記メモにあるワークフローを一部修正。

メモ：構造体におけるpopulationデータ（各原子におけるMulliken Charge）
j-th atomに対するデータは、下記で格納
・config%system%structure%vatom(j)%population
　(converged population)
・config%system%structure%vatom(j)%population_set
　(logical, converged populationが入っているかどうか)
・config%system%structure%vatom(j)%population_guess
　(initial guess population; CSC loopのinitial guessにのみ使われる)
・config%system%structure%vatom(j)%population_guess_set
　(logical, initial guess populationが入っているかどうか)

上記が関連するのは、以下の5カ所

(a) XMLファイルからの読み込み(MD loopが始まる前)
・ルーチン：atom_load (ファイル：elses-xml-config.f90)
・Call tree：elses_md_main_01/ini_load_geno/load_xml_config/config_load/
system_load/structure_load/atom_load

(b) CSC loopの最初で読み込み
・ルーチン：initial_guess_for_charge (ファイル：elses-qm-population.f90)
・Call tree：elses_md_main_01/elses_qm_engine/initial_guess_for_charge
・e_num_on_atom(:), previous_e_num_on_atom(:)に、population_guessの値を代入。
・population_guess_setがfalseなら、
　ルーチン「initialize_charge」(elses-qm-geno.f90)をcallし、default値を代入

(c) CSC loop後、収束した値を保存
・ルーチン：save_population_after_convergence (ファイル：elses-qm-population.f90)
・Call tree：elses_md_main_01/elses_qm_engine/
save_population_after_convergence
・populationに、e_num_on_atom(:)の値を代入。

(d) XMLファイルへの書込み(指定されたMD stepでのみ)
・Call tree：elses_md_main_01/elses_md_save_struct/save_restart_xml/
save_restart_xml_main/atom_save

(e) 次のMD step用に、population_guessの値をupdate
・ルーチン：update_population_guess (ファイル：elses-qm-population.f90)
・Call tree：elses_md_main_01/elses_md_motion/update_population_guess
・population_guessに、populationの値を代入。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/08 (4)
担当者名 星健夫

更新ファイル
src/elses-md-motion-verlet.f90

コード整備（機能変化なし）。

詳細：標準出力への書き出しコマンドを微修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/08 (3)
担当者名 星健夫

更新ファイル
src/elses-vis-rasmol.f90

PDBファイルへの書き出し機能の修正。

詳細：
10万原子以上だと、書式の一部が非対応となる問題を修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/08 (2)
担当者名 星健夫

更新ファイル
src/elses-qm-projection.f90
src/elses-qm-geno.f90
src/elses-kr-sub.f

コード整備（機能変化なし）。
（標準出力への書き出し、消費時間計測コマンドの追加、など）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/08
担当者名 星健夫

更新ファイル
src/Makefile
src/elses-md-main.f90
src/elses-qm-geno-dst.f90
src/elses-la-matvec-dst.f90
src/elses-lib-omp.f90
src/elses-qm-geno-csc-dst.f90
src/elses-qm-dst-global-ham-mat.f90
src/elses-md-dst.f90
src/elses-md-dst-booking.f90
src/elses-qm-dst-projection-cell.f90
src/elses-qm-dst-dens-mat.f90
src/elses-md-dst-cell.f90
src/elses-qm-dst-domain.f90
src/elses-lib-mpi-wrapper-compile.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に変更なし。

メモ：分散メモリ版との違いは、以下の2ファイルのみ。
elses-qm-engine-dst.f90
elses-qm-solver-gkrylov-dst.f90
(パッケージでは、compileを通すためのダミールーチンが入っている)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/07(2)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90
Makefile.inc

コード整備（機能変更なし）。

メモ：
Makefile.incには、gfortran用のコンパイルオプションの記述を追加
（ただし現状ではcomment-outされている）。

elses-ini-load-common.f90の変更は、gfortranコンパイル時にでるwarningを減らすように整備。
（機能変化を伴わない：例：型宣言されているが、利用されていない変数を消す）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/07
担当者名 星健夫

新規ファイル
src/elses-qm-population.f90

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-save-restart-xml.f90
src/elses-qm-engine.f90
src/elses-md-motion.f90
src/Makefile (上記新規ファイルを書き加えただけ)

restart用XMLファイルにおけるpopulation(原子上電子数）情報の活用。
(これまでは、restart用XMLファイルの読み込み時に無視されていた)
GENO-CSC系での有限温度計算において、完全シームレスなrestartができるようになった。

メモ：restart XMLファイルでの、population(電荷分布）情報
1原子あたりの記載の例：
<atom element="C" class="" motion="free">
 <position unit="internal">  0.140356671946042E+00
-0.412660919941943E-02 -0.146279209929467E-02</position>
 <velocity unit="a.u.">  0.736930756849569E-04
-0.448650402465017E-03  0.555237627073981E-04</velocity>
 <force    unit="a.u."> -0.334331032021093E-01
-0.565411353720996E-02  0.194682224551119E-01   </force>
 <population>          4.02432192695226298440  </population>
 <population_guess>          4.01808041083902534041  </
population_guess>
</atom>
ここで、 <population>タグの値は、CSC loopでconvergeした原子上電子数。
<population_guess>タグの値は、CSC loopで使用した、initial guessの原子上電子数。
後者の値はrestart計算のためにのみ使われる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/06
担当者名 星健夫

更新ファイル
src/elses-qm-engine.f90
src/elses-qm-engine-csc.f90

charge-mixing付きCSC loopの振る舞いを若干修正。
（収束途中の振る舞いが変わるだけで、十分収束していれば良いことには変わりない）

詳細：
現在のcharge-mixing付きCSC loopの振る舞いの説明：
charge-mixingとは、CSC loopにおいて、
「現在得られている電荷分布」と「前iterationでの電荷分布」をまぜて、
「新しい(次iterationで使う)電荷分布」を作るテクニック。
しかし、CSC loopの最初のiterationではそもそも「前iteration」が存在しないため、
「前iterationでの電荷分布」を混ぜる事は(定義上)できず、代わりに
「新しい(次iterationで使う)電荷分布」=「現在得られている電荷分布」
となる(mixing_ratio=1.0でのmixing計算に相当)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/04 (2)
担当者名 星健夫

更新ファイル
src/elses-ini-load-common.f90

コードの微修正（機能変化なし）。

詳細：
同じルーチン(elses_md_motion_ini_set)が無意味に2度よばれていたので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/07/04
担当者名 星健夫

更新ファイル
src/elses-md-motion.f90
src/elses-md-velocity-routines.f90
src/elses-md-motion-verlet.f90
src/elses-xml-02.f
src/elses-md-main.f90

有限温度ダイナミクスでのrestart計算法の修正。
「有限温度計算でのrestart計算」をやらなければ、影響なし。

詳細：
restart XMLファイルで、速度データが正しく扱われていなかった問題を修正。
（これはv0.03.00で混入した問題）。

メモ：
GENOワークフローでは、restart XMLファイルに電荷分布
(原子ごとのelectron population)が出力されているが、
現状では、このデータは読み込み時には無視されている。
近日中に、データ読み込みに対応し、
CSC loopで使えるようにする予定。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/06/14
担当者名 星健夫

更新ファイル
src/elses-lib-mpi-wrapper.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/06/12 (2)
担当者名 星健夫

更新ファイル
src/elses-qm-dst-domain.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に変化なし。

詳細メモリ：
allocate文の整理
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/06/12
担当者名 星健夫

更新ファイル
Makefile
src/elses-00-version-info.f90

バージョン番号更新(v0.03.05→v0.03.06)
--------------------------------------------------------------------------------
********************************************************************************
2011/5/28
ELSES v0.03.05 Released (elses-v0.03.05-20110428-rel.tgz)
Note: identical to v0.03.05 RC
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/05/07 (2)
担当者名 星健夫

更新ファイル
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/elses-md-output.f90

実験的機能の更新（分散メモリ版）。
計算結果に変化なし。

詳細メモリ：
ファイル出力(write文)の微修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/05/07
担当者名 星健夫

更新ファイル
src/elses-config.f90

5/06更新の問題(gfortranでcompileできない)を修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/05/06 その(2)
担当者名 星健夫

更新ファイル
src/elses-qm-dst-global-dens-mat.f90
src/elses-la-matvec-routines.f90
src/elses-qm-dst-dens-mat.f90
src/elses-qm-dst-domain.f90
src/elses-md-dst.f90
src/elses-qm-geno-csc-dst.f90
src/elses-qm-output-atom-charge.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に影響なし。

詳細メモ：
これで、詳細仕様が固まっていない2ファイル
elses-qm-engine-dst.f90, elses-qm-solver-gkrylov-dst.f90
をのぞいて、統合できた。
現行パッケージでは、上記2ファイルは、(compileを通すための)dummy fileになっている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/05/06
担当者名 星健夫

更新ファイル
src/elses-md-main.f90
src/elses-config.f90
src/elses-xml-config.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に影響なし。

詳細メモ：
・DST版用のXMLタグの設定(elses-config.f90,elses-xml-config.f90)。
・DST版への分岐部分の更新。positionファイル・restartファイルなどへの書き出しを
root node(myrank=0)のみで行うようにした(elses-md-main.f90)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/05/05
担当者名 星健夫

新規ファイル
src/elses-qm-geno-dst.f90
src/elses-qm-dst-global-ham-mat.f90
src/elses-la-matvec-dst.f90
src/elses-qm-geno-csc-dst

更新ファイル
src/Makefile
src/elses-md-dst.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に影響なし。

詳細メモ：
Makefileへの修正は、追加された4ファイルを追記しただけ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/05/04
担当者名 星健夫

更新ファイル
src/elses-md-output.f90
src/elses-md-main.f90
src/elses-qm-geno-output.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に影響なし。

詳細メモ：
elses-md-output.f90：
DSTワークフローでglobal matrices(dhijなど)がdefineされていないときの、応急処置。
elses-md-main.f90：
DSTワークフローへの分岐部分の修正。
elses-qm-geno-output.f90：
ルーチン「qm_calc_ecsc」をpublic属性にする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/05/02
担当者名 星健夫

更新ファイル
src/elses-qm-domain.f90

実験的機能の更新（分散メモリ版との統合促進）。
従来機能に影響なし。

詳細メモ：
TB0項由来の力を、module変数配列(M_qm_domain)として追加(atm_force_tb0)。
今のところ、分散メモリ計算のみで利用。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/30
担当者名 星健夫

更新ファイル
src/elses-qm-solver-krgl.f90

gkrylov_A solverでの、default設定の一部変更。

gkrylov_A法を使っていて、かつ、CSC計算をする場合にのみ、
計算結果に若干の違いがでる場合がある。

詳細メモ：
DST版にあわせて、sym_dbij_and_dpijルーチンのon/offの変更。
--------------------------------------------------------------------------------
********************************************************************************
2011/04/28
ELSES v0.03.05 Release candidate  (elses-v0.03.05-20110428-rc.tgz)
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/04/26
担当者名 星健夫

更新ファイル
src/elses-md-dst.f90

verbose level設定についての修正

詳細メモ：
従来（非分散メモリ）計算で、verbose levelが正しく設定されない場合がある問題を修正。
（この問題は、4/6更新で入った。それ以前のバージョンには影響なし）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/25
担当者名 星健夫

更新ファイル
src/elses-la-gkrylov-main.f90

実験的機能の更新（分散メモリ版ワークフローへの対応促進）。
従来ワークフローでの動作に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/23
担当者名 星健夫

更新ファイル
src/elses-qm-dst-domain.f90

実験的機能の更新（分散メモリ版の修正）。
従来機能に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/20
担当者名 星健夫

更新ファイル
src/elses-md-init.f
src/elses-xml-02.f
src/elses-eig-leg2.f
src/elses-md-main.f90

コード整備（不使用ルーチンの削除など）。
機能に変更なし。

メモ：更新summary
elses-md-main.f90：defaultを非DST計算にした。
残りの3ファイル：不使用(旧)ルーチンの削除
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/16
担当者名 星健夫

更新ファイル
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90


実験的機能の更新（MPI関連ルーチンの更新）。
従来機能に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/09 (2)
担当者名 星健夫

削除ファイル
src/elses-sub.f

更新ファイル
src/Makefile
src/elses-md-motion-verlet.f90
src/elses-md-motion.f90
src/elses-ana-icohp.f90

コードの整備。機能に変更なし。

メモ：固定形式で書かれたelses-sub.fを、ファイルごと廃止。
　使われていないルーチン→何もせず消すだけ
　　(elses_calc_kin_ene, elses_write_molden_dat, elses_md_output)
　使われていたルーチン→移行（詳細下記）(elses_md_heatbath)
　使われていたfunction→移行（詳細下記）(get_atom_dist)

メモ：ファイルごとの更新summary
elses-md-motion-verlet.f90：
　routine「md_heatbath」新設。
　「elses_md_heatbath」(elses-md-sub.f内)を移行したもの。

elses-md-motion.f90：
　function「get_atom_dist」新設。
　「get_atom_dist」(elses-md-sub.f内)を移行したもの。

elses-ana-icohp.f90：
　「get_atom_dist」を利用していたので、それにともなう更新

Makefile：
　elses-md-sub.fのエントリを削除。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/09
担当者名 星健夫

新設ファイル
src/elses-lib-omp.f90

削除ファイル
src/elses-lib-omp.f
(注：elses-lib-omp.f90に移行)

更新ファイル
src/Makefile
src/elses-00-main.f90

OMP関連ライブラリの更新。
従来機能に変更なし。

メモ：更新sumary
elses-lib-omp.f90：下記の2ルーチンを用意
show_omp_info (従来の、elses_omp_test)
→show OpenMP information, such as the number of threads
zero_clear_omp_r4(a)
→ Zero clear an array with the OMP direvtive

elses-00-main.f90の更新は、
「call elses_omp_test」を「call show_omp_info」にしただけ。

Makefile
elses-lib-omp.f90のエントリを追加して、lses-lib-omp.fを削除。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/06 (2)
担当者名 星健夫

更新ファイル
src/elses-qm-engine-csc.f90
src/elses-00-main.f90
src/elses-md-output.f90
src/elses-ini-load-common.f90
src/elses-la-krgl-main.f90
src/elses-md-dst.f90

実験的機能の実装（分散計算版との統合促進）。
従来機能に変更なし。

メモ：現行コードの分散計算ではノードごとに冗長にファイルに出力してしまうので、
それを抑制するための方策を準備した。

具体的には、elses-md-dst.f90のmodule variable(parameter)である
print_on_all_nodesで（ソースコード書き換えることで設定）できる。
この値から、print_on_this_node(同module variable), i_verbose値が設定される。
(i) print_on_all_nodes = .true.の場合
　全ノードで、print_on_this_node=.true.で、i_verbose値は入力値のまま
(ii) print_on_all_nodes = .false.の場合
 root node (myrank=0)では、print_on_this_node=.true.で、i_verbose値は入力値のまま。
 それ以外のノードでは、print_on_this_node=.false.で、i_verbose=-1。
たとえば、(ii)の設定だと、
　if (i_verbose >= 0) write(*,*) 'Hello'
または、
　if (print_on_this_node) write(*,*) 'Hello'
とすると、root nodeでのみ書き出しが行われる。
徐々にwrite文を上記のように書き換えていく予定。

メモ：verbose level設定のワークフロー
　(1) ルーチン「elses_process_options」→config%option%verboseを設定
 (2) ルーチン「set_dst_initial」　　　→i_verboseを設定

メモ：更新summary
elses-qm-engine-csc.f90
→ルーチン「tune_mix_ratio」をpublic属性にした。
elses-00-main.f90
→サブルーチンのcallする順番を変更。verbose level設定のワークフローのため。
elses-md-output.f90
→ルーチン「elses_md_output」の代わりに、ルーチン「md_output_compat」をcallする。
　ルーチン「elses_md_output」(elses-md-sub.f内)は不要なので、削除予定。
elses-ini-load-common.f90
→i_verboseの設定をやめる。
elses-la-krgl-main.f90
→微修正（機能に違いなし）
elses-md-dst.f90
→i_verboseの設定をする(ルーチン「set_dst_initial」)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/06
担当者名 星健夫

更新ファイル
src/elses-qm-solver-geno-main.f90

コード微調整（機能変化なし）。

注：上記ファイルは、elses-v0.03.04-20110227-rel.tgzのものに戻した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/05 (2)
担当者名 星健夫

新規ファイル
src/elses-qm-dst-global-weight.f90
src/elses-qm-dst-global-dens-mat.f90
src/elses-md-dst-booking.f90
src/elses-qm-dst-domain.f90
src/elses-qm-dst-dens-mat.f90

更新ファイル
src/Makefile
src/elses-qm-domain.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/elses-lib-mpi-wrapper-compile.f90
(code_for_mpi/elses-lib-mpi-wrapper-dummy.f90と同じ)

削除ファイル
src/elses-qm-solver-gkrylov-mpi.f90 (elses-qm-solver-gkrylov-dst.f90に統
合)


実験的機能の実装（分散計算版との統合促進）。
従来機能に変更なし。

注：Makefileへの変更は、ファイル名の追加・削除のみ。
注：elses-qm-domain.f90への変更は、ルーチンmake_booking_listをpublic属性にした点のみ。

注：分散計算版は、仕様の固まったコードから統合。
本パッケージのワークフローは不完全で、機能はしない。
コンパイルを通すために、下記ファイルにはダミールーチンが入っている：
src/elses-qm-solver-gkrylov-dst.f90,
src/elses-qm-engine-dst.f90
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/05
担当者名 星健夫

新規ファイル
src/elses-md-dst.f90
src/elses-qm-engine-dst.f90

更新ファイル
src/elses-00-main.f90
src/elses-qm-solver-geno-main.f90
src/elses-md-main.f90
src/Makefile

削除ファイル
src/elses-md-mpi.f90 (elses-md-dst.f90に統合)


実験的機能の実装（分散計算版との統合促進）。
従来機能に変更なし。

注：分散計算版は、仕様の固まったコードから統合。
本パッケージのワークフローは不完全で、機能はしない。
（コンパイルを通すために、一部にダミールーチンが入っている）。

メモ：分散計算ワークフローに関連したルーチン名や変数名には、
「dst(=distributed)」がついている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/03
担当者名 星健夫

Makefile
src/elses-00-version-info.f90

version番号を、v.0.03.05に変更
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/03
担当者名 星健夫

更新ファイル
src/elses-md-main.f90

実験的機能の微修正（計算途中での手動停止機能）。
従来機能に変更なし。

詳細メモ：4/2更新(計算途中での手動停止機能)への微修正。
inquire文を使うようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/02
担当者名 山元進
更新ファイル elses-qm-geno-Huckel-atom-parameters.f90

  2010/11/29, 2011/03/12 に付け加えた, double-zeta 基底を s, p 軌道で
使うためのコードが、過去との互換性を壊していた。

本来, c2 /= 0d0 ならば、その軌道は single-zeta 基底として扱う必要がある。
しかし、誤ってこれを double-zeta 基底として取扱っていた。
c1, c2 ともに 0d0 であるために、波動関数の norm が 0d0 になり、
renomalization に失敗していた。

これを修正した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/02
担当者名 星健夫

更新ファイル
src/elses-md-save-struct.f90
src/elses-md-save-restart-xml.f90
src/elses-ini-load-geno.f90
src/elses-vis-main.f90
src/elses-md-main.f90

実験的機能の実装（計算途中での手動停止）。
従来機能に変更なし。

詳細メモ：計算途中での手動停止機能。
MD計算(dynamics or optimization)が開始された後で、何かの事情で、途中終了させたくなったときに用いる。
具体的には、実行ディレクトリに
00_stop_signal.txt
というテキストファイル用意し、第1行に「0」以外の整数を書き込んでおくと、発動する。
restart用XMLファイルを書き出して、プログラムが停止する。
なお、上記ファイルが存在しない場合や第1行が「0」である場合は、無視される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/04/01
担当者名 星健夫

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-geno-output.f90
src/elses-qm-output-icohp.f90

実験的機能の追加(ICOHP出力機能）。従来機能での動作に変化なし。

メモ：ICOHP出力機能(現状ではgeno work flowにのみ実装)
該当ルーチンは、「qm_output_icohp」。
config.xmlの<output>タグ中に、下記要領で追記することで発動：
 <bond_list filename="output_bond_list.txt" interval="2" />
ただしくタグが認識されると、標準出力に以下のメッセージが出る：
 A XML tag is found : config%output%bond_list
上記例だと、output_bond_list.txtに、ICOHP(eV単位)が非ゼロである原子ペアに対して出力されている。
出力フォーマットは、Matrix Market形式。
--------------------------------------------------------------------------------
********************************************************************************
2011/3/28
ELSES v0.03.04 Released (elses-v0.03.04-20110227-rel.tgz)
Note: identical to v0.03.04 RC2
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/03/12
担当者名 山元進
更新ファイル elses-qm-geno-Huckel-atom-parameters.f90
s,p 軌道に対して double-zeta 基底関数を適用する際に、
normalization のチェックが行われていなかったので、
チェックするように変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/03/08
担当者名 星健夫

追加ファイル
src/elses-md-mpi.f90
src/elses-lib-mpi-wrapper-compile.f90
src/code_for_mpi/elses-lib-mpi-wrapper.f90
src/code_for_mpi/elses-lib-mpi-wrapper-dummy.f90

更新ファイル
src/Makefile
src/elses-00-main.f90

実験的機能の追加(MPI関連）。従来機能での動作に変化なし。

注：現状ではMPI計算は開発途中で、ソースに手を加えないと発動しない。

詳細メモ：
src/Makefileへの変更点：
elses-lib-mpi-wrapper-compile.f90
elses-md-mpi.f90
の項目を追加。

src/elses-00-main.f90への変更点：
MPIの開始時・終了時用ルーチンをcall
（ただし、現状ではダミールーチンになっているので、何も起きない）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/03/07
担当 西野信也
Quick Startの更新
ファイル：
quick-start.pdf, quick-start_e.pdf
電子数のファイル出力に関する部分を追記。
texファイル（quick-start_20100307.tex, quick-start-e_20100307.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/03/05
担当者名 星健夫

更新ファイル
src/elses-md-save-restart-xml.f90

2/28更新(担当：星健夫)の修正。
gfortranでcompileが通らない問題を解決。

詳細メモ：
下記のルールに違反していたので修正
(ifortでは、違反していてもcompileが通るようだ)。
「if文で、論理値同士の比較には==や/=を使えません。
.eqv.もしくは.neqv.を利用します」
出典：http://www.nag-j.co.jp/fortran/FI_7.html
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/03/04
担当者名 星健夫

新規ファイル
src/elses-la-gkrylov-main.f90
src/elses-qm-solver-gkrylov.f90

更新ファイル
src/Makefile
src/elses-qm-solver-geno-main.f90
src/elses-qm-projection.f90
src/elses-la-krgl-main.f90


機能拡張に備えた、gKrylov_Aソルバー用コード整備。
計算結果に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/03/02
担当者名 星健夫

更新ファイル
src/Makefile
src/elses-qm-geno-output.f90

新設ファイル
src/elses-qm-output-icohp.f90

実験的機能（ICHOPの出力）。
従来機能に変更なし。

詳細メモ：局所結合エネルギー(ICOHP)解析機能
今のところ、ソースコードを書き換えないと発動しない。
具体的には、elses-qm-geno-output.f90の
!  call qm_output_icohp
のコメントアウトをはずす。
発動すると、positionファイルがでるタイミングで、
ICOHPデータがファイル「output-icohp.txt」に追記されていく。
output-icohp.txtの1ステップでの記述の例をしるす。
H2Oモノマーの系で原子index=1が酸素、原子index=2,3が水素。
%%MatrixMarket matrix coordinate real general
% step_count= 0
3 3 6
2 1 -10.3466674339
3 1 -10.3466674339
1 2 -10.3466674339
3 2 0.7942388826
1 3 -10.3466674339
2 3 0.7942388826
上記ファイルは、MatrixMarket形式の行列データとして格納されている。
2行目は、step_count (別名mdstep)。
3行目は、
(原子数) (原子数) (原子ペア数）
に相当。原子数が2度かかれているのは、Matrix Market形式にするため。4行目以降が
i, j, C(i,j)
で、i,jが原子index, C(i,j)はICOHP(eV単位)。
ICOHPの定義より、
C(i,j)=C(j,i)
であるが、上のformatでは、(i,j)と(j,i)が冗長に書かれている。
C(i,j)は負が結合性、正が反結合性。例えば
2 1 -10.3466674339
は、H-O間で結合性であることに対応。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/03/01
担当者名 星健夫

更新ファイル
src/elses-qm-engine.f90
src/elses-xml-02.f

コード整備（旧式コードの整理）。
従来機能に変更なし。

詳細メモ：構造体でのstep count
config%system%structure%mdstep
の設定ルーチンを、
elses_xml_save_txp (in elses-xml-02.f)
から
elses_qm_engine (in elses-qm-engine.f90)
に変更。
注：elses-xml-02.fに含まれるルーチンは旧式なので、
徐々に他へ機能を移行中。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/02/28
担当者名 星健夫

更新ファイル
src/elses-md-save-restart-xml.f90
src/elses-config.f90
src/elses-xml-config.f90

実験的機能(restart XMLファイルのappend mode)の追加。
従来機能に変更なし。

--------------------------------------------------------------------------------
メモ：restart XMLファイルのappend mode
（未サポートの実験的機能で、将来的に変更される可能性がある）

従来、restart用xmlファイル(典型名restart.xml)は上書きで書かれるため、
最新snapshotデータしか残らない。
一方、append modeでは、snapshotデータが追記される。
例えば、MD計算の途中stepから条件を変えてやり直したい時に、有用。

append modeは、defaultではoff。
onにする場合は、config.xmlに以下のように「append_mode="on"」と書く；
<restart  filename="restart.xml" interval="10"  append_mode="on" />

このとき出力されるrestart用XMLは、以下の構造となる。
<?xml version="1.0" encoding="UTF-8"?>
<structure_history>
<structure name="test" mdstep=" 0">～</structure>
<structure name="test" mdstep="10">～</structure>
<structure name="test" mdstep="20">～</structure>
</structure_history>

ここで、
<structure name="test" mdstep="XX">～</structure>
には、指定snapshotからrestartするために必要な全データが入っている。

現在のところ、上記構造のxmlファイルを読んで途中snapshotからrestartさせる機能は未実装。
現状でそのようなことをしたい場合は、対応する
<structure name="test" mdstep="XX">～</structure>
の部分を手作業で取り出して、あらたにrestart用xmlファイルを必要がある。

--------------------------------------------------------------------------------
********************************************************************************
2011/02/27
ELSES v0.03.04 Release candidate 2 (elses-v0.03.04-20110227-rc2.tgz)
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/02/25
担当者名 星健夫

更新ファイル
src/Makefile

bugfix
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/02/24
担当者名 山元進
更新ファイル Makefile.inc_release
　本日の前のエントリーにある Makefile.inc の修正は、修正忘れではなかった。
　実は、release 時に、いつもコンパイルオプションに戻すようにするため、
　make release を実行すると
　Makefile.inc_release で Makefile.inc を上書きするようになっていた。
　今回、Makefile.inc_release に XML_SELFTEST 関係の修正を反映させた。
　また、libXML の selftest は、make だけして実行しないように、動作を変更した。
　これにより、クロスコンパイル環境でもエラーを発生しないようになったはず。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/02/24 
担当者名 星健夫 
全fortran file (*.f, *.f90) 
Copyright表記の修正：「2007-2010」→「2007-2011」 
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/02/24
担当者名 山元進
更新ファイル Makefile.inc
  2010/12/21 の変更を開発ソースにマージする際、Makefile中の XML_SELFTEST マクロを
コピーし忘れた。このため、libXMLのmakeに失敗するようになってしまっていた。
これを修正。
--------------------------------------------------------------------------------
********************************************************************************
2011/02/23
ELSES v0.03.04 Release candidate (elses-v0.03.04-20110223-rc.tgz)
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2011/02/23
担当者名 星健夫　

Makefile
src/elses-00-version-info.f90 (module M_00_v_info)

version番号を、v.0.03.04に変更
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2011/01/28
担当者名 山元進
更新ファイル
	src/elses-qm-geno-Huckel.f90
	src/elses-qm-geno.f90
	src/elses-qm-geno-Huckel-atom-parameters.f90
	src/elses-qm-solver-eig-geno.f90
	src/elses-config.f90
	src/elses-xml-config.f90
変更点
	i. elses-qm-geno-extended.f90 の削除と、
	　elses-qm-geno-extended.f90の持っていた機能(overlap を変えずにボンドを切る)
	　の elses-qm-geno-Huckel.f90 への取り込み
	ii. 試験的に、Hamiltonian の非対角要素を変更せずに、対角要素をシフトする機能を実装
		パラメーター名 extra_shifts 軌道ごとに shift 量を指定できる
	iii. ICON emulation 機能のパラメータ設定方法を変更
		genoOption の直下の階層に、genoMethod パラメータを新設
		STANDARD : 通常の geno
		ICON:           ICON のエミュレーション, normalization のバグまで再現
--------------------------------------------------------------------------------
********************************************************************************
2011/1/20
ELSES v0.03.03 Released (elses-v0.03.03-20101208-rel.tgz)
備考：v0.03.03 Release candidateと同一
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/12/22
担当者名 山元進
更新ファイル src/elses-qm-engine-csc.f90, src/elses-qm-geno-csc.f90
ある系を最適化なしで計算中、csc ハミルトニアンの計算に時間がかかっている事を発見した。
重複計算をしないようにし、時間のかかるばしょを並列化する改良により、計算時間が 3/4 ほどになった。
最適化がかかっている時は、あまり差がないかもしれない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/12/21
担当者名 山元進
更新ファイル Makefile.inc, src/Makefile
クロスコンパイラ環境では、コンパイル時の環境で
実行形式が動作しないため、XML のセルフテストに必ず失敗する。
XML のセルフテストを簡単に無効化できるよう、Makefile.inc に XML_SELFTEST マクロを定義した。
また、ISSP の NEC sx4 の環境で、make の default rule が
.mod ファイルを modula2 のソースファイルとして m2c でコンパイルしようとする。
大変うっとうしいので、このルールを簡単に無効化できる様に Makefile.inc にコメントを入れた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/12/21
担当者名 山元進
更新ファイル src/elses-qm-solver-eig-geno.f90
lastprivate 指定をした変数を loop index に使い、
step を 1 以外にすると、NEC sx4 のコンパイラが segmentation violation で abort する。
これは、コンパイラのバグだが、既に lastprivate を必要としないコードに書き換えてあったので、
単純に lastprivate を削除した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/12/21
担当者名 山元進
更新ファイル
src/elses-hami-01.f
tool/LDOS/src/Green_C.f
tool/LDOS/src/Green_R.f
tool/LDOS/src/Green_SSW.f
tool/LDOS/src/subroutines.f
更新内容
emacs の comment-region で固定形式の場合に c$$$ という文字列が使われる。
しかし、この文字列は、NEC sx4 のコンパイラで特別な意味を持つらしく、
コンパイルに失敗する。そこで、この文字列を機械的に c!!! に置き換えた。
--------------------------------------------------------------------------------
********************************************************************************
2010/12/08
ELSES v0.03.03 Release candidate
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/12/08
担当者名 星健夫　

Makefile
src/elses-00-version-info.f90 (module M_00_v_info)

version番号を、v.0.03.03に変更
--------------------------------------------------------------------------------
********************************************************************************
2010/12/08
ELSES v0.03.02 Released
備考：v0.03.02 Release candidateと同一
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/11/29
担当者名 山元進
更新ファイル elses-config.f90, elses-xml-config.f90,
                   elses-qm-geno-Huckel.f90, elses-qm-geno-Huckel-atom-parameters.f90
更新内容
s-, p- 軌道についても double zeta を使える様に変更。
それぞれの軌道に対応する c2 の値が 0 だと single zeta として扱われる。
よって、今まで通りの入力ファイルなら、s-, p- 軌道の c1, c2 ともに 0 なので、single zeta として扱われる。
注意するべきは、c1, c2 に不適切な値を入れると、値が修正される事である。
これは、論文で与えられる数値が、単精度である場合が多いため、
値を読み込んだ直後に 2つの STO の内積を計算して規格化していることの副作用である。
norm が 1 からかけ離れてしまうような c1, c2 を与えると、c1/c2 を保ったまま、適切にスケールされる。
この動作は、double zeta が d-軌道のみに適用される時からのものであるが、特に注意しておく。

他に、Hamiltonian と overlap matrix の比例係数である K の値を、2原子間の距離の関数にせず、定数とする事を可能にした。

これらの変更により、J. Cerda and F. Soria, Phys. Rev. B61 pp. 7965-7971 と同様の計算が出来る様になった。
今までと同じ入力ファイルならば、同じ結果を返す筈。

下にあげた新設タグ (config.xml) の例は、それぞれ default の値である。
<HML_constant_K> は T/F で 真/偽 を表す。
<HML_K> は、<HML_constant_K> が T の時のみ有効である。 K の値を入れる。

例
<calc> <genoOption> 
<HML_constant_K> F </HML_constant_K>
<HML_K> 1.75d0  </HML_K>
</genoOption> </calc>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/11/27
担当者名 山元進
更新ファイル、更新内容
xmlf90-1.2g-elses/dom/m_dom_error.f90 ! dummy argument 不使用→使用
xmlf90-1.2g-elses/dom/m_dom_node.f90  ! tab code 混入を削除
xmlf90-1.2g-elses/dom/m_dom_utils.f90 ! dummy argument 不使用→使用
src/elses-config.f90                  ! solver%projection_optionの長さ拡張
src/elses-options.f90                 ! 不要局所変数削除
src/Nrl/nrlhop.f90                    ! 不要局所変数削除
tool/band/src/band.f90                ! 出力改良(バンド数が多いときのトラブル解消)
tool/band/src/diag.f90                ! error handling 改善(info の値に応じて内容出力)

これらの変更は、不要な warning を少しでも減らすことを目指している。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/11/21
担当者名 星健夫

tool/src/elses-xml-generate-vasp.f90 (単独ツール)

bugfix。上記ツールを使っていなければ、無関係。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/11/21
担当者名 星健夫

elses-md-save-restart-xml.f90 (module M_save_restart_xml)

標準出力のwarning文を微修正。計算結果に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/11/16
担当者名 山元進
更新ファイル：
tool/src/elses-xml-generate-vasp.f90 elses-xml-generate-vasp.f90

内容
type の成分として、 allocatable な配列を使うのは、Fortran 2003 で許される様になった
拡張仕様であり、それ以前の仕様に準拠したコンパイラではエラーになる。
Ubuntu でデフォルトの gfortran でエラーになったので、allocatable -> pointer に変更した。
（参考）xml のライブラリなど、他の部分でも同様の処置をしている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/11/12
担当者名 山元進
更新ファイル：
src/elses-qm-geno-Huckel.f90

内容
 2010/07/09 の変更で、normalization のコードにバグが混入した。
それ以降、EmulateICON フラグが true の時, double zeta (d 軌道) の normalization が
おかしくなっていたはず。それを修正した。

EmulateICON は隠しフラグで default false なので、実際上の問題は殆どないと思われる。
--------------------------------------------------------------------------------
********************************************************************************
2010/11/10
ELSES v0.03.02 Release candidate
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/11/10
担当者名 星健夫　

elses-00-version-info.f90 (module M_00_v_info)

version番号を、v.0.03.02に変更
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/11/03
担当者名 山元進
更新ディレクトリ：
tool/band/samples

内容
1. tool/band/samples ディレクトリに、古いデータが混じっていた
2. unit cell と super cell のデータがなかった
ことが判明したので、古いデータを削除し、新しい結果を書き込んだ。

また、ELSES 以外の電子構造計算ソフトによる生産物が混入していたので削除した。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/11/03
担当者名 星健夫　

変更ファイル：
src/elses-ini-load-common.f90
src/elses-qm-domain.f90

対角化ソルバーにおけるallocationを修正。
計算結果に変更なし（ただし、必要メモリが増大する可能性がある）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/30
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
MD可視化用出力のvmdに関する部分を追記。
 
texファイル（quick-start_20100930.tex, quick-start-e_20100930.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
********************************************************************************
2010/09/28
ELSES v0.03.01 Released
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/09/20
担当者名 星健夫

修正ファイル
src/elses-la-gkrylov-output.f90

indivisual eigen stateのplot機能の更新
（該当ルーチン：calc_eigen_in_gkrylov,9/9に導入） 。
現状では、ソースコードを書き換えないと発現しない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/19
担当者名 星健夫

修正ファイル
src/elses-qm-geno-output.f90

output_atom_energy.txtへの出力のbug fix。
上記ファイルを出力させていなければ、影響なし。
（defaultでは出力されない）

詳細：
CSC offのときに、上記ファイル上のCSCエネルギー項がNaNになるbugをfix。

参考メモ：
output_atom_energy.txtへの出力は、9/1更新で導入された機能。
詳細は、9/1更新記録を参照。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/09
担当者名 星健夫

追加ファイル
src/elses-la-gkrylov-output.f90

更新ファイル
src/Makefile
src/elses-qm-solver-krgl.f90
src/elses-la-gkrylov-hist.f90
src/elses-la-krgl-main.f90

実験的機能(A型gKrylovソルバー) の更新。
従来機能に変化なし。

メモ：
indivisual eigen stateのplot（該当ルーチン：calc_eigen_in_gkrylov）
現状では、ソースコードを書き換えないと起動しない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/07
担当者名 星健夫

新設ファイル
src/elses-md-save-restart-xml.f90

更新ファイル
src/Makefile
src/elses-md-save-struct.f90

restart用xmlファイルに原子ごとの電子数を出力する。

詳細：
下記要領でpopulationタグとして、追記される：
<atom element="C" class="" motion="free">
<position unit="internal">  0.140286258220813E+00
0.110300142101062E-06 -0.956224639910486E-18</position>
<velocity unit="a.u.">  0.000000000000000E+00  0.000000000000000E
+00  0.000000000000000E+00</velocity>
<force    unit="a.u.">  0.386218703609637E-02
0.824950911671569E-06  0.184100616370532E-15   </force>
<population>          4.01494624744477768274  </population>
</atom>
ただし、この情報をELSESが読み込むことは、現状ではできない。

メモ：
あわせて、restart.xmlファイル書き出しルーチンを
elses-md-save-restart-xml.f90にまとめた。
これまで多くはelses-xml-config.f90にあったが、
elses-xml-config.f90は非常に複雑になっている。
elses-xml-selftest, elses-generate-xmlなど、
ELSES本体以外からも利用されている。
そこで、restart.xmlファイル書き出しルーチンだけを分離した。
--------------------------------------------------------------------------------
********************************************************************************
2010/09/03
ELSES v0.03.01 Release candidate
備考
********************************************************************************
********************************************************************************
2010/09/03
ELSES v0.03.00 Released
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/09/03
担当 西野信也
 
ツールmsdの修正
 
ファイル：
/tool/MSD/src/calc_msd.f90
 
ファイル入力書式を標準書式に全て変更。
gfortranでもコンパイル、実行できることを確認してあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/03
担当者名 星健夫

更新ファイル：
src/elses-la-krgl-main.f90

A型gKrylovソルバーの更新。

詳細：
DOS計算機能の更新。対角化ソルバーとまったく同じ仕様にする。
つまり、
input_energy_meth.txt
が存在すれば計算し、
output_tdos.txt
に出力する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/02
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
・CSCの計算条件に関する文章の追加
・インテルコンパイラーのバグに関する文章の微修正
 
texファイル（quick-start_20100902.tex, quick-start-e_20100902.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/02
担当者名 星健夫

更新ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90

elses-generate-cubefileのファイル出力部分に対する、修正。
非常に稀な状況への対処。

メモ：
波動関数の局所的値が10^{-100}より小さくなると、
formatの問題で、指数表示の"E"が表示されなくなる状況に対処。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/01 (3)
担当者名 星健夫

変更ファイル：
sample/H2O_dimer/config.xml
（および同ディレクトリの計算結果ファイル）

サンプルデータの変更(sample/H2O_dimer)。

詳細：
tuning付きCSC loopになったことにともない、config.xmlのmixing ratioを変更；
<CSC_charge_mixing_ratio> 0.6 </CSC_charge_mixing_ratio>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/01 (2)
担当者名 星健夫

変更ファイル：
src/Makefile

9/1更新（原子ごとのエネルギーをファイルに出力する機能）が不完全だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/09/01
担当者名 星健夫

新設ファイル：
src/elses-md-output-atom-energy.f90

変更ファイル：
src/elses-qm-geno-output.f90
src/elses-qm-geno.f90
src/elses-xml-config.f90
src/elses-md-output.f90

原子ごとのエネルギーをファイルに出力する機能を追加。

詳細：
該当ルーチンはoutput_atom_energy。
設定方法は、設定XMLファイルのoutputタグ内に、以下の例に従って追記する；
<atom_charge filename="output_atom_energy.txt" interval="2" />
ただしく記述されていれば、標準出力に以下の行がでる；
A XML tag is found : config%output%atom_energy

指定したstep interval(上記なら2)で、指定したファイル(上記ならoutput_atom_energy.txt)に、
原子ごとのエネルギーが出力される。

ファイルは、以下の内容が書き出される；
1行目：原子数、2行目mdstep数、3行目以降は、原子ごとに以下の量が列挙される：
atom index, element name, Hamiltonian相互作用半径内の原子数,
atomごとのバンドエネルギー・CSCエネルギー・repulsive energy (au単位)。
例：sample/C6H6での結果
         6
mdstep=           0
       1  O          6       -4.9537767555
0.0002101700        0.0494382052
       2  O          6       -4.8560109365
0.0013989321        0.0486750206
       3  H          6       -0.6901076804
0.0001814568        0.0250943258
       4  H          6       -0.6901206177
0.0001815239        0.0250942883
       5  H          6       -0.6859584470
-0.0001831500        0.0244671149
       6  H          6       -0.6982352063
-0.0001864991        0.0253465137

他に、標準出力に、各MDstepごとに、原子種ごとの和が出る
@@ output_atom_energy
atom species, atom_energy_sum =         1  H
-2.7644219514       -0.0000066684        0.1000022427
atom species, atom_energy_sum =         2  O
-9.8097876919        0.0016091021        0.0981132258
数値の意味は、element index, element name, elementごとのバンドエネルギー・CSCエネルギー・
repulsive energy (au単位)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/31 (3)
担当者名 星健夫

変更ファイル：
src/elses-qm-output-atom-charge.f90

原子ごとの電子数をファイルに出力する機能を、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/31 (2)
担当者名 星健夫

変更ファイル
src/elses-xml-config.f90
src/elses-qm-engine-csc.f90

(1) tuning付きCSC loop (mode=2)をdefaultにする。
CSCのtuning modeは、標準出力に以下のように出る：
@@ qm_engine_csc : mode_for_tuning_mixing_ratio =     2
注；tuning付きCSC loopについては、8/26更新を参照。

(2) CSCの収束回数を標準出力に表示。例：
INFO:CSC loop is converged:loop num., dq=        11 0.941357E-06
（これまでは、verbose modeのみで出力されていた）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/31
担当者名 星健夫

変更ファイル：
src/elses-config.f90
src/elses-xml-config.f90
src/elses-md-output.f90
src/elses-qm-output-atom-charge.f90

原子ごとの電子数をファイルに出力する機能を追加。

詳細：
該当ルーチンはoutput_atom_charge。
設定方法は、設定XMLファイルのoutputタグ内に、以下の例に従って追記する；
<atom_charge filename="output_atom_charge.txt" interval="2" />
指定したstep interval(上記なら2)で、指定したファイル(上記ならoutput_atom_charge.txt)に、原子ごとの電子
数が出力される。

(a) sp基底系の場合
1行目：原子数、2行目mdstep数、3行目以降は、原子ごとに以下の量が列挙される：
atom index, element name, 初期（入力）電子数 (n_ini), 電子数の初期値からのずれ( n -
n_ini ), s,p電子数 (2項), 各p軌道の電子数(3項), Hamiltonian相互作用半径内の原子数
例：sample/C6H6での結果
         12
 mdstep=           0
     1     C   4.00000   0.0146392611   1.16593   2.84871   0.92298
0.92573   1.00000        12
     2     C   4.00000   0.0146410769   1.16593   2.84871   0.92504
0.92367   1.00000        12
     3     C   4.00000   0.0146380523   1.16593   2.84871   0.92504
0.92367   1.00000        12
     4     C   4.00000   0.0146392611   1.16593   2.84871   0.92298
0.92573   1.00000        12
     5     C   4.00000   0.0146410769   1.16593   2.84871   0.92504
0.92367   1.00000        12
     6     C   4.00000   0.0146380523   1.16593   2.84871   0.92504
0.92367   1.00000        12
     7     H   1.00000  -0.0146392814   0.98536   0.00000   0.00000
0.00000   0.00000        12
     8     H   1.00000  -0.0146408406   0.98536   0.00000   0.00000
0.00000   0.00000        12
     9     H   1.00000  -0.0146382684   0.98536   0.00000   0.00000
0.00000   0.00000        12
    10     H   1.00000  -0.0146392814   0.98536   0.00000   0.00000
0.00000   0.00000        12
    11     H   1.00000  -0.0146408406   0.98536   0.00000   0.00000
0.00000   0.00000        12
    12     H   1.00000  -0.0146382684   0.98536   0.00000   0.00000
0.00000   0.00000        12

(b) spd基底系の場合
1行目：原子数、2行目mdstep数、3行目以降は、原子ごとに以下の量が列挙される：
atom index, element name, 電子数の初期(入力)値 (n_ini), 電子数の初期値からのずれ( n -
n_ini ), s,p,d電子数 (3項), 各p軌道の電子数(3項), 各d軌道の電子数(5項), Hamiltonian相互作用半径内の
原子数
例：sample/H2O_dimerでの結果
		   6
 mdstep=           0
     1     O   6.00000   0.1314203898   1.67288   4.49148  -0.03294
1.68602   1.28938   1.51608  -0.00371  -0.00250  -0.00482  -0.01605
-0.00585         6
     2     O   6.00000   0.1704079094   1.67148   4.52131  -0.02238
1.33476   1.73660   1.44995  -0.00215  -0.00150  -0.00271  -0.00961
-0.00641         6
     3     H   1.00000  -0.0923895160   0.69546   0.21215   0.00000
0.11124   0.00568   0.09524   0.00000   0.00000   0.00000   0.00000
0.00000         6
     4     H   1.00000  -0.0923644014   0.69546   0.21218   0.00000
0.11129  -0.00370   0.10459   0.00000   0.00000   0.00000   0.00000
0.00000         6
     5     H   1.00000  -0.0610409757   0.70619   0.23277   0.00000
0.03253   0.12313   0.07711   0.00000   0.00000   0.00000   0.00000
0.00000         6
     6     H   1.00000  -0.0560334061   0.70692   0.23705   0.00000
0.01732   0.12411   0.09561   0.00000   0.00000   0.00000   0.00000
0.00000         6

他に、標準出力に、各MDstepごとに電子数の初期値からのずれの最大値と最小値が出る；
INFO:Max of elec_num ( n - n_ini )=         0         5   0.01464
INFO:Min of elec_num ( n - n_ini )=         0         8  -0.01464
数値の意味は、mdstep数、最大（最小）値を与えるatom index、最大（最小）値
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/29
担当者名 星健夫

変更ファイル
src/elses-xml-config.f90

標準出力への追加（機能変更なし）。

詳細：
入力構造XMLファイルのファイル名を、標準出力にプリントする。
標準出力の例：
Input XML file for structure = test-material
注：この情報は、設定XMLファイルのsystemタグ内に書かれている。例：
<system>
<cluster structure="test-material.xml" />
</system>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/27
担当 西野信也
ファイル：/tool/MSD/src/calc_msd.f90, /tool/MSD/src/Makefile,
tool/Makefile
 
原子座標ファイル(position.xyz)と計算条件ファイル(input_msd.txt)を入力ファイルとして、
平均二乗変位を計算し、ファイル(output_msd.txt)に出力する。
 
＊＊＊使用方法の詳細＊＊＊
・入力ファイルについて
原子座標ファイルはELSESで出力されるxyzファイルのフォーマットに従っている必要がある。
計算条件ファイルは以下のように記述する（#以下はコメント）。
 
240     # natom: 全原子数
10000   # total_md_step: 全MDステップ数
500     # tmax: MSDの計算に使用するMDステップ数
10      # it0: サンプリング間隔
500     # t0max:  保存する初期座標の数
10.0    # dt: MDステップの時間間隔[フェムト秒]
 
＊注意点＊
上記の数値は、ファイル出力された情報に
基づいて入力しなければならない。
つまり、MD計算を1fs刻みで10000ステップ行い、
ファイル出力は10fs毎に1000回行った場合には、
全MDステップ数部分は1000、
MDステップの時間間隔部分は10.0として入力を行う。
また、it0×t0max > tmaxでなければならない。
 
・実行方法
入力ファイルをカレントディレクトリにおき、/bin/msdを実行する。
 --------------------------------------------------------------------------------
 --------------------------------------------------------------------------------
日付 2010/08/26 (2)
担当者名 星健夫

変更ファイル：
src/elses-qm-engine-csc.f90

8/26更新(CSC mixing ratioのtuning機能)が不十分だったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/26
担当者名 星健夫

変更ファイル：
src/elses-qm-engine-csc.f90
src/elses-config.f90
src/elses-xml-config.f90

CSC charge mixing ratioのtuning機能を追加。
ただし現状では、デフォルトではoffになっている。

詳細：
設定XMLファイル例：calcタグ内のgenoOptionタグ部分のみ
<genoOption>
<CSC_method> ELSTNER </CSC_method>
<CSC_max_loop_count> 100 </CSC_max_loop_count>
<CSC_charge_convergence>  1d-3 </CSC_charge_convergence>
<CSC_charge_mixing_ratio> 0.1 </CSC_charge_mixing_ratio>
<CSC_mode_for_tuning_mixing_ratio> 1  </
CSC_mode_for_tuning_mixing_ratio>
</genoOption>
CSC_mode_for_tuning_mixing_ratioタグの値(以下モード)が1または2で、機能がonになる。
モード=0であるか、該当タグの記載がなければ、機能はoff。
モード=2の方が、より積極的にtuningをする(ただしモード1より、遅くなる可能性もある)。
タグが正しく記述されているなら、標準出力に、以下のように出力される：
Optional XML tag detected : CSC_mode_for_tuning_mixing_ratio =
1

メモ：
チューニングの原理は、
「mixing ratioが大きすぎて、残差が上昇に転じる傾向を見せたときに、
ratioを半分にすることで残差上昇を回避する」というもの。
モード2はモード1より、「残差が上昇に転じる傾向」を早く察知することが期待できる。
使い方の指針としては、
「mixing ratioの入力値(CSC_charge_mixing_ratioの値)を、大きめに設定できる。
MDシミュレーションの中で、入力値が大きすぎる状況になったときは、自動的に小さくなる」である。
逆に、ratioの入力値が小さすぎた場合（残差は確実に減少するが減少ペースが遅い場合）、
このtuning機能がratioを大きくすることはない。
--------------------------------------------------------------------------------
********************************************************************************
2010/08/24
ELSES v0.03.00 RC3
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/08/24
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
Intel Fortran Compiler のバグへの対応に関する文章を微修正。
 
texファイル（quick-start_20100824.tex, quick-start-e_20100824.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/23
担当者名 山元進

更新ファイル：
tool/Perl/xyz2xml.pl

追加ファイル
tool/Perl/xyz2xyz.pl

内容
tool/Perl/xyz2xml.pl は、間違って開発途中のものが入れてあったので、
正しく動作するものに置き換えた。

tool/Perl/xyz2xyz.pl  は、ELSES を周期境界条件モードで動かしたときに
生成される position.xyz に関するツール。
position.xyz に書き出される原子座標は、単位胞内の座標に還元しないで
書かれている( diffusion constant を計算するときなどに、連続的な座標が必要となるため)。
一方、単位胞内の座標に還元した方が、
密度が一定になっているかなどが見た目で判断しやすい。
xyz2xyz.pl 構造定義.xml positions.xyz
を実行すると、positions_new.xyz に単位胞内に還元した座標を書き出す。
構造定義.xml は elses の入力ファイルをそのまま使う。
ただし、単位胞の情報しか読まないので、何か理由があれば、原子の座標はなくても良い。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/19
担当者名 星健夫

変更ファイル：
src/elses-la-krgl-main.f90

A型gkrylovソルバーのコードを更新。
上記ソルバーを使わなければ、機能に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/15
担当者名 山元進

更新ファイル
src/elses-qm-solver-eig-geno.f90

更新内容
8/15 の修正不十分につき再修正。
それと同時に、 occupation number が0になる状態についての和を排除する様にした。
若干の高速化が見込まれる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/14
担当者名 山元進

更新ファイル
src/elses-qm-solver-eig-geno.f90

更新内容
並列化のバグを修正
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/13(2)
担当者名 星健夫

削除ファイル：
src/elses-md-sub2.f

変更ファイル：
src/elses-ini-load-common.f90
src/elses-md-motion.f90
src/elses-md-sub.f
src/elses-xml-02.f
src/Makefile

コード整理(機能に変更を与えない)。
主に、使われなくなっている（古い）ルーチンの削除。

注：Makefileの書き換えは、elses-md-sub2.fのエントリーをなくしたことのみ。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/13
担当者名 星健夫

変更ファイル：
src/elses-ini-load-common.f90
src/elses-md-velocity-routines.f90
src/elses-qm-engine.f90

8/11更新(初期速度生成ルーチンの修正)が不十分だったので、訂正。
あわせて、関連ルーチンの（機能変更をともなわない）整理。

詳細：
入力（構造）XMLファイルに速度データ(velocityタグ)がある場合の動作が、従来までとは違っていた。
これを修正。

メモ：有限温度計算での初期速度ベクトルの設定
　　（該当ルーチン：calc_initial_velocity (module M_md_velocity_routines）
(1) 入力（構造）XMLファイルに速度データ(velocityタグ)がない場合
熱浴設定温度(configuration XMLファイルのtemperatureタグの値)に従って、
(Maxwell分布するように)乱数で速度データが生成される。
さらに、生成されたデータは、
　初期速度データの全運動量　＝　0、
　初期速度データの全運動エネルギー　＝　(3/2)*(atom数)*(熱浴設定温度)
を厳密に満たすように、修正される。
(2) 入力（構造）XMLファイルに速度データ(velocityタグ)がある場合
ファイルにある速度データを、そのまま使う。
その際、標準出力に以下のようなメッセージがでる：
Optional XML tag detected : Meaningful velocity data (will be used)
 The temperature of the input velocity data [eV, kel]=
2.35383885698138007E-002   273.14999479441536
この場合、熱浴設定温度(configuration XMLファイルのtemperatureタグの値)は無関係であり、
　初期速度データの全運動エネルギー　＝　(3/2)*(atom数)*(熱浴設定温度)
は満たされるとは限らない。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/12(2)
担当者名 星健夫

変更ファイル：
src/elses-la-krgl-main.f90
src/elses-la-gkrylov-hist.f90

A型gkrylovソルバーのコードを整理。
上記ソルバーを使わなければ、機能に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/12
担当者名 星健夫

変更ファイル：
src/elses-md-velocity-routines.f90

8/11更新(初期速度生成ルーチンの修正)が不十分だったので、訂正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/11
担当者名 星健夫

新設ファイル：
src/elses-md-motion-verlet.f90
src/elses-md-velocity-routines.f90
変更ファイル：
src/elses-md-motion.f90
src/Makefile

多原子種系の有限温度計算での、初期速度生成ルーチンの修正。
他に、速度ベクトル関連のコードを（機能変更をともなわない）整理。

詳細メモ：
多原子種系の有限温度計算で、
初期速度生成の際に、全運動量が厳密に（倍精度で）ゼロになるように補正。
同様の補正は、これまで単原子種系では行われていた。

注：
初期速度生成は、マクスウェル分布に従うように乱数で生成される
（ルーチン：set_velocity_from_maxwell）。
サンプル数が（統計的な意味で）十分に多数でないかぎり、
全運動量はゼロからずれることになるが、これを補正している。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/08 (2)
担当者名 星健夫

新設ファイル：
src/elses-qm-engine-csc.f90
src/elses-qm-engine-csc-tb0.f90

更新ファイル：
src/Makefile
src/elses-qm-engine.f90

バンド計算ワークフローからも呼び出しやすいように、
「elses_qm_engine」からCSC loop部分を独立させる。
動作に変更なし。

メモ：
elses-qm-engine-csc.f90がELSTNER型CSCループの処理、
elses-qm-engine-csc-tb0.f90がTB0型CSCループの処理。
elses-qm-engine.f90内で、下記のように分岐。
	  if (n_csc_loop > 1) then
       select case (CSC_METHOD)
         case("ELSTNER")
            call qm_engine_csc
         case("TB0")
	    	  call qm_engine_csc_tb0
         case default
            stop "elses_qm_engine: !!!ERROR!!! unexpected CSC_METHOD"
       end select
     endif
注：上記部分のまえに、電荷の初期値を(call initialize_chargeなどして)
設定しておく必要がある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/08
担当者名 星健夫

更新ファイル：
src/elses-mod-eig-leg.f
src/elses-qm-solver-eig-geno.f90
src/elses-eig-leg.f90

対角化ソルバーにおける不要な配列を削除。
動作に影響なし。

メモ：
module elses_arr_eig_legに含まれる、
atmp3, atmpoを削除。
これは、full matrixとしてのH,Sを、バックアップをしているだけ。
必要なら、dhij, dsijから（ルーチン「copy_to_full_matrices」の要領で）コピーすれば良い。

メモ：
対角化において新たに必要となるメモリ量は、標準出力に以下の要領で出る：
@@ Allocation for EIG_LEG
n_base_eig_leg is set to=       11042
  total matrix size in GB =   3.90171278400000
上記の意味は、総基底数が11042で、allocateした配列の総容量が3.9GB、ということ。
このメッセージは、ルーチン「elses_alloc_eig_leg」で出力される。
--------------------------------------------------------------------------------
********************************************************************************
2010/08/07
ELSES v0.03.00 RC2
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/08/07
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
計算ソルバーの選択部分に関する文章を修正。
 
texファイル（quick-start_20100807.tex, quick-start-e_20100807.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
********************************************************************************
2010/08/06
ELSES v0.03.00 RC
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/08/06
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
以下の項目が追加・変更されています。
 
・band計算ユーティリティー
・サンプルデータ
・計算ソルバーの項目
 
texファイル（quick-start_20100806.tex, quick-start-e_20100806.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/05
担当者名 星健夫

更新ファイル：
src/elses-md-output.f90

ファイル出力の微調整。

メモ：
仕様が最終ではない、原子ごとの電子数出力機能(2010/07/25(2)の更新記録)を
verboseモード時のみに実行するようにする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/05
担当 西野信也
 
サンプルデータの追加＆動作確認
 
 
以下の項目がsampleディレクトリに追加されています。
 
NO2分子(/sample/NO2/)
SO2分子(/sample/SO2/)
CF4分子(/sample/CF4/)
H2O分子(/sample/H2O/)
H2Oダイマー(/sample/H2O_dimer/)
 
これらのディレクトリに置かれているエレメントファイルでは、
開発者等によって調整されたパラメータ値を使用しています。
 
また、ベンゼン(/sample/C6H6/)、FeO(/sample/FeO/)のサンプルの
動作確認を行った結果、問題はありませんでした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/04
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90

実験的機能（XMLタグ内容の出力）。動作に影響なし。

設定XMLファイル(代表的ファイル名：config.xml)にかかれた、必須でないXMLタグを、標準出力に出力する機能の追加。例えば、以下：
Optional XML tag detected : solver scheme = eigen
XMLファイルの書き間違いがないかを、ユーザー自身が確認できるようにするために、導入した。ただし現状では、必須でないタグすべてが出力されるわけ
ではない。

メモ：
一部のタグは、プログラム側で検出されなければ、defaultの値が設定される。
そのため、ユーザーがタグを正しく書かなかった場合（例えばタグ名の綴り間違い）、
該当タグの記述は無視されて、そのままプログラムが継続してしまうことがある。
そのようなトラブルをふせぐために、プログラムが検出したタグを標準出力に出しておく。
ユーザーが標準出力をみれば、意図通りにタグが設定されているかどうが分かる。
たとえば、solver_schemeタグを指定したつもりなのに、
「Optional XML tag detected : solver scheme」が標準出力に見つからない場合、
XMLファイルを書き間違えている可能性がある。

なお、多くのタグは、プログラム側で検出できなければ、
エラーとなってプログラムが止まる。
この場合は、ユーザーがXMLタグの書き間違えに気づくことになる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/04
担当者名 藤原毅夫

更新ファイル：
tool/band/src/band.f90
tool/band/src/diag.f90
tool/band/sample 以下の各ファイル

内容
バンド計算プログラム完成。以下 ReadMe.txt より

On the BAND-structure calculation with GENO parameters

GENO : Work flow for band calculation
      1. Write Si_unit.xml
      2. Write Si_bulk_512atom.xml (only contains the size of resultant rectangular cell)
      3. Execute 
	../../tool/Perl/mkSupercell.pl Si_unit.xml Si_bulk_512atom_new.xml > mkSupercell.log
	(output : Si_bulk_512atom_new.xml & ForBandCalc.txt)
	(Si_bulk_512atom_new.xml contains every coordinates of atom in recutangular supercell)
      4. Execute
        ../../bin/elses -band > elses-band.log
        (output : OverlapAndHamiltonian.txt)
      5. ../../tool/band/src/band

Program 
      band.f90
      diag.f90 
      Makefile
      Lapack 

Input files : Output files of ELSES package 
    (1) ForBandCalc.txt
    Structure data file for the band structure calculation (Output files of ELSES package)
      # translation vectors of Bravais lattice (a.u.)
        6.741033718396681e+00   0.000000000000000e+00   0.000000000000000e+00
        0.000000000000000e+00   6.741033718396681e+00   0.000000000000000e+00
        0.000000000000000e+00   0.000000000000000e+00   6.741033718396681e+00
      # number of positions in the unitcell
         2
      # positions in the unitcell (internal co-ordinate)
        0.000000000000000e+00   0.000000000000000e+00   0.000000000000000e+00
        2.500000000000000e-01   2.500000000000000e-01   2.500000000000000e-01
      # number of unitcell
        32
      # translation vectors of the origin of unitcell
      # (internal co-ordinate, with shifted center)
        ..........................
      # k-th unitcell includes origin.
      # k is wrtten in the following line.
      29
    (2) OverlapAndHamiltonian.txt (Output files of ELSES package)
    Files of Hamiltonian, Overlap matrices, neighboring list, etc
      # size of Overlap & Hamiltonian storage S(int1,int2,int3,int4), H(int1,int2,int3,int4)
      # List of neighbor atoms (int3-th neighbor of int4)
      # Number of valence orbitals of int4-th atom
      # S(int1,int2,int3,int4) = double1, H(int1,int2,int3,int4) = double2
    (3) SymLine.txt  (Prepared by the user)
    Define the symmetric lines etc.
    -------<from here> a sample SymLine.txt-------
    6
    40   0.5    0.5    0.5    0.0    0.0    0.0       #L-G 
    40   0.0    0.0    0.0    0.0    1.0    0.0       #G-X
    20   0.0    1.0    0.0    0.5    1.0    0.0       #X-W
    30   0.5    1.0    0.0    0.5    0.5    0.5       #W-L
    20   0.5    0.5    0.5    0.0    0.75   0.75      #L-K
    40   0.0    0.75   0.75   0.0    0.0    0.0       #K-G
    -------<to here> a sample SymLine.txt-------
   # The first line contains the number of symmetric lines to be drawn.
   # Following 6 lines contain the specification of respective symmetry lines.
   # The format of specification is as follows.
   #	 number of points between b_start and b_end, b_start(x,y,z), b_end(x,y,z) 
   # All the first and the last points of symmetric lines should be given in a unit of 2*pi/aLat,
   # where aLat=|a_i| (a_i are the translation vectors of Bravais lattice (a.u.)

 
Output files:
    (1) EigenEnergy.txt
    #  kx ky kz K E1 E2 E3 ........
    # of kpoint, vector component of k-vector, k-distance from the first k-point, corresponding eigen enerfies (eV unit)   
    (2) GNU-Ekcurve-**** is one example for gnuplot routine. Here the file "EigenEnergy.txt" should be the input.
    K : horizontal coordinate 
    E1, E2, ... : vertical coordinmate
    The size of figures, the name of symmetric point, K-value of the symmetric point can be found in EigenEnergy.txt.  
    The resultant figure can be found in this directry.

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/03 (2)
担当者名 星健夫

更新ファイル：
src/elses-la-gkrylov-hist.f90
src/elses-la-krgl-main.f90
src/elses-config.f90
src/elses-qm-solver-geno-main.f90

Arnoldi型gKrylov solverの調整。

メモ：
(1) 大容量メモリモード(8/3更新)をオプションとして追加。
省メモリモードにするには、<solver>タグ内に、
  <mode_for_large_memory> 0 </mode_for_large_memory>
を追加する（値を1にすると大容量メモリモード。defaultは1）。
(2) 大メモリモードでのコードの整理
(3) XMLでの<solver>タグは、gKrylov_A、gkrylov_a、と指定する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/03
担当者名 星健夫

更新ファイル：
src/elses-la-gkrylov-hist.f90
src/elses-la-krgl-main.f90

gKrylov solverの調整。高速モードオプションの追加。

メモ：
gkrylov solverで、大容量メモリモードをオプションとして追加。
メモリが余分に必要になるが、最大2倍程度加速する（計算結果は全く同一）。
有効にするには、<solver>タグ内に、
  <mode_for_large_memory> 1 </mode_for_large_memory>
を追加する（値を0にすると、off。defaultはoff）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/02 (2)
担当者名 星健夫

更新ファイル：
src/elses-la-krgl-main.f90
src/elses-la-gkrylov-hist.f90
src/elses-config.f90
src/elses-xml-config.f90
src/elses-qm-solver-krgl.f90

gKrylov solverの全体的な調整。

注：
elses-la-krgl-main.f90, elses-la-gkrylov-hist.f90は、全般的な調整。
elses-config.f90, elses-xml-config.f90への修正は、
<solver>タグ内への<mode_for_large_memory>タグの追加(実験的機能)のみ。
elses-qm-solver-krgl.f90への修正は、標準出力内容のみ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/02
担当者名 星健夫

更新ファイル：
src/elses-qm-output-atom-charge.f90

標準出力の調整。
計算結果に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/01 (2)
担当者名 星健夫

更新ファイル：
src/elses-xml-config.f90

XML入力ファイルの書き間違いを検出する機能を、一部に追加。
従来動作に変更なし。
例：
 read(value,*,iostat=ierr) unitcell%myLength
 if (ierr /= 0) then
   write(*,*)'ERROR in the input XML file:<unitcell><myLength>'
   stop
　 endif
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/08/01
担当者名 星健夫

更新ファイル：
src/elses-qm-domain.f90
src/elses-qm-output-atom-charge.f90

直交基底系ワークフローでの、ファイル出力関係機能ルーチンの整理。
従来動作に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/31
担当者名 山元進

更新ファイル
src/elses-config.f90
src/elses-xml-config.f90

更新内容
5/10 の拡張の、タグ名を変更

lengthScale -> myLength
unit="givenLength" -> unit="myLength"

unit cell 指定時の xml の拡張

<unit_cell> 中で <myLength> に値を設定すると、
<vector> のオプションに unit="givenLength" を指定した時に、
<lengthScale> が長さの単位になる。
<lengthScale> 指定時のオプションに使えるのは unit="a.u." と unit="angstrom" で、
指定しないと原子単位系("a.u.")と解釈される。

例：
<unitcell>
  <myLength unit="a.u.">  0.410342853147435E+02   </myLength>
  <vector unit="myLength">  1.0d0  0.000000000000000E+00  0.000000000000000E+00   </vector>
  <vector unit="myLength">  0.000000000000000E+00  1.0d0  0.000000000000000E+00   </vector>
  <vector unit="myLength">  0.000000000000000E+00  0.000000000000000E+00  1.0d0   </vector>
</unitcell>

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/30
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
以下の項目が追加されています。
 
・ユニットセル設定
・計算時間に関するコメント
・スーパーセル作成ユーティリティー
・DOS関連の出力
・波動関数可視化ユーティリティー
・クリロフサブスペース法による計算
・Gaussian出力からのDOS作成ユーティリティー
 
texファイル（quick-start_20100730.tex, quick-start-e_20100730.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/30
担当者名 星健夫

更新ファイル：
src/elses-config.f90
src/elses-qm-solver-geno-main.f90

ソルバー（config%calc%solver%scheme）設定ルーチンの整理。
従来の動作は変わらず。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/28
担当者名 山元進

更新ファイル
tool/DOS/Makefile

内容
開発用に top directory にある Makefile.inc でどんなコンパイルオプションを
指定しても、-traceback オプションをつけるようになっていた。
このオプションは ifort でしか受付けられないので、
gfortran などでは error になる。
開発の際以外には不要なオプションなので、削除した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/27
担当者名 星健夫

更新ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90

cubeファイル生成ツール(単独ツール)の更新。
動作に影響なし。

メモ：
実験的機能(mesh size resize)部分の修正。
現状では、ソースコード書き換えをしないと発動しない機能。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/26
担当者名 山元進

更新ファイル
Makefile
tool/Makefile
作成ファイル
tool/plot_eigenstates/src/Makefile
tool/DOS/Makefile

内容
top directory の Makefile の内容が、tool 以下の build を含んでいた。
それはやや分かり難いので、tool/Makefile に移した。
また、２つ Makefile を追加した。
tool directory で make all すると tool 以下に含まれるユーティリティが
全て make されるようになり、構造が分かりやすくなったと期待される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/26(2)
担当者名 星健夫

削除ファイル：
tool/plot_eigenstates/output-cubefile-main.f90
新設ファイル：
tool/plot_eigenstates/src/elses-generate-cubefile.f90
（上記ファイルを移動してrename）

cubeファイル生成ツール(単独ツール)の更新。
動作に変更なし。

メモ：
冗長にデータ読み込みをしている部分を修正。
また、波動関数解析ルーチン（defaultでは動かない）を実験的に実行。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/26
担当者名 星健夫

更新ファイル
src/elses-qm-output-eigenstates.f90 ( module M_output_eigenstates )
src/elses-io-ctrl-plot-eigenstates.f90 ( module
M_io_ctrl_output_eigen )

ファイル出力の修正。
計算内容に影響なし。

詳細メモ：
固有状態を計算しない(Krylov subspaceソルバーを使う)のに、
固有状態をファイル出力しようとする場合があったので、これを修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/25 (4)
担当者名 星健夫

削除ファイル：
src/elses-md-io-leg.f
変更ファイル：
src/Makefile

不使用ファイルの削除。機能に変化なし。
（src/Makefileへの変更：上記削除ファイルのエントリーを消去しただけ）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/25(3)
担当者名 星健夫

更新ファイル：
src/elses-qm-output-atom-charge.f90

標準出力への書き出し内容の微修正。
計算結果に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/25(2)
担当者名 星健夫
新設ファイル：
src/elses-qm-output-atom-charge.f90
(module M_output_atom_charge, public routine: output_atom_charge)
更新ファイル：
src/elses-md-output.f90
src/Makefile

原子ごとの電荷（マリケン電荷）などをファイルに出力する機能を追加。
計算結果に影響なし。

メモ：
elses-md-output.f90への変更は、
「call output_atom_charge」を追加しただけ。
Makefileへの変更は、上記新設ファイルのエントリーを追加しただけ。

メモ：
出力されるファイル名は、「output_atom_charge.txt」に固定。
可視化用構造データを書き出すタイミングで
(configuration XMLファイルでの<position>タグ内に指定されたintervalで）、
上記ファイルに追記されていく。
出力フォーマットは以下の通り。1回の記録が（全原子数＋2）行からなる。1行目が原子数、
2行目がMDステップ数（初期構造を0と数える）、
残りの行は各原子ごとの情報がならぶ。
sp基底系とspd基底系では情報内容が違う。
sp基底系では、以下の通り；
atom index, 元素名, 電子数の初期値(入力値。通常は中性孤立原子の価電子数),
電子数の初期値からのずれ, s軌道電子の数, p軌道電子の総数, 各p軌道電子の数（3個）,
相互作業半径内の原子数（自分自身も含めた数）。
以下に、ファイル冒頭の例をあげる；
       5522
 mdstep=           0
     1     C   4.00000   0.0412026520   1.17482   2.86638   0.95428
0.96337   0.94873        10
     2     C   4.00000   0.0040692014   1.15478   2.84929   0.94906
0.95992   0.94031        13
     3     H   1.00000  -0.0099732665   0.99003   0.00000   0.00000
0.00000   0.00000         7
     4     H   1.00000  -0.0058076207   0.99419   0.00000   0.00000
0.00000   0.00000         7
この例の水素はs軌道しか設定されていないが、
表示formatを統一するため、p軌道の欄も設けた上でゼロと表示している。
一方、spd基底系では、1行の内容は以下の通り；
atom index, 元素名, 電子数の初期値,
電子数の初期値からのずれ, s軌道電子の数, p軌道電子の総数,  d軌道電子の総数,
各p軌道電子の数（3個）, 各p軌道電子の数（5個）,
相互作業半径内の原子数。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/25
担当者名 星健夫
更新ファイル： src/elses-xml-02.f

使われていない(outdatedな)ルーチンの削除。
日付 2010/07/24 (3)
担当者名 星健夫
更新ファイル： src/elses-qm-domain.f90 (module  M_qm_domain)

module variable追加：element_name(1:nos)
原子種ごとの元素名を格納。
例：element_name(1)='Si'

メモ：
現状では下記のように、古いmoduleをuseしているだけ。
　use elses_mod_elem_name,only : element_name => elem_name
値の設定はサブルーチン「load_element_info」でなされている。
（歴史的経緯のため）分かりにくくなっている部分なので、いずれ整理したい。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/24 (2)
担当者名 星健夫
更新ファイル： src/elses-la-krgl-main.f90 (module M_la_krgl_main)

gKrylofソルバーでのエラーメッセージの微修正。機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/24
担当者名 星健夫
更新ファイル： src/elses-eig-leg.f90

コード整理。機能に変化なし。

詳細メモ：
不使用ルーチンの消去、標準出力の内容微修正。
--------------------------------------------------------------------------------
********************************************************************************
2010/07/23
ELSES v0.03.00 Beta2
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/07/23
担当者名 山元進

更新ファイル
src/elses-qm-geno-Huckel.f90

内容
initOVLCalc() の CRITICAL section の使い方を誤っていた。
元のコードだと、2 重に allocate する危険を避けるだけで、
未初期化の配列にアクセスしてしまう危険性を排除できなかった。
そこで、確実に初期化が終了しない限り必ず initOVLCalc() を呼び出す様に、
initFinished という logical 変数を付け加えた。
initFinished は、CRITICAL section で全ての初期化を終えた後に .true. になる。
備考
if(.not. initFinished) call initOVLCalc()
...
subroutine initOVLCalc()
...
!$OMP CRITICAL
if(.not. initFinished) ! 一見無駄だが、これがないと 2重に allocate する危険せいがある。
                       ! Serialize されているのは critical section の中だけで、
					   ! 他の部分の実行順序は全く保証されない。
...
initFinished=.true.
!$OMP END CRITICAL


--------------------------------------------------------------------------------
********************************************************************************
2010/07/23
ELSES v0.03.00 Beta
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/07/23
担当者名 星健夫
更新ファイル： Makefile

version番号を更新
(VERSION=0.02.06→VERSION=0.03.00)
--------------------------------------------------------------------------------
********************************************************************************
2010/07/23
ELSES v0.02.06 Released
備考
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/07/23
担当者名 山元進

更新ファイル
tool/DOS/elses-dos.f90

内容
Gaussian の出力フォーマットへの対応が不十分だったので修正した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/23
担当者名 山元進

更新ファイル
src/elses-qm-geno-Huckel.f90

内容
関数B の計算には、精度と速度の trade-off がある。現在、2009/10/20 以降
速度よりの設定になっていたが、今までの改善でその必要がなくなったため、
(実は、同じ日に施した 2009/10/20-I の変更によって B の計算頻度が減った。
実際には 記述の順序とは逆に 2009/10/20-II の変更を先に行ったため、
もはや B の計算が hotspot ではないことに気付かなかった)精度よりの設定にした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/22
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
計算時間の出力、カットオフの設定に関する記述を追加。
texファイル（quick-start_20100722.tex, quick-start-e_20100722.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/22
担当者名 星健夫

更新ファイル
src/ elses-mod-eig-leg.f

対角化ソルバーにおける、warning出力の修正。
従来機能の動作に影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/20
担当者名 星健夫

更新ファイル
tool/plot_eigenstates/output-cubefile-main.f90（外部ツール）

実験的機能の改良：波動関数(可視化用データ)出力機能で、
(a) 複数固有状態をプロットできるようにした、
(b)メッシュグリッドを設定できるようにした。

詳細メモ：Gaussian cube形式のファイルを出力する。
(a) 実行時のargumentを複数指定することで実現。出力されるファイル名にlevel indexが入る。
　例：a.out 2 7
　2番目から7番目の固有状態をプロット。
　例えば3番目の固有波動関数は、以下のファイルに出力される。
　eigen_state_000003.cube
注：1つのlevelだけ出力するときは、argumentは1つ指定するだけでも良い。
　例：a.out 2
　2番目の固有状態をプロット。
注：argumentを全く指定しないと、全levelが出力される。
(b) ファイル「input_mesh_grid.txt」を用意して、x,y,z方向のメッシュ数を以下のように1行に記述。
60 70 80   # Mesh points in the x,y,z directions
注：上記ファイルがないと、メッシュ数は3方向とも80に設定される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/17
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
configファイル内でのκおよびδの設定方法に関する記述を追加。
texファイル（quick-start_20100716.tex, quick-start-e_20100716.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/16
担当者名 山元進

更新ファイル
src/elses-qm-geno-Huckel.f90

内容
不必要な loop の nest を解消した。(9重 -> 8重)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/16
担当者名 山元進

更新ファイル
src/elses-eig-leg.f90
src/elses-eig-leg2.f
src/elses-qm-solver-eig-geno.f90
src/elses-mod-eig-leg.f

内容
module elses_arr_eig_leg_wrk の配列のうち WORK 以外は elses_arr_eig_leg 中の
配列の dead copy であるので、削除した。 WORK についても subroutine elses_eig_mateig 中のみ
でしか使われないため、定義箇所を elses_eig_mateig 中に移した。
(備忘録)
1. subroutine elses_eig_mateig は元々 thread-safe ではないが、
今回の修正でも thread-safe にはなっていない。
一旦確保した WORK を deallocate しないよう、WORK に save 属性を付けているが、
コンパイラーの実装方法によっては、save が無視される可能性もある。
save が無視されても正しく動作するはずだが、WORK のサイズ (LWORK) が毎回初期化され、
LWORK の最適化が働かなくなる。
2. module elses_arr_eig_leg_wrk 作製の理由はどうやらコードの変更を最小限に
したかったためと思われる。
その意向を尊重し、変数名の付け替えを行う事でコードの変更を最小限にした。
use elses_arr_eig_leg, only : A=>atmp, B=>atmp2, EIG_WRK=>eig2
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/16
担当者名 山元進

更新ファイル
src/elses-la-gkrylov-hist.f90
src/elses-io-ctrl-plot-eigenstates.f90

内容
logical 型の配列を取り扱う場所で、gcc が error だと指摘する場所があったので、
そこを gcc でコンパイルできるように変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/15
担当 西野信也
 
Quick Startの更新
 
ファイル：
quick-start.pdf, quick-start_e.pdf
 
d軌道のrepulsive_rescalingに関する記述を追加。
texファイル（quick-start_20100715.tex, quick-start-e_20100715.tex, ）は、
doc_workに置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/13
担当者名 山元進

更新ファイル
src/elses-mod-eig-leg.f90
src/elses-eig-leg.f90

内容
LAPACK 利用のさい、WORK 配列のサイズを最適化すれば 2 倍程度高速化することが
分かったので、WORK 配列の初期サイズを 20*N とした。
また、LAPACK が suggest する配列サイズの方が大きければ、
一旦 deallocate して LAPACK が suggest するサイズで allocate し直す様にした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/09
担当者名 山元進

更新ファイル
src/elses-qm-geno-Huckel.f90

内容
SlaterKoster table 関係のコードを抜本的に整理し、
Nrl の SlaterKoster table 計算ルーチンを使う様にした。
calc_SS_dSS のコードも大幅に整理した。

pp\pi などの要素を書き換える際には、以下の行の部分を変更すれば良い筈である。
コメントを参照の事

		   bond%v(1:3)= v_SS(0:2) ! v_SS(0:2) sigma, pi, delta ...
          dBond%v(1:3)=v_dSS(0:2) ! derivative (w.r.t r) of v_SS
          ! If l_b = 1, l_a = 2, then v_SS(0:1) = (/ pd\sigma, pd\pi /)


--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/09
担当者名 山元進

更新ファイル
src/elses-qm-solver-eig-geno.f90

内容
7日の変更を更に整理して利用する配列を減らした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/07
担当者名 山元進

更新ファイル
src/elses-qm-geno-csc.f90

内容
水の MD で profile をとった時に、set_hamiltonian_csc がかなり時間を
食う事があることに気付いた。みると、非常に効率の悪い事をしていたので、
書き換えた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/07
担当者名 山元進

更新ファイル
src/elses-qm-solver-eig-geno.f90

内容
水の MD で profile をとった時に最も時間を食っているのは set_density_matrix であった。
この set_density_matrix を BLAS を使って高速化した。
（2010/7/15 追記）profile は intel fortran を使って取ったが、library を利用している時間は
全く反映されないらしい。実際に最も時間を使っているのは LAPACK の DSYGV を call している部分だと思われる。
LAPACK利用以外で最も時間がかかるのが set_density_matrix ということらしい。
DSYGV 利用部分については 2010/07/13 の変更で高速になっている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/05
担当者名 山元進

更新ファイル
src/elses-qm-geno-Huckel.f90

内容
不要な配列・変数の削除
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/04 -その2-
担当 星健夫

新設ファイル：
elses-qm-geno-extended.f90 (module M_qm_geno_extended)
更新ファイル：
elses-qm-geno-Huckel.f90　(module M_qm_geno_Huckel)
elses-qm-solver-eig-geno.f90 (module M_qm_solver_eig_geno)
Makefile

実験的機能整備(COHP)。従来機能に変化なし。

メモ：
従来コードへの修正は以下のみ；
elses-qm-geno-Huckel.f90への変更：
→サブルーチン「calc_SS_dSS」をpublic属性に変更
elses-qm-solver-eig-geno.f90への変更：
→サブルーチン「plot_ldos_from_eigen」のみ
Makefileへの変更：
elses-qm-geno-extended.f90を追記。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/04
担当 星健夫

ファイル：
elses-qm-solver-eig-geno.f90 (module M_qm_solver_eig_geno)

固有レベルのファイル出力formatを修正。

メモ：
GENOで固有レベルが計算される場合、最終構造の固有レベルが、ファイル
output_eigen_levels.txt
に出力される（今のところ、ファイル名は固定）。
具体的には、elses-qm-solver-eig-geno.f90の下記部分：
   open(iunit, file='output_eigen_levels.txt', status='unknown')
   write(*,*)'Save eigen levels into output_eigen_levels.txt'
   do k=1,n_tot_base
      write(iunit,'(i10,2f20.10)') k, eig2(k)*ev4au, f_occ(k)
   enddo
   close(iunit)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/03
担当 星健夫

ファイル：
elses-qm-engine.f90 (module M_qm_engine)

verboseモード時の出力（CSC収束時にメッセージ）

メモ：
CSC収束時に「CSC loop is converged」というメッセージを出す。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/02
担当者名 山元進

更新ファイル
src/elses-band-calc.f90

内容
バンド計算の準備をする際に、相互作用する半径内の原子が存在することを保証するため、
次のチェックを行う事にした。
1) x-, y-, z-軸に関して周期的境界条件を用いている。
2) cutoff 半径がそれぞれの軸長の 1/2.01 よりも小さい。(0.01は torelance factor)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/02
担当者名 山元進

更新ファイル
src/elses-qm-geno.f90

内容
Overlap matrix の 非対角要素のうち、最大の100個、最小の100個を書き出すルーチンを作製。
符号付きで比較しているので、絶対値最小の 100 個が出力されるわけではない事に注意。
計算量が O( N log(N) ) なので、verbose level >= 15 で出力される様に設定した。
--------------------------------------------------------------------------------
********************************************************************************
2010/07/02
ELSES v0.02.06 Release Candidate Bulid
備考

********************************************************************************
--------------------------------------------------------------------------------
日付 2010/07/02
担当者名 山元進

更新ファイル
src/elses-qm-geno.f90

内容
overlap & Hamiltonian 生成ルーチンを並列化
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/02
担当者名 山元進

新設ファイル
src/elses-lib-sort.f90

内容
eleses-qm-geno-Huckel-atom-parameters.f90 内にあった、並べ替えようルーチンを、
他から参照できる様に独立させた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/07/01
担当者名 星健夫

更新ファイル：
(a) tool/plot_eigenstates/output-cubefile-main.f90 (単体プログラム)
(b) elses-qm-output-eigenstates.f90 (module M_output_eigenstates)
(c) elses-xml-config.f90 (module elses_xml_element)

(1) 実験的機能(波動関数可視化用ツール)の修正((a))。
(2) 一部read/write文の修正。計算結果に変更なし((b),(c))。

(1)についてのメモ：
output-cubefile-main.f90で、生成されるmesh grid数を、x,y,z方向で別々に指定できるように変更。
ソースコードの下記部分を書き換える必要あり。
 integer :: mesh_point_x=80
 integer :: mesh_point_y=80
 integer :: mesh_point_z=80
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/29
担当 西野信也
 
ファイル：
output-cubfile-main.f90
 
3sのSTO軌道の計算式の誤りを修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/26
担当者名 山元進

新設ファイル
tool/DOS/elses-dos.f90

内容
ファイルからエネルギー固有値を読み取り DOS を書く。
現在、Gaussian の出力ファイルから固有値を読み取る事にのみ対応している。
間に合わせの実験的コード。elses 自身の実験的機能と同様の仕様の、
input_energy_mesh.txt を用意する必要がある。
他に、エネルギー固有値の数は標準入力から読み取る。

実行ファイル elses-dos

用意するもの
1. Gaussian の 出力　-> levels.txt  rename ( symbolic link にしてもよい)
				"Orbital energy" という文字列を探して、その次の次の行からレベルを読むので、
				適当に切って下さい。
2. Gaussian の出力に含まれる level の数		事前に数えておいて下さい。実行すると、プロンプトが出ます。
3. input_energy_mesh.txt
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/26
担当者名 星健夫

新設ファイル：
elses-la-gkrylov-hist.f90 (module M_la_gkrylov_hist)
更新ファイル：
src/Makefile
elses-qm-solver-krgl.f90 (module M_qm_solver_krgl)
elses-la-krgl-main.f90 (module M_la_krgl_main)

実験的機能の更新。従来機能に影響なし。

詳細メモ：
一般化クリロフ法での加速。
inner CG routine (Sx=b) での解を(「historical」に)再利用することで、
（メモリ消費を増やすが）計算速度を向上させる。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/23
担当者名 星健夫

更新ファイル：
elses-la-matvec-routines.f90 (module M_la_matvec_routines)

実験的機能の更新。従来機能に影響なし。

詳細メモ：
一般化クリロフ法での、inner CG routine (Sx=b) の更新。
xのinitial guessをinputとして受け入れるようにしたルーチン(cg_s_mat_proj_r2)を追加
（これまでは(initial guess)=0に固定）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/18

担当者名 星健夫

更新ファイル：
elses-qm-geno-output.f90 (module M_qm_geno_output)

波動関数書き出し機能でのバグフィックス
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/16
担当者名 星健夫
更新ファイル：
elses-xml-config.f90 (module elses_xml_element)
elses-config.f90 (module M_element)
elses-io-ctrl-plot-eigenstates.f90 (module M_io_ctrl_output_eigen)
elses-qm-geno-output.f90 (module M_qm_geno_output)
elses-qm-output-eigenstates.f90 (module M_output_eigenstates)
tool/plot_eigenstates/output-cubefile-main.f90 (単独ツール)

波動関数書き出し機能を、configulation XMLファイルから制御できるようにした。

詳細メモ：
以下のように、configulation XMLファイルのoutputタグに加える。
<output>
 <wavefunction filename="output_wavefunction.txt" />
</output>
最終MDステップのみに書き出しを行う。
ファイル名は自由に決められるが、現状では、
Gaussiann cube作成ツール(tool/plot_eigenstates/output-cubefile-main.f90)
では「output_wavefunction.txt」であることを仮定しているので注意。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/11 (2)
担当者名 星健夫
更新ファイル：
elses-md-main.f90 (module M_md_main)
elses-md-init.f (moduleなし)

初期設定ルーチンの整理。機能的な変化はなし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/11
担当者名 星健夫
更新ファイル： Makefile

version番号を更新
(VERSION=0.02.05→VERSION=0.02.06)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/10 (2)
担当者名 星健夫
更新ファイル：
elses-qm-output-eigenstates.f90 (module M_output_eigenstates)

一部write文のformatを修正。機能に変化なし。

メモ：gfortranでcompileが通らない問題を修正
(例：write(*,'(I,F)')→write(*,'(I10,F25.15)')）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/10
担当者名 星健夫
更新ファイル：
elses-la-krgl-main.f90 (module module M_la_krgl_main)

multiple Arnoldi法における、エラーメッセージを若干変更。
機能に変化なし。
--------------------------------------------------------------------------------
********************************************************************************
2010/06/08
ELSES v0.02.05 Released
備考
開発版の revision number を 1 増やした。
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/06/08
担当者名 星健夫

更新ファイル：
elses-md-save-struct.f90 (module M_md_save_struct)

可視化用構造データファイルの生成部分の修正。

詳細メモ：非周期系計算でXSF(AXSF)形式ファイルを出力する際に、
非周期向け(A)XSF formatで出力するように修正。該当ルーチン：
subroutine save_struct_axsf_npbc
subroutine save_struct_xsf_npbc
参考URL: http://www.xcrysden.org/doc/XSF.html
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/02
担当 西野信也
ファイル：elses-qm-geno-Huckel.f90
モジュール：M_qm_geno_Huckel
 
Kに含まれる$\Delta$の補正を追加
 
軌道エネルギーに正の値を用いる際に問題となる
Δ=(Hii-Hjj)/(Hii+Hjj)
を補正するように変更。
具体的にはΔの絶対値が1より大きくなった場合は、
Δを1に置き換える。
また、Hii+Hjj=0となるような場合には、
Warning出力とともに計算を終了するように変更。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/06/02
担当者名 星健夫

更新：
tool/plot_eigenstates/output-cubefile-main.f90（単独ツール）
実験的機能部分(eigen states可視化用データ生成ツール)の微修正。
従来機能に変化なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/05/29
担当者名 山元進

更新ファイル
elses-xml-misc.f90

更新内容
このファイルに含まれる XML_TO_AU で各種物理定数が使われている。
この定数は、elses-lib-phys-const.f90 で定義されている値と同じではあるが、
コードに埋め込まれた数値になっていた。
物理定数を elses-lib-phys-const.f90 で一括して取り扱うために、
XML_TO_AU 中に埋め込まれた数値に代えて、
elses-lib-phys-const.f90 中の定数を参照するように改めた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/05/29
担当者名 山元進

更新ファイル
elses-config.f90, elses-xml-config.f90, elses-qm-geno-Huckel.f90, elses-qm-geno-Huckel-atom-parameters.f90

更新内容
config.xml の <genoOption> タグの中に
<HML_small_delta> タグと <HML_kappa> タグを新設した。
それぞれ、Wolfsberg-Helmholz formula の K に対する修正関数
(elses-code-GENO-20080916.pdf (1.6),(1.7)式)
中の δ と κ の値を定める。δの単位は Å^(-1) で固定。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/05/19
担当者名 西野信也　星健夫
新設ファイル：
elses-io-ctrl-plot-eigenstates.f90 (module M_io_ctrl_output_eigen)
更新ファイル：
elses-qm-output-eigenstates.f90 (module M_output_eigenstates)
elses-qm-geno-output.f90 (module M_qm_geno_output)
実験的機能(geno系列におけるeigen statesデータの出力)の導入。
従来機能に変化なし。
メモ：geno系列におけるeigen statesデータの出力。
可視化用データ(基底関数用パラメーター、各eigen statesのベクトル成分）を出力する。
現在のところ、XMLでの制御はできない。
input_ctrl_plot_eigenstates.txt
という入力ファイルが存在するときのみ、発動し、
最終MDステップで必要データを以下のファイルに出力する。
output_eigen_states.txt
このデータを可視化用ファイルに変換するツールは開発済みで、
ELSESパッケージには近く統合予定。
input_ctrl_plot_eigenstates.txtの例（#以降はコメント）：
1 # 0 for OFF, 1 for ON
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/05/19
担当者名 星健夫

更新ファイル：
elses-qm-solver-eig-geno.f90 (module M_qm_solver_eig_geno)

実験的機能(geno系列におけるDOS等の出力)の導入。
従来機能に変化なし。

メモ：geno系列におけるDOS等のplot(unofficial段階)
現在のところ、XMLでの制御はできない。
input_energy_mesh.txt
という入力ファイルが存在するときのみ、発動し、
最終MDステップでDOSなどのデータをファイルに出力する。
output_eigen_levels.txt：全固有値
output_dos.txt ：total DOS
output_ldos.txt：LDOS (atomごとのDOS, 全原子分)
output_pdos.txt：PDOS (basisごとのDOS, 全basis分)

input_energy_mesh.txtの例（#以降はコメント）：
2        # Mode ( 0 for nothing, 1 for TDOS, 2 for TDOS and LDOS )
6000     # Number of the energy mesh points
-40      # Lowest energy mesh point in eV
110      # Highest energy mesh point in eV
0.1      # Level broadening parameters in eV
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/05/11
担当者名 星健夫

更新ファイル：
elses-md-motion.f90 (module M_md_motion)
elses-ini-load-geno.f90 (module M_ini_load_geno)
elses-md-main.f90 (module M_md_main)
elses-xml-config.f90 (module elses_xml_element)

実験的機能(file conversion mode)の実装

メモ：file conversion modeについて
（現状では、実験的=(unofficial)な機能）
物理的計算をいっさいせずに、
構造データをconfigulation XMLファイルに指定した
各種の(可視化ソフト用)ファイル形式に変換するだけのモード。
設定方法；configulation XMLファイルのcalcタグのモード名を
「conversion」(またはfile conversion, file_conversion)と指定する；
例：<calc mode="conversion"></calc>
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/05/01
担当者名 山元進

更新内容 unit cell 指定時の xml の拡張

<unit_cell> 中で <lengthScale> に値を設定すると、
<vector> のオプションに unit="givenLength" を指定した時に、
<lengthScale> が長さの単位になる。
<lengthScale> 指定時のオプションに使えるのは unit="a.u." と unit="angstrom" で、
指定しないと原子単位系("a.u.")と解釈される。

例：
<unitcell>
  <lengthScale unit="a.u.">  0.410342853147435E+02   </lengthScale>
  <vector unit="givenLength">  1.0d0  0.000000000000000E+00  0.000000000000000E+00   </vector>
  <vector unit="givenLength">  0.000000000000000E+00  1.0d0 0.000000000000000E+00    </vector>
  <vector unit="givenLength">  0.000000000000000E+00  0.000000000000000E+00  1.0d0   </vector>
</unitcell>

--------------------------------------------------------------------------------
********************************************************************************
2010/04/24
ELSES v0.02.05 Release Candidate Bulid
追記：2010/06/08 official版としてリリース
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/04/21
担当者名 山元進

更新内容 tool/Perl/mkSupercell.pl の bug fix

gcd は gcd(a,0) = a とすべきであるが、間違って 0 を返していた。

line 167
return 0; を return $b; に変更
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/04/16 (その2)
担当者名 星健夫
elses-qm-nrl.f90 (module M_qm_nrl)

実験的機能の整備。
(NRLにrepulsive forceを導入する場合のルーチン)。
Officialな機能への変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/04/16
担当者名 星健夫
elses-la-krgl-main.f90 (module M_la_krgl_main)

実験的機能の整備。
(Arnoldi method with multiple Krylov subspaces)。
Officialな機能への変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/04/16
担当者名 山元進

更新内容 2010/03/11 の変更で、間違って必要な１行を削ってしまった。これを修正

elses-qm-geno.f90 107行
       nss2=atm_element(jsv2)
	   
--------------------------------------------------------------------------------
================================================================================
日付 2010/04/05
ELSES geno w.g 変更履歴 -> ELSES 変更履歴
================================================================================
--------------------------------------------------------------------------------
日付 2010/04/04
担当者名 星健夫
elses-00-version-info.f90 (module M_00_v_info)

version番号を、v.0.02.05に変更
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/03/11
担当者名 山元進

更新内容 ハミルトニアンを書き出す機能＋αの付加

「単位胞定義＋スーパーセル並進ベクトル」を与えてスーパーセルの入力を作製するスクリプト
tool/Perl/mkSupercell.pl
	unitcell を定義する xml ファイル と supercell (の translation vector)を定義する xml ファイルを引数として渡すと、
	supercell を定義する elses の 入力ファイルを作製する。
	また、バンド計算に必要な、
		1. Bravais 格子の並進ベクトル(現在、rectangular なもののみの対応。)　単位は a.u.
		2. unitcell 中の独立なポジション (atom)  を示す  1. の係数
		3. supercell の並進ベクトル を示す 1. の係数
	を記した "ForBandCalc.txt" というファイルを作成する。

未完成のバンド計算サブプログラム
tool/band/src/Makefile
tool/band/src/band.f90
	elses に -band オプションを実行すると、OverlapAndHamiltonian.txt というファイルに
	overlap と Hamiltonian を書き出す。それを読み込んで密行列を作製し、
	動作確認のため overlap 行列の固有値を書き出すプログラム。
	これをバンド計算をするプログラムに書き換えるて下さい。
tool/band/src/diag.f90
	band.f90 で使われるモジュール (本質的には tool/LDOS/src/diag.f と同じ。今後 merge の方法を考える)

バンド計算の手順（予定）
1. unitcell.xml を書く。

サンプルファイル
<?xml version="1.0" encoding="UTF-8"?>
<structure name="Al-fcc" mdstep="0">

<unitcell>
  <vector unit="a.u.">  0.000000000000000E+00  3.826300084848725  3.826300084848725</vector>
  <vector unit="a.u.">  3.826300084848725  0.000000000000000E+00  3.826300084848725</vector>
  <vector unit="a.u.">  3.826300084848725  3.826300084848725  0.000000000000000E+00</vector>
</unitcell>

<atom element="Al" class="" motion="free">
 <position unit="internal">  0.000000000000000E+00  0.000000000000000E+00  0.000000000000000E+00 </position>
</atom>

</structure>

2. supercell.xml を書く

サンプルファイル
<?xml version="1.0" encoding="UTF-8"?>
<structure name="Al-fcc" mdstep="0">

<unitcell>
  <vector unit="a.u.">  0.153052003393949E+02  0.000000000000000E+00  0.000000000000000E+00</vector>
  <vector unit="a.u.">  0.000000000000000E+00  0.153052003393949E+02  0.000000000000000E+00</vector>
  <vector unit="a.u.">  0.000000000000000E+00  0.000000000000000E+00  0.153052003393949E+02</vector>
</unitcell>

<heatbath>
 <massperatom unit="a.u.">  0.250000000000000E+02</massperatom>
 <position unit="a.u.">  0.000000000000000E+00   </position>
 <velocity unit="a.u.">  0.000000000000000E+00   </velocity>
</heatbath>

</structure>

3.  mkSupercell.pl unitcell.xml supercell.xml
	i)   ELSES の入力構造データとして supercell_new.xml ができる。
	ii)  バンド計算用に ForBandCalc.txt ができる。

4. config.xml を書く

サンプルファイル
<?xml version="1.0" encoding="UTF-8"?>
<config name="Al-fcc">

<system>
 <cluster structure="supercell_new.xml" cutoff_radius="7.0" />
 <boundary x="nonperiodic" y="nonperiodic" z="nonperiodic" />

 <temperature unit="kelvin"> 0.15 </temperature>
 <element  name="Al" model="geno"  filename="Al.xml"> </element>
</system>

<calc mode="optimization">
 <genoOption>
   <Use_VOIP> T </Use_VOIP> <Emulate_ICON> T </Emulate_ICON>
   <CSC_method> TB0 </CSC_method> <CSC_max_loop_count> 0 </CSC_max_loop_count>
   <CSC_charge_convergence>  1d-3 </CSC_charge_convergence> 
   <CSC_charge_mixing_ratio> 3d-1 </CSC_charge_mixing_ratio>
 </genoOption>
 <optimization>
 <sd_ratio> 0.3 </sd_ratio>
 <max_num_iter> 1 </max_num_iter>
 </optimization>
 <dynamics scheme="velocity verlet">
   <delta unit="fsec"> 1.00 </delta>
   <total unit="fsec"> 1.00 </total>
 </dynamics>
</calc>

<output>
 <restart  filename="restart.xml" interval="1" />
 <position filename="position.xyz" interval="1" />
</output>

</config>

5. elses -band config.xml を実行する
	i)   OverlapAndHamiltonian.txt に overlap と Hamiltonian 行列を書き出す。

(現在、ここまでの手順はできる。以下はプログラムが未完成)

6. band を起動してバンド計算
	特記事項
	a) OverlapAndHamiltonian.txt には、neighbor list と、各サイトの 軌道の数も書かれている。
	b) OverlapAndHamiltonian.txt を読み込んで密行列を作るところまでは出来ている。
	c) サイトの順序は、unitcell, 並進した unitcell, ..... となっている。並進ベクトルは ForBandCalc.txt を参照する。
	d) ForBandCalc.txt の読み込み部分は作っていない。

--------------------------------------------------------------------------------
********************************************************************************
日付 2010/02/27
ELSES v0.02.04 Release Version
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/02/19
担当者名 星健夫
elses-qm-domain.f90 (module M_qm_domain)
elses-qm-geno-csc.f90 (module M_qm_geno_CSC)
elses-qm-geno-output.f90 (module M_qm_geno_output)

NRL workflowでCSCを利用するために、
CSC関連コードを整理。機能的な変化はなし。

詳細メモ：
・elses-qm-domain.f90の変更点
M_qm_domainのmodule variableとして、
fgamma_csc(noas, noav)を導入
CSC forceのうちOverlap座標微分(dS/dR)由来の項に現れる
\sum_k ( \gamma_{\alpha k} + \gamma_{\beta k} ) \Delta q_k
に相当。ただし、index(\alpha, \beta)はorder-N formatでつける。

・elses-qm-geno-csc.f90の変更点
以下のようにルーチンを呼ぶ形式にし、それぞれのルーチンを追加。
   atm_force_csc(:,:)=0.0d0       !! initial clearance
   call set_atm_force_csc_prep    !! calculation of fgamma_csc(noas,noav)
   call set_atm_force_csc_overlap !! force with the derivative of overlap
   call set_atm_force_csc_dgamma  !! force with the derivative of gamma
さらに、必要なルーチンをpublic化。

・elses-qm-geno-output.f90の変更点。
use文が不適切だったの書き替え。
diff (old) (new)
181c181
<     use M_qm_geno_csc, only: gamma_csc, noav, delta_e_num
---
>     use M_qm_domain, only: gamma_csc, noav, delta_e_num

・sample/H2Oの計算を実施し、計算結果が変わらないことを確認。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/02/14 (その2)
担当者名 星健夫
新設
elses-qm-engine-nrl.f90 (module M_qm_engine_nrl)
変更
elses-qm-engine.f90 (module M_qm_engine)
Makefile (上記新設ファイルを追加)

NRL系workflowの整理。
従来機能の変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/02/14
担当者名 星健夫
elses-qm-nrl.f90 (module M_qm_nrl)
Nrl/nrladapt.f90 (module MNrlAdaptor)

NRL系workflowでの実験的機能(NRL extra repulsion)の修正。
従来機能の変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/02/13 (その2)
担当者名 星健夫
新設
elses-qm-nrl.f90 (module M_qm_nrl)
更新
elses-qm-engine.f90 (module M_qm_engine)
Nrl/nrladapt.f90 (module MNrlAdaptor)
Nrl/nrlrep.f90　 (module MNrlRepulsive)
削除
elses-qm-nrl.f (elses-qm-nrl.f90に変更)

NRL系でのworkflowの整理と実験的機能(NRL extra repulsion)の実装。
従来機能の変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/02/13
担当者名 星健夫
elses-qm-solver-geno-main.f90　(module M_qm_solver_geno_main)
elses-qm-engine.f90　(module M_qm_engine)
elses-mod-nrl.f (moduleなし)
elses-eig-leg.f90 (moduleなし)
elses-eig-leg2.f (moduleなし)

直交基底系でのworkflowの整理(solver部分)。
機能変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/02/12 
担当者名 星健夫
elses-qm-nrl.f　(モジュールなし)

不使用ルーチン(elses_engine_nrl_leg)を消去
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/02/08
担当 西野信也
Quick Startの更新

Quick Start(日本語版＆英語版)に「NRL型ハミルトニアン」の項目を追加。
pdfファイル(quickstart.pdf, quickstart-e.pdf)は/doc/に、
tex原稿ファイル(quick-start_ver_13.tex, quick-start-e_ver_03.tex)は、
/doc_work/に置いてあります。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/31
担当者名 星健夫
ファイル：elses-qm-solver-gscocg.f90 (module M_qm_solver_gscocg)

実験的ソルバー(GSCOCG)ルーチンの修正。
従来機能への影響なし。
--------------------------------------------------------------------------------
********************************************************************************
日付 2010/01/28
ELSES v0.02.03 Released
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/01/25 (その2)
担当者名 星健夫
elses-qm-solver-geno-main.f90　(モジュール：M_qm_solver_geno_main)
elses-qm-solver-krgl.f90 (モジュール：M_qm_solver_krgl)
elses-la-krgl-main.f90　(モジュール：M_la_krgl_main)

実験的機能の搭載。従来機能に影響なし。

詳細メモ：
KRGL法（1/17導入;仮称）の拡張。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/25
担当者名 星健夫
elses-md-motion.f90　(モジュール：M_md_motion)
elses-md-constraint.f90　(モジュール：M_md_constraint)[新規ファイル]
src/Makefile（上記新規ファイルを登録）

実験的機能の搭載。従来機能に影響なし。

詳細メモ：
特定の原子グループの重心を固定したconstrant MDの実現。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/24
担当者名 星健夫
ファイル：elses-md-init.f
ファイル：elses-qm-main.f

使われていない（古い）サブルーチン
(elses_set_mass, elses_init_atm_file53, elses_engine)を削除。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/19
担当 西野信也
Quick Startの更新

Quick Start(日本語版＆英語版)に「alloc. erro」の項目を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/17
担当者名 星健夫
elses-la-matvec-routines.f90　(モジュール：M_la_matvec_routines)
elses-qm-solver-geno-main.f90　(モジュール：M_qm_solver_geno_main)
elses-qm-solver-krgl.f90　(モジュール：M_qm_solver_krgl)[新規ファイル]
elses-io-ctrl-dos-plot.f90　(モジュール：M_io_ctrl_dos_plot)[新規ファイル]
elses-qm-solver-eig-geno.f90　(モジュール：M_qm_solver_eig_geno)
elses-la-krgl-main.f90　(モジュール：M_la_krgl_main)[新規ファイル]
src/Makefile（上記新規ファイルを登録）

一般化固有値問題用の新しいソルバー（仮称：krgl）を実験的に実装
（一般利用では、まだ使えない）。
従来機能に変更はなし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/17
担当者名 星健夫
ファイル：elses-md-init.f(モジュール：なし)
ファイル：elses-xml-02.f(モジュール：なし)

使われていないルーチン（初期設定関係）を削除：
ルーチン名：elses_init_main, elses_init_atm_xml, elses_xml_test2
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/17
担当者名 星健夫
ファイル：elses-00-version.f90(モジュール：M_00_v_info)

version表記をv.0.02.04にする。
--------------------------------------------------------------------------------
********************************************************************************
日付 2010/01/12
ELSES v0.02.03 Release Candidate Build
********************************************************************************
--------------------------------------------------------------------------------
日付 2010/01/09
担当者名 山元進
モジュール  elses_xml_{config,structure,element} に関係するモジュール
ファイル 
elses-xml-element.f90
elses-xml-structure.f90
elses-xml-config.f90
elses-qm-solver-geno-main.f90
elses-qm-solver-eig-geno.f90
elses-qm-geno-output.f90
elses-qm-geno-Huckel-atom-parameters.f90
elses-qm-engine.f90
elses-md-save-struct.f90
elses-md-output.f90
elses-md-motion.f90
elses-ini-load-geno.f90
elses-ini-load-common.f90
elses-band-calc.f90
elses-xml-02.f
elses-qm-nrl.f
Nrl/nrlio.f90
tool/src にある次のファイル
elses-msd.f90
elses-rdf.f90
elses-xml-generate-nrl-param.f90
elses-xml-generate-vasp.f90
elses-xml-generate.f90

xml に関係するモジュールのうち、次にあげる３つを分割した。
elses_xml_element → elses_xml_element + M_element
elses_xml_structure → elses_xml_structure + M_structure
elses_xml_config → elses_xml_config + M_config
これらのモジュールのうち、M_ で始まるものは xml 部分と関係のないモジュールである。

この分割に伴い、必要な修正を施した。
以降、パラメータを保持する構造体 config を必要とする場合、
M_config を use すれば良い。
殆どの場合、elses_xml_config は必要ない筈である。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/09
担当者名 山元進
モジュール  M_la_gscocg_main
ファイル elses-la-gscocg-main.f90
本来、形状引き継ぎ配列にすべきものが
間違って allocatable 配列になっていたので訂正した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/09
担当者名 山元進
モジュール elses_xml_config
ファイル elses-xml-config.f90
Command line option で与える config ファイルのデフォルトを config.xml とした。
状態密度の出力制御用に type(file_type)::config%output%density_of_states を新設した
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/09
担当者名 星健夫
ファイル：elses-vis-main.f90(モジュール：elses_mod_vis_main)
ファイル：elses-md-save-struct.f90(モジュール：M_md_save_struct)
ファイル：elses-ini-load-common.f90(モジュール：M_ini_load_common)

ファイル出力制御の更新。
詳細メモ：
restart XMLファイル・ position XMLファイルの出力を、
interval=0とconfig ファイルで出力することで、停止する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/07
担当 西野信也
Quick Startの更新
elses-v0.02.03用のQuick Start(/doc/quick-start.pdf)を作成。
tex原稿は/doc_work/quick_start_ver_11.texにおいてあります。
全バージョンからの変更点は、
・chemical hardnessに関する説明の追加
・xml チェッカーに関する記述の追加
・Intel Fortran compilerのバグに関する説明の変更
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/07
担当者名 星健夫
ファイル：elses-qm-solver-eig-geno.f90
(モジュール：M_qm_solver_eig_geno)

GENO系列のLDOS計算機能（実験的実装。今のところ非公開機能）の修正。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/07
担当 西野信也
サンプルデータの更新。
sampleディレクトリにあるH2O、FeO、C6H6のファイルを
elses-v0.02.03用に変更。
変更点は、
・エレメントファイルへのchemical hardnessタグの追加
・Outputファイルの更新
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/06
担当者名 山元進
モジュール M_qm_domain
ファイル elses-qm-domain.f90
バンド計算モード実装の都合により、elses-qm-domain.f90 の配列初期化ルーチンで
itemd (MD 計算時の step 数) を参照している部分を書き換え、
配列の allocation の状態を見て処理を変更する様にした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/04
担当者名 山元進
モジュール M_qm_domain, M_qm_engine, M_qm_geno_csc
ファイル elses-qm-domain.f90, elses-qm-engine.f90, elses-qm-geno-csc.f90
CSC のエネルギーの表式は rho^2 であり、Trace(rho H) という表式に基づく
式は使えない。従って、当初の予定通りに dHam_csc を計算しても、
実際には力の計算ができない。CSC 由来の力は atm_force_csc という
配列に保存し、M_qm_engine のなかで atm_force に付加するよう変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/04
担当者名 山元進
モジュール M_qm_solver_gscocg.f90
ファイル elses-qm-solver_gscocg.f90
バグ fix : module function を引用する時に real(8) と宣言していた。
関数を引用する場合に戻り値の型を宣言する必要があるのは外部関数であり、
module function は外部関数ではない。
関数引用の際に real(8) と宣言すると外部関数と見なされ、
リンクに失敗する。
ifort ver. 10 は その辺りの取り扱いがいい加減なのでコンパイルに
成功し、作者の思った通りに動作してしまうため、今まで気がつかれなかった。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/04
担当者名 山元進
ファイル elses-00-version.f90
バージョン表記を 0.02.03 に変更
(2009/12/28 に行うべきだったが忘れていた)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/03 (その3)
担当者名 星健夫

ファイル：elses-ini-load-geno.f90(モジュール名：M_ini_load_geno)

NRL系workflowにおける改変。GENO系／直交基底系には影響なし。

詳細：
NRL系workflowにおいて、
config XMLファイルに「cutoff_radius」タグがあった場合、
この値を採用する(element XML fileの値は、採用されない）。

参考：
現状のcutoff radius(Hamiltonianのinteraction radius)の決定procedure。
(1) GENO系workflow
config XMLファイルに「cutoff_radius」タグがあれば、その値を採用。
なければ、structure XML fileから決まる。
基本的に、上記タグがあることを前提にしている。
(2) NRL系workflow
config XMLファイルに「cutoff_radius」タグがあれば、その値を採用。
なければ、element XML fileで指定された値になる。
(3) 直交基底系workflow
GENO系workflow・NRL系workflowでは、
ソースコード直書き。上記タグの値は無視。
(1)-(3)は、サブルーチン「load_element_info」で決定される。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/03 (その2)
担当者名 星健夫

ファイル：elses-qm-domain.f90(モジュール名：M_qm_domain)
ファイル：elses-md-init.f(モジュールなし)
ファイル：elses-qm-main.f(モジュールなし)
ファイル：elses-mod-03.f(モジュールなし)

メモリ消費を節約。計算結果に変更なし。
詳細メモ：
GENO/NRL/直交基底系、それぞれのworkflowにおいて、
必要な配列のみをallocateするようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/03
担当者名 星健夫

ファイル：elses-qm-domain.f90(モジュール名：M_qm_domain)
不必要な配列の確保をやめ、メモリ消費を節約した。計算結果に変更なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/02
担当 西野信也
ファイル 　elses-qm-engine.f90, elses-qm-geno-csc.f90
モジュール 　M_qm_engine, M_qm_geno_csc
以下の内容（2009/08/05分）がマージされていなかったので、再更新を行った。
 
ＣＳＣによる力を計算する部分を追加し、ＣＳＣ＋ＭＤ計算を実装した。
力の計算はサブルーチンset_qm_force_geno_cscで行っている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/02
担当者名 星健夫

ファイル：elses-qm-domain.f90(モジュール名：M_qm_domain)

(1) domain variableとして、全電子数(total_electron_number)を追加。
(2) 不要なallocateコマンドを削除。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/01 (その3)
担当者名 星健夫

ファイル：elses-qm-engine.f90(モジュール：M_qm_engine)
ファイル：elses-qm-geno-output.f90 (モジュール：M_qm_geno_output)

2010/1/1更新(その1)において、
エネルギー値のファイル出力が一部おかしかったので修正。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/01 (その2)
担当者名 星健夫

ファイル：elses-qm-engine.f90
モジュール名：M_qm_engine
直交基底ワークフローの更新。
GaAs (Molteni.1993 model)がelses_qm_engineで無視されていたので修正、など。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2010/01/01
担当者名 星健夫

ファイル：elses-qm-engine.f90
モジュール名：M_qm_engine
NRLワークフローとGENOのワークフローの統一化を促進。
計算結果に変更なし。

詳細メモ：
NRLワークフローのsolverルーチンをGENOのもの(qm_solver_geno_main)に接続。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/31
担当者名 星健夫

追加ファイル：elses-lib-math-func.f90（モジュール名： M_lib_math_func）
変更ファイル：elses-qm-projection.f90 (モジュール名：M_qm_projection)

一般化クリロフ空間解法関連のコード整備。
その他の手法での計算には影響なし。

詳細メモ
elses-lib-math-func.f90：
数学関数を定義するルーチンを独立させた。
今あるのは、FermiDirac関数のみ。
elses-qm-projection.f90：
allocationルーチンに対するdeallocationルーチンがなかったので、修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/29
担当者名 星健夫
ファイル：elses-eig-leg.f90（モジュール：なし）

動作に支障のない微修正。
（詳細：GENO workflowの対角化において、
M_qm_domainで新たに導入したmodule variable「chemical_potential」に、
chemical potentialの値が入っていなかったので、修正）

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/28
担当者 山元進
モジュール: elses-xml-config, elses-xml-structure, elses-xml-element, 
	(以下新設モジュール) M_config, M_structure, M_element, M_band_calc
ファイル: elses-xml-config.f90, elses-xml-structure.f90, elses-xml-element.f90, 
	elses-xml-02.f, Makefile, 
	(以下新設ファイル) M_band_calc.f90
1. config (各種定数の repository となっている変数) のデータ構造を定義する部分と、
   xml ファイルを読み込んで config に値を設定する部分とを分離した。
2. 以前は command line option の解析が xml ファイル読み込み部分に埋め込まれていたが、
本来、両者は独立したものなので分離した。
 新しいバージョンでは、elses_md_main に突入する前に command line option の解析を行う。
3. バンド計算の準備に入るか、今までと同じ流れに乗るかの分岐は、 elses_00_main で行う。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/26
担当者名 星健夫
ファイル：elses-qm-solver-eig-geno.f90（モジュール：M_qm_solver_eig_geno）

GENO workflowの対角化において、
DOS書き出しルーチン（１２／２３更新で導入）を微修正。
出力されるDOSは、para-spin factor (=2)がかかった量にする、など。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/23　(その2)
担当者名 星健夫
ファイルelses-qm-solver-eig-geno.f90（モジュール M_qm_solver_eig_geno）

Eigen stateからのPDOS計算ルーチン(plot_ldos_from_eigen)のbugfix。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/23
担当者名 星健夫
ファイルelses-qm-engine.f90（モジュール M_qm_engine）
ファイルelses-qm-geno-output.f90（モジュール M_qm_geno_output）

CSC loop数(config%calc%genoOption%CSC_max_loop_count)がゼロのときの、
ECSCエネルギー出力のbug修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/19
担当者名 星健夫

出力機能の整備（計算結果に影響なし）。
特にeigen-state solver利用時に最終MDステップだけDOS, LDOSを出力。

ファイル（変更） elses-qm-engine.f90
モジュール M_qm_engine
module変数として、以下を登録：
電子系温度(temp_for_electron),
chamical potential (chemical_potential)

ファイル（変更） elses-qm-solver-eig-geno.f90
モジュール  M_qm_solver_eig_geno
geno eigen-state solver使用時の、
LDOSなどの出力ルーチン(plot_ldos_from_eigen)を追加（実験的実装）。
注：Lorentz functionによるbroadening。出力されるファイル：
info-tdos.txt : total DOS
info-ldos.txt : local DOS (for each atom)
info-pdos.txt : partial DOS (for each bais)
(エネルギーメッシュなどの詳細設定は、現状ではソースを書き換えないと変更できない)。

ファイル（変更） elses-qm-geno-output.f90
モジュール M_qm_geno_output
geno eigen-state solver使用時のみ、
各MDステップで固有値を出す(verbose level 40以上のみ)、
最終MDステップだけDOS, LDOSを出力(lot_ldos_from_eigenをcallする)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/12
担当者名 山元進
ファイル elses-qm-geno-Huckel-atom-parameters.f90
モジュール M_qm_geno_Huckel_atom_parms

原子パラメータをファイルから読むとき、
chemical_hardness タグがないと XML error で止まるようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/10
担当者名 星健夫
ファイル（変更） elses-qm-engine.f90
モジュール M_qm_engine

CSC(ELSTNER型)処理の改善。
（前MDstepのconvergeした電荷から、
　CSC loopを始めることにした）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/12/09
担当者名 星健夫
ファイル（追加）
elses-qm-solver-geno-main.f90
elses-qm-solver-gscocg.f90
elses-qm-projection.f90
elses-la-gscocg-cg-s-mat.f90
elses-la-gscocg-main.f90
elses-la-gscocg-tru-res.f90
elses-la-matvec-io.f90
elses-la-matvec-routines.f90
（追加分終わり）
ファイル（変更） elses-qm-engine.f90
モジュール M_qm_engine

調整段階のsolver (GSCOCG)をGENO版work flowへ統合。
調整中なので、一般ユーザには利用できない。
従来計算への影響なし。

注：
solverの入り口ルーチンとして、
subroutine qm_solver_geno_main
を用意（ファイルelses-qm-solver-geno-main.f90、モジュールM_qm_solver_geno_main）。
上記ルーチンの内部で、対角化とGSCOCGに分岐する。

elses-qm-engine.f90での変更は下記のみ。
対角化ルーチンをcallしていた部分；
call qm_solver_eig_geno
を、solverの入り口ルーチンをcallするように変更
call qm_solver_geno_main

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/19
担当者名 山元進
ファイル  elses-qm-geno-Huckel-atom-parameters.f90
モジュール M_qm_geno_Huckel_atom_parms
2009/11/14 の修正が不十分であったため、
原子パラメータファイルを使用すると highest occupied level の計算がされなくなった。
結果として、verbose モード時に highest occupied level の出力により異常終了する
ケースがあった。これを修正した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/14
担当者名 山元進
ファイル  elses-qm-geno-Huckel-atom-parameters.f90
モジュール M_qm_geno_Huckel_atom_parms
chemical_hardness を原子パラメータファイルから読める様にした。
これ以降、原子パラメータファイルを書くときは chemical_hardness も書き込む必要がある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/07
担当者名 山元進
ファイル Makefile, elses-eig-leg.f -> elses-eig-leg.f90

1. elses-eig-leg.f を自由書式に変更した。
2. 対角化に失敗した時に、overlap 行列の固有値を書き出す様にした。
3. if文 -> select case への書き換え
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/07
担当者名 山元進
ファイル  elses-qm-solver-eig-geno.f90
モジュール M_qm_solver_eig_geno

openmp ブロックで private 指定し忘れている変数が有ったので修正した。
また、当該部分にあった使用されない配列を削除した。
--------------------------------------------------------------------------------
********************************************************************************
日付 2009/11/04
ELSES v0.02.02 Release Version
********************************************************************************
--------------------------------------------------------------------------------
日付 2009/11/04
担当 西野信也
Quick Start の更新

Quick StartのH2Oに関する出力結果のデータを新しいパッケージでの
出力結果に変更。

入力ファイルの例をsample/H2Oにおいてあるファイル内容に統一して
説明するように修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/03
担当者名 星健夫
ファイル Makefile
以前の更新（日付 2009/11/01 担当者名 星健夫）
が不完全だったので修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/02 -その4-
担当者名 星健夫
ファイル elses-00-version-info.f90
モジュール　M_00_v_info
バージョン番号を更新(v0.02.02)。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/02 -その1-
担当者名 星健夫

ファイル elses-vis-main.f90
不使用ルーチン(elses_vis_main)を削除。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/02 -その2-
担当者名 星健夫

非GENO版の修正。
(1)
ファイル elses-hami-01.f
モジュール　(なし)
エラー時のメッセージの追加。
(2)
ファイル　elses-md-booking.f90
モジュール　M_md_booking
下記実験ルーチンの追加。現状では（ソースを書き替えないかぎり）callされず。
　plot_booking_list（booking listをプロット）
(3)
ファイル　elses-kr-setkry.f
モジュール　(なし)
下記実験機能の追加。現状では（ソースを書き替えないかぎり）実行されず。
　（Green fnのPole情報をplotする機能。iplot_green_pole_info=1で実行）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/02 -その3-
担当者名 星健夫

sample/の修正。
config.xmlの<calc>タグにmode名がついていない系に対して、mode名(dynamics)を追加。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/11/01
担当者名 星健夫

ファイル(新設)  elses-lib-phys-const.f90
ファイル(更新)  elses-mod-01.f, Makefile.dep
モジュール(新設)  M_lib_phys_const
モジュール(更新) elses_mod_phys_const

物理定数・数学定数を扱ったモジュールを、ファイルとして独立させた。
今後上記のモジュール変数を使うときは、
use M_lib_phys_const
とする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/10/27
担当者名 山元進
ファイル elses-qm-domain.f90, elses-qm-engine.f90, elses-qm-geno.f90, elses-mod-01.f
モジュール M_qm_domain, M_qm_engine, M_qm_geno, elses_mod_csc_loop
CSC loop の収束判定条件が、charge mixing の比率に依存していた。
例えば、charge mixing の比率を 0 にすると、必ず収束と判定される。
収束判定と電荷更新の順序を変える事で、この現象が起こらない様にした。
以前と同等の収束判定にするためには、
以前の CSC_charge_convergence  を CSC_charge_mixing_ratio で割れば良い筈である。

他に、
1) モジュール elses_mod_csc_loop を削除した。 
2) judge_charge_convergence を書き換え、
delta q の RMS(Root Mean Square) を返す関数を作成した。
収束判定はこの戻り値を利用して行う。
3) 変数名を他の変数と統一感のあるものに変更した。
pre_e_num_on_atom -> previous_e_num_on_atom
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/10/20
担当者名 山元進
ファイル elses-qm-geno-Huckel-atom-parameters.f90,
             elses-qm-geno-Huckel.f90
モジュール M_qm_geno_Huckel_atom_parms, M_qm_geno_Huckel
Overlap matrix 計算を高速版に置き換えた。
主な変更は次の2点
I) 現在の版はA(), B() の計算がループの中に入っている。
実は、A, B の引数のうち、実数のものはこのルーチン中では定数であり、
整数だけがループ index と関係している。
さらに、この整数は違うループ index に対して同じ値を取る事がある。
従って、最初にあり得る整数引数について A, B の table を
作り、A, B を同じ引数で複数回呼び出す事を避けるようにした。
II) Bの計算には、有限和で表せる公式とマクローリン展開が使える。
現状のものは常にマクローリン展開を用いるが、|x| が大きい場合には
有限和を用いる様にした。
(B(x) は x=0 で微分可能だが、有限和の表式は x=0 が特異点である
関数の和になる。つまり、|x| が小さい時には良くない表式である。)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/10/17
担当者名 山元進
ファイル elses-xml-element.f90
モジュール elses_xml_element
DB_pushback() の仕様による制限で、ELSES で使用できる原子種が 8 種に
限定されていた。8 種以上になった時には原子種データベースを拡張する様に
DB_pushback()の仕様を変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/10/12
担当者名 山元進
ファイル src/Makefile
Intel の ifort 11.1.056 を使用して compile している際に、
compile option を変更すると内部エラーがおきた。
内部エラーは、本質的にはコンパイラのバグで、
我々が我々が対処すべき問題ではない。
しかし、我々の Makefile には、コンパイルオプションの順序が
通常用いられる順序に並んでいないという問題があり、
これを通常の順序にすると問題が解消した。
BSD 系のシステムでも、この順序で問題が起きなかったので、
今後はこの順序を採用する事にする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/10/12
担当者名 星健夫
ファイル elses-qm-solver-eig-geno.f90
モジュール M_qm_solver_eig_geno
qm_solver_eig_genoで、
各サブルーチンでの経過時間を出力(verbose mode時のみ）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/10/12
担当者名 山元進
ファイル elses-lib-wall-clock-time.f90
モジュール M_wall_clock_time
初期化フラグなどに allocatable を使用しない様にした。
この変更に伴い、ifort 11.1.056 ではコンパイルの際に
内部エラーを起こさない様になった。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/10/12
担当者名 山元進
ファイル elses-qm-solver-eig-geno.f90
モジュール M_qm_solver_eig_geno
OMP ブロック内で private 指定し損なっている変数が有った。
これら変数を使用しない様に変更した。
同じブロックで、キャッシュの利用効率をあげるために、
ループの順序を変更した。
--------------------------------------------------------------------------------
********************************************************************************
日付 2009/09/01
ELSES v0.02.01 Release Version
********************************************************************************
--------------------------------------------------------------------------------
日付 2009/08/29
担当 西野信也
サンプルファイルの更新
・sample/H2O/のO.xmlファイルを更新。
repulsive_rescalingが記入されているものに変更した。
 
・sample/FeO/にFe.xmlファイルを追加。
d軌道を用いた計算をする際の例として用意した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/29
担当 西野信也
Quick Startの更新
 
ELSES-GENO v.0.02.01版のQuick Startを
docディレクトリに追加。
変更点は
・コンパイルに関する記述を修正しトラブルシューティングの項目を追加
・Outputファイルにおける力の出力に関する記述の追加
・repulsive_rescalingパラメータについての説明の追加
です。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/28
担当者名 山元進
ファイル elses-geno-Huckel-atom-parameters.f90
モジュール M_qm_geno_Huckel_atom_params
zeta, zeta2, c1, c2, repulsive 用の数値を
出力するルーチンで、zeta と zeta2 を混同した物があったので
修正した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/27
担当 星健夫
更新：
module M_00_v_info (elses-00-version-info.f90)

バージョン表記を「ELSES version 0.02.01」に変更。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/27
担当 星健夫
更新：
module M_qm_domain (elses-qm-domain.f90)

配列確保用の初期パラメーターを変更（計算結果に影響なし）。
注：08/11申請内容(2)と同じ。
申請時（08/11）にファイルの実体をいれかえるのを忘れていた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/17
担当者名 山元進
ファイル elses-geno-Huckel-atom-parameters.f90
モジュール M_qm_geno_Huckel_atom_params
1) zeta 表示ルーチンが warning を出さないように修正
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/15
担当者名 山元進
ファイル elses-geno-Huckel.f90
モジュール  M_qm_geno_Huckel
1) Overlap の計算の高速化が FeOでうまく行かないことが判明したので、以前のコードに巻き戻し。
    (符号が違うことが原因だろうとの見当はつけている. sp系, 単元素系なら新しいコードで問題ない。)
2) Repulsive part 用 zeta, zeta2, c1, c2 (コード中では変数名に Rescaled_ という prefix がつく)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/14
担当者名 山元進
ファイル elses-geno-Huckel-atom-parameters.f90,elses-geno-Huckel.f90
モジュール M_qm_geno_Huckel_atom_params, M_qm_geno_Huckel
1) Repulsive part の zeta, zeta2, c1, c2 を scaling し直すことができるようにした。
2) Overlap の計算の高速化
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/12
担当 星健夫
更新：
module M_ini_load_geno (elses-ini-load-geno.f90)
module M_qm_domain (elses-qm-domain.f90)

(1) GENOで周期系の場合について、
cutoffを自動設定して計算を進めるようにした；
cutoff= (周期境界条件方向の周期長(AX or AY or AZ)の最小値) / 2.01
(2) 配列確保用の初期パラメーターを変更（計算結果に影響なし）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/11
担当 星健夫
更新：
module M_md_output (elses-md-output.f90)
module M_00_v_info (elses-00-version.f90)
main routine (elses-00-main.f90)

Output.txtの冒頭部分にも、version info.
(例：ELSES v0.01）を出力する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/06
担当 星健夫
新設：module M_md_cell_change (elses-md-cell-change.f90)
更新：module M_md_motion (elses-md-motion.f90)
cell sizes (a, b, c軸長)の変化を可能にした(experimental routine)。
今のところ、等法的変形のみ。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/05
担当 西野信也
ファイル 　elses-qm-engine.f90, elses-qm-geno-csc.f90
モジュール 　M_qm_engine, M_qm_geno_csc
 
ＣＳＣによる力を計算する部分を追加し、ＣＳＣ＋ＭＤ計算を実装した。
力の計算はサブルーチンset_qm_force_geno_cscで行っている。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/05
担当 西野信也
ファイル 　elses-mod-02.f, elses-qm-geno-output.f90, elses-md-output.f90
モジュール 　elses-mod-ene, M_qm_geno_output, M_md_output
 
CSCエネルギーを標準出力とOutputファイルに出力するように変更。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/04
担当 西野信也
ファイル
elses-qm-engine.f90, elses-qm-geno.f90, elses-qm-domain.f90, elses-mod-01.f
モジュール
M_qm_engine, M_qm_geno,M_qm_domain, elses_mod_csc_loop
 
CSCループに電荷の収束判定を行うサブルーチンを追加。
電荷が収束した場合にはＣＳＣループを抜けるようにした。
また、CSC_max_loop_count内で電荷が収束しなかった場合には、
エラーメッセージを出してプログラムが止まるようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/03
担当 星健夫更新 module M_md_save_struct (elses-md-save-struct.f90)
更新 subroutine elses_vis_rasmol (elses-vis-rasmol.f90)
更新 module elses_mod_vis_main (elses-vis-main.f90)

可視化用出力ファイルの整備。
数値計算結果には影響なし。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/02 (その2)
担当 星健夫
更新 module 'M_qm_geno' (elses-qm-geno.f90),

verbose level 1以上で、Hamiltonian&Overlap作成部分の計算時間を表示。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/08/02
担当 星健夫
更新 module 'M_md_motion' (elses-md-motion.f90),
更新 subroutne 'elses-md-init.f' ( elses-md-init.f)

初期設定ルーチンの修正。
(genoハミルトニアンとは直接関係なし）

(1) configファイル読み込みルーチンの修正（仕様変更）。
主な修正点：
(1-a) Optimization modeでstatic計算をやる場合
→configファイルで、max_num_iterタグの値を0にする。
例：<max_num_iter> 0 </max_num_iter>
(1-b) dynamics modeでstatic計算をやる場合
→configファイルで、totalタグの値を0にする。
例：<total unit="fsec"> 0.00 </total>

内部仕様メモ：
globalなiteration(module M_md_mainでの「do itemd2=1,itemdmx」)
の回数を指定する内部変数： itemdmx (module elses_mod_md_dat)
→「電子構造計算の回数」という意味。
　(つまり、staticな計算なら、itemdmx=1)
(2) optimizationモードでも、
　初期速度ベクトルが一時的に生成されてしまう動作を解消。
　（計算結果には影響しない修正）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/07/09
担当者名 山元進
ファイル 	work/H2O/{H,O}.xml, work/C60s/C.xml

2009/06/27 山元進 の変更に対応して、work の下の
原子パラメータファイルを修正した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/07/09
担当者名 山元進
ファイル 	elses-qm-domain.f90
モジュール M_qm_domain

近接原子のリスト生成部分で、open boundary にした時に
cut off radius が overflow を起こす場合があったので、
修正した。

( 以下の rcut_bk が huge(1.d0) のとき、overflow となる )
<      rcut1=rcut_bk*1.001d0
---
>      if( rcut_bk .lt. huge(1d0) ) then
>         rcut1=rcut_bk*1.001d0
>      else
>         rcut1=rcut_bk
>      end if

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/07/09
担当者名 山元進
ファイル elses-qm-geno-Huckel-atom-parameters.f90
モジュール M_qm_geno_Huckel_atom_params

元素記号のテーブルを初期化している場所で、
character(len=2) の変数を 'H' など 1 文字の定数文字列で
行っている場所があった。この初期化を受け付けない処理系
(SunStudioExpress) のために、 'H ' のように全て２文字の
定数文字列に変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/07/09
担当者名 山元進
ファイル
	Makefile.inc
	tool/Makefile
	src/Makefile
	xmlf90-1.2g-elses/dom/Makefile-elses

モジュールファイルが存在するディレクトリを指定する
オプションが  -I ではなく -M である処理系 (SunStudioExpress)
に対応するために MOD_OPT というマクロを作成した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/07/09
担当者名 山元進
ファイル
	elses-ini-load-geno.f90
	elses-qm-geno-Huckel-atom-parameters.f90
	elses-qm-geno-Huckel.f90
	elses-qm-geno-csc.f90
	elses-qm-geno.f90
モジュール
	M_qm_geno_Huckel_atom_parameters
	-> M_qm_geno_Huckel_atom_params (名前変更)

31 文字以上のモジュール名は規格外であり、コンパイル
不能な処理系があるため、モジュール名を短縮した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/30
担当者名 星健夫
更新ファイル elses-kr-sub.f
(subroutine elses_cal_rho)

数値(丸め)誤差チェックルーチンを修正。
計算結果に影響なし。
（現行のGENOには呼ばれないルーチン）。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/29
担当者名 星健夫
更新ファイル　
　elses-xml-02.f

直交ハミルトアニンCarbon系の場合の、
メモリ確保用初期設定を変更。
計算結果に影響なし。genoとは無関係。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/29 (その2)
担当者名 星健夫
追加ファイル　
　elses-md-booking.f90 (module名 M_md_booking)
更新ファイル　
　elses-kr-sub.f, Makefile, Makefile.dep
(すべてsrc下のファイル)

booking list作成ルーチンの整理。計算結果への影響なし。
(1) elses-md-booking.f90 追加
サブルーチン「get_max_size_of_booking_list」のみ。
与えられたradiusに対するbooking list sizeの最大値を計算。
(2) elses-kr-sub.f 変更
elses_es_bkmatからget_max_size_of_booking_listをcall。
（ただし、結果は利用していない）
(3) Makefile, Makefile.depに上記の更新を反映
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/29
担当者名 星健夫
追加ファイル　
　elses-00-main.f90 (module含まず)
　elses-md-main.f90 (module名 M_md_main)
削除ファイル　elses-md-main.f
更新ファイル　Makefile, Makefile.dep
(すべてsrc下のファイル)

main routine関連の整理（機能変わらず）。
(1) elses-md-main.f 削除
内容は、下記2ファイルに分割。
(2) elses-00-main.f90 追加
program main (以前はelses-md-main.fに格納)の格納。
(3) elses-md-main.f90 追加
(module名 M_md_main)
elses_md_main_01 (以前はelses-md-main.fに格納)の格納。
(3) Makefile, Makefile.depに上記の更新を反映
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/28
担当者名 星健夫
追加ファイル　elses-lib-wall-clock-time.f90
（モジュール名　M_wall_clock_time）
削除ファイル　elses-lib-clock.f
更新ファイル　elses-md-main.f, Makefile, Makefile.dep
(すべてsrc下のファイル)

シミュレーション経過時間の表示ルーチンを改善。
(1) elses-lib-clock.fをelses-lib-wall-clock-time.f90に置き換える。
経過時間を秒単位で与えるルーチン「get_elapse_wall_clock_time」を追加。
注：system_clockをもとに計算。
初めて呼ばれたときが、経過時間＝０、となる。
system_clock関数の値がresetされても、正しく経過時間を与える。
OMP並列下では使うべきでない（thread間干渉の可能性があるため）。
(2) 「get_elapse_wall_clock_time」を、MDメインルーチンで利用。
→elses-md-main.f書き替え。
(3) Makefile, Makefile.depに上記の更新を反映
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/27
担当 山元進
ファイル elses-qm-geno-Huckel.f90,elses-qm-geno-Huckel-atom-parameters.f90
               Makefile, Makefile.dep
モジュール  M_qm_geno_Huckel, M_qm_geno_Huckel_atom_parameters

1. M_qm_geno_Huckel から, 原子パラメータセッティング関係を分離し
   M_qm_geno_Huckel_atom_parameters に分離した。
2. 原子パラメータ読み込み部分を全面改訂した。
3. 2. に伴い、原子パラメータ記述ファイルのフォーマットが一部変更された。
以前のフォーマットでは <S> <Px> など、軌道ラベルのタグを付ける必要があった。
現在のフォーマットは、軌道の数に見合ったパラメータを列挙するだけである。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/27
担当者名 星健夫
ファイル名 elses-xml-02.f, elses-mod-04.f
10万原子以上の系でstopさせる仕様だったが、
これを１億原子以上に緩和。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/08
担当 山元進
ファイル elses-qm-engine.f90, elses-qm-geno-csc.f90, elses-qm-geno.f90
モジュール M_qm_engine, M_qm_geno_csc, M_qm_geno

1. renew_charge で e_num_on_atom を更新し忘れていたのを修正した。
2. renew_charge_csc と renew_charge を統合した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/06/07
担当 西野信也
ファイル elses-qm-engine.f90, elses-qm-geno-csc.f90
モジュール M_qm_geno_csc
 
CSCループ部分に、charge_mixing_ratioを読み込み電荷分布の
更新を行うサブルーチンrenew_charge_cscを追加した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/05/22
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Hucekl
価電子軌道数(num_val_orb)、
HOMO レベル(highest_occupied_orbital)検出部分が、
かなり限定した場合にしか対応していなかった。
そのため、現在 HOMO レベルの符号を反転させたものとして
定義している筈の chemical_hardness が間違って設定されていた。
今回、該当部分を以下のように改めた。
AtomParameter を allocate したときに、
ハミルトニアンの対角成分の初期値 initial_diagonal_elements に
未初期化の値を入れる (具体的にはHuge(0d0))
num_val_orb は、未初期化値ではない
（つまりは初期化された）
 initial_diagonal_elements の要素数を
勘定して決める。
HOMO レベルは、 initial_diagonal_elements が初期化され、
initial_occupation が 0 より大きい軌道のうち、最も
高いレベルとする。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/05/22
担当 西野信也
ファイル elses-xml-config.f90
モジュール elses-xml-config
charge_convergenceとcharge_mixing_ratioを読み込む部分のタグ名の記述が
"CSC_carge_convergence"、"CSC_carge_mixing_ratio"となっており、
configファイルからの読み込みが行われていなかった点を修正。
正しいタグ名
"CSC_charge_convergence"、"CSC_charge_mixing_ratio"に変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/05/11
担当 星健夫
ファイル elses-xml-02.f
非geno版開発最新版とのunify。以下の修正に相当；
(i) cell lengths(AX,AY,AZ)が計算途中でかわっても
出力XMLファイルがかわらなかった問題をfix。
(ii) 不要なルーチンのcall
（call elses_xml_vis）をやめる。
(iii) 毎iterationごとに構造ファイルを出力するように
設定できなかった問題をfix。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/05/11
担当：星健夫
ファイル elses-xml-config.f90
モジュール elses_xml_config
従来はconfiguration XMLファイルに
原子系温度（<temperature> tag）がないと強制終了していたが、
メッセージを出すだけにした。
注：optimization modeでは温度は不要なので。
dynamics modeの場合、<temperature> tagがないと
初期速度設定ルーチン（LSES_VEL_INI_CHK）でエラーとなって強制終了する。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/05/09
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Hucekl
1. chemical hardness の値が負になっていたので、
修正した。
2. chemical hardness は現在
イオン化エネルギーで代用している。
その事についてのコメントを付加した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2009/01/28
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Hucekl
最新コードのマージ失敗により、2008/12/11 に直っていた筈の
タイポグラフィーが一部直っていなかった。これを正しく
マージし直した。
直っていなかった修正箇所は次の通り(2008/12/11の履歴参照のこと)
line 2577 Vyz_yz   -> Vyz_zx
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/26
担当者名 星健夫
ファイル elses-md-output.f90, elses-qm-geno-Huckel.f90
１行１３２文字の制限を超過している箇所の修正。
(上記制限を超過していると、gfortranではコンパイルできない。）
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/25
担当者名 星健夫
ファイル elses-md-main.f elses-md-save-struct.f90
12/24更新が不十分だったので、修正。
具体的には、下記問題を解決；
Output.txtへの出力機能が作動していなかった。
AXSFファイルに出力されたiteration数が正しくなかった。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/24
担当者名 星健夫
0.00.19+系列から、下記機能を取り込んだ。
(1) ファイル名elses-md-output.f90（追加）
module M_md_output
( public routine: elses_md_output_main )
出力ファイル「Output.txt」の新設し、
ユーザーにとって重要な量（エネルギーなどの物理量）を出力する。
(2) ファイル名elses-md-main.f（更新）
(1)に連動して、
call elses_md_output（旧ルーチン）を、
call elses_md_output_mainに差し替え。
(3) elses-xml-02.f（更新）
以下のように再定義（以前は「-1」はなかった）
config%system%structure%mdstep = itemdorg+itemd-1
上記の「Output.txt」および構造ファイル(*.xyz, *.axsfなど）に出力されるの
は、この値。
今後の方針として、ユーザー向け出力では、上記のmdstepを「step count」とし
て表示する。
注：上記値は、新規シミュレーションでは「０」から始まる。
　　ただし、continued simulationの場合は、初期状態からのtotal step count
となる。
　　（初期状態からのstep countは、itemdorgに保存されている）
注：従来使われてきたitemdは、内部変数としてのみ、使う。
　　itemdは必ず「１」から始まる。
(4) Makefile更新
　elses-md-output.f90を追加
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/22
担当者名 星健夫
0.00.19+系列から、下記機能を取り込んだ。
(1) ファイル名elses-md-save-struct.f90（追加）
原子構造の保存ルーチンを整理し、AXSF形式などを増やす。
(2) ファイル名 elses-md-main.f
上記に合わせて、原子構造の保存ルーチンのcall文を修正。
(3)ファイル名 Makefile
変更内容
elses-md-save-struct.f90をコンパイルするようにした。

注：AXSF形式は、xcrysden用ファイル。原子に働く力も表示される
xcrydenは、以下参照；
http://www.xcrysden.org/
configuration XMLファイルの中の
<output>タグ中の<position>タグを以下のように、「.axsf」の拡張子をもつ
ファイル名にすればできる。
例： <position filename="position.axsf" interval="2" />
注：xcrysdenの簡単チュートリアル；
force 表示：「Display→Forces」
periodic cell frameの表示：「Display→Crystal cells」
supercell表示：「Modify→Modify Number of units drawn」
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/11
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
1) 計算に影響のある修正
　a) 微分に関して、R で割り忘れている量があった
    elses-qm-geno-Huckel.f90 (Dec07) の line 2180-2182
　b) いくつかの typography を修正
    elses-qm-geno-Huckel.f90 (行数は、Dec07 版の行数)
        line 1747 JJ=5     -> JJ=II
        line 1964 =SS(1,7) -> =dSS(1,7)
        line 2018 =SS(1,7) -> =dSS(1,7)
        line 2577 Vyz_yz   -> Vyz_zx

2) 計算に影響のない、形式だけの変更
　いくつかの if 文を論理が分かりやすいように書き換えた。
　ネスティングが変わって、大幅にコードが変更されるように見える部分もあるが、
　論理的には等価である。

これらの修正で、d-軌道を含む系でも力の対称性が保たれるようになった
(Pt, Fe のクラスタで確認)
--------------------------------------------------------------------------------
日付 2008/12/11
担当者名 山元進
ファイル名   elses-qm-geno.f90
モジュール名 M_qm_geno
変更内容
　池田様よりの指摘で、-verbose オプション付きの時に
　チェックの為に出している、全ての原子にかかる力の和の計算が間違っていたので、
　修正した。この変更は、チェック用出力以外には影響しない。

diff の結果
276c276,277
<         write(*,'(" Sum of TB force =",3ES22.14)') atm_force_tmp(:,1)
---
>         write(*,'(" Sum of TB force =",3ES22.14)') -atm_force_tmp(:,1)
>         atm_force_tmp=0d0
280c281
<         write(*,'(" Sum of    force =",3ES22.14)') atm_force_tmp(:,1)
---
>         write(*,'(" Sum of    force =",3ES22.14)')  atm_force_tmp(:,1)

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/7
担当者名 山元進
ファイル名   elses-qm-engine.f90, elses-xml-config.f90, elses-qm-geno.f90, elses-qm-geno-Huckel.f90
モジュール名 M_qm_engine, elses_xml_config, M_qm_geno, M_qm_geno_Huckel
変更内容
  1) 機能の変更
	config.xml ファイルの、<calc> <genoOption> の階層に tag 新設 
    <CSC_method> TB0 </CSC_method>
	<!-- charge の self-consistency を実現する手法。TB0 : ICON 流　ELSTNER : Elstner 流  -->
    <CSC_max_loop_count> 100 </CSC_max_loop_count>
	<!-- CSC loop の最大ループ数  -->
    <CSC_charge_convergence>  1d-3 </CSC_charge_convergence> 
	<!-- CSC loop のループ脱出条件。現在は機能せず、最大ループ数分ループするだけ  -->
    <CSC_charge_mixing_ratio> 3d-1 </CSC_charge_mixing_ratio>
	<!-- TB0 CSC loop のループのときの、charge mixing の係数  -->
  2) 1) の変更に対応して
	 a) elses_xml_config module 中の対応する config 構造体のメンバを増やした
	 b) 以前は、VOIP を使用時に、原子種毎に初期電荷だけから対角成分を決めていた。
	 　この版から、VOIP 使用時は、原子種が同じでも、原子が異なれば対角成分が異なるように変更した。
	 　これには、SetDiagonalElements を書き換える必要があったので、変更した。
	 　その際、論理的には全く等価だが、if 文を select ~ case 文に変更した。
	 c) renew_charge に charge mixing の量を知らせる必要があり、引数として渡すように変更した。
   
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/06
担当者名 星健夫
ファイル名 elses-xml-config.f90 elses-xml-02.f
変更内容
XMLタグにおける名称を変更。geno版での動作に違いなし。
config%calc%eigen --> config%calc%solver
関連して、elses-xml-config.f90で、
「eigen」→「solver」の文字置換を実施。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/06
担当者名 星健夫
ファイル名 elses-md-motion.f90 elses-xml-02.f Makefile.dep
モジュール名  M_md_motion
変更内容(summary)
Optimization modeのとき、XMLファイルから最大更新回数
(<max_num_iter>タグ）を読み込むようにした。
  英文
  Now the maximum iteration number in the optimization mode
  is set by  the <max_num_iter> tag of the configuration XML file.
変更内容(detail)
(1) elses-md-motion.f90
public subroutine
「elses_md_motion_ini_set」を新設。
dynamics modeのとき, optimization modeのとき、
それぞれ、dtmd, itemdmxを設定する。
(2) elses-xml-02.f
「elses_xml_load_str_exp」で、
「elses_md_motion_ini_set」をcallするように変更。
(3) Makefile.dep
上記変更を反映させた。

Note: An example of the <calc> tag in the optimization mode;
<calc mode="optimization">
  <optimization>
    <sd_ratio> 0.3 </sd_ratio>
    <max_num_iter> 10 </max_num_iter>
  </optimization>
</calc>
Here ,  the value of the <sd_ratio> tag gives the update ratio tau
(R ---> R + tau F ) in each steepest descent iteration and
the value of the <max_num_iter> tag gives
the maximum iteration number of update.
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/2
担当者名 山元進
ファイル名   elses-xml-config.f90, elses-qm-geno-Huckel.f90, elses-md-motion.f90
モジュール名 elses-xml-config, M_qm_geno_Huckel, M_md_motion
変更内容
1) config.xml の <calc> タグに mode attribute 新設 mode="dynamics" か mode="optimization" かで
　MD か structure optimization か動作を切り替える。デフォルトは MD
2) config.xml の calc の下の階層に <optimization> タグ新設。更にその下に、
　<sd_ratio>, <max_num_iter>, <force_convergence> を新設。
　これらは、mode="optimization" の時に意味がある。
　ただし、現状では <sd_ratio> 以外は読込むだけで、機能はしない。
3) config.xml <calc> 階層下に <genoOption> 新設。
　<Use_VOIP>, <Emulate_ICON> タグがある。それぞれ T/F で .true./.false. を設定。
　デフォルトは　F, F
　<Use_VOIP> .true. のとき、SetDiagonalElements で -VOIP(Q) で対角成分を計算
　<Emulate_ICON> ICON で d-軌道の normalization を間違えている部分が２カ所ある。
　その場所は、　Repulsive energy を計算するところと、Hamiltonian の非対角を計算する
　ところとである。.true. にすると、ICON の間違った計算を emulate する。
　これらのことは、2008/9/26, 2008/10/9 の山元のメールで報告してある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/12/01
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
1.PtーH、FeーHの、仮想的な分子の計算が、
異常終了していた。
上記の問題は、s軌道のみの水素原子とd軌道を有する
原子で発生している。
2.修正箇所
Ylmの表式に則り計算した、行列要素を、TSKbond vectorに
storeする部分で、上記の場合が考慮されていなかった。
下記を対応する箇所の挿入した。

[追加部分]
 1930行
  ! added by m.ikeda,fla, 12.01.2008
   if(nval_orb_a.eq.9) then
   ! Vsd_sigma/dVsd_sigma
     Vsd_sigma=SS(1,7)
     dVsd_sigma=SS(1,7)
     if(i_verbose.eq.1) then
       write(6,*) ' Vsd_sigma=', Vsd_sigma
       write(6,*) ' dVsd_sigma=', dVsd_sigma
     end if
   end if
   ! mod end m.ikeda, fla, 12.01.2008
1984行
 ! added by m.ikeda,fla, 12.01.2008
   if(nval_orb_b.eq.9.and.nval_orb_a.eq.1) then

! Vsd_sigma/dVsd_sigma
Vds_sigma=SS(7,1)
dVds_sigma=SS(7,1)
if(i_verbose.eq.1) then
write(6,*) ' Vsd_sigma=', Vds_sigma
write(6,*) ' dVsd_sigma=', dVds_sigma
end if
end if
! mod end m.ikeda, fla, 12.01.2008

３.上記のバグが影響をおよぼすのは、上記の場合のみ。
pーd軌道、d-d軌道の場合は影響しない。
修正の結果、 Fe-H、Pt-Hの場合も計算可能に。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/30
担当者名 山元進
ファイル名   elses-qm-engine.f90, elses-qm-geno.f90, elses-qm-geno-Huckel.f90
モジュール名 M_qm_engine, M_qm_geno, M_qm_geno_Huckel
変更内容
charge-self-consistency (CSC) loop の手法として、TB0 型 CSC 
(VOIP を使って Mulliken charge に依存した Ham_tb0 を生成し、
Ham_tb0 と mulliken charge が無撞着となるようにする) を
選択する事ができるようになった。
この変更に伴い、SetDiagonalElements に UseVOIP フラグを新設し、
M_qm_geno 中に、charge mixing の為のサブルーチンを実装した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/30
担当者名 山元進
ファイル名   elses-qm-domain.f90
モジュール名 M_qm_domain
変更内容
1) charge mixing のために、previous_e_num を新設
2) mulliken で e_num_on_basis (軌道で分けたMulliken 電荷) を
 計算しているのに、変数の値を更新し忘れていたのを fix
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/30
担当者名 山元進
ファイル名 Makefile, Makefile.dep(新設)
変更内容
Makefile の依存関係リストの処理が自動化しやすい様に
Makefile を変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/26
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90, elses-xml-config.f90 Makefile
モジュール名 M_qm_geno_Huckel, elses_xml_config
変更内容
(1) AtomParameter を XML ファイルから読み込む際、
initial_occupation のタグが無いと、occupation が 0 で初期化され
計算が実行不能になる。他にもいくつか、XML ファイルからデータを
読むと正しく設定されない値があったので、SetAtomParameters の
プログラム構成をかなり変更した。ルーチンの外から見れば
XML が読み込めるようになっただけである。
同時に、出力も読みやすいように変更した。
(2) RepulsiveEnergy, set_qm_force_geno, set_rest_geno,
set_hamiltonian_and_overlap_geno の出力を、24 日に決まった判断基準に
沿うように変更した。
(3) Steepest Descent モードにおける XML ファイルの読み込み動作
を修正した(以前は dynamics タグを読まないことがあった)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/26
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
　 C6H6 Benzeneを、xy、yz、zx、平面でおいて、最適化した。
本来なら、座標に依存しないはずが、zx平面のみが
正しく、xy、ｙｚ平面内においた場合は対称性が壊れていた。
1. SetOverlapの微分項の修正
　　変更箇所、Rotation_Slater_Kosterサブプログラム内で、
　Ｓｅｌｅｃｔ文での分岐部分の下記をコメントアウトした。
[変更前]
     case(3)
       sresult  = Vyy(bond, rl, rm, rn)
       oresult  = Dyy(bond, rl, rm, rn)
　      sign_factor=-1.d0
       deriv_mat= Vyy(dbond, rl, rm, rn)
[変更後]
     case(3)
       sresult  = Vyy(bond, rl, rm, rn)
       oresult  = Dyy(bond, rl, rm, rn)
! corrected by m.ikeda, fla, 2008.11.25.
!       sign_factor=-1.d0
! irrelevant factor
       deriv_mat= Vyy(dbond, rl, rm, rn)
2. 修正の結果、Benzene内での、力が正しくなり、
　どの座標系でも、Ｂｅｎｚｅｎｅ分子の形が再現。
　その結果、C60、ＣＮＴも構造を再現。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/25
担当者名 中島基
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
サブルーチン名 SetDiagonalElements, SetNondiagonalElements
変更内容
1. if(i_verbose .eq. 1) then を if(i_verbose >= 200) then に変更 (計3箇所)

※添付ファイル名：MN-SetNonDiagonalElements_3.f90
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/24
担当者名 渡辺尚貴
ファイル名   elses-qm-geno-Huckel.f90, elses-ini-load-common.f90,
            elses-xml-02.f, elses-xml-config.f90,
            elses-xml-get-arg.f90
モジュール名 M_qm_geno_Huckel, M_ini_load_common,
            elses_xml_config, elses_get_arg
変更内容：
(1) GENO元素データの読み込みに関してはファイル elses-qm-geno-Huckel.f90
に元素XMLデータを読み込む関数 SetAtomParameter を追加し、
元の全元素データを設定する関数 SetAtomParametersから
これを呼び出すように改めました。
ファイルが無い場合もしくはファイル指定が無い場合は元の埋め込みデータを
参照します。
(2) verboseに関してはプログラムのコマンドラインオプションで
elses -verbose=100 config.xml
のように饒舌レベルを指定できるようにしました。
これに対応するためいくつかのファイルで若干の変更を行っています。
おまけで -debug=100 オプションも付けておきました。
Config%Option%debug で参照できます。

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/24
担当者名 山元進
ファイル名 elses-qm-engine.f90, elses-qm-domain.f90
モジュール名 M_qm_engine, M_qm_domain
変更内容：
(1) n_csc_loop = 1 と書き換え (>=2 で始めて CSC ループが回る)
(2) Mulliken 電荷の表記を変更, 電子の占有数であることを明示することにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/22
担当者名 山元進
ファイル名 elses-qm-geno-csc.f90
モジュール名 M_qm_geno_csc
変更内容：
(1) 電子の占有数の変化であるべき量が、電子の占有数になっていた
(2) 他にも符号の間違いがあった
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/19
担当者名 山元進
ファイル名 elses-xml-config.f90
モジュール名 elses_xml_config
変更内容：
(1) config.xml ファイルから sd_ratio の入力を可能に
(2) GENO モデル時、config.xml ファイルから r_cut_book
   (現在、相互作用の cut off に相当) の入力を可能に
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/19
担当者名 山元進
ファイル名 elses-md-motion.f90, elses-xml-config.f90, Makefile
モジュール名 M_md_motion, elses_xml_config
変更内容：
steepest descent と molecular dynamics の切り替えを
config.xml で行えるようにした。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/19
担当者名 星健夫
ファイル名 elses-md-motion.f90（新設）
モジュール名 M_md_motion（新設）
変更内容：
(1) subroutine elses_md_motion     [public routine]
atom motionのメインルーチン。
local variable 'motion_type' でモードが選べる。
'motion_type'が 'dynamics'で 、dynamics modeとなる。
'motion_type'が 'steepest_descent'で 、Steepest descent (SD) modeとなる。
現状では、SD modeのときの原子移動の割合(sd_ratio)は、ここで設定する。
 X ---> X + (sd_ratio) F_x
 Y ---> Y + (sd_ratio) F_y
 Z ---> Z + (sd_ratio) F_z
(2) subroutine steepest_descent(sd_ratio)    [private routine]
 Steepese Descent modeで原子を動かす。
--------------------------------------------------------------------------------
日付 2008/11/19
担当者名 星健夫
ファイル名 elses-md-main.f
変更内容：
サブルーチン「elses_md_main_01」中で、
「call elses_md_ion_move」の代わりに「 call elses_md_motion」とする。
diff (old file) (new file)
6c6
< czzz  @@@@@ 2008/07/24 @@@@@
---
> czzz  @@@@@ 2008/11/19 @@@@@
39a40,41
> !1119T.Hoshi; In elses_md_main_01, 'elses_md_motion' is called,
> !                  instead of 'elses_md_ion_move'
70a73,74
>       use M_md_motion,      only : elses_md_motion
>
112,117c116,117
< !
< !       call elses_md_volume_change
< c           ---> Volume change
< !
<         call elses_md_ion_move
< c           ---> Ion movement by Newton eq.
---
>         call elses_md_motion
> c           ---> Atom motion

--------------------------------------------------------------------------------
担当者名 星健夫
ファイル名 Makefile
変更内容：
elses-md-motion.f90を追加。
elses-md-add-01.f90を削除 (elses-md-motion.f90があれば不要)。
diff (old file) (new file)（ただし、makedepf90が生成する部分は除く）
45c45
<       elses-mod-file-io.o elses-mod-nrl.o \
---
>       elses-mod-file-io.o elses-mod-nrl.o elses-md-motion.o \
55c55
<       elses-hami-gaas-molteni.o elses-md-add-01.o  \
---
>       elses-hami-gaas-molteni.o \
------------------------------------------------------------------------------------------------------
参考：CALL TREEの一部
------------------------------------------------------------------------------------------------------
elses_md_main_01
 | do itemd2=1,itemdmx
 |
 |    call elses_md_motion
 |       |   if (motion_type == 'steepest_descent') then
 |       |        call steepest_descent(sd_ratio)
 |       |     else
 |       |        call elses_md_ion_move
 |       |     endif
 |      --------------------------------------------------------------------------------------
 |
 | enddo
 -------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/18
担当者名 山元進
ファイル名 elses-qm-engine.f90
モジュール名 M_qm_engine
変更内容：
(1) CSC のループを一回だけ回すようにした。
(2) verbose option 付加時に Ham_csc を書き出すようにした。
 (備考) 書き出しルーチンが elses-qm-engine にあるのは
おかしいので、近々 elses-qm-geno-csc 内の適切な箇所に移動したい。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/17
担当者名 星健夫
ファイル名 elses-qm-solver-eig-geno.f90
モジュール名 M_qm_solver_eig_geno
変更内容：
OpenMP を利用する際のみに意味がある bug fix。
OpenMP の指示文に、存在しない変数名を入れた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/15
担当者名 山元進
ファイル名 elses-qm-geno-csc.f90, elses-qm-geno.f90
モジュール名 M_qm_geno_csc, M_qm_geno
変更内容：
(1) subroutine set_rest_geno
 説明を簡単にするため、a,b ２原子の1次元系を考える
 全 repulsive energy はペアあたりの repulsive energy を
 f(x-y) として.
 E_rep = 1/2 [ f(r_a - r_b) + f(r_b - r_a) ]
 と計算されるようになっている。微分は
 d E_rep = 1/2 [ f'(r_a - r_b) (dr_a - dr_b) + f'(r_b - r_a) (dr_b - dr_a) ]
        = 1/2 { [f'(r_a - r_b)-f'(r_b - r_a)]dr_a + [f'(r_b - r_a)-f'(r_a - r_b)]dr_b }
       (式 1)
となる。これは対称性から
 d E_rep = f'(r_a - r_b) dr_a + f'(r_b - r_a) dr_b (式 2)
となるが、以前のバージョンでは間違えて 1/2 がかかっていた。
後で分かりやすいように、(式 1) をそのまま実装した形に書き換えた。

(2) subroutine set_qm_force_geno
 Spin 自由度の 2 を書け忘れていたので、修正した。
 他に、対称行列の行列要素を参照する際、無意味に index を入れ替えていると
 思われる箇所があったので、修正した。

(3) -verbose オプションを付けて実行すると、
TB ハミルトニアンに起因する力と、Repulsive energy に起因する力とを
書き出すようにした。各原子に働く力と、その総和とが、それぞれに
出力されれる。

(5)subroutine set_CSC_parameters_geno
 gamma の設定ルーチンを呼び忘れていたので呼ぶ様にした (星先生の指摘)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/11/05
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno-Huckel
変更内容：
(背景)
Slater-Koster table の計算ルーチンは、ブラ状態の
原子軌道インデックスを L_1, ケット状態の原子軌道インデックスを
L_2 としたとき、 L_1 <= L_2 のものしか用意されていない。
L_2 > L_1 の場合は、対称性を考慮して L_1, L_2 の大小関係を
入れ替えた行列要素に還元する必要がある。
Overlap 行列は内積計算なので、原子軌道インデックスと、原子座標との
同時に入れ替えに対して不変である(複素波動関数なら、Hermite共役になる)。
原子座標の入れ替えは、方向余弦の符号反転に相当する。
原子軌道インデックスのみを入れ替えると、簡単な考察から
l_1, l_2 をそれぞれの原子軌道の軌道角運動量として
(-1)^(l_1 + l_2)の符号がつく。ここであげた2つの対称性を組み合わせると、
方向余弦の符号反転に対しても (-1)^(l_1 + l_2)の符号がつくことが分かる。
従って、l_1, l_2 を入れ替えて(-1)^(l_1 + l_2)を乗じるか、
(-1)^(l_1 + l_2)を乗じる代わりに方向余弦の符号反転を行えば、
所期の目的が達せられる。
力の計算を行うためには、更に、Slater-Koster テーブルの微分を
計算する必要がある。
(本題)
本プログラムでは、ケット原子座標での微分を必要とする。
(背景)で述べたように、L_1 > L_2 の場合、L_1, L_2 の
入れ替えによって L_1 < L_2 の計算に還元する必要がある。
本プログラムでは、この操作に際し、
符号を乗じる代わりに方向余弦の符号反転を行った。
これは、ブラとケットの原子座標の入れ替えに対応している。
従って、微分演算子を換えなければ、ブラ原子座標で
微分をしたことになり、(本題)冒頭の要求仕様を満たさない。
Overlap 行列は、ブラ・ケット原子座標の相対座標のみに依存するので、
これをケット原子座標の微分に書き換えるには、負符号を掛ければ良い。
以前のバージョンではこの符号を見落としていたので修正した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/21
担当者名 山元進
ファイル名 Makefile
モジュール名 なし
変更内容：
半導体エネルギー研究所の中島様より、Makefile の依存関係が
正しくない旨ご報告をいただき、その点を修正。
(elses-mod-domain.o が elses-mod-eig-leg.o に依存するようになったのに、
依存関係が更新されていなかった。)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/20
担当者名 星健夫
ファイル名 elses-qm-domain.f90
モジュール名 M_qm_domain
変更内容：
privateルーチンとして「qm_domain_ini_compat」を追加し、
「qm_domain_ini_setting」にcall文を追加。
NRL系で動かなくなっていた不都合を解消。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/14
担当者名 山元進
ファイル名 elses-qm-engine.f90, elses-qm-domain.f90
モジュール名 M_qm_engine, M_qm_domain
変更内容：
1. dham_tb0 の内容を ddhij にコピーするのを忘れていたのを修正
2. dham_csc を新設
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/13
担当者名 山元進
ファイル名 elses-qm-engine.f90, elses-qm-geno.f90
モジュール名 M_qm_engine, M_qm_geno
変更内容：
1. set_qm_force_geno を M_qm_geno に作成
2. M_qm_engine で set_qm_force_geno を呼ぶ様にした
これらにより、力の計算ができる様になった(ただし、未チェック)
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/13
担当者名 山元進
ファイル名 elses-qm-engine.f90
モジュール名 M_qm_engine
変更内容：
1. CSC ループ中の計算順序を変えた。
2. CSC 計算の前に Mulliken charge の計算が必要な筈だが，
Mulliken charge 計算ルーチンを呼んでいなかった。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/13
担当者名 山元進
ファイル名 elses-qm-domain.f90, elses-qm-geno.f90, elses-qm-solver-eig-geno.f90
モジュール名 M_qm_domain, M_qm_geno, M_qm_solver_eig_geno
変更内容：
1. Mulliken charge は、geno 固有の量ではなく、M_qm_domain にある量だけで
書き下せる。従って、M_qm_geno にあった Mulliken charge 計算ルーチン
subroutine mulliken を M_qm_domain に移動した。
2. subroutine gene_dhij_tb0_plus_csc は削除しても良さそうなので削除した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/11
担当者名 星健夫
ファイル名 elses-qm-domain.f90
モジュール名 M_qm_domain
変更内容：Eneregy density matrixを、module variableとして追加。
具体的には、以下の行を追加。
  use elses_arr_dpij,     only : dpij
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/11
担当者名 星健夫
ファイル名 elses-qm-solver-eig-geno.f90
モジュール名 module M_qm_solver_eig_geno
変更内容
1. サブルーチン名 qm_solver_eig_geno
　atmpなど、eigen-state solver のみで使う配列のallocation を、
   全基底数n_tot_baseで行う。
      例：atmp(n_tot_base, n_tot_base)
　注：化合物系でも正しく動くようにした。
2. 下記サブルーチン(private)を追加。
　　　 copy_to_full_matrices,
           set_eigen_states,
                       set_density_matrix,
                       plot_eigen_levels
　注：化合物系でも正しく動くようにした

参考：qm_solver_eig_genoにおける、一般化固有値問題ソルバー部分；
!ccccccccccccccccccccccccccccccccccccccccccccccccccccccc
!  Generalized eigen value problem
!     with matrix size of n = n_tot_base
!
    call copy_to_full_matrices
!      --> Copy the Hamiltonian and overlap matrices
!              into full-matrix arraies (atmp, atmp2)
!        INPUT : dhij, dsij
!        OUTPUT: atmp (n,n)  (Hamiltonian, as full matrix)
!        OUTPUT: atmp2(n,n)  (Overlap,     as full matrix)
!
    call set_eigen_states
!      --> Set the eigen states
!        OUTPUT: eig2(n)    (Eigen levels)
!        OUTPUT: atmp(n,n)  (Eigen vectors A(i,k))
!                  k:eigen level
!
    call elses_eig_chem_pot
!      --> Set the chemical potential and occupation number
!               (legacy code)
!        INPUT : temp_for_electron (elenctron temperature)
!        OUTPUT: f_occ(n)
!
    call set_density_matrix
!      --> Set the density matrix
!        OUTPUT: dbij : density matrix
!        OUTPUT: dpij : energy density matrix
!
    call plot_eigen_levels
!      --> Plot eigen levels and so on (optional)
!
!
  end subroutine qm_solver_eig_geno

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/09
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
サブルーチン名 SetAtomParameters
変更内容
1. Pt パラメータ挿入。ただし、VSIE の係数はデータ不足のため 0 としてある。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/09
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
サブルーチン名 SetNonDiagonalElements
変更内容
正しいと思われる表式を comment out し、ICON の表式に合わせた。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/07
担当者名 中島基
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
サブルーチン名 SetDiagonalElements
変更内容
1. d軌道を含む元素に対して、Hamiltonianの対角成分を正しく計算できるように修正
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
日付 2008/10/03
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
1. SetOverlap
 行列要素の微分項にからんだ修正。
s,pとdのクロスターム部分を、Eq.(1.56)のupper half  partss
{s,p} <-> {d}(double-zeta)
表式のミスタイプに修正
correct s,p-d cross term: (npq_a+npq_b)==>(npq_a+npq_b+1)

s,pとdのクロスターム部分を、Eq.(1.56)のlower half  partss

{s,p} <-> {d}(double-zeta)
dS11の初期化がなかったために追加。
added dSS11=0.d0 satatement in s,p-d cross term in lower half elements.

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/02
担当者名 中島基
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
サブルーチン名 SetDiagonalElements
変更内容
1. d軌道を含む元素に対しても、Hamiltonianの対角成分が計算できるよう修正

サブルーチン名 SetNondiagonalElements
変更内容
1. 関数Kの式(2.6)を修正
2. 関数dKのKの微分式を修正
3. double-zeta型軌道の軌道半径r_nが計算できるよう式を追加
4. 関数K,dKで計算していたEq.(2.2)およびEq.(2.3)をcontainsより前へ移動
5. 4に伴う関数K,dKの仮引数を変更
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/02
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
1. SetOverlap
 Off-diagonalな、行列要素の書き出しを、Verbose　modeで
formatした形で、出力できるように変更した。変更の結果、例えば、Fe2の場合は
下記になる。


　昨日の、出力で、d軌道を含む場合に変更を加えました。
下記になります。

left_atom_spec= 1, right_atom_spec= 1
Overlap matrix S(II,JJ)
1 2 3 4
s x y z
1 s 7.71506042049086E-01 4.34113451011160E-01 0.00000000000000E+00
0.00000000000000E+00
2 x -4.34113451011160E-01 2.02969699747552E-01 0.00000000000000E+00
0.00000000000000E+00
3 y 0.00000000000000E+00 0.00000000000000E+00 6.97973726868650E-01
0.00000000000000E+00
4 z 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
6.97973726868650E-01
5 xy 0.00000000000000E+00 0.00000000000000E+00 -2.74537084629726E-01
0.00000000000000E+00
6 yz 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
0.00000000000000E+00
7 zx 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
-2.74537084629726E-01
8 x^2-y^2 -1.02307770974697E-02 -1.43352692496828E-01
0.00000000000000E+00 0.00000000000000E+00
9 3z^2-r^2 5.90674191124316E-03 8.27647156021012E-02
0.00000000000000E+00 0.00000000000000E+00
5 6 7 8 9
xy yz zx x^2-y^2 3z^2-r^2
1 s 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
-1.02307770974697E-02 5.90674191124316E-03
2 x 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
1.43352692496828E-01 -8.27647156021012E-02
3 y 2.74537084629726E-01 0.00000000000000E+00 0.00000000000000E+00
0.00000000000000E+00 0.00000000000000E+00
4 z 0.00000000000000E+00 0.00000000000000E+00 2.74537084629726E-01
0.00000000000000E+00 0.00000000000000E+00
5 xy -2.05443519685286E-01 0.00000000000000E+00 0.00000000000000E+00
0.00000000000000E+00 0.00000000000000E+00
6 yz 0.00000000000000E+00 2.09135591312314E-01 0.00000000000000E+00
0.00000000000000E+00 0.00000000000000E+00
7 zx 0.00000000000000E+00 0.00000000000000E+00 -2.05443519685286E-01
0.00000000000000E+00 0.00000000000000E+00
8 x^2-y^2 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
8.43339067320387E-02 7.20542861877404E-02
9 3z^2-r^2 0.00000000000000E+00 0.00000000000000E+00
0.00000000000000E+00 7.20542861877404E-02 1.67535029785555E-01
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/01
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
1. SetOverlap

Off-diagonalな、行列要素の書き出しを、Verbose　modeで
formatした形で、出力できるように変更した。変更の結果、例えば、O2の場合は
下記になる。

<<<set_overlap_geno off-diagonal verbose mode>>>
left_atom_spec= 1, right_atom_spec= 1
Overlap matrix S(II,JJ)
1 2 3 4
s x y z
1 s 3.20871668541393E-01 4.08229549399337E-01 0.00000000000000E+00
0.00000000000000E+00
2 x -4.08229549399337E-01 -3.30986601245047E-01 0.00000000000000E+00
0.00000000000000E+00
3 y 0.00000000000000E+00 0.00000000000000E+00 2.44302698526785E-01
0.00000000000000E+00
4 z 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
2.44302698526785E-01

differential of Overlap matrix
x derivative dS(1,II,JJ)
1 2 3 4
s x y z
1 s 3.60864660151179E-01 2.97469475810845E-01 0.00000000000000E+00
0.00000000000000E+00
2 x 2.97469475810845E-01 4.60320660778867E-02 0.00000000000000E+00
0.00000000000000E+00
3 y 0.00000000000000E+00 0.00000000000000E+00 3.04429865785359E-01
0.00000000000000E+00
4 z 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
3.04429865785359E-01

y derivative dS(2,II,JJ)
1 2 3 4
s x y z
1 s 0.00000000000000E+00 0.00000000000000E+00 -4.08229549399337E-01
0.00000000000000E+00
2 x 0.00000000000000E+00 0.00000000000000E+00 5.75289299771832E-01
0.00000000000000E+00
3 y -4.08229549399337E-01 -5.75289299771832E-01 0.00000000000000E+00
0.00000000000000E+00
4 z 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
0.00000000000000E+00

z derivative dS(3,II,JJ)
1 2 3 4
s x y z
1 s 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
-4.08229549399337E-01
2 x 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
5.75289299771832E-01
3 y 0.00000000000000E+00 0.00000000000000E+00 0.00000000000000E+00
0.00000000000000E+00
4 z -4.08229549399337E-01 -5.75289299771832E-01 0.00000000000000E+00
0.00000000000000E+00
<<<end set_overlap_geno off-diagonal verbose mode>>>

　d軌道の場合にも対応している。H2Oなどの場合には、ICONとの比較をするため
には必要。

2.　標準出力を６番にしていたが、他のコードの部分と合わせる形で、＊に統一
した。

以上

追伸：sizeコマンドで、S、dSの大きさを求めると、正方行列になっています。
　　　そこで、nval_orb_a, nval_orb_bでの出力に変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/10/01
担当者名 山元進
ファイル名 elses-qm-engine.f90, elses-qm-geno.f90, elses-qm-geno-csc.f90, Makefile
モジュール名 M_qm_engine, M_qm_geno, M_qm_geno_csc
変更内容
1. 新規 module M_qm_geno_csc 作成。interface block の削除など、若干の形式変更を伴う。
2. set_CSC_parameters_geno を M_qm_geno_csc 内に移動。
3. 依存関係が正しくなるように src/Makefile を変更。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/09/29
担当者名 池田稔
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
1. SetOverlap
TSKBondの構造体に、下記の行列を定義した。
　　Bond_matrix(NUMBER_OF_ORBITALS,NUMBER_OF_ORBITALS)
　　dBond_matrix(NUMBER_OF_ORBITALS,NUMBER_OF_ORBITALS)　
　この行列要素に、TSKBondベクトルを、割り当てた。
　Select文を用いての、Slater-Kosterの関数文を呼ぶ部分を、上記の行列要素
　を、下記の、サブプログラムに引数で渡すことで、この、プログラムの論理
　構造を、明確化した。

2.　Rotation_Slater_Koster　のサブプログラムを作成して、select文を用いての
　関数文の分岐を、Rotation_Slater_Kosterで行うようにした。
3. 今までの、累積のタイプミスを修正。ならびに、表式の符号の違いを、訂正
した。
　　力の部分においても修正を施した。
4.　本修正により、
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/09/26
担当者名 山元進
ファイル名 elses-qm-engine.f90, elses-qm-solver-eig-geno.f90, elses-eig-leg.f90
モジュール名 M_qm_engine, M_qm_solver_eig_geno, M_qm_solver_eig_geno
変更内容
1. bug fix : 現在 Hamiltonian は ham_tb0 と ham_csc に分かれている。
 solver で両者を足して dhij に格納していたが、CSC パートが無いために、
 ham_csc が未初期化であった。これを修正。
2. 今回、solver 内で ham_tb0 と ham_csc の加算を行っているために、
 ham_csc が未初期化であることが非常に分かりづらかった。
 ham_tb0 と ham_csc の加算を、CSC ループ中、solver ルーチン突入直前で
 行うように変更した。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/09/26
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90
モジュール名 M_qm_geno_Huckel
変更内容
1. 倍精度関数 RepulsiveEnergy を d-軌道に対応するよう拡張した。
 今日のコードは、ICON の結果を再現するようになっている。
 正しい計算は comment out してある。
2. 鉄の初期電子配置が ICON と同じ [Ar]3d^{8}4s^{0} となるように修正。
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
 日付 2008/09/24
 担当者名 久保井信行
 ファイル名 elses-qm-geno-Huckel.f90
 モジュール名 functionB
 変更内容
 計算精度向上のため、旧バージョンよりコード内容大幅修正
 1. 階乗計算部分の改善
 2. 関数BとdBのsum部分のアルゴリズムを改善
 3.λ=0の場合の計算不具合改善
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
日付 2008/09/16
担当者名 山元進
ファイル名 elses-qm-geno-Huckel.f90, elses-qm-geno.f90, elses-qm-engine.f90, elses-qm-domain.f90
モジュール名 M_qm_geno, M_qm_geno_Huckel, M_qm_domain, M_qm_engine
変更内容
1. CSC モジュールとのインターフェースとなる配列を M_qm_domain に追加(delta_charge, tau_csc)
　　allocation も追加
2. CSC モジュールとのインターフェースとなる配列 gamma_csc のサイズを修正
3. subroutine set_CSC_parameters_geno を M_qm_geno に追加
4. set_CSC_parameters_geno で tau と initial_charge の値をセットする為に、M_qm_geno_Huckel に
 subroutine GetChemicalHardness と subroutine GetInitialCharge を追加
--------------------------------------------------------------------------------
